(window.webpackJsonp=window.webpackJsonp||[]).push([["2bbe1"],{"9Lt2":function(e,t,i){},I37g:function(e,t,i){"use strict";var r=i("lwsE"),n=i.n(r),s=i("W8MJ"),a=i.n(s),o=function(){function e(t,i,r){n()(this,e),this.player=t,this.pluginName="Plugin"}return a()(e,[{key:"safeInvoke",value:function(e){if(this.player&&this.player[e]){for(var t,i=arguments.length,r=new Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];(t=this.player)[e].apply(t,r)}}},{key:"log",value:function(){for(var e,t,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];null===(e=this.player)||void 0===e||null===(t=e.logger)||void 0===t||t.log.apply(t,[this.pluginName].concat(r))}}]),e}();t.a=o},IDdw:function(e,t,i){i("rvZc"),i("/SS/"),i("9VmF"),i("Vd3H"),i("FLlr"),i("RQRG"),i("mura"),i("FlsD"),i("xpiv"),i("3xty");var r=i("cDf5");/*! hy v 2006231631 */!function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==r(e)&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(n,s,function(t){return e[t]}.bind(null,s));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=90)}([function(e,t,i){"use strict";t.__esModule=!0,t.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t,i){"use strict";t.__esModule=!0;var r,n=(r=i(86))&&r.__esModule?r:{default:r};t.default=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,n.default)(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}()},function(e,t){var i=e.exports={version:"2.6.9"};"number"==typeof __e&&(__e=i)},function(e,t,i){var r=i(4),n=i(2),s=i(16),a=i(17),o=i(19),u=function e(t,i,u){var l,h,d,c=t&e.F,f=t&e.G,p=t&e.S,v=t&e.P,y=t&e.B,m=t&e.W,_=f?n:n[i]||(n[i]={}),S=_.prototype,g=f?r:p?r[i]:(r[i]||{}).prototype;for(l in f&&(u=i),u)(h=!c&&g&&void 0!==g[l])&&o(_,l)||(d=h?g[l]:u[l],_[l]=f&&"function"!=typeof g[l]?u[l]:y&&h?s(d,r):m&&g[l]==d?function(e){var t=function(t,i,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,i)}return new e(t,i,r)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(d):v&&"function"==typeof d?s(Function.call,d):d,v&&((_.virtual||(_.virtual={}))[l]=d,t&e.R&&S&&!S[l]&&a(S,l,d)))};u.F=1,u.G=2,u.S=4,u.P=8,u.B=16,u.W=32,u.U=64,u.R=128,e.exports=u},function(e,t){var i=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=i)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,n=(r=i(34))&&r.__esModule?r:{default:r},s=99;function a(e,t){var i=e.toString().length,r=Math.max(0,t-i),n="";if(r>0)for(var s=0;s<r;s++)n+="0";return n+e}function o(){var e=new Date;return e.getFullYear()+"-"+a(e.getMonth()+1,2)+"-"+a(e.getDate(),2)+" "+a(e.getHours(),2)+":"+a(e.getMinutes(),2)+":"+a(e.getSeconds(),2)+"."+a(e.getMilliseconds(),3)+" "}var u={_data:[],_length:0,debug:function(){var e=o(),t=Array.prototype.slice.call(arguments);t[0]=e+t[0],s<=-1&&console.log.apply(console,t)},log:function(e){var t=o(),i=Array.prototype.slice.call(arguments);i[0]=t+i[0],s<=0&&console.log.apply(console,i),u.record(i,"log")},info:function(e){var t=o(),i=Array.prototype.slice.call(arguments);i[0]=t+i[0],s<=1&&console.info.apply(console,i),u.record(i,"info")},warn:function(e){var t=o(),i=Array.prototype.slice.call(arguments);i[0]=t+i[0],s<=2&&console.warn.apply(console,i),u.record(i,"warn")},error:function(e){var t=o(),i=Array.prototype.slice.call(arguments);i[0]=t+i[0],s<=3&&console.error.apply(console,i),u.record(i,"error")},group:function(e){var t=o(),i=Array.prototype.slice.call(arguments);if(i[0]=t+i[0],s<=1){var r=console.groupCollapsed||console.group||console.log;r.apply(console,i)}u.record(i,"group")},groupEnd:function(){console.groupEnd&&console.groupEnd.apply(console)},setLevel:function(e){e!=s&&(console.log(o()+" set log level from "+s+" to "+e),s=e)},getLevel:function(){return s},record:function(e,t){1100===u._length&&(u._data.splice(0,100),u._length=1e3);var i=0,r=(e.shift()||"").toString();for(r=r.replace(/\%c/gi,(function(e,t){return i++,""}));i--&&e.length;)e.shift();for(var s=0,a=e.length;s<a;s++){var o=e[s];"object"==(void 0===o?"undefined":(0,n.default)(o))&&(e[s]="")}e.unshift(r);var l=e.join(" ");u._length++,u._data.push("["+t+"]"+l)},getLog:function(){return u._data}};t.default=u},function(e,t,i){var r=i(50)("wks"),n=i(32),s=i(4).Symbol,a="function"==typeof s;(e.exports=function(e){return r[e]||(r[e]=a&&s[e]||(a?s:n)("Symbol."+e))}).store=r},function(e,t){e.exports=function(e){return"object"==r(e)?null!==e:"function"==typeof e}},function(e,t,i){e.exports=!i(18)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},function(e,t,i){"use strict";t.__esModule=!0;var r,n=(r=i(34))&&r.__esModule?r:{default:r};t.default=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,n.default)(t))&&"function"!=typeof t?e:t}},function(e,t,i){"use strict";t.__esModule=!0;var r=a(i(111)),n=a(i(75)),s=a(i(34));function a(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,s.default)(t)));e.prototype=(0,n.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(r.default?(0,r.default)(e,t):e.__proto__=t)}},function(e,t,i){e.exports={default:i(150),__esModule:!0}},function(e,t,i){var r=i(13),n=i(63),s=i(44),a=Object.defineProperty;t.f=i(8)?Object.defineProperty:function(e,t,i){if(r(e),t=s(t,!0),r(i),n)try{return a(e,t,i)}catch(e){}if("get"in i||"set"in i)throw TypeError("Accessors not supported!");return"value"in i&&(e[t]=i.value),e}},function(e,t,i){var r=i(7);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},function(e,t,i){"use strict";var n,s="object"==("undefined"===typeof Reflect?"undefined":r(Reflect))?Reflect:null,a=s&&"function"==typeof s.apply?s.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)};n=s&&"function"==typeof s.ownKeys?s.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN||function(e){return e!=e};function u(){u.init.call(this)}e.exports=u,u.EventEmitter=u,u.prototype._events=void 0,u.prototype._eventsCount=0,u.prototype._maxListeners=void 0;var l=10;function h(e){return void 0===e._maxListeners?u.defaultMaxListeners:e._maxListeners}function d(e,t,i,n){var s,a,o,u;if("function"!=typeof i)throw new TypeError('The "listener" argument must be of type Function. Received type '+r(i));if(void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),a=e._events),o=a[t]),void 0===o)o=a[t]=i,++e._eventsCount;else if("function"==typeof o?o=a[t]=n?[i,o]:[o,i]:n?o.unshift(i):o.push(i),(s=h(e))>0&&o.length>s&&!o.warned){o.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=o.length,u=l,console&&console.warn&&console.warn(u)}return e}function c(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,a(this.listener,this.target,e))}function f(e,t,i){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},n=c.bind(r);return n.listener=i,r.wrapFn=n,n}function p(e,t,i){var r=e._events;if(void 0===r)return[];var n=r[t];return void 0===n?[]:"function"==typeof n?i?[n.listener||n]:[n]:i?function(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}(n):y(n,n.length)}function v(e){var t=this._events;if(void 0!==t){var i=t[e];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function y(e,t){for(var i=new Array(t),r=0;r<t;++r)i[r]=e[r];return i}Object.defineProperty(u,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");l=e}}),u.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},u.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},u.prototype.getMaxListeners=function(){return h(this)},u.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var r="error"===e,n=this._events;if(void 0!==n)r=r&&void 0===n.error;else if(!r)return!1;if(r){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var o=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw o.context=s,o}var u=n[e];if(void 0===u)return!1;if("function"==typeof u)a(u,this,t);else{var l=u.length,h=y(u,l);for(i=0;i<l;++i)a(h[i],this,t)}return!0},u.prototype.addListener=function(e,t){return d(this,e,t,!1)},u.prototype.on=u.prototype.addListener,u.prototype.prependListener=function(e,t){return d(this,e,t,!0)},u.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+r(t));return this.on(e,f(this,e,t)),this},u.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+r(t));return this.prependListener(e,f(this,e,t)),this},u.prototype.removeListener=function(e,t){var i,n,s,a,o;if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+r(t));if(void 0===(n=this._events))return this;if(void 0===(i=n[e]))return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(s=-1,a=i.length-1;a>=0;a--)if(i[a]===t||i[a].listener===t){o=i[a].listener,s=a;break}if(s<0)return this;0===s?i.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(i,s),1===i.length&&(n[e]=i[0]),void 0!==n.removeListener&&this.emit("removeListener",e,o||t)}return this},u.prototype.off=u.prototype.removeListener,u.prototype.removeAllListeners=function(e){var t,i,r;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[e]),this;if(0===arguments.length){var n,s=Object.keys(i);for(r=0;r<s.length;++r)"removeListener"!==(n=s[r])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},u.prototype.listeners=function(e){return p(this,e,!0)},u.prototype.rawListeners=function(e){return p(this,e,!1)},u.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):v.call(e,t)},u.prototype.listenerCount=v,u.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(i(0)),n=o(i(1)),s=o(i(22)),a=o(i(5));function o(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(){(0,r.default)(this,e)}return(0,n.default)(e,null,[{key:"getNetType",value:function(){var e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;if(e)if(e.effectiveType){if("4g"===e.effectiveType)return HUYA.EMediaNetType.ENET_4G;if("3g"===e.effectiveType)return HUYA.EMediaNetType.ENET_3G;if("2g"===e.effectiveType||"slow-2g"===e.effectiveType)return HUYA.EMediaNetType.ENET_2G}else if(e.type&&"wifi"===e.type)return HUYA.EMediaNetType.ENET_WIFI;return HUYA.EMediaNetType.ENET_UNKNOWN}}]),e}();u.appId=81,u.sHuYaUA="media_web&2006231631&",u.MediaUid=Math.floor(1e5*Math.random()+999999999),u.sUid="",u.sToken="",u.sCookie="",u.bAnonymous=0,u.config=null,u.deviceId="",u.netType=u.getNetType(),u.place=0,u.isLogin=function(){return 0!=u.MediaUid};var l=new HUYA.UserId;u.getUserId=function(){return l.lUid=u.MediaUid,l.sGuid=""!=u.deviceId?u.deviceId:s.default.getCookie("guid"),l.sToken=u.sToken,l.sHuYaUA=u.sHuYaUA,l.sCookie=document.cookie,l};var h=new HUYA.MediaUserId;u.getMediaUserId=function(){return h.lUid=u.MediaUid,h.sGuid=""!=u.deviceId?u.deviceId:s.default.getCookie("guid"),h.sToken=u.sToken,h.sUA=u.sHuYaUA,h.sCookie=u.sCookie,h.iAppid=u.appId,h.bAnonymous=u.bAnonymous,h.sStrUid=u.sUid,h.sUAppId=u.appId,h.iNetType=u.netType,h},u.app=null,u.emitOut=function(e,t,i){var r=u.app;r&&r.emit?r.emit(e,t,i):a.default.warn("Global.emitOut error.")},t.default=u},function(e,t,i){var r=i(23);e.exports=function(e,t,i){if(r(e),void 0===t)return e;switch(i){case 1:return function(i){return e.call(t,i)};case 2:return function(i,r){return e.call(t,i,r)};case 3:return function(i,r,n){return e.call(t,i,r,n)}}return function(){return e.apply(t,arguments)}}},function(e,t,i){var r=i(12),n=i(31);e.exports=i(8)?function(e,t,i){return r.f(e,t,n(1,i))}:function(e,t,i){return e[t]=i,e}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t){var i={}.hasOwnProperty;e.exports=function(e,t){return i.call(e,t)}},function(e,t,i){var r=i(45),n=i(46);e.exports=function(e){return r(n(e))}},function(e,t,i){var r=i(46);e.exports=function(e){return Object(r(e))}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=s(i(0)),n=s(i(1));function s(e){return e&&e.__esModule?e:{default:e}}var a=function(){function e(){(0,r.default)(this,e)}return(0,n.default)(e,null,[{key:"setCookie",value:function(e,t,i,r,n){var s=new Date;s.setTime(s.getTime()+24*i*60*60*1e3);var a=e+"="+t+"; expires="+s.toUTCString();r&&(a+="; domain="+r),n&&(a+="; path="+n),document.cookie=a}},{key:"setWholeCookie",value:function(e,t){var i=new Date;i.setTime(i.getTime()+24*t*60*60*1e3);var r="expires="+i.toUTCString();document.cookie=e+"; "+r}},{key:"setCompleteCookie",value:function(e){document.cookie=e}},{key:"getCookie",value:function(e){for(var t=e+"=",i=document.cookie.split(";"),r=0,n=i.length;r<n;r++){var s=i[r].trim();if(0==s.indexOf(t))return s.substr(t.length)}return""}},{key:"storeIps",value:function(t){for(var i="",r=e.getIpsKey(!0),n=t.join("|").toLocaleLowerCase(),s=0,a=n.length;s<a;s++){var o=r[n.charAt(s)],u=Math.random()*o.length>>0;i+=o.charAt(u)}localStorage.wssips=i}},{key:"getIps",value:function(){var t=localStorage.wssips;if(!t)return[];for(var i="",r=e.getIpsKey(!1),n=0,s=t.length;n<s;n++)i+=r[t.charAt(n)];return i.split("|")}},{key:"getIpsKey",value:function(e){for(var t=["-",".",":","|"],i="_N1Y%/ny^6?Mi7|wCe#$VmT=.GBut]3L*f<acX2Eop>d}WqKPQ@r;zx!s`(:IHFRZ~[A{Jb-O&D)v0Ukj95,8lg+h4S",r={},n=0;n<40;n++){var s=n<11?3:2,a=i.substr(0,s);i=i.substr(s);var o=n+"";if(n>13?o=String.fromCharCode(n+83):n>9&&(o=t[n-10]),e)r[o]=a;else for(var u=0;u<a.length;u++)r[a.charAt(u)]=o}return r}},{key:"logcss",value:function(e,t,i){var r="font-weight:900";return e&&(r+=";color:"+e),t&&(r+=";background:"+t),i&&(r+=";border:3px solid "+i),r}}]),e}();t.default=a},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,i){var r=i(64),n=i(51);e.exports=Object.keys||function(e){return r(e,n)}},function(e,t){var i={}.toString;e.exports=function(e){return i.call(e).slice(8,-1)}},function(e,t){e.exports=!0},function(e,t){e.exports={}},function(e,t,i){var r=i(12).f,n=i(19),s=i(6)("toStringTag");e.exports=function(e,t,i){e&&!n(e=i?e:e.prototype,s)&&r(e,s,{configurable:!0,value:t})}},function(e,t,i){var r=i(16),n=i(120),s=i(121),a=i(13),o=i(47),u=i(77),l={},h={};(t=e.exports=function(e,t,i,d,c){var f,p,v,y,m=c?function(){return e}:u(e),_=r(i,d,t?2:1),S=0;if("function"!=typeof m)throw TypeError(e+" is not iterable!");if(s(m)){for(f=o(e.length);f>S;S++)if((y=t?_(a(p=e[S])[0],p[1]):_(e[S]))===l||y===h)return y}else for(v=m.call(e);!(p=v.next()).done;)if((y=n(v,_,p.value,t))===l||y===h)return y}).BREAK=l,t.RETURN=h},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,n=(r=i(0))&&r.__esModule?r:{default:r},s=function e(){(0,n.default)(this,e)};s.WEBSOCKET_CONNECTED="WEBSOCKET_CONNECTED",s.WEBSOCKET_CLOSED="WEBSOCKET_CLOSED",s.WEBSOCKET_ERROR="WEBSOCKET_ERROR",s.SERVER_OPEN="SERVER_OPEN",s.SERVER_CLOSE="SERVER_CLOSE",s.SERVER_ERROR="SERVER_ERROR",s.SERVER_PROTO="SERVER_PROTO",s.SERVER_INITED="SERVER_INITED",s.SERVER_LOGIN="SERVER_LOGIN",s.SERVER_CFG_INITED="SERVER_CFG_INITED",s.UPDATE_STREAM_INFO="UPDATE_STREAM_INFO",s.UPDATE_STREAM_INFO_FAIL="UPDATE_STREAM_INFO_FAIL",s.ROOM_LIVE_END="ROOM_LIVE_END",s.MEDIA_STOPSTREAM_NOTICE="MEDIA_STOPSTREAM_NOTICE",s.MEDIA_STREAMCHANGED_NOTICE="MEDIA_STREAMCHANGED_NOTICE",t.default=s},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t){var i=0,r=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++i+r).toString(36))}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,i){"use strict";t.__esModule=!0;var n=o(i(100)),s=o(i(69)),a="function"==typeof s.default&&"symbol"==r(n.default)?function(e){return r(e)}:function(e){return e&&"function"==typeof s.default&&e.constructor===s.default&&e!==s.default.prototype?"symbol":r(e)};function o(e){return e&&e.__esModule?e:{default:e}}t.default="function"==typeof s.default&&"symbol"===a(n.default)?function(e){return void 0===e?"undefined":a(e)}:function(e){return e&&"function"==typeof s.default&&e.constructor===s.default&&e!==s.default.prototype?"symbol":void 0===e?"undefined":a(e)}},function(e,t,i){"use strict";var r=i(102)(!0);i(53)(String,"String",(function(e){this._t=String(e),this._i=0}),(function(){var e,t=this._t,i=this._i;return i>=t.length?{value:void 0,done:!0}:(e=r(t,i),this._i+=e.length,{value:e,done:!1})}))},function(e,t,i){var r=i(13),n=i(104),s=i(51),a=i(49)("IE_PROTO"),o=function(){},u=function(){var e,t=i(43)("iframe"),r=s.length;for(t.style.display="none",i(66).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),u=e.F;r--;)delete u.prototype[s[r]];return u()};e.exports=Object.create||function(e,t){var i;return null!==e?(o.prototype=r(e),i=new o,o.prototype=null,i[a]=e):i=u(),void 0===t?i:n(i,t)}},function(e,t,i){i(105);for(var r=i(4),n=i(17),s=i(27),a=i(6)("toStringTag"),o="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),u=0;u<o.length;u++){var l=o[u],h=r[l],d=h&&h.prototype;d&&!d[a]&&n(d,a,l),s[l]=s.Array}},function(e,t,i){t.f=i(6)},function(e,t){},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,n=(r=i(0))&&r.__esModule?r:{default:r},s=function e(){(0,n.default)(this,e)};s.GET_MEDIA_CONFIG="getMediaConfig",s.GET_INFO_FROM_VGM="getInfoFromVGM",s.CHECK_ID_BY_STR="checkIdByStr",s.LOGIN_VERIFY="loginVerify",s.REFRESH_COOKIE="refreshCookie",s.JOIN_GROUP="joinGroup",s.QUIT_GROUP="quitGroup",s.GET_STREAM_INFO_BY_ROOM="getStreamInfoByRoom",s.GET_STREAM_INFO_BY_STREAMNAME="getStreamInfoByStreamName",s.GET_STREAM_INFO_BY_ROOM_FAKE="getStreamInfoByRoomFake",t.default=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(i(0)),n=o(i(1)),s=o(i(15)),a=o(i(5));function o(e){return e&&e.__esModule?e:{default:e}}var u=new(function(){function e(){(0,r.default)(this,e)}return(0,n.default)(e,[{key:"setTaf",value:function(e){this.tafHandler=e}},{key:"onDataMetric2",value:function(e){var t=new HUYA.MetricDetailSet;t.tId=s.default.getUserId();var i=Date.now();for(var r in e)t.vMetricDetail.value.push(this.createDetail(e[r],i));this.tafHandler&&this.tafHandler.sendWup("metric","reportDetailV2",t)}},{key:"onNimoDataMetric2",value:function(e,t,i,r,n){var o=new HUYA.MetricDetailSet;o.tId=s.default.getUserId();var u=Date.now();for(var l in e)o.vMetricDetail.value.push(this.createDetail(e[l],u,t,i,r,n));this.tafHandler&&(a.default.log("%cmetric data:","color:#F9F900;background:gray",o),this.tafHandler.sendWup("metric","reportDetailV2",o,0,0,1))}},{key:"sendWupHttp",value:function(e,t,i){var r=new Taf.Wup;r.setServant(e),r.setFunc(t),r.writeStruct("tReq",i);var n,s=r.encode().getBuffer(),a=(new Date).getTime();n=ISDEBUG&&!localStorage.mytest?"//14.116.171.232:9998":G.useHttps?"https://statwup.huya.com":"//stat.wup.huya.com",Taf.Util.ajax(n+"?timestamp="+a,s,(function(e){console.log("http sucess")}),(function(e){console.warn("%c<http fail reqWup>","color:#FF6100",e)}))}},{key:"createDetail",value:function(e,t,i,r,n,s){var a=new HUYA.MetricDetail;return a.sMetricName=e.sMetricName,a.iTS=t,this.fillField(e.vField,a.vFiled.value,n),this.fillDimension(e.vDimension,a.vDimension.value,i,r,s),a}},{key:"fillField",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(e){for(var r in e){var n=new HUYA.Field;n.sName=r,n.fValue=e[r],t.push(n)}var s=new HUYA.Field;s.sName="appid",s.fValue="81";var a=new HUYA.Field;a.sName="videourl",a.fValue=i,t.push(s),t.push(a)}}},{key:"fillDimension",value:function(e,t,i,r){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a={anchoruid:i,line:n,coderate:r,coderatebps:1e3*r,h265:0,gameId:0,place_p:s.default.place,experiment:"default"};if(e)for(var o in e)a[o]=e[o];this.creatDimension(a,t)}},{key:"creatDimension",value:function(e,t){for(var i in e){var r=new HUYA.Dimension;r.sName=i,r.sValue=e[i],t.push(r)}}}]),e}());t.default=u},function(e,t,i){e.exports={default:i(94),__esModule:!0}},function(e,t,i){var r=i(7),n=i(4).document,s=r(n)&&r(n.createElement);e.exports=function(e){return s?n.createElement(e):{}}},function(e,t,i){var r=i(7);e.exports=function(e,t){if(!r(e))return e;var i,n;if(t&&"function"==typeof(i=e.toString)&&!r(n=i.call(e)))return n;if("function"==typeof(i=e.valueOf)&&!r(n=i.call(e)))return n;if(!t&&"function"==typeof(i=e.toString)&&!r(n=i.call(e)))return n;throw TypeError("Can't convert object to primitive value")}},function(e,t,i){var r=i(25);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,i){var r=i(48),n=Math.min;e.exports=function(e){return e>0?n(r(e),9007199254740991):0}},function(e,t){var i=Math.ceil,r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?r:i)(e)}},function(e,t,i){var r=i(50)("keys"),n=i(32);e.exports=function(e){return r[e]||(r[e]=n(e))}},function(e,t,i){var r=i(2),n=i(4),s=n["__core-js_shared__"]||(n["__core-js_shared__"]={});(e.exports=function(e,t){return s[e]||(s[e]=void 0!==t?t:{})})("versions",[]).push({version:r.version,mode:i(26)?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,i){"use strict";var r=i(26),n=i(3),s=i(65),a=i(17),o=i(27),u=i(103),l=i(28),h=i(67),d=i(6)("iterator"),c=!([].keys&&"next"in[].keys()),f=function(){return this};e.exports=function(e,t,i,p,v,y,m){u(i,t,p);var _,S,g,T=function(e){if(!c&&e in R)return R[e];switch(e){case"keys":case"values":return function(){return new i(this,e)}}return function(){return new i(this,e)}},E=t+" Iterator",I="values"==v,P=!1,R=e.prototype,k=R[d]||R["@@iterator"]||v&&R[v],L=k||T(v),A=v?I?T("entries"):L:void 0,w="Array"==t&&R.entries||k;if(w&&(g=h(w.call(new e)))!==Object.prototype&&g.next&&(l(g,E,!0),r||"function"==typeof g[d]||a(g,d,f)),I&&k&&"values"!==k.name&&(P=!0,L=function(){return k.call(this)}),r&&!m||!c&&!P&&R[d]||a(R,d,L),o[t]=L,o[E]=f,v)if(_={values:I?L:T("values"),keys:y?L:T("keys"),entries:A},m)for(S in _)S in R||s(R,S,_[S]);else n(n.P+n.F*(c||P),t,_);return _}},function(e,t,i){var n=i(32)("meta"),s=i(7),a=i(19),o=i(12).f,u=0,l=Object.isExtensible||function(){return!0},h=!i(18)((function(){return l(Object.preventExtensions({}))})),d=function(e){o(e,n,{value:{i:"O"+ ++u,w:{}}})},c=e.exports={KEY:n,NEED:!1,fastKey:function(e,t){if(!s(e))return"symbol"==r(e)?e:("string"==typeof e?"S":"P")+e;if(!a(e,n)){if(!l(e))return"F";if(!t)return"E";d(e)}return e[n].i},getWeak:function(e,t){if(!a(e,n)){if(!l(e))return!0;if(!t)return!1;d(e)}return e[n].w},onFreeze:function(e){return h&&c.NEED&&l(e)&&!a(e,n)&&d(e),e}}},function(e,t,i){var r=i(4),n=i(2),s=i(26),a=i(38),o=i(12).f;e.exports=function(e){var t=n.Symbol||(n.Symbol=s?{}:r.Symbol||{});"_"==e.charAt(0)||e in t||o(t,e,{value:a.f(e)})}},function(e,t,i){var r=i(17);e.exports=function(e,t,i){for(var n in t)i&&e[n]?e[n]=t[n]:r(e,n,t[n]);return e}},function(e,t){e.exports=function(e,t,i,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(i+": incorrect invocation!");return e}},function(e,t,i){var r=i(25),n=i(6)("toStringTag"),s="Arguments"==r(function(){return arguments}());e.exports=function(e){var t,i,a;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(i=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),n))?i:s?r(t):"Object"==(a=r(t))&&"function"==typeof t.callee?"Arguments":a}},function(e,t,i){"use strict";var r=i(23);function n(e){var t,i;this.promise=new e((function(e,r){if(void 0!==t||void 0!==i)throw TypeError("Bad Promise constructor");t=e,i=r})),this.resolve=r(t),this.reject=r(i)}e.exports.f=function(e){return new n(e)}},function(e,t,i){var r=i(3),n=i(2),s=i(18);e.exports=function(e,t){var i=(n.Object||{})[e]||Object[e],a={};a[e]=t(i),r(r.S+r.F*s((function(){i(1)})),"Object",a)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={TCP_OPEN:"TCP_OPEN",TCP_CLOSE:"TCP_CLOSE",TCP_ERROR:"TCP_ERROR",TCP_MESSAGE:"TCP_MESSAGE"}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={TAF_DECODE_SUCCESS:"TAF_DECODE_SUCCESS",TAF_DECODE_UNSUCCESS:"TAF_DECODE_UNSUCCESS"}},function(e,t,i){e.exports=!i(8)&&!i(18)((function(){return 7!=Object.defineProperty(i(43)("div"),"a",{get:function(){return 7}}).a}))},function(e,t,i){var r=i(19),n=i(20),s=i(97)(!1),a=i(49)("IE_PROTO");e.exports=function(e,t){var i,o=n(e),u=0,l=[];for(i in o)i!=a&&r(o,i)&&l.push(i);for(;t.length>u;)r(o,i=t[u++])&&(~s(l,i)||l.push(i));return l}},function(e,t,i){e.exports=i(17)},function(e,t,i){var r=i(4).document;e.exports=r&&r.documentElement},function(e,t,i){var r=i(19),n=i(21),s=i(49)("IE_PROTO"),a=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=n(e),r(e,s)?e[s]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?a:null}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,i){e.exports={default:i(107),__esModule:!0}},function(e,t,i){"use strict";var n=i(4),s=i(19),a=i(8),o=i(3),u=i(65),l=i(54).KEY,h=i(18),d=i(50),c=i(28),f=i(32),p=i(6),v=i(38),y=i(55),m=i(108),_=i(71),S=i(13),g=i(7),T=i(21),E=i(20),I=i(44),P=i(31),R=i(36),k=i(72),L=i(74),A=i(52),w=i(12),C=i(24),M=L.f,D=w.f,b=k.f,O=n.Symbol,N=n.JSON,F=N&&N.stringify,U=p("_hidden"),B=p("toPrimitive"),V={}.propertyIsEnumerable,x=d("symbol-registry"),H=d("symbols"),G=d("op-symbols"),Y=Object.prototype,W="function"==typeof O&&!!A.f,j=n.QObject,q=!j||!j.prototype||!j.prototype.findChild,K=a&&h((function(){return 7!=R(D({},"a",{get:function(){return D(this,"a",{value:7}).a}})).a}))?function(e,t,i){var r=M(Y,t);r&&delete Y[t],D(e,t,i),r&&e!==Y&&D(Y,t,r)}:D,J=function(e){var t=H[e]=R(O.prototype);return t._k=e,t},z=W&&"symbol"==r(O.iterator)?function(e){return"symbol"==r(e)}:function(e){return e instanceof O},X=function e(t,i,r){return t===Y&&e(G,i,r),S(t),i=I(i,!0),S(r),s(H,i)?(r.enumerable?(s(t,U)&&t[U][i]&&(t[U][i]=!1),r=R(r,{enumerable:P(0,!1)})):(s(t,U)||D(t,U,P(1,{})),t[U][i]=!0),K(t,i,r)):D(t,i,r)},Q=function(e,t){S(e);for(var i,r=m(t=E(t)),n=0,s=r.length;s>n;)X(e,i=r[n++],t[i]);return e},Z=function(e){var t=V.call(this,e=I(e,!0));return!(this===Y&&s(H,e)&&!s(G,e))&&(!(t||!s(this,e)||!s(H,e)||s(this,U)&&this[U][e])||t)},$=function(e,t){if(e=E(e),t=I(t,!0),e!==Y||!s(H,t)||s(G,t)){var i=M(e,t);return!i||!s(H,t)||s(e,U)&&e[U][t]||(i.enumerable=!0),i}},ee=function(e){for(var t,i=b(E(e)),r=[],n=0;i.length>n;)s(H,t=i[n++])||t==U||t==l||r.push(t);return r},te=function(e){for(var t,i=e===Y,r=b(i?G:E(e)),n=[],a=0;r.length>a;)!s(H,t=r[a++])||i&&!s(Y,t)||n.push(H[t]);return n};W||(u((O=function(){if(this instanceof O)throw TypeError("Symbol is not a constructor!");var e=f(arguments.length>0?arguments[0]:void 0),t=function t(i){this===Y&&t.call(G,i),s(this,U)&&s(this[U],e)&&(this[U][e]=!1),K(this,e,P(1,i))};return a&&q&&K(Y,e,{configurable:!0,set:t}),J(e)}).prototype,"toString",(function(){return this._k})),L.f=$,w.f=X,i(73).f=k.f=ee,i(33).f=Z,A.f=te,a&&!i(26)&&u(Y,"propertyIsEnumerable",Z,!0),v.f=function(e){return J(p(e))}),o(o.G+o.W+o.F*!W,{Symbol:O});for(var ie="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),re=0;ie.length>re;)p(ie[re++]);for(var ne=C(p.store),se=0;ne.length>se;)y(ne[se++]);o(o.S+o.F*!W,"Symbol",{for:function(e){return s(x,e+="")?x[e]:x[e]=O(e)},keyFor:function(e){if(!z(e))throw TypeError(e+" is not a symbol!");for(var t in x)if(x[t]===e)return t},useSetter:function(){q=!0},useSimple:function(){q=!1}}),o(o.S+o.F*!W,"Object",{create:function(e,t){return void 0===t?R(e):Q(R(e),t)},defineProperty:X,defineProperties:Q,getOwnPropertyDescriptor:$,getOwnPropertyNames:ee,getOwnPropertySymbols:te});var ae=h((function(){A.f(1)}));o(o.S+o.F*ae,"Object",{getOwnPropertySymbols:function(e){return A.f(T(e))}}),N&&o(o.S+o.F*(!W||h((function(){var e=O();return"[null]"!=F([e])||"{}"!=F({a:e})||"{}"!=F(Object(e))}))),"JSON",{stringify:function(e){for(var t,i,r=[e],n=1;arguments.length>n;)r.push(arguments[n++]);if(i=t=r[1],(g(t)||void 0!==e)&&!z(e))return _(t)||(t=function(e,t){if("function"==typeof i&&(t=i.call(this,e,t)),!z(t))return t}),r[1]=t,F.apply(N,r)}}),O.prototype[B]||i(17)(O.prototype,B,O.prototype.valueOf),c(O,"Symbol"),c(Math,"Math",!0),c(n.JSON,"JSON",!0)},function(e,t,i){var r=i(25);e.exports=Array.isArray||function(e){return"Array"==r(e)}},function(e,t,i){var n=i(20),s=i(73).f,a={}.toString,o="object"==("undefined"===typeof window?"undefined":r(window))&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return o&&"[object Window]"==a.call(e)?function(e){try{return s(e)}catch(e){return o.slice()}}(e):s(n(e))}},function(e,t,i){var r=i(64),n=i(51).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,n)}},function(e,t,i){var r=i(33),n=i(31),s=i(20),a=i(44),o=i(19),u=i(63),l=Object.getOwnPropertyDescriptor;t.f=i(8)?l:function(e,t){if(e=s(e),t=a(t,!0),u)try{return l(e,t)}catch(e){}if(o(e,t))return n(!r.f.call(e,t),e[t])}},function(e,t,i){e.exports={default:i(115),__esModule:!0}},function(e,t,i){e.exports={default:i(117),__esModule:!0}},function(e,t,i){var r=i(58),n=i(6)("iterator"),s=i(27);e.exports=i(2).getIteratorMethod=function(e){if(null!=e)return e[n]||e["@@iterator"]||s[r(e)]}},function(e,t,i){"use strict";var r=i(4),n=i(2),s=i(12),a=i(8),o=i(6)("species");e.exports=function(e){var t="function"==typeof n[e]?n[e]:r[e];a&&t&&!t[o]&&s.f(t,o,{configurable:!0,get:function(){return this}})}},function(e,t,i){var r=i(7);e.exports=function(e,t){if(!r(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},function(e,t,i){e.exports={default:i(133),__esModule:!0}},function(e,t,i){e.exports={default:i(135),__esModule:!0}},function(e,t,i){var r=i(13),n=i(23),s=i(6)("species");e.exports=function(e,t){var i,a=r(e).constructor;return void 0===a||null==(i=r(a)[s])?t:n(i)}},function(e,t,i){var r,n,s,a=i(16),o=i(139),u=i(66),l=i(43),h=i(4),d=h.process,c=h.setImmediate,f=h.clearImmediate,p=h.MessageChannel,v=h.Dispatch,y=0,m={},_=function(){var e=+this;if(m.hasOwnProperty(e)){var t=m[e];delete m[e],t()}},S=function(e){_.call(e.data)};c&&f||(c=function(e){for(var t=[],i=1;arguments.length>i;)t.push(arguments[i++]);return m[++y]=function(){o("function"==typeof e?e:Function(e),t)},r(y),y},f=function(e){delete m[e]},"process"==i(25)(d)?r=function(e){d.nextTick(a(_,e,1))}:v&&v.now?r=function(e){v.now(a(_,e,1))}:p?(s=(n=new p).port2,n.port1.onmessage=S,r=a(s.postMessage,s,1)):h.addEventListener&&"function"==typeof postMessage&&!h.importScripts?(r=function(e){h.postMessage(e+"","*")},h.addEventListener("message",S,!1)):r="onreadystatechange"in l("script")?function(e){u.appendChild(l("script")).onreadystatechange=function(){u.removeChild(this),_.call(e)}}:function(e){setTimeout(a(_,e,1),0)}),e.exports={set:c,clear:f}},function(e,t){e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},function(e,t,i){var r=i(13),n=i(7),s=i(59);e.exports=function(e,t){if(r(e),n(t)&&t.constructor===e)return t;var i=s.f(e);return(0,i.resolve)(t),i.promise}},function(e,t,i){e.exports={default:i(145),__esModule:!0}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={kMediaPackTypeStreamChangeNotice:1e5,kMediaPackTypeMediaStopStream:100102,kMediaPackTypeMediaChgUpStream:100200,kMediaPackTypeRoomStreamChangeNotice:100300}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,n=(r=i(0))&&r.__esModule?r:{default:r},s=function e(){(0,n.default)(this,e)};s.VIDEO_ERROR="VIDEO_ERROR",s.VIDEO_FRAME_LOADED="VIDEO_FRAME_LOADED",s.VIDEO_PLAY="VIDEO_PLAY",s.VIDEO_STOP="VIDEO_STOP",s.VIDEO_SEEK="VIDEO_SEEK",s.ANCHOR_STOP="ANCHOR_STOP",s.PLAY_STATUS="PLAY_STATUS",s.PLAY_DOWNLINK_INFO="PLAY_DOWNLINK_INFO",s.PLAY_TIME="PLAY_TIME",s.LINK_TIMEOUT="LINK_TIMEOUT",s.LOAD_DATA_TIMEOUT="LOAD_DATA_TIMEOUT",s.LINK_UNAVAILABLE="LINK_UNAVAILABLE",s.NO_DATA_RECEIVED="NO_DATA_RECEIVED",s.VIDEO_CLOSE="VIDEO_CLOSE",s.METADATA="METADATA",s.VIDEO_FRAME_JITTERBUFFER="VIDEO_FRAME_JITTERBUFFER",s.MEDIA_STREAMSTOP_NOTICE="MEDIA_STREAMSTOP_NOTICE",s.ROOM_STREAM_CHANGE="ROOM_STREAM_CHANGE",s.ROOM_NO_STREAM="ROOM_NO_STREAM",s.MEDIA_STREAM_UPDATE="MEDIA_STREAM_UPDATE",s.MEDIA_STREAM_INFO_ERROR="MEDIA_STREAM_INFO_ERROR",t.default=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=u(i(80)),n=u(i(42)),s=u(i(76)),a=u(i(0)),o=u(i(1));function u(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(){(0,a.default)(this,e),this.comDim=new s.default,this.coreDim=new s.default,this.actDim=new s.default,this.extDim=new s.default,this.coreMap=new s.default,this.compMap=new s.default,this.heart_type=0}return(0,o.default)(e,[{key:"reset",value:function(){this.comDim.clear(),this.coreDim.clear(),this.actDim.clear(),this.extDim.clear(),this.coreMap.clear(),this.compMap.clear(),this.heart_type=0}},{key:"createAct",value:function(e,t){return this._createAct(e,t)}},{key:"createActs",value:function(e){var t=[];if(e)for(var i=0;i<e.length;i++){var r=e[i],n=this._createAct(r.type,r.params);t.push(n)}return t}},{key:"_createAct",value:function(e,t){var i={sMetricName:"yspwl.web.live.user.act",vField:{},vDimension:{}};if(i.vDimension.act_type=e,this._fillFromMap(i.vDimension,this.comDim),this._fillFromMap(i.vDimension,this.actDim),t){var r=0;if(t.hasOwnProperty("value")){var s=t.value;for(r=0;r<s.length;r++)i.vField["value"+(r+1)]=s[r]}if(t.hasOwnProperty("str")){var a=t.str;for(r=0;r<a.length;r++)i.vDimension["str"+(r+1)]=a[r]}t.hasOwnProperty("dim")&&(0,n.default)(i.vDimension,t.dim)}return this.actDim.clear(),i}},{key:"fill",value:function(e,t){t?(this.heart_type=2,this._fill(e)):this._fill(e)}},{key:"_fill",value:function(e){if(0!=this.coreMap.size||0!=this.compMap.size){var t={sMetricName:"yspwl.web.live.user.heart20",vField:{},vDimension:{},vExLog:{}};this.coreDim.set("heart_type",this.heart_type),this._fillFromMap(t.vDimension,this.comDim),this._fillFromMap(t.vDimension,this.coreDim),this._fillFromMap(t.vExLog,this.extDim),this._fillFromMap(t.vField,this.coreMap),this._fillComp(t.vDimension),this.coreDim.clear(),this.extDim.clear(),this.coreMap.clear(),this.compMap.clear(),0==this.heart_type&&(this.heart_type=1),e.push(t)}}},{key:"_fillComp",value:function(e){var t=!0,i=!1,n=void 0;try{for(var s,a=(0,r.default)(this.compMap.keys());!(t=(s=a.next()).done);t=!0){var o=s.value,u=this.compMap.get(o),l="",h=!0,d=!1,c=void 0;try{for(var f,p=(0,r.default)(u.keys());!(h=(f=p.next()).done);h=!0){var v=f.value;l.length>0&&(l+=";"),l+=v+","+u.get(v)}}catch(e){d=!0,c=e}finally{try{!h&&p.return&&p.return()}finally{if(d)throw c}}e[o]=l}}catch(e){i=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw n}}}},{key:"_fillFromMap",value:function(e,t){var i=!0,n=!1,s=void 0;try{for(var a,o=(0,r.default)(t.keys());!(i=(a=o.next()).done);i=!0){var u=a.value;e[u]=t.get(u)}}catch(e){n=!0,s=e}finally{try{!i&&o.return&&o.return()}finally{if(n)throw s}}}},{key:"setComDim",value:function(e,t){this.comDim.set(e,t)}},{key:"setCoreDim",value:function(e,t){this.coreDim.set(e,t)}},{key:"setActDim",value:function(e,t){this.actDim.set(e,t)}},{key:"setExtDim",value:function(e,t){this.extDim.set(e,t)}},{key:"delDim",value:function(e){this.comDim.has(e)?this.comDim.delete(e):this.coreDim.has(e)?this.coreDim.delete(e):this.actDim.has(e)&&this.actDim.delete(e)}},{key:"setCore",value:function(e,t){this.coreMap.set(e,t)}},{key:"addCore",value:function(e,t){this._addValue(this.coreMap,e,t)}},{key:"setComp",value:function(e,t,i){this._getCompMap(e).set(t,i)}},{key:"addComp",value:function(e,t,i){var r=this._getCompMap(e);this._addValue(r,t,i)}},{key:"_getCompMap",value:function(e){if(this.compMap.has(e))return this.compMap.get(e);var t=new s.default;return this.compMap.set(e,t),t}},{key:"_addValue",value:function(e,t,i){if(e.has(t)){var r=e.get(t);e.set(t,r+i)}else e.set(t,i)}}]),e}();t.default=l},function(e,t,i){i(91),i(92),i(93),i(99),e.exports=i(162)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=window.Taf||{};window.Taf=r,t.default=r,r.INT8=function(){this._clone=function(){return 0},this._write=function(e,t,i){return e.writeInt8(t,i)},this._read=function(e,t,i){return e.readInt8(t,!0,i)},this._className=function(){return r.CHAR}},r.INT16=function(){this._clone=function(){return 0},this._write=function(e,t,i){return e.writeInt16(t,i)},this._read=function(e,t,i){return e.readInt16(t,!0,i)},this._className=function(){return r.SHORT}},r.INT32=function(){this._clone=function(){return 0},this._write=function(e,t,i){return e.writeInt32(t,i)},this._read=function(e,t,i){return e.readInt32(t,!0,i)},this._className=function(){return r.INT32}},r.INT64=function(){this._clone=function(){return 0},this._write=function(e,t,i){return e.writeInt64(t,i)},this._read=function(e,t,i){return e.readInt64(t,!0,i)},this._className=function(){return r.INT64}},r.UINT8=function(){this._clone=function(){return 0},this._write=function(e,t,i){return e.writeInt16(t,i)},this._read=function(e,t,i){return e.readInt16(t,!0,i)},this._className=function(){return r.SHORT}},r.UInt16=function(){this._clone=function(){return 0},this._write=function(e,t,i){return e.writeInt32(t,i)},this._read=function(e,t,i){return e.readInt32(t,!0,i)},this._className=function(){return r.INT32}},r.UInt32=function(){this._clone=function(){return 0},this._write=function(e,t,i){return e.writeInt64(t,i)},this._read=function(e,t,i){return e.readInt64(t,!0,i)},this._className=function(){return r.INT64}},r.Float=function(){this._clone=function(){return 0},this._write=function(e,t,i){return e.writeFloat(t,i)},this._read=function(e,t,i){return e.readFloat(t,!0,i)},this._className=function(){return r.FLOAT}},r.Double=function(){this._clone=function(){return 0},this._write=function(e,t,i){return e.writeDouble(t,i)},this._read=function(e,t,i){return e.readDouble(t,!0,i)},this._className=function(){return r.DOUBLE}},r.STRING=function(){this._clone=function(){return 0},this._write=function(e,t,i){return e.writeString(t,i)},this._read=function(e,t,i){return e.readString(t,!0,i)},this._className=function(){return r.STRING}},r.BOOLEAN=function(){this._clone=function(){return!1},this._write=function(e,t,i){return e.writeBoolean(t,i)},this._read=function(e,t,i){return e.readBoolean(t,!0,i)},this._className=function(){return r.BOOLEAN}},r.ENUM=function(){this._clone=function(){return 0},this._write=function(e,t,i){return e.writeInt32(t,i)},this._read=function(e,t,i){return e.readInt32(t,!0,i)}},r.Vector=function(e){this.proto=e,this.value=new Array},r.Vector.prototype._clone=function(){return new r.Vector(this.proto)},r.Vector.prototype._write=function(e,t,i){return e.writeVector(t,i)},r.Vector.prototype._read=function(e,t,i){return e.readVector(t,!0,i)},r.Vector.prototype._className=function(){return r.TypeHelp.VECTOR.replace("$t",this.proto._className())},r.Map=function(e,t){this.kproto=e,this.vproto=t,this.value=new Object},r.Map.prototype._clone=function(){return new r.Map(this.kproto,this.vproto)},r.Map.prototype._write=function(e,t,i){return e.writeMap(t,i)},r.Map.prototype._read=function(e,t,i){return e.readMap(t,!0,i)},r.Map.prototype.put=function(e,t){this.value[e]=t},r.Map.prototype.get=function(e){return this.value[e]},r.Map.prototype.getKeys=function(){var e=[];for(var t in this.value)""!=t&&e.push(t);return e},r.Map.prototype.hasKey=function(e){return this.value.hasOwnProperty(e)},r.Map.prototype.remove=function(e){delete this.value[e]},r.Map.prototype.clear=function(){this.value=new Object},r.Map.prototype.size=function(){var e=0;for(var t in this.value)e++;return e},r.Vector.prototype._className=function(){return r.TypeHelp.Map.replace("$k",this.kproto._className()).replace("$v",this.vproto._className())},r.DataHelp={EN_INT8:0,EN_INT16:1,EN_INT32:2,EN_INT64:3,EN_FLOAT:4,EN_DOUBLE:5,EN_STRING1:6,EN_STRING4:7,EN_MAP:8,EN_LIST:9,EN_STRUCTBEGIN:10,EN_STRUCTEND:11,EN_ZERO:12,EN_SIMPLELIST:13},r.TypeHelp={BOOLEAN:"bool",CHAR:"char",SHORT:"short",INT32:"int32",INT64:"int64",FLOAT:"float",DOUBLE:"double",STRING:"string",VECTOR:"list<$t>",MAP:"map<$k, $v>"},r.BinBuffer=function(e){this.buf=null,this.vew=null,this.len=0,this.position=0,null!=e&&null!=e&&(e instanceof ArrayBuffer?(this.buf=e,this.vew=new DataView(this.buf),this.len=this.vew.byteLength,this.position=0):(this.buf=e.buf,this.vew=new DataView(this.buf),this.len=e.length,this.position=e.position)),this.__defineGetter__("length",(function(){return this.len})),this.__defineGetter__("buffer",(function(){return this.buf}))},r.BinBuffer.prototype._write=function(e,t,i){return e.writeBytes(t,i)},r.BinBuffer.prototype._read=function(e,t,i){return e.readBytes(t,!0,i)},r.BinBuffer.prototype._clone=function(){return new r.BinBuffer},r.BinBuffer.prototype.allocate=function(e){if(e=this.position+e,!(null!=this.buf&&this.buf.length>e)){var t=new ArrayBuffer(Math.max(256,2*e));null!=this.buf&&(new Uint8Array(t).set(new Uint8Array(this.buf)),this.buf=void 0),this.buf=t,this.vew=void 0,this.vew=new DataView(this.buf)}},r.BinBuffer.prototype.getBuffer=function(){var e=new ArrayBuffer(this.len);return new Uint8Array(e).set(new Uint8Array(this.buf,0,this.len)),e},r.BinBuffer.prototype.memset=function(e,t,i){this.allocate(i),new Uint8Array(this.buf).set(new Uint8Array(e,t,i),this.position)},r.BinBuffer.prototype.writeInt8=function(e){this.allocate(1),this.vew.setInt8(this.position,e),this.position+=1,this.len=this.position},r.BinBuffer.prototype.writeUInt8=function(e){this.allocate(1),this.vew.setUint8(this.position++,e),this.len=this.position},r.BinBuffer.prototype.writeInt16=function(e){this.allocate(2),this.vew.setInt16(this.position,e),this.position+=2,this.len=this.position},r.BinBuffer.prototype.writeUInt16=function(e){this.allocate(2),this.vew.setUint16(this.position,e),this.position+=2,this.len=this.position},r.BinBuffer.prototype.writeInt32=function(e){this.allocate(4),this.vew.setInt32(this.position,e),this.position+=4,this.len=this.position},r.BinBuffer.prototype.writeUInt32=function(e){this.allocate(4),this.vew.setUint32(this.position,e),this.position+=4,this.len=this.position},r.BinBuffer.prototype.writeInt64=function(e){this.allocate(8),this.vew.setUint32(this.position,parseInt(e/4294967296)),this.vew.setUint32(this.position+4,e%4294967296),this.position+=8,this.len=this.position},r.BinBuffer.prototype.writeFloat=function(e){this.allocate(4),this.vew.setFloat32(this.position,e),this.position+=4,this.len=this.position},r.BinBuffer.prototype.writeDouble=function(e){this.allocate(8),this.vew.setFloat64(this.position,e),this.position+=8,this.len=this.position},r.BinBuffer.prototype.writeString=function(e){for(var t=[],i=0;i<e.length;i++)t.push(255&e.charCodeAt(i));this.allocate(t.length),new Uint8Array(this.buf).set(new Uint8Array(t),this.position),this.position+=t.length,this.len=this.position},r.BinBuffer.prototype.writeBytes=function(e){0!=e.length&&null!=e.buf&&(this.allocate(e.length),new Uint8Array(this.buf).set(new Uint8Array(e.buf,0,e.length),this.position),this.position+=e.length,this.len=this.position)},r.BinBuffer.prototype.readInt8=function(){return this.vew.getInt8(this.position++)},r.BinBuffer.prototype.readInt16=function(){return this.position+=2,this.vew.getInt16(this.position-2)},r.BinBuffer.prototype.readInt32=function(){return this.position+=4,this.vew.getInt32(this.position-4)},r.BinBuffer.prototype.readUInt8=function(){return this.position+=1,this.vew.getUint8(this.position-1)},r.BinBuffer.prototype.readUInt16=function(){return this.position+=2,this.vew.getUint16(this.position-2)},r.BinBuffer.prototype.readUInt32=function(){return this.position+=4,this.vew.getUint32(this.position-4)},r.BinBuffer.prototype.readInt64=function(){var e=this.vew.getUint32(this.position),t=this.vew.getUint32(this.position+4);return this.position+=8,4294967296*e+t},r.BinBuffer.prototype.readFloat=function(){var e=this.vew.getFloat32(this.position);return this.position+=4,e},r.BinBuffer.prototype.readDouble=function(){var e=this.vew.getFloat64(this.position);return this.position+=8,e},r.BinBuffer.prototype.readString=function(e){for(var t=[],i=0;i<e;i++)t.push(String.fromCharCode(this.vew.getUint8(this.position++)));var r=t.join("");try{r=decodeURIComponent(escape(r))}catch(e){}return r},r.BinBuffer.prototype.readBytes=function(e){var t=new r.BinBuffer;return t.allocate(e),t.memset(this.buf,this.position,e),t.position=0,t.len=e,this.position=this.position+e,t},r.JceOutputStream=function(){this.buf=new r.BinBuffer,this.getBinBuffer=function(){return this.buf},this.getBuffer=function(){return this.buf.getBuffer()}},r.JceOutputStream.prototype.clear=function(){return this.buf=new r.BinBuffer,this},r.JceOutputStream.prototype.writeTo=function(e,t){e<15?this.buf.writeUInt8(e<<4&240|t):this.buf.writeUInt16((240|t)<<8|e)},r.JceOutputStream.prototype.writeBoolean=function(e,t){this.writeInt8(e,1==t?1:0)},r.JceOutputStream.prototype.writeInt8=function(e,t){0==t?this.writeTo(e,r.DataHelp.EN_ZERO):(this.writeTo(e,r.DataHelp.EN_INT8),this.buf.writeInt8(t))},r.JceOutputStream.prototype.writeInt16=function(e,t){t>=-128&&t<=127?this.writeInt8(e,t):(this.writeTo(e,r.DataHelp.EN_INT16),this.buf.writeInt16(t))},r.JceOutputStream.prototype.writeInt32=function(e,t){t>=-32768&&t<=32767?this.writeInt16(e,t):(this.writeTo(e,r.DataHelp.EN_INT32),this.buf.writeInt32(t))},r.JceOutputStream.prototype.writeInt64=function(e,t){t>=-2147483648&&t<=2147483647?this.writeInt32(e,t):(this.writeTo(e,r.DataHelp.EN_INT64),this.buf.writeInt64(t))},r.JceOutputStream.prototype.writeUInt8=function(e,t){this.writeInt16(e,t)},r.JceOutputStream.prototype.writeUInt16=function(e,t){this.writeInt32(e,t)},r.JceOutputStream.prototype.writeUInt32=function(e,t){this.writeInt64(e,t)},r.JceOutputStream.prototype.writeFloat=function(e,t){0==t?this.writeTo(e,r.DataHelp.EN_ZERO):(this.writeTo(e,r.DataHelp.EN_FLOAT),this.buf.writeFloat(t))},r.JceOutputStream.prototype.writeDouble=function(e,t){0==t?this.writeTo(e,r.DataHelp.EN_ZERO):(this.writeTo(e,r.DataHelp.EN_DOUBLE),this.buf.writeDouble(t))},r.JceOutputStream.prototype.writeStruct=function(e,t){if(null==t.writeTo)throw Error("not defined writeTo Function");this.writeTo(e,r.DataHelp.EN_STRUCTBEGIN),t.writeTo(this),this.writeTo(0,r.DataHelp.EN_STRUCTEND)},r.JceOutputStream.prototype.writeString=function(e,t){var i=t;try{i=unescape(encodeURIComponent(i))}catch(e){}i.length>255?(this.writeTo(e,r.DataHelp.EN_STRING4),this.buf.writeUInt32(i.length)):(this.writeTo(e,r.DataHelp.EN_STRING1),this.buf.writeUInt8(i.length)),this.buf.writeString(i)},r.JceOutputStream.prototype.writeBytes=function(e,t){this.writeTo(e,r.DataHelp.EN_SIMPLELIST),this.writeTo(0,r.DataHelp.EN_INT8),this.writeInt32(0,t.length),this.buf.writeBytes(t)},r.JceOutputStream.prototype.writeVector=function(e,t){this.writeTo(e,r.DataHelp.EN_LIST),this.writeInt32(0,t.value.length);for(var i=0;i<t.value.length;i++)t.proto._write(this,0,t.value[i])},r.JceOutputStream.prototype.writeMap=function(e,t){for(var i in this.writeTo(e,r.DataHelp.EN_MAP),this.writeInt32(0,t.size()),t.value)t.kproto._write(this,0,i),t.vproto._write(this,1,t.value[i])},r.JceInputStream=function(e){this.buf=new r.BinBuffer(e)},r.JceInputStream.prototype.setBuffer=function(e){return this.buf=new r.BinBuffer(e),this},r.JceInputStream.prototype.readFrom=function(){var e=this.buf.readUInt8(),t=(240&e)>>4,i=15&e;return t>=15&&(t=this.buf.readUInt8()),{tag:t,type:i}},r.JceInputStream.prototype.peekFrom=function(){var e=this.buf.position,t=this.readFrom();return this.buf.position=e,{tag:t.tag,type:t.type,size:t.tag>=15?2:1}},r.JceInputStream.prototype.skipField=function(e){switch(e){case r.DataHelp.EN_INT8:this.buf.position+=1;break;case r.DataHelp.EN_INT16:this.buf.position+=2;break;case r.DataHelp.EN_INT32:this.buf.position+=4;break;case r.DataHelp.EN_INT64:this.buf.position+=8;break;case r.DataHelp.EN_STRING1:var t=this.buf.readUInt8();this.buf.position+=t;break;case r.DataHelp.EN_STRING4:var i=this.buf.readInt32();this.buf.position+=i;break;case r.DataHelp.EN_STRUCTBEGIN:this.skipToStructEnd();break;case r.DataHelp.EN_STRUCTEND:case r.DataHelp.EN_ZERO:break;case r.DataHelp.EN_MAP:for(var n=this.readInt32(0,!0),s=0;s<2*n;++s){var a=this.readFrom();this.skipField(a.type)}break;case r.DataHelp.EN_SIMPLELIST:if((a=this.readFrom()).type!=r.DataHelp.EN_INT8)throw Error("skipField with invalid type, type value: "+e+","+a.type);t=this.readInt32(0,!0),this.buf.position+=t;break;case r.DataHelp.EN_LIST:for(n=this.readInt32(0,!0),s=0;s<n;++s)a=this.readFrom(),this.skipField(a.type);break;default:throw new Error("skipField with invalid type, type value: "+e)}},r.JceInputStream.prototype.skipToStructEnd=function(){for(;;){var e=this.readFrom();if(this.skipField(e.type),e.type==r.DataHelp.EN_STRUCTEND)return}},r.JceInputStream.prototype.skipToTag=function(e,t){for(;this.buf.position<this.buf.length;){var i=this.peekFrom();if(e<=i.tag||i.type==r.DataHelp.EN_STRUCTEND)return i.type!=r.DataHelp.EN_STRUCTEND&&e==i.tag;this.buf.position+=i.size,this.skipField(i.type)}if(t)throw Error("require field not exist, tag:"+e);return!1},r.JceInputStream.prototype.readBoolean=function(e,t,i){return 1==this.readInt8(e,t,i)},r.JceInputStream.prototype.readInt8=function(e,t,i){if(0==this.skipToTag(e,t))return i;var n=this.readFrom();switch(n.type){case r.DataHelp.EN_ZERO:return 0;case r.DataHelp.EN_INT8:return this.buf.readInt8()}throw Error("read int8 type mismatch, tag:"+e+", get type:"+n.type)},r.JceInputStream.prototype.readInt16=function(e,t,i){if(0==this.skipToTag(e,t))return i;var n=this.readFrom();switch(n.type){case r.DataHelp.EN_ZERO:return 0;case r.DataHelp.EN_INT8:return this.buf.readInt8();case r.DataHelp.EN_INT16:return this.buf.readInt16()}throw Error("read int8 type mismatch, tag:"+e+", get type:"+n.type)},r.JceInputStream.prototype.readInt32=function(e,t,i){if(0==this.skipToTag(e,t))return i;var n=this.readFrom();switch(n.type){case r.DataHelp.EN_ZERO:return 0;case r.DataHelp.EN_INT8:return this.buf.readInt8();case r.DataHelp.EN_INT16:return this.buf.readInt16();case r.DataHelp.EN_INT32:return this.buf.readInt32()}throw Error("read int8 type mismatch, tag:"+e+", get type:"+n.type)},r.JceInputStream.prototype.readInt64=function(e,t,i){if(0==this.skipToTag(e,t))return i;switch(this.readFrom().type){case r.DataHelp.EN_ZERO:return 0;case r.DataHelp.EN_INT8:return this.buf.readInt8();case r.DataHelp.EN_INT16:return this.buf.readInt16();case r.DataHelp.EN_INT32:return this.buf.readInt32();case r.DataHelp.EN_INT64:return this.buf.readInt64()}throw Error("read int64 type mismatch, tag:"+e+", get type:"+h.type)},r.JceInputStream.prototype.readFloat=function(e,t,i){if(0==this.skipToTag(e,t))return i;switch(this.readFrom().type){case r.DataHelp.EN_ZERO:return 0;case r.DataHelp.EN_FLOAT:return this.buf.readFloat()}throw Error("read float type mismatch, tag:"+e+", get type:"+h.type)},r.JceInputStream.prototype.readDouble=function(e,t,i){if(0==this.skipToTag(e,t))return i;switch(this.readFrom().type){case r.DataHelp.EN_ZERO:return 0;case r.DataHelp.EN_DOUBLE:return this.buf.readDouble()}throw Error("read double type mismatch, tag:"+e+", get type:"+h.type)},r.JceInputStream.prototype.readUInt8=function(e,t,i){return this.readInt16(e,t,i)},r.JceInputStream.prototype.readUInt16=function(e,t,i){return this.readInt32(e,t,i)},r.JceInputStream.prototype.readUInt32=function(e,t,i){return this.readInt64(e,t,i)},r.JceInputStream.prototype.readStruct=function(e,t,i){if(0==this.skipToTag(e,t))return i;var n=this.readFrom();if(n.type!=r.DataHelp.EN_STRUCTBEGIN)throw Error("read struct type mismatch, tag: "+e+", get type:"+n.type);return i.readFrom(this),this.skipToStructEnd(),i},r.JceInputStream.prototype.readString=function(e,t,i){if(0==this.skipToTag(e,t))return i;var n=this.readFrom();if(n.type==r.DataHelp.EN_STRING1)return this.buf.readString(this.buf.readUInt8());if(n.type==r.DataHelp.EN_STRING4)return this.buf.readString(this.buf.readUInt32());throw Error("read 'string' type mismatch, tag: "+e+", get type: "+n.type+".")},r.JceInputStream.prototype.readString2=function(e,t,i){if(0==this.skipToTag(e,t))return i;var n=this.readFrom();if(n.type==r.DataHelp.EN_STRING1)return this.buf.readBytes(this.buf.readUInt8());if(n.type==r.DataHelp.EN_STRING4)return this.buf.readBytes(this.buf.readUInt32());throw Error("read 'string' type mismatch, tag: "+e+", get type: "+n.type+".")},r.JceInputStream.prototype.readBytes=function(e,t,i){if(0==this.skipToTag(e,t))return i;var n=this.readFrom();if(n.type==r.DataHelp.EN_SIMPLELIST){var s=this.readFrom();if(s.type!=r.DataHelp.EN_INT8)throw Error("type mismatch, tag:"+e+",type:"+n.type+","+s.type);if((a=this.readInt32(0,!0))<0)throw Error("invalid size, tag:"+e+",type:"+n.type+","+s.type);return this.buf.readBytes(a)}if(n.type==r.DataHelp.EN_LIST){var a=this.readInt32(0,!0);return this.buf.readBytes(a)}throw Error("type mismatch, tag:"+e+",type:"+n.type)},r.JceInputStream.prototype.readVector=function(e,t,i){if(0==this.skipToTag(e,t))return i;var n=this.readFrom();if(n.type!=r.DataHelp.EN_LIST)throw Error("read 'vector' type mismatch, tag: "+e+", get type: "+n.type);var s=this.readInt32(0,!0);if(s<0)throw Error("invalid size, tag: "+e+", type: "+n.type+", size: "+s);for(var a=0;a<s;++a)i.value.push(i.proto._read(this,0,i.proto._clone()));return i},r.JceInputStream.prototype.readMap=function(e,t,i){if(0==this.skipToTag(e,t))return i;var n=this.readFrom();if(n.type!=r.DataHelp.EN_MAP)throw Error("read 'map' type mismatch, tag: "+e+", get type: "+n.type);var s=this.readInt32(0,!0);if(s<0)throw Error("invalid map, tag: "+e+", size: "+s);for(var a=0;a<s;a++){var o=i.kproto._read(this,0,i.kproto._clone()),u=i.vproto._read(this,1,i.vproto._clone());i.put(o,u)}return i},r.Wup=function(){this.iVersion=3,this.cPacketType=0,this.iMessageType=0,this.iRequestId=0,this.sServantName="",this.sFuncName="",this.sBuffer=new r.BinBuffer,this.iTimeout=0,this.context=new r.Map(new r.STRING,new r.STRING),this.status=new r.Map(new r.STRING,new r.STRING),this.data=new r.Map(new r.STRING,new r.Map(new r.STRING,new r.BinBuffer)),this.newdata=new r.Map(new r.STRING,new r.BinBuffer),this.iStream=new r.JceInputStream,this.oStream=new r.JceOutputStream},r.Wup.prototype.hasKey=function(e){return this.newdata.hasKey(e)},r.Wup.prototype.setVersion=function(e){this.iVersion=e},r.Wup.prototype.getVersion=function(e){return this.iVersion},r.Wup.prototype.setServant=function(e){this.sServantName=e},r.Wup.prototype.setFunc=function(e){this.sFuncName=e},r.Wup.prototype.setRequestId=function(e){this.iRequestId=e||++this.iRequestId},r.Wup.prototype.getRequestId=function(){return this.iRequestId},r.Wup.prototype.setTimeOut=function(e){this.iTimeout=e},r.Wup.prototype.getTimeOut=function(){return this.iTimeout},r.Wup.prototype.writeTo=function(){var e=this.oStream.clear();return e.writeInt16(1,this.iVersion),e.writeInt8(2,this.cPacketType),e.writeInt32(3,this.iMessageType),e.writeInt32(4,this.iRequestId),e.writeString(5,this.sServantName),e.writeString(6,this.sFuncName),e.writeBytes(7,this.sBuffer),e.writeInt32(8,this.iTimeout),e.writeMap(9,this.context),e.writeMap(10,this.status),new r.BinBuffer(e.getBuffer())},r.Wup.prototype.encode=function(){var e=this.oStream.clear();3==this.iVersion?e.writeMap(0,this.newdata):e.writeMap(0,this.data),this.sBuffer=e.getBinBuffer();var t=this.writeTo(),i=new r.BinBuffer;return i.writeInt32(4+t.len),i.writeBytes(t),i},r.Wup.prototype.writeBoolean=function(e,t){var i=this.oStream.clear();if(i.writeBoolean(0,t),3==this.iVersion)this.newdata.put(e,new r.BinBuffer(i.getBuffer()));else{var n=this.data.get(e),s=TAF.TypeHelp.BOOLEAN;null==n&&(n=new r.Map(r.STRING,r.STRING)),n.put(s,new r.BinBuffer(i.getBuffer())),this.data.put(e,n)}},r.Wup.prototype.writeInt8=function(e,t){var i=this.oStream.clear();if(i.writeInt8(0,t),3==this.iVersion)this.newdata.put(e,new r.BinBuffer(i.getBuffer()));else{var n=this.data.get(e),s=TAF.TypeHelp.CHAR;null==n&&(n=new r.Map(r.STRING,r.STRING)),n.put(s,new r.BinBuffer(i.getBuffer())),this.data.put(e,n)}},r.Wup.prototype.writeInt16=function(e,t){var i=this.oStream.clear();if(i.writeInt16(0,t),3==this.iVersion)this.newdata.put(e,new r.BinBuffer(i.getBuffer()));else{var n=this.data.get(e),s=TAF.TypeHelp.SHORT;null==n&&(n=new r.Map(r.STRING,r.STRING)),n.put(s,new Uint8Array(i.getBuffer())),this.data.put(e,n)}},r.Wup.prototype.writeInt32=function(e,t){var i=this.oStream.clear();if(i.writeInt32(0,t),3==this.iVersion)this.newdata.put(e,new r.BinBuffer(i.getBuffer()));else{var n=this.data.get(e),s=TAF.TypeHelp.INT32;null==n&&(n=new r.Map(r.STRING,r.STRING)),n.put(s,new Uint8Array(i.getBuffer())),this.data.put(e,n)}},r.Wup.prototype.writeInt64=function(e,t){var i=this.oStream.clear();if(i.writeInt64(0,t),3==this.iVersion)this.newdata.put(e,new r.BinBuffer(i.getBuffer()));else{var n=this.data.get(e),s=TAF.TypeHelp.INT64;null==n&&(n=new r.Map(r.STRING,r.STRING)),n.put(s,new Uint8Array(i.getBuffer())),this.data.put(e,n)}},r.Wup.prototype.writeFloat=function(e,t){var i=this.oStream.clear();if(i.writeFloat(0,t),3==this.iVersion)this.newdata.put(e,new r.BinBuffer(i.getBuffer()));else{var n=this.data.get(e),s=TAF.TypeHelp.FLOAT;null==n&&(n=new r.Map(r.STRING,r.STRING)),n.put(s,new Uint8Array(i.getBuffer())),this.data.put(e,n)}},r.Wup.prototype.writeDouble=function(e,t){var i=this.oStream.clear();if(i.writeDouble(0,t),3==this.iVersion)this.newdata.put(e,new r.BinBuffer(i.getBuffer()));else{var n=this.data.get(e),s=TAF.TypeHelp.DOUBLE;null==n&&(n=new r.Map(r.STRING,r.STRING)),n.put(s,new Uint8Array(i.getBuffer())),this.data.put(e,n)}},r.Wup.prototype.writeString=function(e,t){var i=this.oStream.clear();if(i.writeString(0,t),3==this.iVersion)this.newdata.put(e,new r.BinBuffer(i.getBuffer()));else{var n=this.data.get(e),s=r.TypeHelp.STRING;null==n&&(n=new r.Map(r.STRING,r.STRING)),n.put(s,new Uint8Array(i.getBuffer())),this.data.put(e,n)}},r.Wup.prototype.writeVector=function(e,t){var i=this.oStream.clear();if(i.writeVector(0,t),3==this.iVersion)this.newdata.put(e,new r.BinBuffer(i.getBinBuffer()));else{var n=this.data.get(e),s=t._className();null==n&&(n=new r.Map(r.STRING,r.STRING)),n.put(s,new Uint8Array(i.getBuffer())),this.data.put(e,n)}},r.Wup.prototype.writeStruct=function(e,t){var i=this.oStream.clear();if(i.writeStruct(0,t),3==this.iVersion)this.newdata.put(e,new r.BinBuffer(i.getBuffer()));else{var n=this.data.get(e);null==n&&(n=new r.Map(r.STRING,r.STRING)),n.put(" ",new Uint8Array(i.getBuffer())),this.data.put(e,n)}},r.Wup.prototype.writeBytes=function(e,t){var i=this.oStream.clear();if(i.writeBytes(0,t),3==this.iVersion)this.newdata.put(e,new r.BinBuffer(i.getBuffer()));else{var n=this.data.get(e);null==n&&(n=new r.Map(r.STRING,r.STRING)),n.put("vec",new Uint8Array(i.getBuffer())),this.data.put(e,n)}},r.Wup.prototype.writeMap=function(e,t){var i=this.oStream.clear();if(i.writeMap(0,t),3==this.iVersion)this.newdata.put(e,new r.BinBuffer(i.getBuffer()));else{var n=this.data.get(e),s=r.Util.getClassType(t);null==n&&(n=new r.Map(r.STRING,r.STRING)),n.put(s,new Uint8Array(i.getBuffer())),this.data.put(e,n)}},r.Wup.prototype.readFrom=function(e){this.iVersion=e.readInt16(1,!0),this.cPacketType=e.readInt8(2,!0),this.iMessageType=e.readInt32(3,!0),this.iRequestId=e.readInt32(4,!0),this.sServantName=e.readString(5,!0),this.sFuncName=e.readString(6,!0),localStorage.__wup&&console.info("%c@@@ "+this.sServantName+"."+this.sFuncName,"color:white;background:black;",this),this.sBuffer=e.readBytes(7,!0),this.iTimeout=e.readInt32(8,!0),this.context=e.readMap(9,!0,this.context),this.status=e.readMap(10,!0,this.status)},r.Wup.prototype.decode=function(e){var t=this.iStream.setBuffer(e);if(t.buf.vew.getInt32(t.buf.position)<4)throw Error("packet length too short");t.buf.position+=4,this.readFrom(t),t=this.iStream.setBuffer(this.sBuffer.getBuffer()),3==this.iVersion?(this.newdata.clear(),t.readMap(0,!0,this.newdata)):(this.data.clear(),t.readMap(0,!0,this.data))},r.Wup.prototype.readBoolean=function(e){var t,i;if(3==this.iVersion){if(null==(t=this.newdata.get(e)))throw Error("UniAttribute not found key:"+e);i=this.iStream.setBuffer(t.buffer).readBoolean(0,!0,i)}else{if(null==(t=this.data.get(e)))throw Error("UniAttribute not found key:"+e);var n=r.TypeHelp.BOOLEAN,s=t.get(n);if(null==s)throw Error("UniAttribute not found type:"+n);i=this.iStream.setBuffer(s).readBoolean(0,!0,i)}return i},r.Wup.prototype.readInt8=function(e){var t,i;if(3==this.iVersion){if(null==(t=this.newdata.get(e)))throw Error("UniAttribute not found key:"+e);i=this.iStream.setBuffer(t.buffer).readInt8(0,!0,i)}else{if(null==(t=this.data.get(e)))throw Error("UniAttribute not found key:"+e);var n=r.TypeHelp.CHAR,s=t.get(n);if(null==s)throw Error("UniAttribute not found type:"+n);i=this.iStream.setBuffer(s).readInt8(0,!0,i)}return i},r.Wup.prototype.readInt16=function(e){var t,i;if(3==this.iVersion){if(null==(t=this.newdata.get(e)))throw Error("UniAttribute not found key:"+e);i=(a=this.iStream.setBuffer(t.buffer)).readInt16(0,!0,i)}else{if(null==(t=this.data.get(e)))throw Error("UniAttribute not found key:"+e);var n=r.TypeHelp.SHORT,s=t.get(n),a=this.iStream.setBuffer(s);if(null==s)throw Error("UniAttribute not found type:"+n);i=a.readInt16(0,!0,i)}return i},r.Wup.prototype.readInt32=function(e){var t,i;if(3==this.iVersion){if(null==(t=this.newdata.get(e)))throw Error("UniAttribute not found key:"+e);i=this.iStream.setBuffer(t.buffer).readInt32(0,!0,i)}else{if(null==(t=this.data.get(e)))throw Error("UniAttribute not found key:"+e);var n=r.TypeHelp.INT32,s=t.get(n);if(null==s)throw Error("UniAttribute not found type:"+n);i=this.iStream.setBuffer(s).readInt32(0,!0,i)}return i},r.Wup.prototype.readInt64=function(e){var t,i;if(3==this.iVersion){if(null==(t=this.newdata.get(e)))throw Error("UniAttribute not found key:"+e);i=this.iStream.setBuffer(t.buffer).readInt64(0,!0,i)}else{if(null==(t=this.data.get(e)))throw Error("UniAttribute not found key:"+e);var n=r.TypeHelp.INT64,s=t.get(n);if(null==s)throw Error("UniAttribute not found type:"+n);i=this.iStream.setBuffer(s).readInt64(0,!0,i)}return i},r.Wup.prototype.readFloat=function(e){var t,i;if(3==this.iVersion){if(null==(t=this.newdata.get(e)))throw Error("UniAttribute not found key:"+e);i=this.iStream.setBuffer(t.buffer).readFloat(0,!0,i)}else{if(null==(t=this.data.get(e)))throw Error("UniAttribute not found key:"+e);var n=r.TypeHelp.FLOAT,s=t.get(n);if(null==s)throw Error("UniAttribute not found type:"+n);i=this.iStream.setBuffer(s).readFloat(0,!0,i)}return i},r.Wup.prototype.readDouble=function(e){var t;if(3==this.iVersion){if(null==(t=this.newdata.get(e)))throw Error("UniAttribute not found key:"+e);var i=this.iStream.setBuffer(t.buffer);def=i.readDouble(0,!0,def)}else{if(null==(t=this.data.get(e)))throw Error("UniAttribute not found key:"+e);var n=r.TypeHelp.DOUBLE,s=t.get(n);if(null==s)throw Error("UniAttribute not found type:"+n);i=this.iStream.setBuffer(s),def=i.readDouble(0,!0,def)}return def},r.Wup.prototype.readVector=function(e,t,i){var r;if(3==this.iVersion){if(null==(r=this.newdata.get(e)))throw Error("UniAttribute not found key:"+e);t=this.iStream.setBuffer(r.buffer).readVector(0,!0,t)}else{if(null==(r=this.data.get(e)))throw Error("UniAttribute not found key:"+e);var n=r.get(i);if(null==n)throw Error("UniAttribute not found type:"+i);t=this.iStream.setBuffer(n).readVector(0,!0,t)}return t},r.Wup.prototype.readStruct=function(e,t,i){var r;if(3==this.iVersion){if(null==(r=this.newdata.get(e)))throw Error("UniAttribute not found key:"+e);t=this.iStream.setBuffer(r.buffer).readStruct(0,!0,t)}else{if(null==(r=this.data.get(e)))throw Error("UniAttribute not found key:"+e);var n=r.get(i);if(null==n)throw Error("UniAttribute not found type:"+i);t=this.iStream.setBuffer(n).readStruct(0,!0,t)}return t},r.Wup.prototype.readMap=function(e,t,i){var r;if(3==this.iVersion){if(null==(r=this.newdata.get(e)))throw Error("UniAttribute not found key:"+e);t=this.iStream.setBuffer(r.buffer).readMap(0,!0,t)}else{if(null==(r=this.data.get(e)))throw Error("UniAttribute not found key:"+e);var n=r.get(i);if(null==n)throw Error("UniAttribute not found type:"+i);t=this.iStream.setBuffer(n).readMap(0,!0,t)}return t},r.Wup.prototype.readBytes=function(e,t,i){var r;if(3==this.iVersion){if(null==(r=this.newdata.get(e)))throw Error("UniAttribute not found key:"+e);t=this.iStream.setBuffer(r.buffer).readBytes(0,!0,t)}else{if(null==(r=this.data.get(e)))throw Error("UniAttribute not found key:"+e);var n=r.get(i);if(null==n)throw Error("UniAttribute not found type:"+i);t=this.iStream.setBuffer(n).readBytes(0,!0,t)}return t},r.Util=r.Util||{},r.Util.jcestream=function(e,t){if(null!=e&&null!=e)if(e instanceof ArrayBuffer){t=t||16;for(var i=new Uint8Array(e),r="",n=0;n<i.length;n++)0!=n&&n%t==0?r+="\n":0!=n&&(r+=" "),r+=(i[n]>15?"":"0")+i[n].toString(16);console.log(r.toUpperCase())}else console.log("Taf.Util.jcestream::value is not ArrayBuffer");else console.log("Taf.Util.jcestream::value is null or undefined")},r.Util.str2ab=function(e){var t,i=e.length,r=new Array(i);for(t=0;t<i;++t)r[t]=e.charCodeAt(t);return new Uint8Array(r).buffer},r.Util.ajax=function(e,t,i,n){var s=new XMLHttpRequest;s.overrideMimeType("text/plain; charset=x-user-defined"),s.addEventListener("readystatechange",(function e(){4===s.readyState&&(200===s.status||304===s.status?i(r.Util.str2ab(s.response)):n(s.status),s.removeEventListener("readystatechange",e),s=void 0)})),s.open("post",e),s.send(t)}},function(e,t,i){"use strict";var r=window.HUYA||{};window.HUYA=r,r.EWebSocketCommandType={EWSCmd_NULL:0,EWSCmd_RegisterReq:1,EWSCmd_RegisterRsp:2,EWSCmd_WupReq:3,EWSCmd_WupRsp:4,EWSCmdC2S_HeartBeat:5,EWSCmdS2C_HeartBeatAck:6,EWSCmdS2C_MsgPushReq:7,EWSCmdC2S_DeregisterReq:8,EWSCmdS2C_DeRegisterRsp:9,EWSCmdC2S_VerifyCookieReq:10,EWSCmdS2C_VerifyCookieRsp:11,EWSCmdC2S_VerifyHuyaTokenReq:12,EWSCmdS2C_VerifyHuyaTokenRsp:13,EWSCmdC2S_UNVerifyReq:14,EWSCmdS2C_UNVerifyRsp:15,EWSCmdC2S_RegisterGroupReq:16,EWSCmdS2C_RegisterGroupRsp:17,EWSCmdC2S_UnRegisterGroupReq:18,EWSCmdS2C_UnRegisterGroupRsp:19,EWSCmdC2S_HeartBeatReq:20,EWSCmdS2C_HeartBeatRsp:21,EWSCmdS2C_MsgPushReq_V2:22},r.WebSocketCommand=function(){this.iCmdType=0,this.vData=new Taf.BinBuffer,this.lRequestId=0,this.traceId=""},r.WebSocketCommand.prototype._clone=function(){return new r.WebSocketCommand},r.WebSocketCommand.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.WebSocketCommand.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.WebSocketCommand.prototype.writeTo=function(e){e.writeInt32(0,this.iCmdType),e.writeBytes(1,this.vData),e.writeInt64(2,this.lRequestId),e.writeString(3,this.traceId)},r.WebSocketCommand.prototype.readFrom=function(e){this.iCmdType=e.readInt32(0,!1,this.iCmdType),this.vData=e.readBytes(1,!1,this.vData),this.lRequestId=e.readInt64(2,!1,this.lRequestId),this.traceId=e.readString(3,!1,this.traceId)},r.WSRegisterRsp=function(){this.iResCode=0,this.lRequestId=0,this.sMessage="",this.sBCConnHost=""},r.WSRegisterRsp.prototype._clone=function(){return new r.WSRegisterRsp},r.WSRegisterRsp.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.WSRegisterRsp.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.WSRegisterRsp.prototype.writeTo=function(e){e.writeInt32(0,this.iResCode),e.writeInt64(1,this.lRequestId),e.writeString(2,this.sMessage),e.writeString(3,this.sBCConnHost)},r.WSRegisterRsp.prototype.readFrom=function(e){this.iResCode=e.readInt32(0,!1,this.iResCode),this.lRequestId=e.readInt64(1,!1,this.lRequestId),this.sMessage=e.readString(2,!1,this.sMessage),this.sBCConnHost=e.readString(3,!1,this.sBCConnHost)},r.WSPushMessage=function(){this.ePushType=0,this.iUri=0,this.sMsg=new Taf.BinBuffer,this.iProtocolType=0,this.sGroupId=""},r.WSPushMessage.prototype._clone=function(){return new r.WSPushMessage},r.WSPushMessage.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.WSPushMessage.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.WSPushMessage.prototype.writeTo=function(e){e.writeInt32(0,this.ePushType),e.writeInt64(1,this.iUri),e.writeBytes(2,this.sMsg),e.writeInt32(3,this.iProtocolType),e.writeString(4,this.sGroupId)},r.WSPushMessage.prototype.readFrom=function(e){this.ePushType=e.readInt32(0,!1,this.ePushType),this.iUri=e.readInt64(1,!1,this.iUri),this.sMsg=e.readBytes(2,!1,this.sMsg),this.iProtocolType=e.readInt32(3,!1,this.iProtocolType),this.sGroupId=e.readString(4,!1,this.sGroupId)},r.WSUserInfo=function(){this.lUid=0,this.bAnonymous=!0,this.sGuid="",this.sToken="",this.lTid=0,this.lSid=0,this.lGroupId=0,this.lGroupType=0,this.sAppId="",this.sUA=""},r.WSUserInfo.prototype._clone=function(){return new r.WSUserInfo},r.WSUserInfo.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.WSUserInfo.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.WSUserInfo.prototype.writeTo=function(e){e.writeInt64(0,this.lUid),e.writeBoolean(1,this.bAnonymous),e.writeString(2,this.sGuid),e.writeString(3,this.sToken),e.writeInt64(4,this.lTid),e.writeInt64(5,this.lSid),e.writeInt64(6,this.lGroupId),e.writeInt64(7,this.lGroupType),e.writeString(8,this.sAppId),e.writeString(9,this.sUA)},r.WSUserInfo.prototype.readFrom=function(e){this.lUid=e.readInt64(0,!1,this.lUid),this.bAnonymous=e.readBoolean(1,!1,this.bAnonymous),this.sGuid=e.readString(2,!1,this.sGuid),this.sToken=e.readString(3,!1,this.sToken),this.lTid=e.readInt64(4,!1,this.lTid),this.lSid=e.readInt64(5,!1,this.lSid),this.lGroupId=e.readInt64(6,!1,this.lGroupId),this.lGroupType=e.readInt64(7,!1,this.lGroupType),this.sAppId=e.readString(8,!1,this.sAppId),this.sUA=e.readString(9,!1,this.sUA)},r.WSVerifyCookieReq=function(){this.lUid=0,this.sUA="",this.sCookie="",this.sGuid="",this.bAutoRegisterUid=0},r.WSVerifyCookieReq.prototype._clone=function(){return new r.WSVerifyCookieReq},r.WSVerifyCookieReq.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.WSVerifyCookieReq.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.WSVerifyCookieReq.prototype.writeTo=function(e){e.writeInt64(0,this.lUid),e.writeString(1,this.sUA),e.writeString(2,this.sCookie),e.writeString(3,this.sGuid),e.writeInt32(4,this.bAutoRegisterUid)},r.WSVerifyCookieReq.prototype.readFrom=function(e){this.lUid=e.readInt64(0,!1,this.lUid),this.sUA=e.readString(1,!1,this.sUA),this.sCookie=e.readString(2,!1,this.sCookie),this.sGuid=e.readString(3,!1,this.sGuid),this.bAutoRegisterUid=e.readInt32(4,!1,this.bAutoRegisterUid)},r.WSVerifyCookieRsp=function(){this.iValidate=0},r.WSVerifyCookieRsp.prototype._clone=function(){return new r.WSVerifyCookieRsp},r.WSVerifyCookieRsp.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.WSVerifyCookieRsp.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.WSVerifyCookieRsp.prototype.writeTo=function(e){e.writeInt32(0,this.iValidate)},r.WSVerifyCookieRsp.prototype.readFrom=function(e){this.iValidate=e.readInt32(0,!1,this.iValidate)},r.WSPushMessage_V2=function(){this.sGroupId="",this.vMsgItem=new Taf.Vector(new r.WSMsgItem)},r.WSPushMessage_V2.prototype._clone=function(){return new r.WSPushMessage_V2},r.WSPushMessage_V2.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.WSPushMessage_V2.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.WSPushMessage_V2.prototype.writeTo=function(e){e.writeString(0,this.sGroupId),e.writeVector(1,this.vMsgItem)},r.WSPushMessage_V2.prototype.readFrom=function(e){this.sGroupId=e.readString(0,!1,this.sGroupId),this.vMsgItem=e.readVector(1,!1,this.vMsgItem)},r.WSMsgItem=function(){this.iUri=0,this.sMsg=new Taf.BinBuffer},r.WSMsgItem.prototype._clone=function(){return new r.WSMsgItem},r.WSMsgItem.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.WSMsgItem.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.WSMsgItem.prototype.writeTo=function(e){e.writeInt64(0,this.iUri),e.writeBytes(1,this.sMsg)},r.WSMsgItem.prototype.readFrom=function(e){this.iUri=e.readInt64(0,!1,this.iUri),this.sMsg=e.readBytes(1,!1,this.sMsg)},r.UserId=function(){this.lUid=0,this.sGuid="",this.sToken="",this.sHuYaUA="",this.sCookie="",this.iTokenType=0},r.UserId.prototype._clone=function(){return new r.UserId},r.UserId.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.UserId.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.UserId.prototype.writeTo=function(e){e.writeInt64(0,this.lUid),e.writeString(1,this.sGuid),e.writeString(2,this.sToken),e.writeString(3,this.sHuYaUA),e.writeString(4,this.sCookie),e.writeInt32(5,this.iTokenType)},r.UserId.prototype.readFrom=function(e){this.lUid=e.readInt64(0,!1,this.lUid),this.sGuid=e.readString(1,!1,this.sGuid),this.sToken=e.readString(2,!1,this.sToken),this.sHuYaUA=e.readString(3,!1,this.sHuYaUA),this.sCookie=e.readString(4,!1,this.sCookie),this.iTokenType=e.readInt32(5,!1,this.iTokenType)},r.Dimension=function(){this.sName="",this.sValue=""},r.Dimension.prototype._clone=function(){return new r.Dimension},r.Dimension.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.Dimension.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.Dimension.prototype.writeTo=function(e){e.writeString(0,this.sName),e.writeString(1,this.sValue)},r.Dimension.prototype.readFrom=function(e){this.sName=e.readString(0,!1,this.sName),this.sValue=e.readString(1,!1,this.sValue)},r.Field=function(){this.sName="",this.fValue=0},r.Field.prototype._clone=function(){return new r.Field},r.Field.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.Field.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.Field.prototype.writeTo=function(e){e.writeString(0,this.sName),e.writeDouble(1,this.fValue)},r.Field.prototype.readFrom=function(e){this.sName=e.readString(0,!1,this.sName),this.fValue=e.readDouble(1,!1,this.fValue)},r.MetricDetail=function(){this.sMetricName="",this.iTS=0,this.vDimension=new Taf.Vector(new r.Dimension),this.vFiled=new Taf.Vector(new r.Field),this.vExLog=new Taf.Vector(new r.Dimension)},r.MetricDetail.prototype._clone=function(){return new r.MetricDetail},r.MetricDetail.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.MetricDetail.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.MetricDetail.prototype.writeTo=function(e){e.writeString(0,this.sMetricName),e.writeInt64(1,this.iTS),e.writeVector(2,this.vDimension),e.writeVector(3,this.vFiled),e.writeVector(4,this.vExLog)},r.MetricDetail.prototype.readFrom=function(e){this.sMetricName=e.readString(0,!0,this.sMetricName),this.iTS=e.readInt64(1,!1,this.iTS),this.vDimension=e.readVector(2,!1,this.vDimension),this.vFiled=e.readVector(3,!1,this.vFiled),this.vExLog=e.readVector(4,!1,this.vExLog)},r.MetricDetailSet=function(){this.tId=new r.UserId,this.vMetricDetail=new Taf.Vector(new r.MetricDetail)},r.MetricDetailSet.prototype._clone=function(){return new r.MetricDetailSet},r.MetricDetailSet.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.MetricDetailSet.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.MetricDetailSet.prototype.writeTo=function(e){e.writeStruct(0,this.tId),e.writeVector(1,this.vMetricDetail)},r.MetricDetailSet.prototype.readFrom=function(e){this.tId=e.readStruct(0,!0,this.tId),this.vMetricDetail=e.readVector(1,!0,this.vMetricDetail)},r.EMediaNetType={ENET_WIFI:0,ENET_MOB:1,ENET_DISCONNECT:2,ENET_2G:3,ENET_3G:4,ENET_4G:5,ENET_UNKNOWN:127},r.EVerifyResCode={VRC_UNKNOWN:-1,VRC_SUCCESS:0,VRC_INVALID_TOKEN:1,VRC_WRONG_APPID:2,VRC_TOKEN_TIMEOUT:3,VRC_RELYON_SERVER_ERROR:4},r.MediaUserId=function(){this.lUid=0,this.sGuid="",this.sToken="",this.sUA="",this.sCookie="",this.iAppid=0,this.sStrUid="",this.sUAppId="",this.iNetType=127},r.MediaUserId.prototype._clone=function(){return new r.MediaUserId},r.MediaUserId.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.MediaUserId.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.MediaUserId.prototype.writeTo=function(e){e.writeInt64(0,this.lUid),e.writeString(1,this.sGuid),e.writeString(2,this.sToken),e.writeString(3,this.sUA),e.writeString(4,this.sCookie),e.writeInt32(6,this.iAppid),e.writeString(8,this.sStrUid),e.writeString(9,this.sUAppId),e.writeInt32(10,this.iNetType)},r.MediaUserId.prototype.readFrom=function(e){this.lUid=e.readInt64(0,!1,this.lUid),this.sGuid=e.readString(1,!1,this.sGuid),this.sToken=e.readString(2,!1,this.sToken),this.sUA=e.readString(3,!1,this.sUA),this.sCookie=e.readString(4,!1,this.sCookie),this.iAppid=e.readInt32(6,!1,this.iAppid),this.sStrUid=e.readString(8,!1,this.sStrUid),this.sUAppId=e.readString(9,!1,this.sUAppId),this.iNetType=e.readInt32(10,!1,this.iNetType)},r.LoginVerifyReq=function(){this.tId=new r.MediaUserId,this.iCookieDeadTime=0},r.LoginVerifyReq.prototype._clone=function(){return new r.LoginVerifyReq},r.LoginVerifyReq.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.LoginVerifyReq.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.LoginVerifyReq.prototype.writeTo=function(e){e.writeStruct(0,this.tId),e.writeInt32(1,this.iCookieDeadTime)},r.LoginVerifyReq.prototype.readFrom=function(e){this.tId=e.readStruct(0,!1,this.tId),this.iCookieDeadTime=e.readInt32(1,!1,this.iCookieDeadTime)},r.LoginVerifyRsp=function(){this.iResCode=0,this.lUid=0,this.sCookie="",this.sUid="",this.iAppId=0},r.LoginVerifyRsp.prototype._clone=function(){return new r.LoginVerifyRsp},r.LoginVerifyRsp.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.LoginVerifyRsp.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.LoginVerifyRsp.prototype.writeTo=function(e){e.writeInt32(0,this.iResCode),e.writeInt64(1,this.lUid),e.writeString(2,this.sCookie),e.writeString(3,this.sUid),e.writeInt32(4,this.iAppId)},r.LoginVerifyRsp.prototype.readFrom=function(e){this.iResCode=e.readInt32(0,!1,this.iResCode),this.lUid=e.readInt64(1,!1,this.lUid),this.sCookie=e.readString(2,!1,this.sCookie),this.sUid=e.readString(3,!1,this.sUid),this.iAppId=e.readInt32(4,!1,this.iAppId)},r.RefreshCookieReq=function(){this.tId=new r.MediaUserId,this.iCookieDeadTime=0},r.RefreshCookieReq.prototype._clone=function(){return new r.RefreshCookieReq},r.RefreshCookieReq.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.RefreshCookieReq.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.RefreshCookieReq.prototype.writeTo=function(e){e.writeStruct(0,this.tId),e.writeInt32(1,this.iCookieDeadTime)},r.RefreshCookieReq.prototype.readFrom=function(e){this.tId=e.readStruct(0,!1,this.tId),this.iCookieDeadTime=e.readInt32(1,!1,this.iCookieDeadTime)},r.RefreshCookieRsp=function(){this.iResCode=0,this.sCookie=""},r.RefreshCookieRsp.prototype._clone=function(){return new r.RefreshCookieRsp},r.RefreshCookieRsp.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.RefreshCookieRsp.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.RefreshCookieRsp.prototype.writeTo=function(e){e.writeInt32(0,this.iResCode),e.writeString(1,this.sCookie)},r.RefreshCookieRsp.prototype.readFrom=function(e){this.iResCode=e.readInt32(0,!1,this.iResCode),this.sCookie=e.readString(1,!1,this.sCookie)},r.CheckUidByStrReq=function(){this.iAppid=0,this.sUid=""},r.CheckUidByStrReq.prototype._clone=function(){return new r.CheckUidByStrReq},r.CheckUidByStrReq.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.CheckUidByStrReq.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.CheckUidByStrReq.prototype.writeTo=function(e){e.writeInt32(0,this.iAppid),e.writeString(1,this.sUid)},r.CheckUidByStrReq.prototype.readFrom=function(e){this.iAppid=e.readInt32(0,!1,this.iAppid),this.sUid=e.readString(1,!1,this.sUid)},r.CheckUidByStrRsp=function(){this.lUid=0},r.CheckUidByStrRsp.prototype._clone=function(){return new r.CheckUidByStrRsp},r.CheckUidByStrRsp.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.CheckUidByStrRsp.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.CheckUidByStrRsp.prototype.writeTo=function(e){e.writeInt64(0,this.lUid)},r.CheckUidByStrRsp.prototype.readFrom=function(e){this.lUid=e.readInt64(0,!1,this.lUid)},r.MediaStreamInfo=function(){this.sCdnName="",this.sStreamName="",this.sFlvUrl="",this.sFlvSuffix="",this.sHlsUrl="",this.sHlsSuffix="",this.iLineIndex=0,this.vFlvIPList=new Taf.Vector(new Taf.STRING),this.iIsP2PSupport=0,this.sP2pUrl="",this.sP2pSuffix="",this.lFreeFlag=0,this.iIsHEVCSupport=0,this.vP2pIPList=new Taf.Vector(new Taf.STRING),this.iPCPriorityRate=0,this.iWebPriorityRate=0,this.iMobilePriorityRate=0,this.sAdditionalParam="",this.mMediaStreamFormatInfo=new Taf.Map(new Taf.STRING,new r.MediaStreamFormatInfo)},r.MediaStreamInfo.prototype._clone=function(){return new r.MediaStreamInfo},r.MediaStreamInfo.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.MediaStreamInfo.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.MediaStreamInfo.prototype.writeTo=function(e){e.writeString(0,this.sCdnName),e.writeString(1,this.sStreamName),e.writeString(2,this.sFlvUrl),e.writeString(3,this.sFlvSuffix),e.writeString(4,this.sHlsUrl),e.writeString(5,this.sHlsSuffix),e.writeInt32(6,this.iLineIndex),e.writeVector(7,this.vFlvIPList),e.writeInt32(8,this.iIsP2PSupport),e.writeString(9,this.sP2pUrl),e.writeString(10,this.sP2pSuffix),e.writeInt64(11,this.lFreeFlag),e.writeInt32(12,this.iIsHEVCSupport),e.writeVector(13,this.vP2pIPList),e.writeInt32(14,this.iPCPriorityRate),e.writeInt32(15,this.iWebPriorityRate),e.writeInt32(16,this.iMobilePriorityRate),e.writeString(17,this.sAdditionalParam),e.writeMap(18,this.mMediaStreamFormatInfo)},r.MediaStreamInfo.prototype.readFrom=function(e){this.sCdnName=e.readString(0,!1,this.sCdnName),this.sStreamName=e.readString(1,!1,this.sStreamName),this.sFlvUrl=e.readString(2,!1,this.sFlvUrl),this.sFlvSuffix=e.readString(3,!1,this.sFlvSuffix),this.sHlsUrl=e.readString(4,!1,this.sHlsUrl),this.sHlsSuffix=e.readString(5,!1,this.sHlsSuffix),this.iLineIndex=e.readInt32(6,!1,this.iLineIndex),this.vFlvIPList=e.readVector(7,!1,this.vFlvIPList),this.iIsP2PSupport=e.readInt32(8,!1,this.iIsP2PSupport),this.sP2pUrl=e.readString(9,!1,this.sP2pUrl),this.sP2pSuffix=e.readString(10,!1,this.sP2pSuffix),this.lFreeFlag=e.readInt64(11,!1,this.lFreeFlag),this.iIsHEVCSupport=e.readInt32(12,!1,this.iIsHEVCSupport),this.vP2pIPList=e.readVector(13,!1,this.vP2pIPList),this.iPCPriorityRate=e.readInt32(14,!1,this.iPCPriorityRate),this.iWebPriorityRate=e.readInt32(15,!1,this.iWebPriorityRate),this.iMobilePriorityRate=e.readInt32(16,!1,this.iMobilePriorityRate),this.sAdditionalParam=e.readString(17,!1,this.sAdditionalParam),this.mMediaStreamFormatInfo=e.readMap(18,!1,this.mMediaStreamFormatInfo)},r.JoinMediaGroupReq=function(){this.tId=new r.MediaUserId,this.vGroupId=new Taf.Vector(new Taf.STRING)},r.JoinMediaGroupReq.prototype._clone=function(){return new r.JoinMediaGroupReq},r.JoinMediaGroupReq.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.JoinMediaGroupReq.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.JoinMediaGroupReq.prototype.writeTo=function(e){e.writeStruct(0,this.tId),e.writeVector(1,this.vGroupId)},r.JoinMediaGroupReq.prototype.readFrom=function(e){this.tId=e.readStruct(0,!1,this.tId),this.vGroupId=e.readVector(1,!1,this.vGroupId)},r.JoinMediaGroupRsp=function(){this.iCode=0,this.sMsg="",this.vGroupId=new Taf.Vector(new Taf.STRING)},r.JoinMediaGroupRsp.prototype._clone=function(){return new r.JoinMediaGroupRsp},r.JoinMediaGroupRsp.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.JoinMediaGroupRsp.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.JoinMediaGroupRsp.prototype.writeTo=function(e){e.writeInt32(0,this.iCode),e.writeString(1,this.sMsg),e.writeVector(2,this.vGroupId)},r.JoinMediaGroupRsp.prototype.readFrom=function(e){this.iCode=e.readInt32(0,!1,this.iCode),this.sMsg=e.readString(1,!1,this.sMsg),this.vGroupId=e.readVector(2,!1,this.vGroupId)},r.QuitMediaGroupReq=function(){this.tId=new r.MediaUserId,this.vGroupId=new Taf.Vector(new Taf.STRING)},r.QuitMediaGroupReq.prototype._clone=function(){return new r.QuitMediaGroupReq},r.QuitMediaGroupReq.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.QuitMediaGroupReq.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.QuitMediaGroupReq.prototype.writeTo=function(e){e.writeStruct(0,this.tId),e.writeVector(1,this.vGroupId)},r.QuitMediaGroupReq.prototype.readFrom=function(e){this.tId=e.readStruct(0,!1,this.tId),this.vGroupId=e.readVector(1,!1,this.vGroupId)},r.QuitMediaGroupRsp=function(){this.iCode=0,this.sMsg="",this.vGroupId=new Taf.Vector(new Taf.STRING)},r.QuitMediaGroupRsp.prototype._clone=function(){return new r.QuitMediaGroupRsp},r.QuitMediaGroupRsp.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.QuitMediaGroupRsp.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.QuitMediaGroupRsp.prototype.writeTo=function(e){e.writeInt32(0,this.iCode),e.writeString(1,this.sMsg),e.writeVector(2,this.vGroupId)},r.QuitMediaGroupRsp.prototype.readFrom=function(e){this.iCode=e.readInt32(0,!1,this.iCode),this.sMsg=e.readString(1,!1,this.sMsg),this.vGroupId=e.readVector(2,!1,this.vGroupId)},r.GetStreamInfoByRoomReq=function(){this.tId=new r.MediaUserId,this.sRoomId="",this.iMediaPackType=0,this.iLoopTime=0},r.GetStreamInfoByRoomReq.prototype._clone=function(){return new r.GetStreamInfoByRoomReq},r.GetStreamInfoByRoomReq.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.GetStreamInfoByRoomReq.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.GetStreamInfoByRoomReq.prototype.writeTo=function(e){e.writeStruct(0,this.tId),e.writeString(1,this.sRoomId),e.writeInt32(2,this.iMediaPackType),e.writeInt32(3,this.iLoopTime)},r.GetStreamInfoByRoomReq.prototype.readFrom=function(e){this.tId=e.readStruct(0,!1,this.tId),this.sRoomId=e.readString(1,!1,this.sRoomId),this.iMediaPackType=e.readInt32(2,!1,this.iMediaPackType),this.iLoopTime=e.readInt32(3,!1,this.iLoopTime)},r.GetStreamInfoByRoomRsp=function(){this.tStreamInfoPack=new r.MediaStreamInfoPack,this.sRoomId="",this.sRoomGroupId="",this.lModifyTime=0},r.GetStreamInfoByRoomRsp.prototype._clone=function(){return new r.GetStreamInfoByRoomRsp},r.GetStreamInfoByRoomRsp.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.GetStreamInfoByRoomRsp.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.GetStreamInfoByRoomRsp.prototype.writeTo=function(e){e.writeStruct(0,this.tStreamInfoPack),e.writeString(1,this.sRoomId),e.writeString(2,this.sRoomGroupId),e.writeInt64(3,this.lModifyTime)},r.GetStreamInfoByRoomRsp.prototype.readFrom=function(e){this.tStreamInfoPack=e.readStruct(0,!1,this.tStreamInfoPack),this.sRoomId=e.readString(1,!1,this.sRoomId),this.sRoomGroupId=e.readString(2,!1,this.sRoomGroupId),this.lModifyTime=e.readInt64(3,!1,this.lModifyTime)},r.GetStreamInfoByStreamNameReq=function(){this.tId=new r.MediaUserId,this.vStreamName=new Taf.Vector(new Taf.STRING)},r.GetStreamInfoByStreamNameReq.prototype._clone=function(){return new r.GetStreamInfoByStreamNameReq},r.GetStreamInfoByStreamNameReq.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.GetStreamInfoByStreamNameReq.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.GetStreamInfoByStreamNameReq.prototype.writeTo=function(e){e.writeStruct(0,this.tId),e.writeVector(1,this.vStreamName)},r.GetStreamInfoByStreamNameReq.prototype.readFrom=function(e){this.tId=e.readStruct(0,!1,this.tId),this.vStreamName=e.readVector(1,!1,this.vStreamName)},r.GetStreamInfoByStreamNameRsp=function(){this.tStreamInfoPack=new r.MediaStreamInfoPack},r.GetStreamInfoByStreamNameRsp.prototype._clone=function(){return new r.GetStreamInfoByStreamNameRsp},r.GetStreamInfoByStreamNameRsp.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.GetStreamInfoByStreamNameRsp.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.GetStreamInfoByStreamNameRsp.prototype.writeTo=function(e){e.writeStruct(0,this.tStreamInfoPack)},r.GetStreamInfoByStreamNameRsp.prototype.readFrom=function(e){this.tStreamInfoPack=e.readStruct(0,!1,this.tStreamInfoPack)},r.MediaStreamInfoPack=function(){this.mMediaStreamInfoPack=new Taf.Map(new Taf.STRING,new r.MediaStreamNameInfoPack)},r.MediaStreamInfoPack.prototype._clone=function(){return new r.MediaStreamInfoPack},r.MediaStreamInfoPack.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.MediaStreamInfoPack.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.MediaStreamInfoPack.prototype.writeTo=function(e){e.writeMap(0,this.mMediaStreamInfoPack)},r.MediaStreamInfoPack.prototype.readFrom=function(e){this.mMediaStreamInfoPack=e.readMap(0,!1,this.mMediaStreamInfoPack)},r.MediaStreamNameInfoPack=function(){this.vMediaStreamInfo=new Taf.Vector(new r.MediaStreamInfo),this.vStreamGearInfo=new Taf.Vector(new r.StreamGearInfo),this.sStreamGroupId="",this.lLiveCompatibleFlag=0,this.sAntiCode="",this.lStreamId=0,this.lUid=0,this.iStreamProperty=0,this.iBitRate=0,this.iStreamType=0,this.iPcDefaultBitRate=0,this.iWebDefaultBitRate=0,this.iMobileDefaultBitRate=0,this.sStreamBusiProperty="",this.sAdditionalParam=""},r.MediaStreamNameInfoPack.prototype._clone=function(){return new r.MediaStreamNameInfoPack},r.MediaStreamNameInfoPack.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.MediaStreamNameInfoPack.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.MediaStreamNameInfoPack.prototype.writeTo=function(e){e.writeVector(0,this.vMediaStreamInfo),e.writeVector(1,this.vStreamGearInfo),e.writeString(2,this.sStreamGroupId),e.writeInt64(3,this.lLiveCompatibleFlag),e.writeString(4,this.sAntiCode),e.writeInt64(5,this.lStreamId),e.writeInt64(6,this.lUid),e.writeInt32(7,this.iStreamProperty),e.writeInt32(8,this.iBitRate),e.writeInt32(9,this.iStreamType),e.writeInt32(10,this.iPcDefaultBitRate),e.writeInt32(11,this.iWebDefaultBitRate),e.writeInt32(12,this.iMobileDefaultBitRate),e.writeString(13,this.sStreamBusiProperty),e.writeString(14,this.sAdditionalParam)},r.MediaStreamNameInfoPack.prototype.readFrom=function(e){this.vMediaStreamInfo=e.readVector(0,!1,this.vMediaStreamInfo),this.vStreamGearInfo=e.readVector(1,!1,this.vStreamGearInfo),this.sStreamGroupId=e.readString(2,!1,this.sStreamGroupId),this.lLiveCompatibleFlag=e.readInt64(3,!1,this.lLiveCompatibleFlag),this.sAntiCode=e.readString(4,!1,this.sAntiCode),this.lStreamId=e.readInt64(5,!1,this.lStreamId),this.lUid=e.readInt64(6,!1,this.lUid),this.iStreamProperty=e.readInt32(7,!1,this.iStreamProperty),this.iBitRate=e.readInt32(8,!1,this.iBitRate),this.iStreamType=e.readInt32(9,!1,this.iStreamType),this.iPcDefaultBitRate=e.readInt32(10,!1,this.iPcDefaultBitRate),this.iWebDefaultBitRate=e.readInt32(11,!1,this.iWebDefaultBitRate),this.iMobileDefaultBitRate=e.readInt32(12,!1,this.iMobileDefaultBitRate),this.sStreamBusiProperty=e.readString(13,!1,this.sStreamBusiProperty),this.sAdditionalParam=e.readString(14,!1,this.sAdditionalParam)},r.StreamGearInfo=function(){this.sDisplayName="",this.iBitRate=0,this.iCodecType=0,this.iHEVCBitRate=-1,this.tResolution=new r.MediaResolution,this.sAdditionalParam="",this.mSupportFormat=new Taf.Map(new Taf.STRING,new Taf.INT64),this.sBusiGearIndex=""},r.StreamGearInfo.prototype._clone=function(){return new r.StreamGearInfo},r.StreamGearInfo.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.StreamGearInfo.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.StreamGearInfo.prototype.writeTo=function(e){e.writeString(0,this.sDisplayName),e.writeInt32(1,this.iBitRate),e.writeInt32(2,this.iCodecType),e.writeInt32(3,this.iHEVCBitRate),e.writeStruct(4,this.tResolution),e.writeString(5,this.sAdditionalParam),e.writeMap(6,this.mSupportFormat),e.writeString(7,this.sBusiGearIndex)},r.StreamGearInfo.prototype.readFrom=function(e){this.sDisplayName=e.readString(0,!1,this.sDisplayName),this.iBitRate=e.readInt32(1,!1,this.iBitRate),this.iCodecType=e.readInt32(2,!1,this.iCodecType),this.iHEVCBitRate=e.readInt32(3,!1,this.iHEVCBitRate),this.tResolution=e.readStruct(4,!1,this.tResolution),this.sAdditionalParam=e.readString(5,!1,this.sAdditionalParam),this.mSupportFormat=e.readMap(6,!1,this.mSupportFormat),this.sBusiGearIndex=e.readString(7,!1,this.sBusiGearIndex)},r.MediaResolution=function(){this.iWidth=0,this.iHeight=0},r.MediaResolution.prototype._clone=function(){return new r.MediaResolution},r.MediaResolution.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.MediaResolution.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.MediaResolution.prototype.writeTo=function(e){e.writeInt32(0,this.iWidth),e.writeInt32(1,this.iHeight)},r.MediaResolution.prototype.readFrom=function(e){this.iWidth=e.readInt32(0,!1,this.iWidth),this.iHeight=e.readInt32(1,!1,this.iHeight)},r.GetInfoFromVGMReq=function(){this.tId=new r.MediaUserId,this.iServiceType=0,this.iClientType=0,this.iTerminalType=0,this.iRequestVPType=0,this.sMsg=new Taf.BinBuffer,this.iUri=0,this.sProtoName="",this.vStreamName=new Taf.Vector(new Taf.STRING),this.iTypeFlag=0},r.GetInfoFromVGMReq.prototype._clone=function(){return new r.GetInfoFromVGMReq},r.GetInfoFromVGMReq.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.GetInfoFromVGMReq.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.GetInfoFromVGMReq.prototype.writeTo=function(e){e.writeStruct(0,this.tId),e.writeInt32(1,this.iServiceType),e.writeInt32(2,this.iClientType),e.writeInt32(3,this.iTerminalType),e.writeInt32(4,this.iRequestVPType),e.writeBytes(5,this.sMsg),e.writeInt64(6,this.iUri),e.writeString(7,this.sProtoName),e.writeVector(8,this.vStreamName),e.writeInt32(9,this.iTypeFlag)},r.GetInfoFromVGMReq.prototype.readFrom=function(e){this.tId=e.readStruct(0,!1,this.tId),this.iServiceType=e.readInt32(1,!1,this.iServiceType),this.iClientType=e.readInt32(2,!1,this.iClientType),this.iTerminalType=e.readInt32(3,!1,this.iTerminalType),this.iRequestVPType=e.readInt32(4,!1,this.iRequestVPType),this.sMsg=e.readBytes(5,!1,this.sMsg),this.iUri=e.readInt64(6,!1,this.iUri),this.sProtoName=e.readString(7,!1,this.sProtoName),this.vStreamName=e.readVector(8,!1,this.vStreamName),this.iTypeFlag=e.readInt32(9,!1,this.iTypeFlag)},r.GetInfoFromVGMRsp=function(){this.lUid=0,this.lServerId=0,this.sMsg=new Taf.BinBuffer,this.iUri=0,this.sProtoName=""},r.GetInfoFromVGMRsp.prototype._clone=function(){return new r.GetInfoFromVGMRsp},r.GetInfoFromVGMRsp.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.GetInfoFromVGMRsp.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.GetInfoFromVGMRsp.prototype.writeTo=function(e){e.writeInt64(0,this.lUid),e.writeInt64(1,this.lServerId),e.writeBytes(2,this.sMsg),e.writeInt64(3,this.iUri),e.writeString(4,this.sProtoName)},r.GetInfoFromVGMRsp.prototype.readFrom=function(e){this.lUid=e.readInt64(0,!1,this.lUid),this.lServerId=e.readInt64(1,!1,this.lServerId),this.sMsg=e.readBytes(2,!1,this.sMsg),this.iUri=e.readInt64(3,!1,this.iUri),this.sProtoName=e.readString(4,!1,this.sProtoName)},r.EMediaStreamType={EMST_UNKNOWN:-1,EMST_WS_RTMP:1,EMST_AL_RTMP:3,EMST_HUYA_UDP:5,EMST_TX_RTMP:6,EMST_JS_RTMP:8,EMST_HUYA_RTMP:15,EMST_HW_RTMP:16,EMST_BD_RTMP:17,EMST_WS2_RTMP:18,EMST_SW_UDP:20,EMST_ZG_UDP:21,EMST_HWVR_RTMP:22},r.EMediaStreamProperty={EOriginalStream:1,EMixStream:2},r.GetStreamInfoByRoomFakeReq=function(){this.tId=new r.MediaUserId,this.sRoomId="",this.mpVariable=new Taf.Map(new Taf.STRING,new Taf.STRING),this.iMediaPackType=-1},r.GetStreamInfoByRoomFakeReq.prototype._clone=function(){return new r.GetStreamInfoByRoomFakeReq},r.GetStreamInfoByRoomFakeReq.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.GetStreamInfoByRoomFakeReq.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.GetStreamInfoByRoomFakeReq.prototype.writeTo=function(e){e.writeStruct(0,this.tId),e.writeString(1,this.sRoomId),e.writeMap(2,this.mpVariable),e.writeInt32(3,this.iMediaPackType)},r.GetStreamInfoByRoomFakeReq.prototype.readFrom=function(e){this.tId=e.readStruct(0,!1,this.tId),this.sRoomId=e.readString(1,!1,this.sRoomId),this.mpVariable=e.readMap(2,!1,this.mpVariable),this.iMediaPackType=e.readInt32(3,!1,this.iMediaPackType)},r.GetStreamInfoByRoomFakeRsp=function(){this.tStreamInfoPack=new r.MediaStreamInfoPack,this.mpConfig=new Taf.Map(new Taf.STRING,new Taf.STRING),this.sRoomId=""},r.GetStreamInfoByRoomFakeRsp.prototype._clone=function(){return new r.GetStreamInfoByRoomFakeRsp},r.GetStreamInfoByRoomFakeRsp.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.GetStreamInfoByRoomFakeRsp.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.GetStreamInfoByRoomFakeRsp.prototype.writeTo=function(e){e.writeStruct(0,this.tStreamInfoPack),e.writeMap(1,this.mpConfig),e.writeString(2,this.sRoomId)},r.GetStreamInfoByRoomFakeRsp.prototype.readFrom=function(e){this.tStreamInfoPack=e.readStruct(0,!1,this.tStreamInfoPack),this.mpConfig=e.readMap(1,!1,this.mpConfig),this.sRoomId=e.readString(2,!1,this.sRoomId)},r.MediaStreamFormatInfo=function(){this.sFormatName="",this.sUrl="",this.sSuffix="",this.vIPList=new Taf.Vector(new Taf.STRING),this.iIsSupport=0,this.iRate=0,this.sAdditionalParam="",this.lFormatPropertyFlag=0},r.MediaStreamFormatInfo.prototype._clone=function(){return new r.MediaStreamFormatInfo},r.MediaStreamFormatInfo.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.MediaStreamFormatInfo.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.MediaStreamFormatInfo.prototype.writeTo=function(e){e.writeString(0,this.sFormatName),e.writeString(1,this.sUrl),e.writeString(2,this.sSuffix),e.writeVector(3,this.vIPList),e.writeInt32(4,this.iIsSupport),e.writeInt32(5,this.iRate),e.writeString(6,this.sAdditionalParam),e.writeInt64(7,this.lFormatPropertyFlag)},r.MediaStreamFormatInfo.prototype.readFrom=function(e){this.sFormatName=e.readString(0,!1,this.sFormatName),this.sUrl=e.readString(1,!1,this.sUrl),this.sSuffix=e.readString(2,!1,this.sSuffix),this.vIPList=e.readVector(3,!1,this.vIPList),this.iIsSupport=e.readInt32(4,!1,this.iIsSupport),this.iRate=e.readInt32(5,!1,this.iRate),this.sAdditionalParam=e.readString(6,!1,this.sAdditionalParam),this.lFormatPropertyFlag=e.readInt64(7,!1,this.lFormatPropertyFlag)},r.StreamChangeNotice=function(){this.tStreamPack=new r.MediaStreamInfoPack,this.sRoomId=""},r.StreamChangeNotice.prototype._clone=function(){return new r.StreamChangeNotice},r.StreamChangeNotice.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.StreamChangeNotice.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.StreamChangeNotice.prototype.writeTo=function(e){e.writeStruct(0,this.tStreamPack),e.writeString(1,this.sRoomId)},r.StreamChangeNotice.prototype.readFrom=function(e){this.tStreamPack=e.readStruct(0,!1,this.tStreamPack),this.sRoomId=e.readString(1,!1,this.sRoomId)},r.RoomStreamChangeNotic=function(){this.sRoomId="",this.sSeq="",this.iDelay=0},r.RoomStreamChangeNotic.prototype._clone=function(){return new r.RoomStreamChangeNotic},r.RoomStreamChangeNotic.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.RoomStreamChangeNotic.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.RoomStreamChangeNotic.prototype.writeTo=function(e){e.writeString(0,this.sRoomId),e.writeString(1,this.sSeq),e.writeInt32(2,this.iDelay)},r.RoomStreamChangeNotic.prototype.readFrom=function(e){this.sRoomId=e.readString(0,!1,this.sRoomId),this.sSeq=e.readString(1,!1,this.sSeq),this.iDelay=e.readInt32(2,!1,this.iDelay)},r.MediaChangeUpStreamNotic=function(){this.iStreamtype=0,this.sUpUrl="",this.vIps=new Taf.Vector(new Taf.STRING)},r.MediaChangeUpStreamNotic.prototype._clone=function(){return new r.MediaChangeUpStreamNotic},r.MediaChangeUpStreamNotic.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.MediaChangeUpStreamNotic.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.MediaChangeUpStreamNotic.prototype.writeTo=function(e){e.writeInt32(0,this.iStreamtype),e.writeString(1,this.sUpUrl),e.writeVector(2,this.vIps)},r.MediaChangeUpStreamNotic.prototype.readFrom=function(e){this.iStreamtype=e.readInt32(0,!1,this.iStreamtype),this.sUpUrl=e.readString(1,!1,this.sUpUrl),this.vIps=e.readVector(2,!1,this.vIps)},r.MediaStopStreamNotice=function(){this.iAppId=0,this.lSequence=0,this.sStreamName="",this.sReason="",this.iReason=0,this.iFlag=0},r.MediaStopStreamNotice.prototype._clone=function(){return new r.MediaStopStreamNotice},r.MediaStopStreamNotice.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.MediaStopStreamNotice.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.MediaStopStreamNotice.prototype.writeTo=function(e){e.writeInt32(0,this.iAppId),e.writeInt64(1,this.lSequence),e.writeString(2,this.sStreamName),e.writeString(3,this.sReason),e.writeInt32(4,this.iReason),e.writeInt32(5,this.iFlag)},r.MediaStopStreamNotice.prototype.readFrom=function(e){this.iAppId=e.readInt32(0,!1,this.iAppId),this.lSequence=e.readInt64(1,!1,this.lSequence),this.sStreamName=e.readString(2,!1,this.sStreamName),this.sReason=e.readString(3,!1,this.sReason),this.iReason=e.readInt32(4,!1,this.iReason),this.iFlag=e.readInt32(5,!1,this.iFlag)},r.GetMediaConfigReq=function(){this.tId=new r.MediaUserId,this.mpVariable=new Taf.Map(new Taf.STRING,new Taf.STRING)},r.GetMediaConfigReq.prototype._clone=function(){return new r.GetMediaConfigReq},r.GetMediaConfigReq.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.GetMediaConfigReq.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.GetMediaConfigReq.prototype.writeTo=function(e){e.writeStruct(0,this.tId),e.writeMap(1,this.mpVariable)},r.GetMediaConfigReq.prototype.readFrom=function(e){this.tId=e.readStruct(0,!1,this.tId),this.mpVariable=e.readMap(1,!1,this.mpVariable)},r.GetMediaConfigRsp=function(){this.mpConfig=new Taf.Map(new Taf.STRING,new Taf.STRING)},r.GetMediaConfigRsp.prototype._clone=function(){return new r.GetMediaConfigRsp},r.GetMediaConfigRsp.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.GetMediaConfigRsp.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.GetMediaConfigRsp.prototype.writeTo=function(e){e.writeMap(0,this.mpConfig)},r.GetMediaConfigRsp.prototype.readFrom=function(e){this.mpConfig=e.readMap(0,!1,this.mpConfig)}},function(e,t,i){"use strict";var r,n=(r=i(42))&&r.__esModule?r:{default:r},s=window.TafMx||{};window.TafMx=s,s.UriMapping=s.UriMapping||{},s.WupMapping=s.WupMapping||{},s.NoLog=s.NoLog||{},(0,n.default)(s.UriMapping,{1e5:HUYA.StreamChangeNotice,100100:HUYA.MediaBeginLiveNotice,100101:HUYA.MediaEndLiveNotice,100102:HUYA.MediaStopStreamNotice,100200:HUYA.MediaChangeUpStreamNotic,100300:HUYA.RoomStreamChangeNotic}),(0,n.default)(s.WupMapping,{checkIdByStr:HUYA.CheckUidByStrRsp,loginVerify:HUYA.LoginVerifyRsp,refreshCookie:HUYA.RefreshCookieRsp,getMediaConfig:HUYA.GetMediaConfigRsp,getInfoFromVGM:HUYA.GetInfoFromVGMRsp,joinGroup:HUYA.JoinMediaGroupRsp,quitGroup:HUYA.QuitMediaGroupRsp,getStreamInfoByRoom:HUYA.GetStreamInfoByRoomRsp,getStreamInfoByRoomFake:HUYA.GetStreamInfoByRoomFakeRsp}),(0,n.default)(s.NoLog,{loginVerify:1,refreshCookie:1,getMediaConfig:1,getInfoFromVGM:1,getStreamInfoByRoomFake:1})},function(e,t,i){i(95),e.exports=i(2).Object.assign},function(e,t,i){var r=i(3);r(r.S+r.F,"Object",{assign:i(96)})},function(e,t,i){"use strict";var r=i(8),n=i(24),s=i(52),a=i(33),o=i(21),u=i(45),l=Object.assign;e.exports=!l||i(18)((function(){var e={},t={},i=Symbol(),r="abcdefghijklmnopqrst";return e[i]=7,r.split("").forEach((function(e){t[e]=e})),7!=l({},e)[i]||Object.keys(l({},t)).join("")!=r}))?function(e,t){for(var i=o(e),l=arguments.length,h=1,d=s.f,c=a.f;l>h;)for(var f,p=u(arguments[h++]),v=d?n(p).concat(d(p)):n(p),y=v.length,m=0;y>m;)f=v[m++],r&&!c.call(p,f)||(i[f]=p[f]);return i}:l},function(e,t,i){var r=i(20),n=i(47),s=i(98);e.exports=function(e){return function(t,i,a){var o,u=r(t),l=n(u.length),h=s(a,l);if(e&&i!=i){for(;l>h;)if((o=u[h++])!=o)return!0}else for(;l>h;h++)if((e||h in u)&&u[h]===i)return e||h||0;return!e&&-1}}},function(e,t,i){var r=i(48),n=Math.max,s=Math.min;e.exports=function(e,t){return(e=r(e))<0?n(e+t,0):s(e,t)}},function(e,t,i){"use strict";var r=E(i(9)),n=E(i(10)),s=E(i(76)),a=E(i(80)),o=E(i(81)),u=E(i(42)),l=E(i(136)),h=E(i(0)),d=E(i(1)),c=E(i(147)),f=E(i(11)),p=E(i(152)),v=E(i(155)),y=E(i(158)),m=E(i(75)),_=E(i(34)),S=E(i(160)),g=E(i(69)),T=E(i(86));function E(e){return e&&e.__esModule?e:{default:e}}!function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||(0,T.default)(e,t,{enumerable:!0,get:r})},i.r=function(e){void 0!==g.default&&S.default&&(0,T.default)(e,S.default,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==(void 0===e?"undefined":(0,_.default)(e))&&e&&e.__esModule)return e;var r=(0,m.default)(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=2)}([function(e,t,i){var r,n="object"==("undefined"==typeof Reflect?"undefined":(0,_.default)(Reflect))?Reflect:null,s=n&&"function"==typeof n.apply?n.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)};r=n&&"function"==typeof n.ownKeys?n.ownKeys:y.default?function(e){return(0,v.default)(e).concat((0,y.default)(e))}:function(e){return(0,v.default)(e)};var a=p.default||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var u=10;function l(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function h(e,t,i,r){var n,s,a,o;if("function"!=typeof i)throw new TypeError('The "listener" argument must be of type Function. Received type '+(void 0===i?"undefined":(0,_.default)(i)));if(void 0===(s=e._events)?(s=e._events=(0,m.default)(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),s=e._events),a=s[t]),void 0===a)a=s[t]=i,++e._eventsCount;else if("function"==typeof a?a=s[t]=r?[i,a]:[a,i]:r?a.unshift(i):a.push(i),(n=l(e))>0&&a.length>n&&!a.warned){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=a.length,o=u,console&&console.warn&&console.warn(o)}return e}function d(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,s(this.listener,this.target,e))}function S(e,t,i){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},n=d.bind(r);return n.listener=i,r.wrapFn=n,n}function g(e,t,i){var r=e._events;if(void 0===r)return[];var n=r[t];return void 0===n?[]:"function"==typeof n?i?[n.listener||n]:[n]:i?function(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}(n):E(n,n.length)}function T(e){var t=this._events;if(void 0!==t){var i=t[e];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function E(e,t){for(var i=new Array(t),r=0;r<t;++r)i[r]=e[r];return i}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");u=e}}),o.init=function(){void 0!==this._events&&this._events!==(0,f.default)(this)._events||(this._events=(0,m.default)(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return l(this)},o.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var r="error"===e,n=this._events;if(void 0!==n)r=r&&void 0===n.error;else if(!r)return!1;if(r){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var u=n[e];if(void 0===u)return!1;if("function"==typeof u)s(u,this,t);else{var l=u.length,h=E(u,l);for(i=0;i<l;++i)s(h[i],this,t)}return!0},o.prototype.addListener=function(e,t){return h(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return h(this,e,t,!0)},o.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+(void 0===t?"undefined":(0,_.default)(t)));return this.on(e,S(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+(void 0===t?"undefined":(0,_.default)(t)));return this.prependListener(e,S(this,e,t)),this},o.prototype.removeListener=function(e,t){var i,r,n,s,a;if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+(void 0===t?"undefined":(0,_.default)(t)));if(void 0===(r=this._events))return this;if(void 0===(i=r[e]))return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=(0,m.default)(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(n=-1,s=i.length-1;s>=0;s--)if(i[s]===t||i[s].listener===t){a=i[s].listener,n=s;break}if(n<0)return this;0===n?i.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(i,n),1===i.length&&(r[e]=i[0]),void 0!==r.removeListener&&this.emit("removeListener",e,a||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,i,r;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=(0,m.default)(null),this._eventsCount=0):void 0!==i[e]&&(0==--this._eventsCount?this._events=(0,m.default)(null):delete i[e]),this;if(0===arguments.length){var n,s=(0,c.default)(i);for(r=0;r<s.length;++r)"removeListener"!==(n=s[r])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=(0,m.default)(null),this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},o.prototype.listeners=function(e){return g(this,e,!0)},o.prototype.rawListeners=function(e){return g(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):T.call(e,t)},o.prototype.listenerCount=T,o.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e,t,i){var r={buildAbsoluteURL:function(e,t){if(t=t.trim(),/^[a-z]+:/i.test(t))return t;var i=null,n=null,s=/^([^#]*)(.*)$/.exec(t);s&&(n=s[2],t=s[1]);var a=/^([^\?]*)(.*)$/.exec(t);a&&(i=a[2],t=a[1]);var o=/^([^#]*)(.*)$/.exec(e);o&&(e=o[1]);var u=/^([^\?]*)(.*)$/.exec(e);u&&(e=u[1]);var l=/^((([a-z]+):)?\/\/[a-z0-9\.-]+(:[0-9]+)?\/)(.*)$/i.exec(e),h=l[3],d=l[1],c=l[5],f=null;return f=/^\/\//.test(t)?h+"://"+r.buildAbsolutePath("",t.substring(2)):/^\//.test(t)?d+r.buildAbsolutePath("",t.substring(1)):d+r.buildAbsolutePath(c,t),i&&(f+=i),n&&(f+=n),f},buildAbsolutePath:function(e,t){for(var i,r,n=t,s="",a=e.replace(/[^\/]*$/,n.replace(/(\/|^)(?:\.?\/+)+/g,"$1")),o=0;(r=a.indexOf("/../",o))>-1;o=r+i)i=/^\/(?:\.\.\/)*/.exec(a.slice(r))[0].length,s=(s+a.substring(o,r)).replace(new RegExp("(?:\\/+[^\\/]*){0,"+(i-1)/3+"}$"),"/");return s+a.substr(o)},getTimeFromUrl:function(e,t){var i=t?/\d+_(\d+)_\d+.ts?/:/(\d+)_\d+_\d+.ts?/,r=e.match(i);return r?t?r[1]:Math.round(r[1]/1e3):-1},getVodUrl:function(e,t,i,r){return"http://106.38.255.95:9123/xcrs/"+e+"_"+t+"_"+i+".m3u8?btime="+r}};e.exports=r},function(e,t,i){i.r(t);var c={PLAY_STATUS:"PLAY_STATUS",PLAY_CARTON:"PLAY_CARTON",PLAY_TIME_STATUS:"PLAY_TIME_STATUS",VIDEO_PLAY:"VIDEO_PLAY",METADATA:"METADATA",RECV_VIDEO_FRAME:"RECV_VIDEO_FRAME",VIDEO_STOP:"VIDEO_STOP",VIDEO_SEEK:"VIDEO_SEEK",AUDIO_PLAY:"AUDIO_PLAY",AUDIO_SOUND:"AUDIO_SOUND",ANCHOR_STOP:"ANCHOR_STOP",VIDEO_LINK_CLOSE:"VIDEO_LINK_CLOSE",NO_VIDEO:"NO_VIDEO",HLS_URL_UNAVAILABLE:"HLS_URL_UNAVAILABLE",HLS_URL_LOAD_TIMEOUT:"HLS_URL_LOAD_TIMEOUT",HLS_MAINFEST_LOAD_TIMEOUT:"HLS_MAINFEST_LOAD_TIMEOUT",FLV_URL_UNAVAILABLE:"FLV_URL_UNAVAILABLE",FLV_URL_LOAD_TIMEOUT:"FLV_URL_LOAD_TIMEOUT",H5_PLAYER_ERROR:"H5_PLAYER_ERROR",NO_DATA_RECEIVED:"NO_DATA_RECEIVED",P2P_REPORT:"P2P_REPORT",DATA_METRIC:"DATA_METRIC",DATA_METRIC2:"DATA_METRIC2",P2P_TIMEOUT:"P2P_TIMEOUT",FLV_TO_P2P:"FLV_TO_P2P",FLAC_AUDIO_START:"FLAC_AUDIO_START",FLAC_AUDIO_ERROR:"FLAC_AUDIO_ERROR",FLAC_AUDIO_NEED_RETRY:"FLAC_AUDIO_NEED_RETRY",SIGNAL_PLAY:"SIGNAL_PLAY",SIGNAL_HEART:"SIGNAL_HEART",SIGNAL_DATA:"SIGNAL_DATA",SIGNAL_ERROR:"SIGNAL_ERROR",H264_SEI_PLAY:"H264_SEI_PLAY",UPDATE_INTERSITY:"UPDATE_INTERSITY",PLAY_DOWNLINK_INFO:"PLAY_DOWNLINK_INFO",PLAY_FRAME_BUFFER:"PLAY_FRAME_BUFFER",REPLAY_VIDEO:"REPLAY_VIDEO"},p="VIDEO_PLAYING",v="VIDEO_STOP",y="VIDEO_CACHING",m=c,S=function(){function e(){(0,h.default)(this,e)}return(0,d.default)(e,null,[{key:"turnStr",value:function(e,t,i){for(var r=e.toString(t),n=r.length;n<i;n++)r="0"+r;return r}},{key:"rotl64",value:function(t,i){var r=e.turnStr(t,2,64),n=r.substr(i,64-i)+r.substr(0,i);return parseInt(n,2)}},{key:"rotr64",value:function(t,i){var r=e.turnStr(t,2,64),n=r.substr(64-i,i)+r.substr(0,64-i);return parseInt(n,2)}},{key:"rotUid",value:function(t,i){return 0===t&&(t="1234"+e.turnStr(parseInt(9999*Math.random()),10,4)),t=parseFloat(t),i=parseFloat(i),e.rotl64(t^i,8)+i%256}},{key:"revertUid",value:function(t,i){var r=(t=parseFloat(t))-(i=parseFloat(i))%256;return e.rotr64(r,8)^i}},{key:"inet_ntoa",value:function(e){var t,i,r,n=new Uint8Array(4),s=new DataView(n.buffer);return s.setUint32(0,e),t=s.getUint8(0),i=s.getUint8(1),r=s.getUint8(2),s.getUint8(3)+"."+r+"."+i+"."+t}},{key:"ip2uint",value:function(e){for(var t=0,i=e.split("."),r=0;r<i.length;r++)t|=Number(i[r])<<8*r;return t<0&&(t+=4294967296),t}},{key:"isBiggerUint",value:function(e,t){return e!==t&&(e>t?e-t<2147483647:!(t-e<2147483647))}},{key:"isEqualOrBiggerUint",value:function(e,t){return e===t||(e>t?e-t<2147483647:!(t-e<2147483647))}},{key:"isUintMax",value:function(e){return 4294967295===e}},{key:"isUint64Max",value:function(e){return 0x10000000000000000===e}},{key:"getQueryString",value:function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),i=window.location.search.substr(1).match(t);return null!=i?unescape(i[2]):null}},{key:"printHexBytes",value:function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=new DataView(e.buffer),r=t?10:0,n=[];r<i.byteLength;){var s=i.getUint8(r++);(s=s.toString(16).toUpperCase()).length<2&&(s="0"+s),n.push(s,"\t"),r%10==0&&n.push("\n")}console.log(n.join("")+"\tsize:",i.byteLength)}},{key:"getCookie",value:function(e){for(var t=e+"=",i=document.cookie.split(";"),r=0,n=i.length;r<n;r++){var s=i[r].trim();if(0==s.indexOf(t))return s.substr(t.length)}return""}},{key:"formatByteSize",value:function(e){var t=e/1024;return t=t>1024?(t/=1024).toFixed(1)+"MB":t.toFixed(1)+"KB"}},{key:"padStrLen",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.length>=t)return e;var r=" ".repeat(t-e.length);return i?r+e:e+r}},{key:"xhr",value:function(e,t,i,r,n){var s=new XMLHttpRequest;s.overrideMimeType("text/plain; charset=x-user-defined"),s.addEventListener("readystatechange",(function e(){4===s.readyState&&(200===s.status||304===s.status?r(s.response):n(s.status),s.removeEventListener("readystatechange",e),s=void 0)})),s.open(t,e,!0),s.send(i)}},{key:"loadLib",value:function(t,i,r){var n="lib_"+i.replace(".js","");if(!document.getElementById(n)){var s=t+i;return e.loadScript(s,{id:n}).then((function(){return r&&r()}))}}},{key:"loadScript",value:function(e,t){var i=t.timeout,r=void 0===i?6e4:i,n=t.id;return new l.default((function(t,i){var s=document,a=s.createElement("script"),o=setTimeout((function(){u(),i("timeout")}),r);function u(){clearTimeout(o),a.parentNode&&!n&&a.parentNode.removeChild(a)}n&&(a.id=n),a.src=e,a.async=!0,a.onload=function(){u(),t()},a.onerror=function(){u(),i("error")},s.getElementsByTagName("head")[0].appendChild(a)}))}}]),e}();S.IntMax=2147483647,S.IntMin=-2147483647,S.UintMax=4294967295;var g=S,T={};!function(){var e=self.navigator.userAgent.toLowerCase(),t=/(edge)\/([\w.]+)/.exec(e)||/(opr)[\/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(iemobile)[\/]([\w.]+)/.exec(e)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(e)||[],i=/(ipad)/.exec(e)||/(ipod)/.exec(e)||/(windows phone)/.exec(e)||/(iphone)/.exec(e)||/(kindle)/.exec(e)||/(android)/.exec(e)||/(windows)/.exec(e)||/(mac)/.exec(e)||/(linux)/.exec(e)||/(cros)/.exec(e)||[],r={browser:t[5]||t[3]||t[1]||"",version:t[2]||t[4]||"0",majorVersion:t[4]||t[2]||"0",platform:i[0]||""},n={};if(r.browser){n[r.browser]=!0;var s=r.majorVersion.split(".");n.version={major:parseInt(r.majorVersion,10),string:r.version},s.length>1&&(n.version.minor=parseInt(s[1],10)),s.length>2&&(n.version.build=parseInt(s[2],10))}for(var a in r.platform&&(n[r.platform]=!0),(n.chrome||n.opr||n.safari)&&(n.webkit=!0),(n.rv||n.iemobile)&&(n.rv&&delete n.rv,r.browser="msie",n.msie=!0),n.edge&&(delete n.edge,r.browser="msedge",n.msedge=!0),n.opr&&(r.browser="opera",n.opera=!0),n.safari&&n.android&&(r.browser="android",n.android=!0),n.name=r.browser,n.platform=r.platform,T)T.hasOwnProperty(a)&&delete T[a];(0,u.default)(T,n)}(),T.version||(T.version={major:0,minor:0,build:0,string:"0.0.0"});var E=T;function I(e,t){var i=e.toString().length,r=Math.max(0,t-i),n="";if(r>0)for(var s=0;s<r;s++)n+="0";return n+e}var P=0,R=function(){0===P&&(P=Date.now()-1);var e=Date.now()-P;return e>4294967295?(P+=4294967295,e-4294967295):e},k=function(){return Math.round(Date.now()/1e3)},L=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:NaN,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=null,r=(i=e?new Date(e):new Date).getFullYear()+"-"+I(i.getMonth()+1,2)+"-"+I(i.getDate(),2)+" "+I(i.getHours(),2)+":"+I(i.getMinutes(),2)+":"+I(i.getSeconds(),2);return t&&(r+="."+I(i.getMilliseconds(),3)),r},A=99;function w(){return L()+" "}var C=!1,M={_data:[],_length:0,debug:function(){var e=w(),t=Array.apply(null,arguments);t[0]=e+t[0],A<=-1&&console.log.apply(console,t)},log:function(e){var t=w(),i=Array.apply(null,arguments);i[0]=t+i[0],A<=0&&console.log.apply(console,i),M.record(i,"log")},info:function(e){var t=w(),i=Array.apply(null,arguments);i[0]=t+i[0],A<=1&&console.info.apply(console,i),M.record(i,"info")},warn:function(e){var t=w(),i=Array.apply(null,arguments);i[0]=t+i[0],A<=2&&console.warn.apply(console,i),M.record(i,"warn")},error:function(e){var t=w(),i=Array.apply(null,arguments);i[0]=t+i[0],A<=3&&console.error.apply(console,i),M.record(i,"error")},group:function(e){var t=w(),i=Array.apply(null,arguments);if(i[0]=t+i[0],A<=1){var r=console.groupCollapsed||console.group||console.log;r.apply(console,i)}M.record(i,"group")},groupEnd:function(){console.groupEnd&&console.groupEnd.apply(console)},setLevel:function(e){e!=A&&(console.log(w()+" set log level from "+A+" to "+e),A=e)},getLevel:function(){return A},record:function(e,t){1100===M._length&&(M._data.splice(0,100),M._length=1e3);var i=0,r=(e.shift()||"").toString();for(r=r.replace(/\%c/gi,(function(e,t){return i++,""}));i--&&e.length;)e.shift();for(var n=0,s=e.length;n<s;n++)"object"==(0,_.default)(e[n])&&(e[n]="");e.unshift(r);var a=e.join(" ");M._length++,M._data.push("["+t+"]"+a)},getLog:function(){return C||(C=!0,M._data.unshift(E.platform+" "+E.name+" "+E.version.string)),M._data}},D=M,b=new(function(){function e(){(0,h.default)(this,e),this.pushGop=!1,this.jitBufLen=4e3,this.jitMaxBufLen=8e3,this.jitMinBufLen=1e3,this.hlsUseFetch=100,this.baseSubs=10,this.urgentResend=1,this.urgentResendAudio=1,this.crossCdn=0,this.p2pWssLines="all",this.connectTotalTime=6e3,this.connectTimeout=2e3,this.flowTimeout=2e3,this.flowRetryTimes=3,this.renderTimeout=4e3,this.noDataTimeout=3e3,this.testResender=0,this.maxResendTs=3e3,this.minResendTs=200,this.maxResendTimes=2,this.resendGapTs=400,this.resendMinCnt=10,this.resendDelayTs=400,this.patchSubTs=250,this.http2Channel="",this.deleteH264Aud=[],this.useChangeRate=[],this.freeBufferBitrate=1e4,this.needCooling=1,this.needQueue=1,this.queueTime=3e3,this.punchedCoolingTime=3e4,this.delayCloseNum=200,this.punchTimeout=1e6,this.maxPunchedCnt=15,this.maxPunchedCntMore=30,this.maxNodeCnt=30,this.punchBackCooling=2e4,this.punchIgnoreTime=3e5,this.coefficient=8,this.trySubNum=5,this.trySubTime=5e3,this.fastTime=5e3,this.lostSeqTime=6,this.sliceLate=500,this.sliceFast=2e3,this.sliceConstraints=6e3,this.badDelay=2e3,this.emuteDelay=1800,this.switchDelay=500,this.aliveTimeout=1e3,this.resubTime=3e4,this.sliceTimeout=2e3,this.maxPeerStreamNum=8,this.maxUplinkBw=2e3,this.closeUids=[],this.flvEmptyAudioFrame=1,this.sendHeartBeatAlone=0,this.signalNoCdnp=[],this.coderates=[[15e3,10,8e3,5,5,230,1,20],[8e3,1,4e3,5,5,230,5,10],[6e3,1,4e3,5,5,170,5,10],[4e3,0,4e3,5,5,120,5,10],[3e3,0,4e3,5,5,80,5,10],[0,0,4e3,5,5,50,5,10]],this.swapdomain={}}return(0,d.default)(e,[{key:"init",value:function(e){if(e){(0,u.default)(this,e),D.group("Configs");var t=["Configs:"];for(var i in this){var r=this[i];"string"==typeof r&&("pushGop"==i?r=!!Number(r):"coderates"==i||"testCoderates"==i||"swapdomain"==i?(r=r.replace(/[↵\s+\n]/gm,""),r=JSON.parse(r)):"p2pWssLines"!=i&&"http2Channel"!=i&&(r=Number(r))),this[i]=r,"object"==(void 0===r?"undefined":(0,_.default)(r))&&(r=(0,o.default)(r)),i=g.padStrLen(i,18,!1),t.push("\t"+i+" => "+r)}D.log(t.join("\n")),D.groupEnd(),D.log("Config",this)}}}]),e}()),O={KEY_VALUE:"value",KEY_STR:"str",KEY_DIM:"dim",K:"k",LIVE_TYPE:{FLV:0,P2P:1,HLS:2},HEART_TYPE:{START:0,CONTINUS:1,END:2},DIM_COM:{P2P:"p2p",STREAM_URL:"stream_url",CDNP_CONNECT_IP:"cdnp_connect_ip",CDNP_CONNECTED:"cdnp_connected",USER_WAN_IP:"user_wan_ip",VIDEO_LOGIN_FAIL:"video_login_fail",ORIGINAL_BITRATE:"original_bitrate",BROWSER_NAME:"browser_name",BROWSER_VERSION:"browser_version",SPHD_TYPE:"sphd_type",DPI:"dpi",CDNIP:"cdnip",P2P_COOL_FLAG:"p2p_cool_flag",MP_EXPERIMENT:"mp_experiment",ACT_LOAD_TYPE:"act_load_type",PLAYER_TYPE:"player_type",LIVE_TYPE:"live_type",START_TYPE:"start_type"},DIM_CORE:{VIDEO_BAD_QUALITY_OLD:"video_bad_quality_old",VIDEO_BAD_QUALITY:"video_bad_quality",VIDEO_BAD_REASON:"video_bad_reason",USER_PROPERTY:"user_property",HEART_TYPE:"heart_type",SIGNAL_USER_PROPERTY:"signal_user_property"},DIM_EXT:{CDN_IP:"cdn_ip"},CORE:{name:"yspwl.web.live.user.heart20",CDN_TOTAL_BW:"cdn_total_bw",CDN_VALID_BW:"cdn_valid_bw",CDN_REPEAT_BW:"cdn_repeat_bw",P2P_TOTAL_BW:"p2p_total_bw",P2P_REPEAT_BW:"p2p_repeat_bw",P2P_VALID_BW:"p2p_valid_bw",RANGE_TOTAL_BW:"range_total_bw",RANGE_VALID_BW:"range_valid_bw",DEFAULT_BW:"default_bw",FAST_BW:"fast_bw",PATCH_BW:"patch_bw",COMPETE_BW:"compete_bw",FIXED_BW:"fixed_bw",FORCE_BW:"force_bw",SIGNAL_UP_BW:"signal_up_bw",SIGNAL_DOWN_BW:"signal_down_bw",BUFFER_LENGTH:"buffer_length",PLAY_DELAY:"play_delay",HAS_PUNCH_NODES:"has_punch_nodes",FORWARD_REJECT_CNT:"forward_reject_cnt"},UPDOWN_INFO:{name:"updown_info",UPLINK_BW:"uplink_bw",DOWNLINK_BW:"downlink_bw",UPLINK_CNT:"uplink_cnt",UPLINK_LIMIT_CNT:"uplink_limit_cnt"},SIGNAL_HEART20:{name:"yspwl.web.live.signal.heart20",STREAM_NAME:"stream_name",STREAM_DELAY:"stream_delay",FULL_FRAME_NUM:"full_frame_num",LOST_FRAME_NUM:"lost_frame_num",P2P_FLOW_DANMU:"p2p_flow_danmu",P2P_FLOW_EMPTY:"p2p_flow_empty",CDN_FLOW_DANMU_VALID:"cdn_flow_danmu_valid",CDN_FLOW_DANMU_TOTAL:"cdn_flow_danmu_total",CDN_FLOW_EMPTY_VALID:"cdn_flow_empty_valid",CDN_FLOW_EMPTY_TOTAL:"cdn_flow_empty_total"},HLS_INFO:{name:"hls_info",M3U8_CNT:"m3u8_cnt",M3U8_SUC_CNT:"m3u8_suc_cnt",M3U8_FAIL_CNT:"m3u8_fail_cnt",M3U8_EMPTY_CNT:"m3u8_empty_cnt",M3U8_WRONG_CNT:"m3u8_wrong_cnt",M3U8_TIMEOUT_CNT:"m3u8_timeout_cnt",TS_CNT:"ts_cnt",TS_SUC_CNT:"ts_suc_cnt",TS_FAIL_CNT:"ts_fail_cnt",TS_TIMEOUT_CNT:"ts_timeout_cnt",TS_OPEN_AVG:"ts_open_avg",TS_LOADED_AVG:"ts_loaded_avg",TS_SPEED_AVG:"ts_speed_avg",TS_SIZE_AVG:"ts_size_avg"},FRAME_INFO:{name:"frame_info",LOSS_FRAMES:"loss_frames",PLAY_FRAMES:"play_frames",DTS_JUMPPAUSE_CNT:"dts_jumppause_cnt",SKIP_PAUSE_CNT:"skip_pause_cnt",EMPTY_FRAMES:"empty_frames",FULL_RATIO:"full_ratio"},SUB_INFO:{name:"sub_info",TOTAL_CNT:"total_cnt",SUCC_CNT:"succ_cnt",FAIL_CNT:"fail_cnt",TIMEOUT_CNT:"timeout_cnt",KICK_CNT:"kick_cnt",TRY_CNT:"try_cnt",CMP_TOTAL_CNT:"cmp_total_cnt",CMP_SUCC_CNT:"cmp_succ_cnt",CMP_FAIL_CNT:"cmp_fail_cnt",CMP_TIMEOUT_CNT:"cmp_timeout_cnt",FORCE_CNT:"force_cnt"},PUNCH_INFO:{name:"punch_info",TOTAL_CNT:"total_cnt",VALID_CNT:"valid_cnt",TRY_CNT:"try_cnt",SUCC_CNT:"succ_cnt",BACK_CNT:"back_cnt",BACK_SUCC_CNT:"back_succ_cnt",BACK_TRY_CNT:"back_try_cnt"},PUNCH_BACK_RET:{name:"punch_back_ret"},RESEND_INFO:{name:"resend_info",RESEND_CNT:"resend_cnt",TIMEOUT_CNT:"timeout_cnt",ERROR_CNT:"error_cnt",SLICE_CNT:"slice_cnt",RESPOND_CNT:"respond_cnt",LATE_CNT:"late_cnt",MISS_CNT:"miss_cnt",REPEAT_CNT:"repeat_cnt",REPEAT_SUCC_CNT:"repeat_succ_cnt",REPEAT_FAIL_CNT:"repeat_fail_cnt",LIMIT_CNT:"limit_cnt"},SUBSTREAM_INFO:{name:"substream_info",FIXED_CNT:"fixed_cnt",FORCE_CNT:"force_cnt",COMPETE_CNT:"compete_cnt"},FORCESUB_REASON:{name:"forcesub_reason",NOPEER_CNT:"nopeer_cnt",SUBEND_CNT:"subend_cnt",TIMEOUT_CNT:"timeout_cnt"},SUB_RETURN:{sub_name:"sub_return",switch_name:"switch_return",last_name:"last_return"},NONODE_RETURN:{name:"nonode_return",PRESENTER_CNT:"presenter_cnt",UPLINK_LESS_CNT:"uplink_less_cnt",PULL_SAME_CNT:"pull_same_cnt",SUBED_CNT:"subed_cnt",COOL_CNT:"cool_cnt",DELAY_CNT:"delay_cnt",RTT_CNT:"rtt_cnt",LATE_CNT:"late_cnt",FAST_CNT:"fast_cnt",NONE_CNT:"none_cnt"},P2P_TCP_TYPE:{name:"p2p_tcp_type"},P2P_TCP_STATE:{name:"p2p_tcp_state"},ACT:{name:"yspwl.web.live.user.act",field:"act_type",NO_PICTURE:"no_picture",HLS_PLAY_SUCC:"hls_play_succ",HLS_LOAD_SUCC:"hls_load_succ",P2P_PLAY_FAIL:"p2p_play_fail",P2P_LOAD_VIDEO:"p2p_load_video",P2P_RESTART:"p2p_restart",TCP_NO_SLICE:"tcp_no_slice",TCP_OPEN_TIME:"tcp_open_time",HTTP_CODE_:"http_code_",TCP_TIMEOUT:"tcp_timeout",P2P_COOLING:"p2p_cooling",CONNECT_VIDEO_TS:"connect_video_ts",RECV_VIDEO_TS:"recv_video_ts",FIRST_VIDEO_PKG_TS:"first_video_pkg_ts",FIRST_VIDEO_IFRAME_TS:"first_video_iframe_ts",VIDEO_IFRAME_TS:"video_iframe_ts",FIRST_VIDEO_RENDER_TS:"first_video_render_ts",VIDEO_PLAYED_TS:"video_played_ts",VIDEO_LOAD_TS:"video_load_ts",VIDEO_GET_VP_TS:"video_get_vp_ts",VIDEO_LOGIN_TS:"video_login_ts",LOAD_M3U8_TS:"load_m3u8_ts",FIRST_FRAG_LOAD_TS:"first_frag_load_ts",FIRST_FRAG_LOADED_TS:"first_frag_loaded_ts",FIRST_FRAG_SIZE:"first_frag_size",SIGNAL_TURN_BACK:"signal_turn_back"}},N=function(){function e(t){(0,h.default)(this,e),this.hyPlayer=t,this.stat=t.stat,this.isSendLoadTime=!1,this.isSendH265=!1,this.hasP2P=0,this.restartReason=-1,this.restartTimes=0,this.turnToFlvReason=-1,this.turnToFlvTimes=0,this.httpError=!1}return(0,d.default)(e,[{key:"sendCdnTime",value:function(e,t){if(!this.isSendLoadTime)if(this.isSendLoadTime=!0,t){var i=Math.max(0,e.connectVideoTime-e.startTime),r=e.firstVideoPkgTime-e.connectVideoTime,n=e.firstIFrameTime1-e.connectVideoTime,s=e.firstIFrameTime2-e.firstIFrameTime1,a=e.firstRenderTime-e.firstIFrameTime2,o=e.onPlayTime-e.firstRenderTime,u=e.onPlayTime-e.startTime,l=[{sMetricName:"video.connect_video_time",vField:{value:i}},{sMetricName:"video.first_video_pkg_time",vField:{value:r}},{sMetricName:"video.first_iframe_time",vField:{value:n}},{sMetricName:"video.iframe_time",vField:{value:s}},{sMetricName:"video.first_render_time",vField:{value:a}},{sMetricName:"video.video_played_time",vField:{value:o}},this.stat.createAct(O.ACT.CONNECT_VIDEO_TS,{value:[i]}),this.stat.createAct(O.ACT.FIRST_VIDEO_PKG_TS,{value:[r]}),this.stat.createAct(O.ACT.FIRST_VIDEO_IFRAME_TS,{value:[n]}),this.stat.createAct(O.ACT.VIDEO_IFRAME_TS,{value:[s]}),this.stat.createAct(O.ACT.FIRST_VIDEO_RENDER_TS,{value:[a]}),this.stat.createAct(O.ACT.VIDEO_PLAYED_TS,{value:[o]}),this.stat.createAct(O.ACT.VIDEO_LOAD_TS,{value:[u]})];this.sendMetrics(l)}else{var h=e.getVPTime-e.startTime,d=Math.max(0,e.connectVideoTime-e.getVPTime),c=e.loginTime-e.connectVideoTime,f=e.firstVideoPkgTime-e.loginTime,p=e.firstIFrameTime-e.firstVideoPkgTime,v=e.firstRenderTime-e.firstIFrameTime,y=e.onPlayTime-e.firstRenderTime,m=e.onPlayTime-e.startTime,_=[{sMetricName:"video.get_vp_time",vField:{value:h}},{sMetricName:"video.connect_video_time",vField:{value:d}},{sMetricName:"video.login_time",vField:{value:c}},{sMetricName:"video.first_video_pkg_time",vField:{value:f}},{sMetricName:"video.first_iframe_time",vField:{value:p}},{sMetricName:"video.first_render_time",vField:{value:v}},{sMetricName:"video.video_played_time",vField:{value:y}},this.stat.createAct(O.ACT.VIDEO_GET_VP_TS,{value:[h]}),this.stat.createAct(O.ACT.CONNECT_VIDEO_TS,{value:[d]}),this.stat.createAct(O.ACT.VIDEO_LOGIN_TS,{value:[c]}),this.stat.createAct(O.ACT.FIRST_VIDEO_PKG_TS,{value:[f]}),this.stat.createAct(O.ACT.FIRST_VIDEO_IFRAME_TS,{value:[p]}),this.stat.createAct(O.ACT.FIRST_VIDEO_RENDER_TS,{value:[v]}),this.stat.createAct(O.ACT.VIDEO_PLAYED_TS,{value:[y]}),this.stat.createAct(O.ACT.VIDEO_LOAD_TS,{value:[m]})];this.sendMetrics(_)}}},{key:"sendFlvTime",value:function(e,t,i,r){var n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;if((!this.isSendLoadTime||n)&&(this.isSendLoadTime=!0,!(e>1e4||t>1e4))){var o=0;a&&(o+=1),s&&(o+=2),this.stat.setComDim(O.DIM_COM.ACT_LOAD_TYPE,o);var u=[{sMetricName:"video.video_load_time_flv",vField:{value:e},vDimension:{p2p:0}},{sMetricName:"video.video_load_time",vField:{value:e},vDimension:{p2p:0}},{sMetricName:"video.video_connect_time_flv",vField:{value:t},vDimension:{p2p:0}},this.stat.createAct(O.ACT.VIDEO_LOAD_TS,{value:[e,i,t,s,a]}),this.stat.createAct(O.ACT.CONNECT_VIDEO_TS,{value:[t]}),this.stat.createAct(O.ACT.RECV_VIDEO_TS,{value:[i,r]})];this.sendMetrics(u)}}},{key:"sendHlsTime",value:function(e,t,i,r,n,s){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;if(!this.isSendLoadTime){var u=0;if(o&&(u+=1),a&&(u+=2),this.stat.setComDim(O.DIM_COM.ACT_LOAD_TYPE,u),this.isSendLoadTime=!0,!(t>1e4||i>1e4||n>1e4)){var l=[{sMetricName:"video.video_load_time",vField:{value:t},vDimension:{p2p:2}},{sMetricName:"video.video_load_time_hls",vField:{loadType:e,loadTime:t,loadM3u8Time:i,firstFragLoadTs:r,firstFragLoadedTs:n,firstFragSize:s}},this.stat.createAct(O.ACT.VIDEO_LOAD_TS,{value:[t,e,0,a,o]}),this.stat.createAct(O.ACT.LOAD_M3U8_TS,{value:[i,e]}),this.stat.createAct(O.ACT.FIRST_FRAG_LOAD_TS,{value:[r,e]}),this.stat.createAct(O.ACT.FIRST_FRAG_LOADED_TS,{value:[n,e]}),this.stat.createAct(O.ACT.FIRST_FRAG_SIZE,{value:[s,e]})];this.sendMetrics(l)}}}},{key:"sendMetrics",value:function(e){this.hyPlayer.trigger(m.DATA_METRIC2,e)}},{key:"sendOldMetrics",value:function(e){this.hyPlayer.trigger(m.DATA_METRIC,e)}}]),e}();N.METRIC={VIDEO_FLOW_LINE:"video.flow.line",VIDEO_FLOW_P2P:"video.flow.p2p",VIDEO_BAD_QUALITY_RATIO:"video.video_bad_quality_ratio",WEB_HLS_PLAY_VIDEO_RATIO:"web.hls.play_video_ratio",WEB_HLS_PLAY_SUC_RATIO:"web.hls.play_suc_ratio",WEB_P2P_PLAY_RATIO:"web.p2p.play_ratio",WEB_P2P_PUNCH:"web.p2p.punch",WEB_P2P_BW_P2P_VALID:"web.p2p.bw_p2p_valid",WEB_P2P_BW_P2P_REPEAT:"web.p2p.bw_p2p_repeat",WEB_P2P_BW_P2P_TOTAL:"web.p2p.bw_p2p_total",WEB_P2P_BW_CDN_VALID:"web.p2p.bw_cdn_valid",WEB_P2P_BW_CDN_REPEAT:"web.p2p.bw_cdn_repeat",WEB_P2P_BW_CDN_TOTAL:"web.p2p.bw_cdn_total",WEB_P2P_BW_RANGE_VALID:"web.p2p.bw_range_valid",WEB_P2P_BW_RANGE_TOTAL:"web.p2p.bw_range_total",WEB_P2P_PLAY_FAIL:"web.p2p.play_fail",WEB_P2P_LOAD_RATIO:"web.p2p.load_ratio",WEB_P2P_CDN_RESTART:"web.p2p.cdn_restart",WEB_P2P_TCP_NO_SLICE:"web.p2p.tcp_no_slice",WEB_P2P_TCP_OPEN_TIME:"web.p2p.tcp_open_time",WEB_P2P_HTTP_CODE:"web.p2p.http_code_",WEB_P2P_TCP_TIMEOUT:"web.p2p.tcp_timeout",WEB_H265:"web.h265",SDK_P2P_TCP:"sdk.p2p.tcp",SDK_VIDEO_LOGIN_SUC:"sdk.video.login_suc",SDK_P2P_COOLING:"sdk.p2p.cooling",SDK_P2P_SERVER_OPEN:"sdk.p2p.server_open",SDK_P2P_USER_PROPERTY:"sdk.p2p.user_property",VIDEO_VIDEO_BAD_QUALITY_5M_RATIO:"video.video_bad_quality_5m_ratio",VIDEO_VIDEO_LOAD_ERROR:"video_load_error",RECV_DANMU_CARTON:"recv_danmu_carton",SDK_P2P_DETAILS:"sdk.p2p.details",SDK_P2P_FORCE_REASON:"sdk.p2p.force_reason",SDK_P2P_DEFAULT_REASON:"sdk.p2p.default_reason",SDK_P2P_VALID_RET:"sdk.p2p.valid_ret",SDK_P2P_GET_NODE:"sdk.p2p.get_node",WEB_USER:"web.user"},N.INTERVAL={SDK_VIDEO_QUALITY:"sdk.video.quality",SDK_VIDEO_QUALITY_5M:"sdk.video.quality_5m",SDK_CALC_FLOW:"sdk.calc.flow",SDK_P2P_TCP:"sdk.p2p.tcp",SDK_P2P_FLOW:"sdk.p2p.flow",SDK_P2P_PUNCH:"sdk.p2p.punch",SDK_P2P_SUB:"sdk.p2p.sub",SDK_P2P_RESEND:"sdk.p2p.resend",SDK_P2P_DELAY:"sdk.p2p.resend",SDK_P2P_OTHER:"sdk.p2p.other"},N.TRIGGER={SDK_HLS_PLAY:"sdk.hls.play",SDK_HLS_LOAD:"sdk.hls.load",SDK_MSE_ERROR:"sdk.mse.error",SDK_P2P_LOAD:"sdk.p2p.load",SDK_P2P_LOAD_SAMPLE:"sdk.p2p.load_sample",SDK_P2P_RESTART:"sdk.p2p.restart",SDK_WEB_H265:"sdk.web.h265"};var F=N,U=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;(0,h.default)(this,e),this.maxSize=t,this.sum=0,this.list=[],this.idx=0,this.cur=0}return(0,d.default)(e,[{key:"reset",value:function(){this.sum=0,this.list=[],this.idx=0,this.cur=0}},{key:"addCur",value:function(e){this.cur+=e}},{key:"calculate",value:function(){this.add(this.cur);var e=this.cur;return this.cur=0,e}},{key:"add",value:function(e){this.sum+=e,this.list.length<this.maxSize?this.list.push(e):(this.sum-=this.list[this.idx],this.list[this.idx]=e),this.idx++,this.idx>=this.maxSize&&(this.idx=0)}},{key:"average",value:function(){return 0===this.list.length?g.UintMax:Math.round(this.sum/this.list.length)}},{key:"getSamples",value:function(){return this.list}},{key:"max",value:function(){if(0===this.list.length)return g.UintMax;var e=0,t=!0,i=!1,r=void 0;try{for(var n,s=(0,a.default)(this.list);!(t=(n=s.next()).done);t=!0){var o=n.value;o>e&&(e=o)}}catch(e){i=!0,r=e}finally{try{!t&&s.return&&s.return()}finally{if(i)throw r}}return e}},{key:"min",value:function(){var e=0,t=!0,i=!1,r=void 0;try{for(var n,s=(0,a.default)(this.list);!(t=(n=s.next()).done);t=!0){var o=n.value;o<e&&(e=o)}}catch(e){i=!0,r=e}finally{try{!t&&s.return&&s.return()}finally{if(i)throw r}}return e}}]),e}(),B=function(){function e(){(0,h.default)(this,e),this.speed=new U(20),this.rtt=new U(20),this.p2p=0}return(0,d.default)(e,[{key:"addSpeed",value:function(e){var t=parseInt(e.replace("KB",""));this.speed.add(t)}},{key:"addRtt",value:function(e){this.rtt.add(e)}},{key:"setP2p",value:function(e){this.p2p=e}},{key:"getP2p",value:function(){return this.p2p}},{key:"getResult",value:function(){return{speed:this.speed.getSamples(),rtt:this.rtt.getSamples(),p2p:this.p2p}}}]),e}(),V=i(0),x=i.n(V),H=new(function(){function e(){(0,h.default)(this,e),this.version=1100,this.baseSubs=10,this.uid=0,this.roomId=0,this.uuid=0,this.convertUid=0,this.appId=66,this.appid=66}return(0,d.default)(e,[{key:"initUUId",value:function(){0===this.uuid&&(this.uuid=Number((Date.now()%1e10*1e3+(1e3*Math.random()|0))%4294967295));var e=Number(localStorage.appid);e&&(this.appid=e,D.warn("--- test appid "+e+" ---",this))}}]),e}()),G={SLICE_SPEED:12.5,MAX_PACKET_CNT:1e4,SWITCH_INTERVAL:10,MAX_DELAY:66e4,DEFAULT_DELAY:65535,SUBSCRIBE_TIMEOUT:1e4,PUNCH_BACK_COOLING:2e4,PUNCH_IGNORE_TIME:3e5,SUB_TIMEOUT:5e3,RESUB_TIMEOUT:3e4,STREAM_DELAY:2e3,EMULATE_DELAY:1800,MAX_DEPTH:1,PROXY_NUM:3,MAX_PEER_STREAM_NUM:8,MAX_PUSH_NUM:3,MAX_PULL_NUM:3,SLICE_DELAY:100,SLICE_LATE:50,SLICE_FAST:50,SLICE_TIMEOUT:2e3,SWITCH_DELAY:500,StreamType:{NONE:0,FORCE:1,FIXED:2,COMPETE:3,PEER:4},LeaveReason:{PING_DIF:1,RESET:2},DEL_REASON:{CHANNEL_CLOSE:1,CHANNEL_ERROR:2,NODE_LEAVE:3,SERVER_REJECT:5,PEER_ERROR:6,PEER_TIMEOUT:7,PING_TIMEOUT:8,OTHER_SID:9,EMPTY_SLICE:10,SUB_TIMEOUT:11,SUB_FAIL_TIMES:12,NODE_REJECT:13,DIF_CDNP:14,PEER_HANDLER_ERR:15},PERIOD:{UPLINK_CALC:10,CHECK_SEED:20,GET_NODE:5},SubType:{SUBSCRIBE_FORCE:0,SUBSCRIBE_NORMAL:1},LoadVideoTimeoutReason:{FLV_DISCONNECTED:0,FLV_CONNECTED:1,FLV_CONNECT_ERROR:2,FLV_RECV_DATA:3,FLV_DATA_INVALID:4,FLV_STARTPLAY:5,FLV_PLAYERROR:6,HLS_DISCONNECTED:7,HLS_LOADMANIFEST_ERROR:8,HLS_LOADMANIFEST_SUCCESS:9,HLS_LOADFRAMENT:10,HLS_LOADFRAMENT_ERROR:11,HLS_LOADFRAMENT_SUCCESS:12,HLS_PLAY_ERROR:13},SubResCode:{ACCEPT_SUBSCRIBE:0,EMPTY_UPLOAD_NUM:1,DETECT_SUBSCRIBE_CYCLE:2,EMPTY_PEER_INFO:3,SUBSCRIBE_UPLINK_NOT_ENOUGH:4,PUBLISHER_KICK_OFF:5,NOT_SUBSCRIBER:6,INVALID_SUB_STREAM:7,ACCEPT_BY_SUBSCRIBER_UPLINK:9,INVALID_STREAMID:10,SERVER_EMPTY_BW:11,PUBLISHER_LEAVE:12,DIFFERENT_VIDEO_PROXY:13,OLD_VERSION_REQ:14,INVALID_TREE_DEPTH:15,INVALID_MAX_SUBSTREAM_NUM:16,STREAM_LATE:17,DEPTH_LARGE:18,STREAM_LIMIT:19,SLICE_LARGE:20,NOT_FOUND_PKG:21,KICK_OUT:22,SELF_WORST:23,SLICE_LATE:24,SLICE_FAST:25,RESTART:26,RESET:27,DIF_BASE_SUBS:28},VIDEO_COMPETE_UID:4294967295,VIDEO_FORCE_UID:0,VIDEO_FIXED_UID:-1,VIDEO_DEFAULT_UID:-2,isProxyUid:function(e){return e===G.VIDEO_COMPETE_UID||e===G.VIDEO_FORCE_UID||e===G.VIDEO_FIXED_UID||e===G.VIDEO_DEFAULT_UID},isCompete:function(e){return e===G.VIDEO_COMPETE_UID},isForce:function(e){return e===G.VIDEO_FORCE_UID},isFixed:function(e){return e===G.VIDEO_FIXED_UID},isDefault:function(e){return e===G.VIDEO_DEFAULT_UID},isSliceJumpFromPeer:function(e,t){return t.isFromPeer&&e>0&&t.seq-e>10*G.LOST_SEQ_NUM},offerReject:{REASON_NOTSTART:1,REASON_PUNCHFAILED_CD:2,REASON_PUNCHED_FULL:3,REASON_QUOTA_EXHAUST:4,REASON_VERSION:5,REASON_DIF_LINE:6,REASON_FAIL:7,REASON_IGNORE:8,REASON_HAS_NODE:9,REASON_WAITING:10,REASON_OTHER:100},offerRejectTime:12e4,punchBackRet:{SUC:0,DIF_STREAM:1,CLOSING:2,COOLING:3,REQUEST:4,REJECT:5},restartReason:{RANGE_SEQ_MAX:1,RANGE_SEQ_LARGE:2,CDN_JUMP:3,PLAYER_NO_DATA:4,LOST_SEQ:5,CONNECT:6,WORKER_ERROR:7,MULTI_CDN:8,FLV_TO_P2P:9,PLAYER_ERROR:10,PLAYER_DISPOSE:11,LOST_SEQ_JUMP:12},turnToFlvReason:{FULL_PLAY_FAIL:1,FULL_CONNECT_TIMEOUT:2,SUB_CONNECT_TIMEOUT:3,FULL_NO_DATA:4,SUB_NO_DATA:5,P2P_ARGS_ERROR:6,P2P_COOLING:7,FLV_TO_P2P_FAIL:8,FLV_TO_P2P_FULL_STREAM_COMPLETE:9,FULL_ERROR:10,FULL_CLOSE:11,SUB_ERROR:12,SUB_CLOSE:13,RESTART_TIMES:14,SIGNAL_TIMEOUT:15,PROBE_TIMEOUT:16,PROBE_ERROR:17,NO_DATA_TIMEOUT:18},userProperty:{SERVER_CLOSE:1,CLIENT_CLOSE:2,BROWSER_UN_SUPPORT:3,FLASH:4,UNKNOW:5,P2P:6,FIRST_FULL_CONNECT_TIMEOUT:7,FIRST_FULL_PLAY_FAIL:8,FIRST_FULL_NO_DATA:17,RESTART_RANGE_MAX:9,RESTART_RANGE_LARGE:10,RESTART_CONNECT:11,RESTART_MUTI_CDN:12,RESTART_PLAYER_NO_DATA:13,RESTART_PLAYER_ERROR:14,SUB_NO_DATA:15,SUB_CONNECT_TIMEOUT:16,P2P_ARGS_ERROR:18,FLV_TO_P2P:19,LOST_SEQ:20,P2P_COOLING:21},pauseReason:{FLV_NO_BUFF:1,FLV_UNKNOW_PAUSE:2,FLV_NET_SLOW:3,P2P_NO_BUFF:4,P2P_UNKNOW_PAUSE:5,P2P_FULL_LOADER_NO_DATA:10,P2P_FULL_LOADER_CONNECT_FAIL:11,P2P_SUB_LOADER_NO_DATA:12,P2P_SUB_LOADER_CONNECT_FAIL:13,FLV_NO_DATA:14,P2P_NO_SLICE:15,P2P_RESEND_SKIP_FRAME:20,P2P_RESEND_TOOLATE:21,P2P_RESEND_TIMEOUT:22,P2P_RESEND_ERROR:23,P2P_RESEND_MISSING:24,P2P_DTS_JUMP:25,P2P_NET_SLOW:26},DataType:{SIGNALLING:0,PING:1,SLICE:2},LOST_SEQ_NUM:4e3,initConfig:function(e,t){for(var i=t.coderates,r=null,n=0;n<i.length;n++)if(r=i[n],e>Number(r[0])){G.PROXY_NUM=Number(r[1]),G.SLICE_DELAY=Number(r[2]),G.MAX_PUSH_NUM=Number(r[3]),G.MAX_PULL_NUM=Number(r[4]),G.SLICE_LARGE=Number(r[5]);break}G.MAX_PEER_STREAM_NUM=Number(t.maxPeerStreamNum)||8;var s=G.SLICE_SPEED*H.baseSubs*(e/1e3);G.SLICE_LATE=parseInt(s*((Number(t.sliceLate)||1e3)/1e3)),G.SLICE_FAST=parseInt(s*((Number(t.sliceFast)||2e3)/1e3)),G.STREAM_DELAY=Number(t.badDelay)||2e3,G.EMULATE_DELAY=Number(t.emuteDelay)||1800,G.RESUB_TIMEOUT=Number(t.resubTime)||3e4,G.SLICE_TIMEOUT=Number(t.sliceTimeout)||2e3,G.SWITCH_DELAY=Number(t.switchDelay)||500},HLS_LOAD_TYPE:{FETCH:1,XHR:2}},Y=G,W=10,j=!1,q=[],K=0;function J(e,t){for(var i=0,r=q.length;i<r;i++){var n=q[i];if(n.callback==e&&n.thisObj==t)return n}return null}function z(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if((i=0|(Number(i)||0))<W||i%W!=0||!e)return D.error("Timer.add Invalide interval value or callback function."),!1;var s=J(e,t);return s||(s={callback:e,thisObj:t,bindCallback:t?e.bind(t):e,param:r},q.push(s)),s.times=n,s.tickCount=0,s.interval=i/W,s.delayDel=!1,!K&&q.length>0&&(K=setInterval(X,W)),!0}function X(){if(0!=q.length){j=!0;for(var e=R(),t=q.length-1;t>=0;t--){var i=q[t];if(i&&!i.delayDel){if(++i.tickCount%i.interval==0){var r=i.bindCallback,n=i.tickCount/i.interval;r(e,n,i.param),i.times>0&&i.times<=n&&i.tickCount>0&&q.splice(t,1)}}else q.splice(t,1)}j=!1}else clearInterval(K),K=0}var Q={has:function(e,t){return!!J(e,t)},add:z,remove:function(e,t){for(var i=0,r=q.length;i<r;i++){var n=q[i];if(n.callback==e&&n.thisObj==t)return j?n.delayDel=!0:q.splice(i,1),!0}return!1},once:function(e,t,i,r){z(e,t,i+W,r,1)},getSize:function(){return q.length}},Z=function(){function e(){(0,h.default)(this,e)}return(0,d.default)(e,null,[{key:"init",value:function(){var t;for(t in e.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var i=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:i,audio:r};var n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=s,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var a=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),u=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,a,u,a,o),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,n))}},{key:"box",value:function(e){for(var t,i=Array.prototype.slice.call(arguments,1),r=8,n=i.length,s=n;n--;)r+=i[n].byteLength;for((t=new Uint8Array(r))[0]=r>>24&255,t[1]=r>>16&255,t[2]=r>>8&255,t[3]=255&r,t.set(e,4),n=0,r=8;n<s;n++)t.set(i[n],r),r+=i[n].byteLength;return t}},{key:"hdlr",value:function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])}},{key:"mdat",value:function(t){return e.box(e.types.mdat,t)}},{key:"mdhd",value:function(t,i){return e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,i>>24,i>>16&255,i>>8&255,255&i,85,196,0,0]))}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))}},{key:"mfhd",value:function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"minf",value:function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))}},{key:"moof",value:function(t,i,r){return e.box(e.types.moof,e.mfhd(t),e.traf(r,i))}},{key:"moov",value:function(t){for(var i=t.length,r=[];i--;)r[i]=e.trak(t[i]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(r).concat(e.mvex(t)))}},{key:"mvex",value:function(t){for(var i=t.length,r=[];i--;)r[i]=e.trex(t[i]);return e.box.apply(null,[e.types.mvex].concat(r))}},{key:"mvhd",value:function(t,i){var r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,t>>24&255,t>>16&255,t>>8&255,255&t,i>>24&255,i>>16&255,i>>8&255,255&i,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,r)}},{key:"sdtp",value:function(t){var i,r,n=t.samples||[],s=new Uint8Array(4+n.length);for(r=0;r<n.length;r++)i=n[r].flags,s[r+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return e.box(e.types.sdtp,s)}},{key:"stbl",value:function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))}},{key:"avc1",value:function(t){var i,r,n,s=[],a=[];for(i=0;i<t.sps.length;i++)n=(r=t.sps[i]).byteLength,s.push(n>>>8&255),s.push(255&n),s=s.concat(Array.prototype.slice.call(r));for(i=0;i<t.pps.length;i++)n=(r=t.pps[i]).byteLength,a.push(n>>>8&255),a.push(255&n),a=a.concat(Array.prototype.slice.call(r));var o=e.box(e.types.avcC,new Uint8Array([1,s[3],s[4],s[5],255,224|t.sps.length].concat(s).concat([t.pps.length]).concat(a))),u=t.width,l=t.height;return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,255&u,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]),o,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])))}},{key:"hvc1",value:function(t){var i,r,n,s=[],a=[],o=[];for(s.push(161),s.push(t.vps.length>>>8&255),s.push(255&t.vps.length),i=0;i<t.vps.length;i++)n=(r=t.vps[i]).byteLength,s.push(n>>>8&255),s.push(255&n),s=s.concat(Array.prototype.slice.call(r));for(a.push(162),a.push(t.sps.length>>>8&255),a.push(255&t.sps.length),i=0;i<t.sps.length;i++)n=(r=t.sps[i]).byteLength,a.push(n>>>8&255),a.push(255&n),a=a.concat(Array.prototype.slice.call(r));var u=[],l=0;for(i=0;i<a.length;)r=a[i],2!==l||3!==r?(0===r?l++:l=0,u.push(r),++i):(++i,l=0);for(o.push(163),o.push(t.pps.length>>>8&255),o.push(255&t.pps.length),i=0;i<t.pps.length;i++)n=(r=t.pps[i]).byteLength,o.push(n>>>8&255),o.push(255&n),o=o.concat(Array.prototype.slice.call(r));var h=e.box(e.types.hvcC,new Uint8Array([1,u[8],u[9],u[10],u[11],u[12],u[13],u[14],u[15],u[16],u[17],u[18],u[19],240,0,255,253,248,248,0,0,15].concat([3]).concat(s).concat(a).concat(o))),d=t.width,c=t.height;return e.box(e.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,d>>8&255,255&d,c>>8&255,255&c,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]),h,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])))}},{key:"esds",value:function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}},{key:"mp4a",value:function(t){var i=t.audiosamplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,i>>8&255,255&i,0,0]),e.box(e.types.esds,e.esds(t)))}},{key:"stsd",value:function(t){return"audio"===t.type?e.box(e.types.stsd,e.STSD,e.mp4a(t)):t.isHevc?e.box(e.types.stsd,e.STSD,e.hvc1(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))}},{key:"tkhd",value:function(t){var i=t.id,r=t.duration,n=t.width,s=t.height;return e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,i>>24&255,i>>16&255,i>>8&255,255&i,0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,255&n,0,0,s>>8&255,255&s,0,0]))}},{key:"traf",value:function(t,i){var r=e.sdtp(t),n=t.id;return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n])),e.box(e.types.tfdt,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])),e.trun(t,r.length+16+16+8+16+8+8),r)}},{key:"trak",value:function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))}},{key:"trex",value:function(t){var i=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function(t,i){var r,n,s,a,o,u,l=t.samples||[],h=l.length,d=12+16*h,c=new Uint8Array(d);for(i+=8+d,c.set([0,0,15,1,h>>>24&255,h>>>16&255,h>>>8&255,255&h,i>>>24&255,i>>>16&255,i>>>8&255,255&i],0),r=0;r<h;r++)s=(n=l[r]).duration,a=n.size,o=n.flags,u=n.cts,c.set([s>>>24&255,s>>>16&255,s>>>8&255,255&s,a>>>24&255,a>>>16&255,a>>>8&255,255&a,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,61440&o.degradPrio,15&o.degradPrio,u>>>24&255,u>>>16&255,u>>>8&255,255&u],12+16*r);return e.box(e.types.trun,c)}},{key:"initSegment",value:function(t){e.types||e.init();var i,r=e.moov(t);return(i=new Uint8Array(e.FTYP.byteLength+r.byteLength)).set(e.FTYP),i.set(r,e.FTYP.byteLength),i}}]),e}(),$=function(){function e(t){(0,h.default)(this,e),this.mse=t,this.ISGenerated=!1,this.audioISGenerated=!1,this.videoISGenerated=!1,this.PES2MP4SCALEFACTOR=1,this.PES_TIMESCALE=9e4,this.MP4_TIMESCALE=this.PES_TIMESCALE/this.PES2MP4SCALEFACTOR,this._forceFirstIDR=!(!E.chrome||!(E.version.major<50||50===E.version.major&&E.version.build<2661))}return(0,d.default)(e,[{key:"destroy",value:function(){this.reset()}},{key:"reset",value:function(){this.insertDiscontinuity(),this.switchLevel()}},{key:"insertDiscontinuity",value:function(){this._initPTS=this._initDTS=this.nextAacPts=this.nextAvcDts=void 0}},{key:"getInitDts",value:function(){return void 0!==this._initDTS?this._initDTS/90:-1}},{key:"switchLevel",value:function(){this.ISGenerated=!1,this.audioISGenerated=!1,this.videoISGenerated=!1}},{key:"remux",value:function(e,t,i,r){Number(localStorage._printMp4Remux)&&D.debug("\n### Audio",e,"\n### Video",t),this.audioISGenerated||this.generateAudioIS(e,i),this.videoISGenerated||this.generateVideoIS(t,i),this.initTs(e,t,i),t.samples.length&&this.remuxVideo(t,r),e.samples.length&&this.remuxAudio(e,r),this.mse.onFragParsed()}},{key:"initTs",value:function(e,t,i){if(null==this._initPTS){var r=e.samples,n=t.samples,s=r.length,a=n.length,o=this.PES_TIMESCALE;0===s&&0===a?D.warn("mp4-remuxer.initTs have no nbAudio&nbVideo"):0===a?(this._initPTS=r[0].pts-o*i,this._initDTS=r[0].dts-o*i):0===s?(this._initPTS=n[0].pts-o*i,this._initDTS=n[0].dts-o*i):(this._initPTS=Math.min(n[0].pts,r[0].pts)-o*i,this._initDTS=Math.min(n[0].dts,r[0].dts)-o*i)}}},{key:"generateAudioIS",value:function(e,t){if(e.config){var i={audioMoov:Z.initSegment([e]),audioCodec:e.codec,audioChannelCount:e.channelCount};this.mse.onInitSegment(i),this.audioISGenerated=!0}}},{key:"generateVideoIS",value:function(e,t){if(e.sps&&e.pps){var i={videoMoov:Z.initSegment([e]),videoCodec:e.codec,videoWidth:e.width,videoHeight:e.height};this.mse.onInitSegment(i),this.videoISGenerated=!0}}},{key:"remuxVideo",value:function(e,t){var i,r=void 0,n=void 0,s=void 0,a=void 0,o=void 0,u=void 0,l=void 0,h=void 0,d=void 0,c=void 0,f=void 0,p=void 0,v=void 0,y=8,m=this.PES2MP4SCALEFACTOR,_=[];for(l=new Uint8Array(e.len+4*e.naluCnt+8),(r=new DataView(l.buffer)).setUint32(0,l.byteLength),l.set(Z.types.mdat,4);e.samples.length;){for(s=e.samples.shift(),o=0;s.units.length;)n=(u=s.units.shift()).data.byteLength,r.setUint32(y,n),y+=4,l.set(u.data,y),y+=n,o+=4+n;if(c=s.pts-this._initDTS,f=s.dts-this._initDTS,void 0!==d)p=this._PTSNormalize(c,d),v=this._PTSNormalize(f,d),a.duration=(v-d)/m,a.duration<0&&(Number(localStorage._printMp4RemuxVideo)&&D.warn("mp4-remuxer.remuxVideo invalid sample duration at pts="+s.pts/90+" dts="+s.dts/90+" duration="+a.duration/90),a.duration=0,v=d);else{var S,g=this.nextAvcDts||f;p=this._PTSNormalize(c,g),v=this._PTSNormalize(f,g),S=Math.round((v-g)/90),(t||Math.abs(S)<600)&&S&&(S>1?D.warn("mp4-remuxer.remuxVideo hole="+S+" filling it"):S<-1&&D.warn("mp4-remuxer.remuxVideo overlapping="+-S+" detected"),v=g,p=Math.max(p-S,v)),Math.max(0,p),h=Math.max(0,v)}var T=s.key;a={size:o,duration:0,cts:(p-v)/m,flags:{isLeading:0,degradPrio:0,hasRedundancy:0,dependsOn:T?2:1,isDependedOn:T?1:0,isNonSync:T?0:1}},_.push(a),d=v}this._forceFirstIDR&&(_[0].flags.dependsOn=2,_[0].flags.isNonSync=0),void 0!==e.endDts?(a.duration=(90*e.endDts-this._initDTS-v)/m,a.duration<0?(a.duration=0,this.nextAvcDts=v):this.nextAvcDts=90*e.endDts-this._initDTS):(_.length>=2&&(a.duration=_[_.length-2].duration),this.nextAvcDts=v+a.duration*m),e.len=0,e.naluCnt=0,e.samples=_,i=Z.moof(e.sn,h/m,e),e.samples=[];var E={type:"video",data:this._mergeBoxes(i,l)};this.mse.onFragParsing(E)}},{key:"remuxAudio",value:function(e,t){var i,r=void 0,n=void 0,s=void 0,a=void 0,o=void 0,u=void 0,l=void 0,h=void 0,d=void 0,c=void 0,f=8,p=this.PES_TIMESCALE,v=this.PES2MP4SCALEFACTOR,y=[];for(a=new Uint8Array(e.len+8),new DataView(a.buffer).setUint32(0,a.byteLength),a.set(Z.types.mdat,4);e.samples.length;){if(s=(r=e.samples.shift()).unit,a.set(s,f),f+=s.byteLength,l=r.pts-this._initDTS,h=r.dts-this._initDTS,void 0!==u)d=this._PTSNormalize(l,u),c=this._PTSNormalize(h,u),n.duration=(c-u)/v,n.duration<0&&(Number(localStorage._printMp4RemuxAudio)&&D.warn("mp4-remuxer.remuxAudio invalid AAC sample duration at PTS="+r.pts+" duration="+n.duration),n.duration=0,d=c=u);else{var m,_=this.nextAacPts||l;d=this._PTSNormalize(l,_),c=this._PTSNormalize(h,_),m=Math.round(1e3*(d-_)/p),(t||Math.abs(m)<600)&&m&&(d=c=_),Math.max(0,d),o=Math.max(0,c)}n={size:s.byteLength,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},y.push(n),u=c}y.length>=2&&(n.duration=y[y.length-2].duration),this.nextAacPts=d+n.duration*v,e.len=0,e.samples=y,i=Z.moof(e.sn,o/v,e),e.samples=[];var S={type:"audio",data:this._mergeBoxes(i,a)};this.mse.onFragParsing(S)}},{key:"_mergeBoxes",value:function(e,t){var i=new Uint8Array(e.byteLength+t.byteLength);return i.set(e,0),i.set(t,e.byteLength),i}},{key:"_PTSNormalize",value:function(e,t){var i;if(void 0===t)return e;for(i=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=i;return e}},{key:"timescale",get:function(){return this.MP4_TIMESCALE}}]),e}(),ee=function(){function e(t){(0,h.default)(this,e),this.data=t,this.bytesAvailable=this.data.byteLength,this.word=0,this.bitsAvailable=0}return(0,d.default)(e,[{key:"loadWord",value:function(){var e=this.data.byteLength-this.bytesAvailable,t=new Uint8Array(4),i=Math.min(4,this.bytesAvailable);if(0===i)throw new Error("no bytes available");t.set(this.data.subarray(e,e+i)),this.word=new DataView(t.buffer).getUint32(0),this.bitsAvailable=8*i,this.bytesAvailable-=i}},{key:"skipBits",value:function(e){var t=void 0;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(t=(e-=this.bitsAvailable)>>3,e-=t>>3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}},{key:"readBits",value:function(e){var t=Math.min(this.bitsAvailable,e),i=this.word>>>32-t;return e>32&&D.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0?this.word<<=t:this.bytesAvailable>0&&this.loadWord(),(t=e-t)>0?i<<t|this.readBits(t):i}},{key:"skipLZ",value:function(){var e=void 0;for(e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var e=this.skipLZ();return this.readBits(e+1)-1}},{key:"readEG",value:function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}},{key:"readBoolean",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"skipScalingList",value:function(e){var t=void 0,i=8,r=8;for(t=0;t<e;t++)0!==r&&(r=(i+this.readEG()+256)%256),i=0===r?i:r}},{key:"readSPS",value:function(){var e,t,i,r,n=void 0,s=void 0,a=void 0,o=0,u=0,l=0,h=0,d=0;if(this.readUByte(),e=this.readUByte(),this.readBits(5),this.skipBits(3),this.readUByte(),this.skipUEG(),100===e||110===e||122===e||144===e||244===e||44===e||83===e||86===e||118===e||128===e||138===e){var c=this.readUEG();if(3===c&&this.skipBits(1),this.skipUEG(),this.skipUEG(),this.skipBits(1),this.readBoolean())for(s=3!==c?8:12,a=0;a<s;a++)this.readBoolean()&&(a<6?this.skipScalingList(16):this.skipScalingList(64))}this.skipUEG();var f=this.readUEG();if(0===f)this.readUEG();else if(1===f)for(this.skipBits(1),this.skipEG(),this.skipEG(),n=this.readUEG(),a=0;a<n;a++)this.skipEG();if(this.skipUEG(),this.skipBits(1),t=this.readUEG(),i=this.readUEG(),0===(r=this.readBits(1))&&this.skipBits(1),this.skipBits(1),this.readBoolean()&&(o=this.readUEG(),u=this.readUEG(),l=this.readUEG(),h=this.readUEG()),this.readBoolean()&&(this.readBoolean()&&255===this.readUByte()&&(this.readBits(16),this.readBits(16)),this.readBoolean()&&this.skipBits(1),this.readBoolean()&&(this.readBits(3),this.skipBits(1),this.readBoolean()&&(this.readUByte(),this.readUByte(),this.readUByte())),this.readBoolean()&&(this.readUEG(),this.readUEG()),this.readBoolean())){var p=this.readBits(32);d=this.readBits(32)/p,this.readBoolean()&&(d=Math.ceil(d/2))}return{fps:d,width:16*(t+1)-2*o-2*u,height:(2-r)*(i+1)*16-(l+h)*(r?2:4)}}},{key:"readSliceType",value:function(){return this.readUByte(),this.readUEG(),this.readUEG()}}]),e}(),te=function(){function e(t,i){(0,h.default)(this,e),this.mse=t,this.remuxer=i,this.width=0,this.height=0,this.lastSN=0,this.lastLevel=0,this.PES_TIMESCALE=9e4,this.lastTsData=null,this.lastPos=0,this.hasRemux=!1,this.fragStartTs=0}return(0,d.default)(e,[{key:"getFps",value:function(){return 0}},{key:"getStartTs",value:function(){return this.fragStartTs}},{key:"destroy",value:function(){this.switchLevel(),this.duration=0,this._initPTS=this._initDTS=void 0}},{key:"probe",value:function(e){return e.length>=564&&71===e[0]&&71===e[188]&&71===e[376]}},{key:"resetAVData",value:function(){this._avcTrack&&(this._avcTrack.len=0,this._avcTrack.naluCnt=0,this._avcTrack.samples=[]),this._aacTrack&&(this._aacTrack.len=0,this._aacTrack.samples=[])}},{key:"switchLevel",value:function(){var e=this.createTrack;this._avcTrack=e("video"),this._aacTrack=e("audio"),this._id3Track=e("id3"),this.pmtParsed=!1,this._pmtId=-1,this.remuxer.switchLevel()}},{key:"createTrack",value:function(e){return{type:e,id:-1,sn:0,samples:[],len:0,naluCnt:0}}},{key:"insertDiscontinuity",value:function(){this.switchLevel(),this.remuxer.insertDiscontinuity()}},{key:"reset",value:function(){this.hasRemux=!1,this._avcTrack&&(this._avcTrack.sps=null,this._avcTrack.pps=null,this._avcTrack.len=0,this._avcTrack.naluCnt=0,this._avcTrack.samples=[]),this._aacTrack&&(this._aacTrack.len=0,this._aacTrack.naluCnt=0,this._aacTrack.samples=[])}},{key:"resetTsData",value:function(){var e=this._avcTrack,t=this._aacTrack,i=this._id3Track;t&&(e.pesData=null,t.pesData=null,i.pesData=null,this.lastTsData=null),this.fragStartTs=0}},{key:"appendTsData",value:function(e,t){var i=void 0;t&&this.resetTsData(),e instanceof Uint8Array||(e=new Uint8Array(e));var r=this.lastTsData,n=this.lastPos;if(r){var s=r.byteLength-n,a=s+e.byteLength;(i=new Uint8Array(a)).set(r.slice(n),0),i.set(e,s)}else i=e;return this.lastPos=0,this.lastTsData=i,i}},{key:"syncOffset",value:function(e){for(var t=Math.min(188,e.length-564),i=0;i<t;){if(71===e[i]&&71===e[i+188]&&71===e[i+376])return i;i++}return-1}},{key:"parseTs",value:function(e){var t=e.data,i=e.audioCodec,r=e.videoCodec,n=e.timeOffset,s=e.duration,a=e.discontinuity,o=e.level,u=e.sn,l=e.seeking,h=e.hlsDT,d=e.tsDT,c=(t=this.appendTsData(t,l)).length;this.audioCodec=i,this.videoCodec=r,this.timeOffset=n,this.duration=s,this.contiguous=!1,a?(D.log("TsParser.parseTs discontinuity detected"),this.insertDiscontinuity()):o!==this.lastLevel?(D.log("TsParser.parseTs level switch detected"),this.switchLevel(),this.lastLevel=o):u===this.lastSN+1&&(this.contiguous=!0),this.lastSN=u,this.contiguous||(this.aacOverFlow=null),this._avcTrack||this.insertDiscontinuity();var f=this.syncOffset(t);if(!(f<0)){this.lastPos=c-=(c+f)%188,c===t.length&&(this.lastTsData=null);for(var p,v,y,m,_,S=this._avcTrack,g=this._aacTrack,T=this._id3Track,E=this.pmtParsed,I=S.pesData,P=g.pesData,R=T.pesData,k=S.id,L=g.id,A=T.id,w=f;w<c;w+=188)if(71===t[w]){if(p=!!(64&t[w+1]),v=((31&t[w+1])<<8)+t[w+2],(48&t[w+3])>>4>1){if((y=w+5+t[w+4])===w+188)continue}else y=w+4;if(E)if(m=(_=w+188)-y,v===k)p&&(I&&this._parseAVCPES(this._parsePES(I,n,h,d)),I={data:[],size:0}),I&&(I.data.push(t.subarray(y,_)),I.size+=m);else if(v===L){if(0===this._avcTrack.samples.length&&!this.remuxer.audioISGenerated&&!this.remuxer.videoISGenerated)continue;p&&(P&&(this._parseAACPES(this._parsePES(P,n,h,d)),!this.hasRemux&&S.samples.length>1&&this.remuxTs(g,S,u)),P={data:[],size:0}),P&&(P.data.push(t.subarray(y,_)),P.size+=m)}else v===A&&(p&&(R&&this._parseID3PES(this._parsePES(R,n,h,d)),R={data:[],size:0}),R&&(R.data.push(t.subarray(y,_)),R.size+=m));else p&&(y+=t[y]+1),0===v?this._parsePAT(t,y):v===this._pmtId&&(this._parsePMT(t,y),E=this.pmtParsed=!0,k=this._avcTrack.id,L=this._aacTrack.id,A=this._id3Track.id)}else D.error("TsParser.parseTs ERROR: TS packet did not start with 0x47");I&&(S.pesData=I),P&&(g.pesData=P),R&&(T.pesData=R),(g.samples.length>1||null===this.lastTsData)&&this.remuxTs(g,S,u)}}},{key:"remuxTs",value:function(e,t,i){e.sn=t.sn=i,this.hasRemux=!0,this.remuxer.remux(e,t,this.timeOffset,this.contiguous)}},{key:"_parsePAT",value:function(e,t){var i=e[t+8]<<8|e[t+9];1==i&&(this._pmtId=(31&e[t+10])<<8|e[t+11]),D.log("TsParser._parsePAT program_number="+i+" pmtId="+this._pmtId)}},{key:"_parsePMT",value:function(e,t){var i=t+3+((15&e[t+1])<<8|e[t+2])-4;for(t+=12+((15&e[t+10])<<8|e[t+11]);t<i;){var r=e[t],n=(31&e[t+1])<<8|e[t+2];switch(r){case 15:this._aacTrack.id=n;break;case 21:this._id3Track.id=n;break;case 27:this._avcTrack.id=n;break;default:D.log("unkown stream type:"+e[t])}t+=5+((15&e[t+3])<<8|e[t+4])}D.log("TsParser._parsePMT aacTrack.id="+this._aacTrack.id+" avcTrack.id="+this._avcTrack.id)}},{key:"_parsePES",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=e.data[0];if(1!=(n[0]<<16)+(n[1]<<8)+n[2])return null;var s,a,o=(n[4]<<8)+n[5],u=n[7];192&u&&((s=536870912*(14&n[9])+4194304*(255&n[10])+16384*(254&n[11])+128*(255&n[12])+(254&n[13])/2)>4294967295&&(s-=8589934592),64&u?(a=536870912*(14&n[14])+4194304*(255&n[15])+16384*(254&n[16])+128*(255&n[17])+(254&n[18])/2)>4294967295&&(a-=8589934592):a=s);var l=n[8]+9;e.data[0]=e.data[0].subarray(l),e.size-=l;for(var h=0,d=new Uint8Array(e.size);e.data.length;)n=e.data.shift(),d.set(n,h),h+=n.byteLength;return r>i&&r-i-1e3*t>0&&(s-=90*(r-i-1e3*t),a-=90*(r-i-1e3*t)),{data:d,pts:s,dts:a,len:o}}},{key:"_parseAVCPES",value:function(e){if(null!=e){0===this.fragStartTs&&(this.fragStartTs=e.pts/this.PES_TIMESCALE);var t,i=this._avcTrack,r=i.samples,n=this._parseAVCNALu(e.data),s=[],o=0;0===n.length&&r.length>0&&this._pushToPreUnit(e.data),e.data=null;var u=!1,l=!1,h="",d=!0,c=!1,f=void 0;try{for(var p,v=(0,a.default)(n);!(d=(p=v.next()).done);d=!0){var y=p.value;switch(y.type){case 1:l=!0;break;case 5:l=!0,u=!0,i.idr=!0;break;case 6:l=!0;break;case 7:if(l=!0,!i.sps){i.sps=[y.data],i.timescale=this.remuxer.timescale,i.duration=this.remuxer.timescale*this.duration;var m=new ee(y.data).readSPS();this.width=i.width=m.width,this.height=i.height=m.height;for(var _=y.data.subarray(1,4),S="avc1.",g=0;g<3;g++){var T=_[g].toString(16);T.length<2&&(T="0"+T),S+=T}i.codec=S}break;case 8:l=!0,i.pps||(i.pps=[y.data]);break;case 9:l=!0;break;default:l=!1,h+="unknown NAL "+y.type+" "}l&&(s.push(y),o+=y.data.byteLength)}}catch(e){c=!0,f=e}finally{try{!d&&v.return&&v.return()}finally{if(c)throw f}}h.length&&D.log(h),i.sps&&i.pps&&!i.idr||s.length&&(!0===u||i.sps)&&(t={units:s,dts:e.dts,pts:e.pts,key:u},r.push(t),i.len+=o,i.naluCnt+=s.length)}else D.error("TsParser._parseAVCPES pes is null.")}},{key:"_parseAVCNALu",value:function(e){for(var t,i,r,n,s,a,o=0,u=e.byteLength,l=0,h=[];o<u;)switch(t=e[o++],l){case 0:0===t&&(l=1);break;case 1:l=0===t?2:0;break;case 2:case 3:0===t?l=3:1===t?(n=31&e[o],s?(r={data:e.subarray(s,o-l-1),type:a},h.push(r)):(i=o-l-1)&&this._pushToPreUnit(e.subarray(0,i)),s=o,a=n,1!==n&&5!==n||(o=u),l=0):l=0}return s&&(r={data:e.subarray(s,u),type:a},h.push(r)),h}},{key:"_pushToPreUnit",value:function(e){var t=this._avcTrack.samples.length;if(0!=t){var i=this._avcTrack.samples[t-1],r=i.units[i.units.length-1],n=new Uint8Array(r.data.byteLength+e.byteLength);n.set(r.data,0),n.set(e,r.data.byteLength),r.data=n,this._avcTrack.len+=e.byteLength}}},{key:"_parseAACPES",value:function(e){if(null!=e){var t,i,r,n,s,a,o,u,l=this._aacTrack,h=e.data,d=h.length,c=0;if(this.aacOverFlow){var f=new Uint8Array(this.aacOverFlow.byteLength+h.byteLength);f.set(this.aacOverFlow,0),f.set(h,this.aacOverFlow.byteLength),h=f,this.aacOverFlow=null}for(i=0;i<d-1&&(255!==h[i]||240!=(240&h[i+1]));i++);if(i&&(i<d-1?(o="AAC PES did not start with ADTS header, offset:"+i,u=!1):(o="no ADTS header found in AAC PES",u=!0),D.error("TsParser._parseAACPES ERROR:"+o),u))return;if(!l.audiosamplerate){var p=this._ADTStoAudioConfig(h,i,this.audioCodec);l.config=p.config,l.audiosamplerate=p.samplerate,l.channelCount=p.channelCount,l.codec=p.codec,l.timescale=this.remuxer.timescale,l.duration=this.remuxer.timescale*this.duration,D.log("TsParser._parseAACPES parsed codec:"+l.codec+",rate:"+p.samplerate+",nb channel:"+p.channelCount)}for(;i+5<d;){if(r=1&h[i+1]?7:9,n=(3&h[i+3])<<11,n|=h[i+4]<<3,n|=(224&h[i+5])>>>5,(n-=r)<0)return void D.error("TsParser._parseAACPES adtsFrameSize:"+n+", adtsStartOffset:"+i+", len:"+d);if(0!=n){if(!((s=i+r)+n<=d))break;for(a=Math.round(e.pts+1024*c*this.PES_TIMESCALE/l.audiosamplerate),t={unit:h.subarray(s,s+n),pts:a,dts:a},l.samples.push(t),l.len+=n,i+=r+n,c++;i<d-1&&(255!==h[i]||240!=(240&h[i+1]));i++);}else i+=r}i<d&&(this.aacOverFlow=h.subarray(i,d))}else D.error("TsParser._parseAACPES pes is null.")}},{key:"_ADTStoAudioConfig",value:function(t,i,r){var n=e.AdtsSampleingRates,s=1+((192&t[i+2])>>>6),a=(60&t[i+2])>>>2;if(!(a>n.length-1)){var o=(1&t[i+2])<<2|(192&t[i+3])>>>6;D.log("TsParser._ADTStoAudioConfig manifest codec:"+r+", [ADTS] type:"+s+",sampleingIndex:"+a+"["+n[a]+"kHz],channelConfig:"+o);var u,l,h=navigator.userAgent.toLowerCase();return-1!==h.indexOf("firefox")?a>=6?(s=5,l=new Array(4),u=a-3):(s=2,l=new Array(2),u=a):-1!==h.indexOf("android")?-1!==h.indexOf("mqqbrowser")?(s=2,l=new Array(2),u=a):(s=5,l=new Array(4),u=a):(s=5,l=new Array(4),r&&(-1!==r.indexOf("mp4a.40.29")||-1!==r.indexOf("mp4a.40.5"))||!r&&a>=6?u=a-3:(r&&-1!==r.indexOf("mp4a.40.2")&&(a>=6||1===o)&&(s=2,l=new Array(2)),u=a)),l[0]=s<<3,l[0]|=(14&a)>>1,l[1]|=(1&a)<<7,l[1]|=o<<3,5===s&&(l[1]|=(14&u)>>1,l[2]=(1&u)<<7,l[2]|=8,l[3]=0),{config:l,samplerate:n[a],channelCount:o,codec:"mp4a.40."+s}}D.error("TsParser._ADTStoAudioConfig ERROR:invalid ADTS sampling index:"+a)}},{key:"_parseID3PES",value:function(e){this._id3Track.samples.push(e)}}]),e}();te.AdtsSampleingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];var ie=te,re=function(){function e(){(0,h.default)(this,e)}return(0,d.default)(e,null,[{key:"getSilentFrame",value:function(e,t){if(2===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}}]),e}();re.emptyAacFrameAdts=[255,241,92,64,18,64,252,0,208,32,6,238,90,119,128,0,128,0,0,0,0,26,37,65,0,13,237,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,28],re.emptyAacFrame=[0,208,32,6,238,90,119,128,0,128,0,0,0,0,26,37,65,0,13,237,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,28],re.emptyAacFrame_44_1=[1,64,34,128,163,78,129,64,0,0,0,0,4,96,6,246,81,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94];var ne=re,se=function(){function e(){(0,h.default)(this,e),this.size=0,this.buffers=[]}return(0,d.default)(e,[{key:"destroy",value:function(){this.reset()}},{key:"reset",value:function(){this.size=0,this.buffers=[]}},{key:"append",value:function(e){0!==e.length&&(this.buffers.push(e),this.size+=e.length)}},{key:"getByte",value:function(e){for(var t=0,i=0;i<this.buffers.length;++i){var r=this.buffers[i];if(t+r.length>e)return r[e-t];t+=r.length}return D.warn("FlvCacher.getByte has no offset="+e),0}},{key:"popFrame",value:function(){if(0===this.size)return null;if(0===this.buffers.length)return D.error("FlvCacher.popFront error no buffers, size:"+this.size+" not eq 0"),this.reset(),null;if(this.size<=pe.TAG_HEADER_LEN+pe.PREV_TAG_SIZE_LEN)return null;var e=(this.getByte(1)<<16)+(this.getByte(2)<<8)+this.getByte(3),t=pe.TAG_HEADER_LEN+e+pe.PREV_TAG_SIZE_LEN;if(this.size<t)return null;if(1===this.buffers.length){if(this.buffers[0].length===t)return this.size-=t,this.buffers.shift();var i=this.buffers[0].slice(0,t);return this.buffers[0]=this.buffers[0].slice(t),this.size-=t,i}for(var r=void 0,n=new Uint8Array(t),s=0,a=0;s<t;){var o=t-s;if(this.buffers[0].length>o){r=this.buffers[0].slice(0,o),n.set(r,a),a+=o,s+=o,this.buffers[0]=this.buffers[0].slice(o),this.size-=o;break}r=this.buffers.shift(),n.set(r,a),a+=r.length,s+=r.length,this.size-=r.length}return n}}]),e}(),ae=function(){var e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),256===new Int16Array(e)[0]}(),oe=function(){function e(){(0,h.default)(this,e)}return(0,d.default)(e,null,[{key:"parseObject",value:function(t,i,r){var n=e.parseString(t,i),s=e.parseScript(t,i+n.size);return{data:{name:n.data,value:s.data},size:s.size}}},{key:"parseVariable",value:function(t,i,r){return e.parseObject(t,i,r)}},{key:"parseDate",value:function(e,t,i){if(i<10)throw new Error("Data size invalid when parse Date");var r=new DataView(e,t),n=r.getFloat64(0,!ae);return n+=60*r.getInt16(8,!ae)*1e3,{data:new Date(n),size:10}}},{key:"parseString",value:function(e,t){var i=new DataView(e,t),r=i.getUint16(0,!ae),n="";if(r>0)for(var s=0;s<r;s++)n+=String.fromCharCode(i.getUint8(s+2));return{data:n,size:2+r}}},{key:"parseMetadata",value:function(t){var i=e.parseScript(t,0);return e.parseScript(t,i.size,t.length-i.size)}},{key:"parseScript",value:function(t,i,r){var n=i,s=new Uint8Array(t).buffer,a=new DataView(s,0,r),o=null,u=a.getUint8(n);switch(n+=1,u){case 0:o=a.getFloat64(n,!ae),n+=8;break;case 1:o=!!a.getUint8(n),n+=1;break;case 2:var l=e.parseString(s,n);o=l.data,n+=l.size;break;case 3:for(o={};n<r-3;){var h=e.parseObject(s,n,r-i);if(o[h.data.name]=h.data.value,n=h.size,0===a.getUint8(n)&&0===a.getUint8(n+1)&&9===a.getUint8(n+2)){n+=3;break}}break;case 8:for(o={},n+=4;n<r-8;){var d=e.parseVariable(s,n);o[d.data.name]=d.data.value,n=d.size}n<=r-3&&9==(16777215&a.getUint32(n-1,!ae))&&(n+=3);break;case 10:o=[];var c=a.getUint32(n,!ae);n+=4;for(var f=0;f<c;f++){var p=e.parseScript(s,n);o.push(p.data),n=p.size}break;case 11:var v=e.parseDate(s,n+1,r-1);o=v.data,n+=v.size;break;case 12:var y=e.parseString(s,n+1);o=y.data,n+=y.size;break;default:n=r,console.log("AMF","Unsupported AMF value type "+u)}return{data:o,size:n}}}]),e}(),ue=function(){function e(){(0,h.default)(this,e),this.fpsArr=[],this.fpsMap=new s.default}return(0,d.default)(e,[{key:"reset",value:function(){this.fpsArr=[],this.fpsMap.clear()}},{key:"addDts",value:function(e){var t=parseInt(e/1e3);if(this.fpsMap.has(t))this.fpsMap.set(t,this.fpsMap.get(t)+1);else if(this.fpsArr.push(t),this.fpsMap.set(t,1),this.fpsArr.length>10){var i=this.fpsArr.shift();this.fpsMap.delete(i)}}},{key:"getFps",value:function(){if(this.fpsArr.length>1){var t=this.fpsArr[1],i=this.fpsMap.get(t),r=0,n=i;return e.FIXED_FPS.forEach((function(e){var t=e>i?e-i:i-e;t<3&&(0===r||t<r)&&(r=t,n=e)})),n}return 0}}]),e}();ue.FIXED_FPS=[0,15,20,24,30,40,48,60];var le=ue,he=!!Number(localStorage._dropAudio),de=!!Number(localStorage._dropVideo),ce=function(){function e(){(0,h.default)(this,e),this.lastDts=0,this.lastPts=0,this.lastCts=0,this.dtsStat=[0,0,0,0,0,0],this.ptsStat=[0,0,0,0,0,0],this.ctsStat=[0,0,0,0,0,0]}return(0,d.default)(e,[{key:"reset",value:function(){this.lastDts=this.lastPts=this.lastCts=0,this.dtsStat=[0,0,0,0,0,0],this.ptsStat=[0,0,0,0,0,0],this.ctsStat=[0,0,0,0,0,0]}},{key:"setTimeStamp",value:function(e,t,i){this.addStat(this.dtsStat,this.lastDts,e),this.addStat(this.ptsStat,this.lastPts,t),this.addStat(this.ctsStat,this.lastCts,i),this.lastDts=e,this.lastPts=t,this.lastCts=i}},{key:"addStat",value:function(e,t,i){if(t>0&&i>t){var r=i-t;r>=1e3?e[4]++:r>=800?e[3]++:r>=600?e[2]++:r>=400?e[1]++:r>=200&&e[0]++}}}]),e}(),fe=function(){function e(t,i){(0,h.default)(this,e),this.mse=t,this.remuxer=i,this.flvCacher=new se,this.fps=new le,this.timeStampStat=new ce,this.emptyFrames=0,this.DEFAULT_GOP=400,this.bufLen=400,this.firstBufLen=400,this.remuxLen=this.firstBufLen,this.pushGop=!1,this.parseFlvHead=!1,this.lengthSizeMinusOne=0,this.hasRemuxed=!1,this.recvVideoFrameTimeStamp=0,this.recvVideoFrameNums=0,this.videoFramePlayDelayTs=0,this.videoFrameCalculatePlayDelayFrames=0,this.audioConfig=[43,138,8,0],this.audioSampleRate=22050,this.aacTimeLen=1024e3/this.audioSampleRate,this.validAacTime=500*this.aacTimeLen,this.audioChannelCount=1,this.audioObjectType=5,this.audioIncreaseTSMap=new s.default,this.firstDemuxAudioTS=-1,this.spsUnit=null,this.ppsUnit=null,this.vpsUnit=null,this.hasCtsZero=!1,this.paused=!1,this.hasEmptyFrames=!1,this.nextAacDts=-1,this.playVideoFrameCnt=0,this.playVideoLength=0,this.playAudioFrameCnt=0,this.playAudioLength=0,this.playEmptyAudioFrameCnt=0,this.avcTrackList=[],this.beginParseTs=0,this.hasAudioTag=!1,this.lastAacTs=0,this.hasKeyFrame=!1,this.lastAudioTs=0,this.lastVideoTs=0,this.lastAudioUtil=null,this.maxaudioptsList=[0,0,0,0,0,0,0,0,0,0],this.last10anduiptsList=[0,0,0,0,0,0,0,0,0,0],this.firstAudioTs=-1,this.showH265Tip=!1,this.appendHighQualityEmptyAudio=!0,this.deleteH264Aud=!1,this.needEmptyAudioFrame=!1,this.incompleteFlvheaderLen=0,this.reset()}return(0,d.default)(e,[{key:"getFps",value:function(){return this.fps.getFps()}},{key:"getFrameReadyed",value:function(){return this.avcTrack&&this.avcTrack.samples?this.avcTrack.samples.length:0}},{key:"setDecoctorTimeAbnormal",value:function(){var e=localStorage.decodeabnormal;if(e&&e.split("_").length>1){var t=parseInt(e.split("_")[1]),i=(new Date).getTime()-t;i&&i>864e5?(this.appendHighQualityEmptyAudio=!0,localStorage.decodeabnormal=""):this.appendHighQualityEmptyAudio=!1}}},{key:"destroy",value:function(){this.reset()}},{key:"reset",value:function(e){D.log("FlvParser.reset"),this.fps.reset(),this.timeStampStat.reset(),this.remuxer.reset(),this.avcTrack={type:"video",id:1,sn:0,samples:[],len:0,duration:0,startDts:-1,endDts:0,naluCnt:0},this.aacTrack={type:"audio",id:2,sn:0,samples:[],len:0,duration:0,startDts:-1,endDts:0},this.aacTrack.config=this.audioConfig,this.aacTrack.audiosamplerate=this.audioSampleRate,this.aacTrack.channelCount=this.audioChannelCount,this.aacTrack.codec="mp4a.40.5",this.aacTrack.timescale=this.remuxer.timescale,this.avcTrack.isHevc=!1,this.avcTrack.timescale=this.remuxer.timescale,this.avcTrackList=[],this.hasAudioTag=!1,this.lastAacTs=0,this.hasKeyFrame=!1,this.lastAudioTs=0,this.lastVideoTs=0,this.showH265Tip=!1,this.bufLen=400,this.remuxLen=this.firstBufLen,this.nextAacDts=-1,this.hasCtsZero=!1,this.hasRemuxed=!1,this.audioIncreaseTSMap.clear(),this.firstDemuxAudioTS=-1,this.recvVideoFrameTimeStamp=0,this.recvVideoFrameNums=0,this.videoFramePlayDelayTs=0,this.videoFrameCalculatePlayDelayFrames=0}},{key:"getPlayStat",value:function(){var e={videoFrameCnt:this.playVideoFrameCnt,videoLength:this.playVideoLength,audioFrameCnt:this.playAudioFrameCnt,audioLength:this.playAudioLength,emptyAudioFrameCnt:this.playEmptyAudioFrameCnt};return this.playVideoFrameCnt=0,this.playVideoLength=0,this.playAudioFrameCnt=0,this.playAudioLength=0,this.playEmptyAudioFrameCnt=0,e}},{key:"setPaused",value:function(e){this.paused=e}},{key:"setPushGop",value:function(e){this.pushGop=e,D.log("FlvParser.setPushGop "+e)}},{key:"setDeleteH264Aud",value:function(e){this.deleteH264Aud=e,D.log("FlvParser.deleteH264Aud "+e)}},{key:"setNeedEmptyAudioFrame",value:function(e){this.needEmptyAudioFrame=e,D.log("FlvParser.setNeedEmptyAudioFrame "+e)}},{key:"getParserBufLen",value:function(){return 0!==this.avcTrack.samples.length?this.avcTrack.endDts-this.avcTrack.startDts:0!==this.aacTrack.samples.length?this.aacTrack.endDts-this.aacTrack.startDts:0}},{key:"parseFlv",value:function(t){var i=void 0,r=0,n=t.length;if(!1===this.parseFlvHead){var s=e.FLV_HEADER_LEN+e.PREV_TAG_SIZE_LEN;if(n<(s-=this.incompleteFlvheaderLen))return D.warn("FlvParser.parseFlv flv has no header len="+n),void(this.incompleteFlvheaderLen+=n);r+=s,this.parseFlvHead=!0,this.beginParseTs=Date.now()}for(0===r?this.flvCacher.append(t):this.flvCacher.append(t.slice(r));null!==(i=this.flvCacher.popFrame());)this.parseTag(i)}},{key:"parseTag",value:function(t){var i=t.length;if(i<e.TAG_HEADER_LEN+e.PREV_TAG_SIZE_LEN)D.warn("FlvParser.parseTag flv has no whole tag len="+i+" data="+t);else{var r=0,n=t[r++],s=(t[r++]<<16)+(t[r++]<<8)+t[r++];if(i-(e.TAG_HEADER_LEN+e.PREV_TAG_SIZE_LEN)<s)D.warn("FlvParser.parseTag flv has no enough data dataLen="+s+" len="+i);else if(0!==s){var a=(t[r++]<<16)+(t[r++]<<8)+t[r++]+parseInt(t[r++].toString(16)+"000000",16);r+=3,n===e.VIDEO_TYPE?de||this.mse.isPureAudio||this.parseVideo(t,11,s,a):n===e.AUDIO_TYPE?he||this.parseAudio(t,11,s,a):n===e.SCRIPT_TYPE?this.parseScriptTag(t,11,s,a):(D.warn("%cFlvParser.parseTag discard type="+n+" len="+s,"color:white;background:black"),this.mse&&this.mse.onVideoParseInvalid&&this.mse.onVideoParseInvalid())}else D.warn("FlvParser.parseTag flvtag empty type="+n)}}},{key:"parseScriptTag",value:function(t,i,r,n){if(i+e.SCRIPT_AMF1_HEAD_LEN>r)D.log("script too small");else{t[i++];var s=(t[i++]<<8)+t[i++],a=this.getStr(t,i,s);i+=s,"onMetaData"===a?(0,u.default)(this.mse.metadata,oe.parseScript(t,i,t.length).data):-1!==a.indexOf("onMixAudio")&&(a=a.replace("onMixAudio:",""),this.parseScriptTagMixAudio(a,n))}}},{key:"parseScriptTagMixAudio",value:function(e,t){if(e.length>0)for(var i=e.split(","),r=0;r<i.length;r++)this.mse.saveScriptVolumeData(t,i[r])}},{key:"getStr",value:function(e,t,i){for(var r="",n=0;n<i;n++)r+=String.fromCharCode(e[t++]);return r}},{key:"parseAudioVolumeInScriptTag",value:function(e,t,i,r){if(2==e[t++]){var n=i-t;if(e[t++],e[t++],n<0||i<t+n-3)return D.log("script too samll");if(111==e[t]&&110==e[t+1]&&77==e[t+2]&&105==e[t+3]&&120==e[t+4]&&65==e[t+5]&&117==e[t+6]&&100==e[t+7]&&105==e[t+8]&&111==e[t+9]&&58==e[t+10]){t+=11,new s.default;for(var a=e.subarray(t,t+n),o="",u=0;u<n;u++)o+=String.fromCharCode(a[u]);if(o.length>0)for(var l=o.split(","),h=0;h<l.length;h++)this.mse.saveScriptVolumeData(r,l[h])}}}},{key:"parseVideo",value:function(t,i,r,n){if(this.fps.addDts(n),r<5)D.warn("FlvParser.parseVideo avc videotag not enough dataLen="+r);else{var s=t[i]>>4,a=(t[i++],t[i++]);if(5!==r)if(0===a)this.parseVideoConfig(t,i,r,n);else if(1===a){if(s==e.IFRAME)this.hasKeyFrame||this.remuxer.reset(),this.hasKeyFrame=!0;else if(!this.hasKeyFrame)return void D.log("-------- drop video tag has no IFrame",n);Number(localStorage._printVideoTs)&&(D.debug("%cFlvParser video ts","color:green",n,n-this.lastVideoTs),this.lastVideoTs=n),this.parseVideoNalu(t,i,r,n,s)}else 2===a?D.info("%cFlvParser.parseVideo avc_end dataLen="+r,"color:white;background:black"):D.warn("%cFlvParser.parseVideo error avc packet type="+a,"color:white;background:black");else D.log("FlvParser.parseVideo avc_empty frameType="+s+" avcPacketType="+a)}}},{key:"parseVideoConfig",value:function(t,i,r,n){var s=void 0,a=void 0,o=[],u=[],l=[],h=!1,d=(i+=3)+r-5;if(this.isHevcNal(t,i)){this.showH265Tip||(this.showH265Tip=!0,D.warn("This is a H265 video."));for(var c=t[i+=4]>>1&63,f=i;i<d;){if(this.isHevcNal(t,i)||i+1===d){switch(c){case e.NAL_VPS:var p={data:t.subarray(f,i),type:c};this.vpsUnit&&this.vpsUnit.data.toString(16)!==p.data.toString(16)&&(D.log("FlvParser.parseVideoConfig vps changed"),h=!0),this.vpsUnit=p,l.push(p.data);break;case e.NAL_SPS:var v={data:t.subarray(f,i),type:c};this.spsUnit&&this.spsUnit.data.toString(16)!==v.data.toString(16)&&(D.log("FlvParser.parseVideoConfig sps changed"),h=!0),this.spsUnit=v,o.push(v.data);break;case e.NAL_PPS:var y={data:t.subarray(f,i),type:c};this.ppsUnit&&this.ppsUnit.data.toString(16)!==y.data.toString(16)&&(D.log("FlvParser.parseVideoConfig pps changed"),h=!0),this.ppsUnit=y,u.push(y.data)}if(i+4<d){c=t[i+=4]>>1&63,f=i;continue}}i++}h&&(this.reset(),this.paused=this.mse.onAvcCfgChange()),this.avcTrack.isHevc=!0,this.avcTrack.vps=l,this.avcTrack.sps=o,this.avcTrack.pps=u,this.avcTrack.codec="avc1.4d401f",this.avcTrack.width=this.mse.width,this.avcTrack.height=this.mse.height,this.hasCtsZero=!0}else{i+=4,this.lengthSizeMinusOne=3&t[i++];for(var m=0,_=0,S="",g=31&t[i++],T=0;T<g;++T){s=(t[i++]<<8)+t[i++];var E={data:t.subarray(i,i+s),type:7};this.spsUnit&&this.spsUnit.data.toString(16)!==E.data.toString(16)&&(D.log("FlvParser.parseVideoConfig sps changed"),h=!0),this.spsUnit=E,i+=s,o.push(E.data);var I=new ee(E.data).readSPS();m=I.width,_=I.height;for(var P=E.data.subarray(1,4),R="avc1.",k=0;k<3;k++){var L=P[k].toString(16);L.length<2&&(L="0"+L),R+=L}S=R}for(var A=t[i++],w=0;w<A;++w){a=(t[i++]<<8)+t[i++];var C={data:t.subarray(i,i+a),type:8};this.ppsUnit&&this.ppsUnit.data.toString(16)!==C.data.toString(16)&&(D.log("FlvParser.parseVideoConfig pps changed"),h=!0),this.ppsUnit=C,i+=a,u.push(C.data)}h&&(this.reset(),this.paused=this.mse.onAvcCfgChange()),this.avcTrack.isHevc=!1,this.avcTrack.sps=o,this.avcTrack.pps=u,this.avcTrack.width=m,this.avcTrack.height=_,this.avcTrack.codec=S,this.mse.setResolution(m,_)}D.log("FlvParser.parseVideoConfig avccfg dataLen="+r+" spsLen="+s+" ppsLen="+a+" w/h="+this.avcTrack.width+"/"+this.avcTrack.height+" codec="+this.avcTrack.codec)}},{key:"parseVideoNalu",value:function(t,i,r,n,s){var a=void 0,o=void 0,u=[],l=0,h=(t[i++]<<16)+(t[i++]<<8)+t[i++];if(0===h?this.hasCtsZero||(this.hasCtsZero=!0):h>=8388608?h-=16777216:h>2500&&h<3500?h=0:h>600&&D.warn("FlvParser.parseVideoNalu large cts="+h+" dts="+n),-1!==this.avcTrack.startDts&&!this.paused){var d=!1;this.pushGop?s===e.IFRAME&&(d=!0):n>=this.avcTrack.startDts+this.bufLen&&(d=!0),d&&(this.avcTrack.endDts=n,this.remux(e.REMUX_TYPE_VIDEO))}s===e.IFRAME&&(this.spsUnit&&(u.push(this.spsUnit),l+=this.spsUnit.data.length),this.ppsUnit&&(u.push(this.ppsUnit),l+=this.ppsUnit.data.length));var c=i+r-5;if(this.isHevcNal(t,i)){t[i+=4];for(var f=i;i<c;)(this.isHevcNal(t,i)||i+1===c)&&(o={data:t.subarray(f,i),type:1===s?5:1},u.push(o),l+=o.data.length,i+4<c)?(t[i+=4],f=i):i++}else for(var p=r-5;p;){a=0;for(var v=0;v<=this.lengthSizeMinusOne;++v)a+=t[i++]<<8*(this.lengthSizeMinusOne-v);if(p-=this.lengthSizeMinusOne+1,0!==a){if(a<0||a>r-5)break;if(a>p){i+=p;break}if(p-=a,o={data:t.subarray(i,i+a),type:1===s?5:1},this.isH264Sei(o.data)){for(var y=e.H265_SEI_HEAD.length,m=0,_=3;_<y+3&&o.data[_]==e.H265_SEI_HEAD[_-3];_++)m++;if(49==o.data[11+m-1+5]&&72==o.data[3+m-1+1]&&85==o.data[3+m-1+2]&&89==o.data[3+m-1+3]&&65==o.data[3+m-1+4]&&58==o.data[3+m-1+5]){var S=o.data.subarray(3+m+5,o.data.length-1);this.mse.saveH264SeiData(n,S)}}else this.isH264NALUPPS(o.data)||this.isH264Aud(o.data)&&this.deleteH264Aud||(u.push(o),l+=o.data.length);i+=a}}if(l>0){var g={units:u,dts:90*n,pts:90*(n+h),key:s===e.IFRAME};this.timeStampStat.setTimeStamp(n,n+h,h),this.avcTrack.samples.push(g),this.avcTrack.naluCnt+=u.length,this.avcTrack.len+=l,this.playVideoFrameCnt++,this.playVideoLength+=r,-1===this.avcTrack.startDts&&(this.avcTrack.startDts=n),this.avcTrack.endDts=n}else D.warn("FlvParser.parseVideoNalu discard empty nalu dts="+n+" pts="+(n+h)+" dataLen="+r+" naluLen="+a)}},{key:"parseAudio",value:function(t,i,r,n){var s=t[i++]>>>4,a=!0,o=n;10!=s&&D.error("FlvParser.parseAudio Unsupported audio codec, soundFormat="+s),this.calcAudioFrameRate(n),null!=this.audioIncreaseTSMap.get(n)&&(n=this.audioIncreaseTSMap.get(n)),n<this.lastAudioTs&&0!=this.lastAudioTs&&(a=!1);var u=t[i++];if(0===u)if(r>=4){var l=t[i]>>3;this.audioObjectType=l;var h=((7&t[i])<<1)+((128&t[i+1])>>7);if(h>=e.AdtsSampleingRates.length)return void D.error("FlvParser.parseAudio SampleingRate out of bounds. samplingIndex="+h);this.audioChannelCount=(120&t[i+1])>>3;var d=this.getAdtsConfig(l,h,this.audioChannelCount);d.toString(16)!==this.audioConfig.toString(16)&&D.warn("FlvParser.parseAudio adts changed old="+this.audioConfig+" new="+d),this.audioConfig=d,this.firstAudioTs=-1,this.firstDemuxAudioTS=-1,this.lastAudioTs=0}else D.warn("FlvParser.parseAudio adts error dataLen="+r+" ts="+n);else if(1===u){if(this.last10anduiptsList.shift(),this.last10anduiptsList.push(n),-1==this.firstAudioTs&&(this.firstAudioTs=n),-1==this.firstDemuxAudioTS)this.firstDemuxAudioTS=n;else if(n==this.firstDemuxAudioTS)return void D.warn("parseaudio audio too much audio in firstTs ts="+n);if(!a)return void D.warn("parseaudio audio ts too small maxlist="+this.maxaudioptsList+"  now="+n+"  first="+this.firstAudioTs+"  last="+this.lastAudioTs);for(var c=0;c<10;c++)this.maxaudioptsList[c]=this.last10anduiptsList[c];if(this.lastAudioTs>0&&this.lastAudioTs==n){var f=n+(0|this.aacTimeLen);this.audioIncreaseTSMap.set(o,f),n=f}if(Number(localStorage._printAudioTs)&&D.debug("%cFlvParser audio ts","color:red",n,n-this.lastAudioTs),this.lastAudioTs=n,this.hasAudioTag=!0,-1!==this.aacTrack.startDts&&0===this.avcTrackList.length&&0===this.avcTrack.samples.length&&n>=this.aacTrack.startDts+this.bufLen&&(this.aacTrack.endDts=n,this.remux(e.REMUX_TYPE_AUDIO)),-1===this.aacTrack.startDts&&(this.aacTrack.startDts=n),!this.validAacSample(n))return;var p=r-2,v={unit:t.subarray(i,i+p),dts:90*n,pts:90*n,ts:n};this.lastAudioUtil=v.unit,this.aacTrack.samples.push(v),this.aacTrack.endDts=n,this.aacTrack.len+=v.unit.length,this.avcTrackList.length>0&&this.remux(e.REMUX_TYPE_AUDIO)}else D.warn("FlvParser.parseAudio error aac packet type="+u)}},{key:"validAacSample",value:function(e){var t=this.aacTrack.samples.length;if(t>0){var i=this.aacTrack.samples[t-1];return 1===t&&i.ts>e&&i.ts-e>this.validAacTime?(this.aacTrack.samples.shift(),!0):e-i.ts<this.validAacTime}return!0}},{key:"getAdtsConfig",value:function(t,i,r){var n=0,s=null,a=navigator.userAgent.toLowerCase();return-1!==a.indexOf("firefox")?i>=6?(t=5,s=new Array(4),n=i-3):(t=2,s=new Array(2),n=i):-1!==a.indexOf("android")?-1!==a.indexOf("mqqbrowser")?(t=2,s=new Array(2),n=i):(t=5,s=new Array(4),n=i):(t=5,s=new Array(4),n=i,i>=6?n=i-3:1===r&&(t=2,s=new Array(2),n=i)),this.audioSampleRate=e.AdtsSampleingRates[i],this.aacTimeLen=1024e3/this.audioSampleRate,D.log("FlvParser.getAdtsConfig audioSampleRate="+this.audioSampleRate+" aacTimeLen="+this.aacTimeLen),s[0]=t<<3,s[0]|=(14&i)>>1,s[1]=(1&i)<<7,s[1]|=r<<3,5===t&&(s[1]|=(14&n)>>1,s[2]=(1&n)<<7,s[2]|=8,s[3]=0),D.log("FlvParser.getAdtsConfig type="+t+" index="+i+" channel="+r+" exIndex="+n+" config="+s),s}},{key:"isHevcNal",value:function(e,t){return 0===e[t]&&0===e[t+1]&&0===e[t+2]&&1===e[t+3]}},{key:"isH264Sei",value:function(e){return 6===e[0]}},{key:"isH264Aud",value:function(e){return 9===e[0]}},{key:"isH264NALUPPS",value:function(e){return 40===e[0]}},{key:"calcVideoFramePlayDelay",value:function(){if(this.recvVideoFrameNums>0){var e=R(),t=Math.floor((e*this.recvVideoFrameNums-this.recvVideoFrameTimeStamp)/this.recvVideoFrameNums);this.videoFrameCalculatePlayDelayFrames+=this.recvVideoFrameNums,this.videoFramePlayDelayTs+=t,this.recvVideoFrameNums=0,this.recvVideoFrameTimeStamp=0}}},{key:"getCalculateVideoFramePlayDelay",value:function(){var e=0;return this.videoFrameCalculatePlayDelayFrames>0&&(e=Math.floor(this.videoFramePlayDelayTs/this.videoFrameCalculatePlayDelayFrames)+this.mse.getBufferLen(),this.videoFrameCalculatePlayDelayFrames=0),e}},{key:"remux",value:function(t){this.calcVideoFramePlayDelay(),t==e.REMUX_TYPE_VIDEO&&(this.avcTrackList.push(this.avcTrack),this.avcTrack={type:"video",id:1,sn:0,samples:[],len:0,duration:0,startDts:-1,endDts:0,naluCnt:0},this.avcTrack.sn=this.avcTrackList[this.avcTrackList.length-1].sn+1);var i=this.aacTrack,r=i.samples,n=this.avcTrackList[0];if(n){if(n.endDts>i.endDts+this.aacTimeLen&&(this.hasAudioTag||Date.now()-this.beginParseTs<200))return;this.avcTrackList.shift()}else n=this.avcTrack;var s=Number(localStorage._printRemux);s&&(D.debug("=========== aStartDts:"+i.startDts+" aEndDts:"+i.endDts+" samples:"+i.samples.length),D.debug("=========== vStartDts:"+n.startDts+" vEndDts:"+n.endDts+" samples:"+n.samples.length+" avcTrackList:"+this.avcTrackList.length));var a={type:"audio",id:0,sn:0,samples:[],len:0,duration:0,startDts:-1,endDts:0};a.sn=i.sn++,a.config=this.audioConfig,a.audiosamplerate=this.audioSampleRate,a.channelCount=this.audioChannelCount,a.codec="mp4a.40.5",a.timescale=this.remuxer.timescale;var o=n.startDts,u=n.endDts;-1===o&&(o=i.startDts,u=i.endDts),this.remuxAudio(r,a,o,u),r.length>0?(this.aacTrack.startDts=r[0].ts,this.aacTrack.endDts=r[r.length-1].ts):(this.aacTrack.startDts=-1,this.aacTrack.endDts=0),n.duration=Math.round((n.endDts-n.startDts)*(this.remuxer.timescale/1e3)),a.duration=Math.round((a.endDts-a.startDts)*(this.remuxer.timescale/1e3)),Number(localStorage._printRemux2)&&(D.debug("REMUX aac ts="+a.startDts+"-"+a.endDts+" len="+a.len+" samples="+a.samples.length+" duration="+a.duration),D.debug("REMUX avc ts="+n.startDts+"-"+n.endDts+" len="+n.len+" samples="+n.samples.length+" nalus="+n.naluCnt+" duration="+n.duration)),this.hasRemuxed||(this.hasRemuxed=!0,this.remuxLen=this.bufLen,this.mse.recvDataFull()),this.mse.onGop(u-o),this.remuxer.remux(a,n,0,!1),this.bufLen=this.DEFAULT_GOP,s&&D.debug("=========== aStartDts:"+i.startDts+" aEndDts:"+i.endDts+" samples:"+i.samples.length,"\n\n")}},{key:"remuxAudio",value:function(e,t,i,r){var n=null;if(e.length>0&&(n=e[0]),-1===this.nextAacDts&&(this.nextAacDts=i,0===this.nextAacDts&&(this.nextAacDts+=this.aacTimeLen)),r-this.nextAacDts>this.validAacTime)e.shift();else{var s=0,a=0,o=0;for(s=this.nextAacDts;s<r;s+=this.aacTimeLen)if(a=Math.round(s),n&&n.ts<=a)(n=e.shift()).ts<=this.lastAacTs&&0!=this.lastAacTs&&(s-=this.aacTimeLen,a=Math.round(s)),Number(localStorage._printRemux)&&D.log("^^^^^^^^^^^^^ aac.ts",n.ts,"to",a,"diff",a-n.ts),this.lastAacTs=n.ts,n.pts=n.dts=90*a,n.ts=a,t.samples.push(n),t.len+=n.unit.length,this.playAudioFrameCnt++,this.playAudioLength+=n.unit.length,-1===t.startDts&&(t.startDts=n.ts),t.endDts=n.ts,n=e.length>0?e[0]:null;else if(!this.mse.isPureAudio&&this.needEmptyAudioFrame){o++;var u=null;(u=22050===this.audioSampleRate&&2===this.audioObjectType?{unit:new Uint8Array(ne.emptyAacFrame),pts:0,dts:0,ts:0}:{unit:ne.getSilentFrame(this.audioObjectType,this.audioChannelCount),pts:0,dts:0,ts:0})&&(u.pts=u.dts=90*a,u.ts=a,t.samples.push(u),t.len+=u.unit.length,a>this.lastAudioTs&&(this.lastAudioTs=a),this.playAudioFrameCnt++,this.playEmptyAudioFrameCnt++,this.playAudioLength+=u.unit.length,-1===t.startDts&&(t.startDts=u.ts),t.endDts=u.ts)}this.nextAacDts=s,o>0&&this.hasAudioTag&&(this.hasEmptyFrames=!0,this.emptyFrames+=o,D.log("FlvParser.remux aac add "+o+" empty frames."))}}},{key:"calcAudioFrameRate",value:function(e){this.audioFrameRateTs||(this.audioFrameRateTs=e,this.audioFrameCnt=0),e-this.audioFrameRateTs<1e3?this.audioFrameCnt++:(Number(localStorage._printAudioFrameRate)&&D.log("@@@@@@@@ audioFrameRate="+this.audioFrameCnt),this.audioFrameRateTs=e,this.audioFrameCnt=0)}}]),e}();fe.REMUX_TYPE_AUDIO=0,fe.REMUX_TYPE_VIDEO=1,fe.FLV_HEADER_LEN=9,fe.TAG_HEADER_LEN=11,fe.PREV_TAG_SIZE_LEN=4,fe.AUDIO_TYPE=8,fe.VIDEO_TYPE=9,fe.SCRIPT_TYPE=18,fe.SCRIPT_AMF1_HEAD_LEN=13,fe.SCRIPT_AMF2_HEAD_LEN=5,fe.IFRAME=1,fe.NAL_VPS=32,fe.NAL_SPS=33,fe.NAL_PPS=34,fe.H265_SEI_HEAD=[44,162,222,9,181,23,71,219,187,85,164,254,127,194,252,78],fe.AdtsSampleingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];var pe=fe,ve=function(){function e(t){(0,h.default)(this,e),this.seiList=[],this.player=t,this.lastTs=-1,this.internal=10,this.timerStart=!1}return(0,d.default)(e,[{key:"add",value:function(e,t){var i=this.seiList.length;if(this.seiList.length>0)for(i=this.seiList.length-1;i>0&&!(e>this.seiList[i].timeStamp);i--);this.seiList.splice(i+1,0,{timeStamp:e,data:t}),this.timerStart||(this.timerStart=!0,setTimeout(this.checkDispatchSei.bind(this),this.internal))}},{key:"checkDispatchSei",value:function(){if(this.timerStart){for(var e=this.player.getCurrentRealTime(),t=0,i=null;t<this.seiList.length-2;){if(e>=this.seiList[t].timeStamp&&this.seiList[t+1].timeStamp>e){i=this.seiList[t+1].data,this.player.onH264Sei(i,this.seiList[t+1].timeStamp),this.seiList.splice(0,t+1);break}t++}setTimeout(this.checkDispatchSei.bind(this),this.internal)}}},{key:"reset",value:function(){this.seiList=[],this.player=null,this.lastTs=-1,this.timerStart=!1}}]),e}(),ye=function(){function e(t){(0,h.default)(this,e),this.volumeList=[],this.player=t,this.lastTs=-1,this.internal=100,this.timerStart=!1}return(0,d.default)(e,[{key:"add",value:function(e,t){var i=this.volumeList.length;if(this.volumeList.length>0)for(i=this.volumeList.length-1;i>0&&!(e>this.volumeList[i].timeStamp);i--);this.volumeList.splice(i+1,0,{timeStamp:e,data:t}),this.timerStart||(this.timerStart=!0,setTimeout(this.checkDispatchVolume.bind(this),this.internal))}},{key:"checkDispatchVolume",value:function(){if(this.timerStart){for(var e=this.player.getCurrentRealTime(),t=0;this.volumeList[t]&&this.volumeList[t].timeStamp<e;){var i=this.volumeList[t].data.split("_");i.length>1&&this.player.onScriptVolumeInfo(i[0],i[1]),t++}this.volumeList.splice(0,t),this.volumeList.length>0?setTimeout(this.checkDispatchVolume.bind(this),this.internal):this.timerStart=!1}}},{key:"reset",value:function(){this.volumeList=[],this.player=null,this.lastTs=-1,this.timerStart=!1}}]),e}(),me=0,_e=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"flv",r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;(0,h.default)(this,e),this.handler=t,this.videoType=i,this.isLive=r,this.isPureAudio=n,this._num_=++me,this.pushVideoStartRenderTime=0,this.remuxer=new $(this),this.parser="ts"===i?new ie(this,this.remuxer):new pe(this,this.remuxer),this.JITTER_BUFMIN=1e3,this.JITTER_BUFLEN=4e3,this.JITTER_BUFMAX=8e3,this.userPaused=!1,this.playing=!1,this.lastPlayTime=0,this.lastCheckPlayTime=0,this.paused=!1,this.pausedTs=0,this.maxGop=0,this.playStartTime=0,this.delayReset=!1,this.isPlayerError=!1,this.isErrorEvent=!1,this.startPlayBackRate=.9,this.metadata={},this.tryPlayAgainTimout=0,this.onUpdateErrorBind=this.onUpdateError.bind(this),this.onAudioUpdateEndBind=this.onAudioUpdateEnd.bind(this),this.onVideoUpdateEndBind=this.onVideoUpdateEnd.bind(this),this.onMediaSourceOpenBind=this.onMediaSourceOpen.bind(this),this.onVideoErrorBind=this.onVideoError.bind(this),this.onVideoPauseBind=this.onVideoPause.bind(this),this.onVideoPlayBind=this.onVideoPlay.bind(this),this.mediaSource=new MediaSource,this.mediaSource.addEventListener("sourceopen",this.onMediaSourceOpenBind),this.h264SeiInfos=new ve(this),this.scriptVolumeInfos=new ye(this),null==s?this.video=document.createElement("video"):(this.video=s,this.video.addEventListener("loadeddata",this.onVideoLoaded.bind(this)),requestAnimationFrame(this.checkVideoPlaying.bind(this))),this.videoElement=s,this.video.src=URL.createObjectURL(this.mediaSource),this.video.addEventListener("error",this.onVideoErrorBind),this.video.addEventListener("pause",this.onVideoPauseBind),this.video.addEventListener("play",this.onVideoPlayBind),this.audioSourceBuffer=null,this.videoSourceBuffer=null,this.audioCodec=null,this.videoCodec=null,this.audioSegments=[],this.videoSegments=[],this.width=1280,this.height=720,this.playbackrateChangeAccess=!0,this.enableLowLatency=!1,this.enableLowLatencyBufferLen=2e3,this.sensitivePause=!0,this.printJitter=!!Number(localStorage._printJitter);var a=navigator.userAgent.toLowerCase();this.isAndroid=-1!==a.indexOf("Android"),-1==D.getLevel()&&window.chrome&&(window.chrome.mse=this),this.videoDataAppended=!1,this.avcchangeCheckTimer=0}return(0,d.default)(e,[{key:"destroy",value:function(){if(D.log("MSEPlayer.destroy"),this.playing=!1,this.lastPlayTime=0,this.playStartTime=0,this.lastCheckPlayTime=0,this.handler&&(this.handler.onVideoStop(this.video,!!this.videoSourceBuffer),this.handler=null),this.video.removeEventListener("error",this.onVideoErrorBind),this.remuxer.destroy(),this.parser.destroy(),this.audioCodec=null,this.videoCodec=null,this.audioSegments=[],this.videoSegments=[],this.audioSourceBuffer&&(this.audioSourceBuffer.removeEventListener("updateend",this.onAudioUpdateEndBind),this.audioSourceBuffer.removeEventListener("error",this.onUpdateErrorBind),this.audioSourceBuffer=null),this.videoSourceBuffer&&(this.videoSourceBuffer.removeEventListener("updateend",this.onVideoUpdateEndBind),this.videoSourceBuffer.removeEventListener("error",this.onUpdateErrorBind),this.videoSourceBuffer=null),this.mediaSource){this.mediaSource.removeEventListener("sourceopen",this.onMediaSourceOpenBind);for(var e=this.mediaSource.sourceBuffers;e.length;)this.mediaSource.removeSourceBuffer(e[0]);this.mediaSource=this.onMediaSourceOpenBind=null}this.onAudioUpdateEndBind=this.onVideoUpdateEndBind=this.onUpdateErrorBind=null,this.video&&null==this.videoElement&&(this.video.removeEventListener("error",this.onVideoErrorBind),this.video.pause(),this.video.src="",this.video=null),this.pushVideoStartRenderTime=0,this.playbackrateChangeAccess=!0}},{key:"resetHls",value:function(){this.parser.reset&&this.parser.reset(),this.remuxer.reset()}},{key:"reset",value:function(){if(D.log("MSEPlayer.reset"),this.handler.onVideoStop(this.video,!!this.videoSourceBuffer),this.JITTER_BUFMIN=1e3,this.JITTER_BUFLEN=4e3,this.JITTER_BUFMAX=8e3,this.userPaused=!1,this.playing=!1,this.lastPlayTime=0,this.playStartTime=0,this.lastCheckPlayTime=0,this.audioCodec=null,this.videoCodec=null,this.audioSegments=[],this.videoSegments=[],this.metadata={},this.paused&&this.handler.onPlayResume(R()),this.paused=!1,this.pausedTs=0,this.maxGop=0,clearTimeout(this.tryPlayAgainTimout),this.audioSourceBuffer&&(this.audioSourceBuffer.removeEventListener("updateend",this.onAudioUpdateEndBind),this.audioSourceBuffer.removeEventListener("error",this.onUpdateErrorBind),this.audioSourceBuffer=null),this.videoSourceBuffer&&(this.videoSourceBuffer.removeEventListener("updateend",this.onVideoUpdateEndBind),this.videoSourceBuffer.removeEventListener("error",this.onUpdateErrorBind),this.videoSourceBuffer=null),this.mediaSource){this.mediaSource.removeEventListener("sourceopen",this.onMediaSourceOpenBind);for(var e=this.mediaSource.sourceBuffers;e.length;)this.mediaSource.removeSourceBuffer(e[0])}this.mediaSource=new MediaSource,this.mediaSource.addEventListener("sourceopen",this.onMediaSourceOpenBind),null!=this.videoElement&&(this.video&&(this.video.removeEventListener("error",this.onVideoErrorBind),this.video.pause(),this.video.src="",this.video=null),this.video=document.createElement("video"),this.video.src=URL.createObjectURL(this.mediaSource),this.video.addEventListener("error",this.onVideoErrorBind)),this.playbackrateChangeAccess=!0,this.videoDataAppended=!1}},{key:"setPushGop",value:function(e){this.parser.setPushGop(e)}},{key:"setDeleteH264Aud",value:function(e){this.parser.setDeleteH264Aud(e)}},{key:"setNeedEmptyAudioFrame",value:function(e){this.parser.setNeedEmptyAudioFrame(e)}},{key:"getPlayStat",value:function(){return this.parser.getPlayStat()}},{key:"getPlayVideo",value:function(){return this.video}},{key:"getFrameReadyed",value:function(){return this.parser&&this.parser.getFrameReadyed?this.parser.getFrameReadyed():0}},{key:"getFramePlayDelays",value:function(){return this.parser.getCalculateVideoFramePlayDelay?this.parser.getCalculateVideoFramePlayDelay():0}},{key:"getBufferLen",value:function(){var e=0;if(this.video){var t=this.video.buffered;t.length>0&&(e=1e3*(t.end(t.length-1)-this.video.currentTime)>>0)}return e}},{key:"setSensitivePause",value:function(e){this.sensitivePause=e}},{key:"getParserBufLen",value:function(){return this.parser.getParserBufLen()}},{key:"getCurrentDts",value:function(){return this.remuxer.getInitDts()<0?0:Math.round(1e3*this.video.currentTime)+this.remuxer.getInitDts()}},{key:"getCurrentTime",value:function(){return Math.round(1e3*this.video.currentTime)}},{key:"getCurrentRealTime",value:function(){return this.video?Math.round(1e3*this.video.currentTime)+this.remuxer.getInitDts():0}},{key:"appendFlv",value:function(e){this.parser.parseFlv(e)}},{key:"appendTs",value:function(e){this.parser.parseTs(e)}},{key:"saveH264SeiData",value:function(e,t){this.h264SeiInfos.add(e,t)}},{key:"saveScriptVolumeData",value:function(e,t){this.scriptVolumeInfos.add(e,t)}},{key:"setPlaybackrateAccess",value:function(e){this.playbackrateChangeAccess=e}},{key:"checkBuffer",value:function(){if(!this.video.paused){var e=R(),t=this.video.buffered,i=t.length,r=this.getBufferLen();if(0===this.video.currentTime&&0!==this.lastPlayTime)return D.warn("MSEPlayer.checkBuffer onPlayerError(false) lastPlayTime="+this.lastPlayTime+" bufLen="+r),this._onPlayerError(!1),void(this.lastPlayTime=0);if(this.lastPlayTime=this.video.currentTime,e>this.playStartTime+3e3&&r>4e3&&0==this.video.currentTime&&(i>0&&t.start(0)<=4&&(D.log("MSEPlayer.checkBuffer buffer full but can not play"),this.video.currentTime=Math.round(t.start(0)+1)),this.videoPlay()),0!==this.playStartTime&&e>this.playStartTime+5e3&&(r>5e3||0===r))if(0==this.video.currentTime&&r>2e3)D.log("####### currentTime=0 ++ bufLen="+r+"  paused="+this.video.paused);else if(this.playStartTime=0,0===this.video.currentTime&&!this.isAndroid)return D.warn("MSEPlayer.checkBuffer onPlayerError(true) playTime="+this.video.currentTime+" bufLen="+r),this._onErrorEvent(6),void this._onPlayerError(!0);null==this.videoElement&&i&&this.video.currentTime-t.start(0)>20&&(this.audioSourceBuffer&&!this.audioSourceBuffer.updating&&this.audioSourceBuffer.remove(0,this.video.currentTime-10),this.videoSourceBuffer&&!this.videoSourceBuffer.updating&&this.videoSourceBuffer.remove(0,this.video.currentTime-10))}}},{key:"_onPlayerError",value:function(e){this.isPlayerError||(this.isPlayerError=!0,this.handler.onPlayerError(e))}},{key:"_onErrorEvent",value:function(e){this.isErrorEvent||(this.isErrorEvent=!0,this.handler&&this.handler.onErrorEvent&&this.handler.onErrorEvent({type:e}))}},{key:"onAvcCfgChange",value:function(){return D.log("MSEPlayer.onAvcCfgChange"),this.getBufferLen()<500?(D.log("MSEPlayer.onAvcCfgChange reset player"),this.remuxer.reset(),this.parser.setPaused(!1),!1):(this.delayReset=!0,!0)}},{key:"onRestart",value:function(){D.log("MSEPlayer.onRestart"),this.reset()}},{key:"onVideoParseInvalid",value:function(){this.handler&&this.handler.onVideoParseInvalid&&this.handler.onVideoParseInvalid()}},{key:"onGop",value:function(e){this.handler.onGop&&this.handler.onGop(e),e>this.maxGop&&(this.maxGop=e,D.log("MSEPlayer.onGop update maxGop="+this.maxGop))}},{key:"getMaxGop",value:function(){return this.maxGop}},{key:"setVolume",value:function(e){this.video&&(this.video.volume=e)}},{key:"setEnableLowLatency",value:function(e){this.enableLowLatency=e}},{key:"getVolume",value:function(){return this.video?this.video.volume:-1}},{key:"setMuted",value:function(e){this.video&&(this.video.muted=e,D.log("MSEPlayer.setMuted "+e+" hasVideo="+!!this.videoSourceBuffer+" hasAudio="+!!this.audioSourceBuffer))}},{key:"getMuted",value:function(){return this.video?this.video.muted:-1}},{key:"setResolution",value:function(e,t){D.log("MSEPlayer.setResolution w/h="+e+"/"+t),this.width=e,this.height=t}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"onInitSegment",value:function(e){e.audioCodec&&(this.audioCodec=e.audioCodec),e.videoCodec&&(this.videoCodec=e.videoCodec),this.isMediaSourceOpen&&this.initSourceBuffer(),e.audioMoov&&this.audioSegments.push(e.audioMoov),e.videoMoov&&this.videoSegments.push(e.videoMoov),this.playStartTime=0}},{key:"onFragParsing",value:function(e){"audio"===e.type?this.audioSegments.push(e.data):"video"===e.type&&this.videoSegments.push(e.data)}},{key:"onFragParsed",value:function(){this.audioSourceBuffer&&this.appendBuffer("audio"),this.videoSourceBuffer&&this.appendBuffer("video"),null==this.videoElement&&this.triggerPlay()}},{key:"checkVideoPlaying",value:function(){0==this.pushVideoStartRenderTime&&this.video.videoWidth>0&&this.video.videoHeight>0?this.pushVideoStartRenderTime=R():requestAnimationFrame(this.checkVideoPlaying.bind(this))}},{key:"onVideoLoaded",value:function(){this.triggerPlay()}},{key:"initSourceBuffer",value:function(){if(this.audioCodec&&!this.audioSourceBuffer){D.log("MSEPlayer.initSourceBuffer audio codec="+this.audioCodec);try{this.audioSourceBuffer=this.mediaSource.addSourceBuffer("video/mp4;codecs="+this.audioCodec),this.audioSourceBuffer.addEventListener("updateend",this.onAudioUpdateEndBind),this.audioSourceBuffer.addEventListener("error",this.onUpdateErrorBind)}catch(e){return D.warn("MSEPlayer.initSourceBuffer audio err="+e.message),e.message&&-1!=e.message.indexOf("No additional SourceBuffer objects may be added")&&(D.log("MSEPlayer.initSourceBuffer resetMediasource in audio"),this.handler.resetMediasource)?void this.handler.resetMediasource():(this._onErrorEvent(4),void this._onPlayerError(!0))}}if(this.videoCodec&&!this.videoSourceBuffer){D.log("MSEPlayer.initSourceBuffer video codec="+this.videoCodec);try{this.videoSourceBuffer=this.mediaSource.addSourceBuffer("video/mp4;codecs="+this.videoCodec),this.videoSourceBuffer.addEventListener("updateend",this.onVideoUpdateEndBind),this.videoSourceBuffer.addEventListener("error",this.onUpdateErrorBind)}catch(e){if(e.message&&-1!=e.message.indexOf("No additional SourceBuffer objects may be added")&&(D.log("MSEPlayer.initSourceBuffer resetMediasource in video"),this.handler.resetMediasource))return void this.handler.resetMediasource();D.warn("MSEPlayer.initSourceBuffer video err="+e.message),this._onErrorEvent(5),this._onPlayerError(!0)}}}},{key:"appendBuffer",value:function(e){if(0!=this.mediaSource.sourceBuffers.length&&!this.isPlayerError)if("audio"==e){if(this.audioSegments.length>0&&this.audioSourceBuffer&&!this.audioSourceBuffer.updating){var t=this.audioSegments.shift();try{this.audioSourceBuffer.appendBuffer(t),this.videoDataAppended=!0}catch(e){D.warn("MSEPlayer.appendBuffer audio err="+e.message),this._onErrorEvent(7),this._onPlayerError(!0)}}}else{if("video"!=e)throw new Error("MSEPlayer.appendBuffer type error! Valide type is audio or video.");if(this.videoSegments.length>0&&this.videoSourceBuffer&&!this.videoSourceBuffer.updating){var i=this.videoSegments.shift();try{this.videoSourceBuffer.appendBuffer(i),this.videoDataAppended=!0}catch(e){D.warn("MSEPlayer.appendBuffer video err="+e.message),this._onErrorEvent(8),this._onPlayerError(!0)}}}}},{key:"checkPlay",value:function(){0===this.video.currentTime&&this.videoPlay()}},{key:"triggerPlay",value:function(){if(!this.playing&&this.isMediaSourceOpen){this.playing=!0,this.playStartTime=R();var e=!!this.videoSourceBuffer;this.video.autoplay&&(this.videoPlay(),Q.once(this.checkPlay,this,50)),this.handler.onPlayVideo(this.video,this.width,this.height,e),null==this.videoElement&&(clearTimeout(this.tryPlayAgainTimout),this.tryPlayAgainTimout=setTimeout(this.setPlayAgain.bind(this),100))}}},{key:"recvDataFull",value:function(){this.handler.recvDataFull()}},{key:"videoPlay",value:function(){var e=this.video.play();void 0!==e&&e.then((function(e){})).catch((function(e){D.log("MSEPlayer.videoPlay play err "+e)}))}},{key:"setPlayAgain",value:function(){this.video&&this.video.autoplay&&this.videoPlay()}},{key:"onH264Sei",value:function(e,t){this.handler.onSendSeiData(e,t,this.video.currentTime)}},{key:"onScriptVolumeInfo",value:function(e,t){this.handler.onSendScriptVolumeInfo(e,t)}},{key:"onMediaSourceOpen",value:function(){this.mediaSource.removeEventListener("sourceopen",this.onMediaSourceOpenBind),(this.audioSegments.length>0||this.videoSegments.length>0)&&(this.initSourceBuffer(),this.appendBuffer("audio"),this.appendBuffer("video"),null==this.videoElement&&this.triggerPlay())}},{key:"onAudioUpdateEnd",value:function(){this.appendBuffer("audio"),this.checkAppendOver()}},{key:"onVideoUpdateEnd",value:function(){this.appendBuffer("video"),this.checkAppendOver()}},{key:"checkAppendOver",value:function(){0===this.videoSegments.length&&0===this.audioSegments.length&&(this.videoSourceBuffer&&this.videoSourceBuffer.updating||this.audioSourceBuffer&&this.audioSourceBuffer.updating||this.handler.onSBUpdateEnd&&this.handler.onSBUpdateEnd())}},{key:"onUpdateError",value:function(e){D.warn("MSEPlayer.onUpdateError",e)}},{key:"onVideoPause",value:function(e){this.userPaused=!0}},{key:"onVideoPlay",value:function(e){this.userPaused=!1}},{key:"onVideoError",value:function(e){var t="";if(this.video.error){var i=this.video.error.code;t=" errCode="+i+" "+["Unknow","用户终止","网络错误","解码错误","格式不支持"][i],3!=i&&4!=i||(this._onErrorEvent(3==i?1:2),this._onPlayerError(!0),localStorage.decodeabnormal="abnormal_"+(new Date).getTime())}D.warn("MSEPlayer.onVideoError"+t)}},{key:"pause",value:function(){D.info("MSEPlayer.pause"),this.userPaused=!0,this.video&&this.video.pause()}},{key:"play",value:function(){if(D.info("MSEPlayer.play"),this.userPaused=!1,this.video){var e=this.video.play();void 0!==e&&e.then((function(e){})).catch((function(e){}))}}},{key:"seek",value:function(e){this.video&&(D.info("MSEPlayer.seek seekTime="+e,"currentTime="+this.video.currentTime),this.lastPlayTime=e,this.video.currentTime=e)}},{key:"onCheckTimer",value:function(e,t){if(this.isMediaSourceOpen){this.metadata.fps=this.parser.getFps();var i=this.getBufferLen(),r=Number(localStorage._printBufferLen);if(-1==r||r>0&&r==this._num_){var n=Math.max(0,i/100);D.debug(this._getTag(),"bufLen","-".repeat(n),i)}if(Number(localStorage._printMseLog)&&this.audioSegments&&this.videoSegments&&D.debug("MSE aSegments="+this.audioSegments.length+" vSegments="+this.videoSegments.length+" bufLen="+this.getBufferLen()),!this.video.paused&&!this.userPaused){if(null==this.videoElement&&this.isLive&&t%4==0&&i>2e4&&!Number(localStorage._localFlvTest)){var s=.001*(i-8e3);this.video.currentTime+=s,D.warn("MSEPlayer.onCheckTimer jumpTs="+s+" bufLen="+this.getBufferLen())}this.checkBuffer(),this.onJitterTimer();var a=this.handler.lastEmptySliceTs||0,o=a>0&&e-a<3e3,u=!!this.videoSourceBuffer;this.isLive&&u&&this.pausedTs>0&&e-this.pausedTs>5e3&&!o&&this.sensitivePause&&(D.warn("MSEPlayer.onCheckTimer paused 5 sec."),this._onErrorEvent(3),this._onPlayerError(!0))}}}},{key:"onCheckFastTimer",value:function(e,t){if(this.isMediaSourceOpen&&!this.video.paused&&!this.userPaused){this.checkEmptyFrames(),this.checkDelayReset(),this.checkSensePause(e);var i=(this.handler?this.handler.lastEmptySliceTs:0)||0,r=i>0&&e-i<3e3,n=!!this.videoSourceBuffer;if(null==this.videoElement&&!this.pause500checked&&n&&this.pausedTs>0&&e-this.pausedTs>500&&!r){this.pause500checked=!0;var s=this.bufferedInfo(),a=s.bufferLen.toFixed(2),o=(s.nextStart-s.end).toFixed(2);if(D.info("MSEPlayer.onCheckFastTimer paused","bufferLen="+a,"hole="+o,"nextStart="+s.nextStart.toFixed(2),"currentTime="+this.video.currentTime),this.isLive&&"ts"!=this.videoType){var u=Number(s.nextStart);this.video&&u&&o>0&&o<3&&u-this.video.currentTime>.5&&(this.video.currentTime=u,D.log("MSEPlayer.onCheckFastTimer try jump currentTime="+this.video.currentTime))}}}}},{key:"checkEmptyFrames",value:function(){this.handler.hasOwnProperty("hasEmptyFrames")&&this.parser.hasEmptyFrames&&(this.handler.hasEmptyFrames=this.parser.hasEmptyFrames)}},{key:"checkDelayReset",value:function(){this.delayReset&&this.getBufferLen()<500&&(D.log("MSEPlayer.checkDelayReset reset player"),this.remuxer.reset(),this.parser.setPaused(!1),this.delayReset=!1)}},{key:"checkSensePause",value:function(e){var t=this.video,i=t.currentTime;if(0!==this.lastCheckPlayTime)if(i!==this.lastCheckPlayTime||t.paused)this.paused&&(this.paused=!1,this.pausedTs=0,this.pause500checked=!1,this.handler.onPlayResume(e,!!this.videoSourceBuffer));else{var r=this.getBufferLen();if(this.paused){if(r>1e3&&e-this.pausedTs>500){D.log("####### readyState="+t.readyState+" bufLen="+r+" rate="+t.playbackRate+"  paused="+this.video.paused);var n=t.buffered;"flv"==this.videoType&&n&&n.length>0&&n.start(n.length-1)>t.currentTime?n.end(n.length-1)-n.start(n.length-1)>1&&(D.log("video current play not in buffered , currentTime="+t.currentTime+"  buffed start="+n.start(n.length-1)),t.currentTime=n.start(n.length-1),this.play()):t.currentTime+=1}}else this.paused=!0,this.pausedTs=e,D.log("MSEPlayer.checkSensePause readyState="+t.readyState+" currentTime="+i+" bufLen="+r),this.isLive&&this.handler.onPlayPause(e,!!this.videoSourceBuffer)}this.lastCheckPlayTime=i}},{key:"bufferedInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.2,t=void 0,i=void 0,r=void 0,n=void 0,s=void 0,a=[],o=[],u=this.video.buffered;for(s=0;s<u.length;s++)a.push({start:u.start(s),end:u.end(s)});for(a.sort((function(e,t){return e.start-t.start||t.end-e.end})),s=0;s<a.length;s++){var l=o.length;if(l){var h=o[l-1].end;a[s].start-h<e?a[s].end>h&&(o[l-1].end=a[s].end):o.push(a[s])}else o.push(a[s])}var d=this.video.currentTime;for(s=0,t=0,i=r=d;s<o.length;s++){var c=o[s].start,f=o[s].end;if(d+e>=c&&d<f)i=c,t=(r=f)-d;else if(d+e<c){n=c;break}}return n||(n=r),{bufferLen:t,start:i,end:r,nextStart:n}}},{key:"printBuffer",value:function(e){if(this.video){var t=this.video.buffered,i="buffered=["+(1e3*t.start(0)|0)+","+(1e3*t.end(0)|0)+"]",r=1e3*this.video.currentTime>>0,n=this.getBufferLen();D.log("MSEPlayer.printBuffer "+e+" currentTime="+r+" bufLen="+n+" "+i)}}},{key:"onJitterTimer",value:function(e,t){if(this.playing&&("ts"!=this.videoType||this.isLive)){var i=this.getPlayVideo();if(i){var r=this.getBufferLen(),n=i.playbackRate,s=0;if(r<this.JITTER_BUFMIN?s=r-this.JITTER_BUFLEN:r>this.JITTER_BUFMAX&&(s=r-this.JITTER_BUFMAX),this.enableLowLatency&&r>this.enableLowLatencyBufferLen)i.playbackRate=1.1;else if(this.playbackrateChangeAccess)if(0==s){if(1!=n){if(n<1&&r<this.JITTER_BUFLEN)return;if(n>1&&r>this.JITTER_BUFMAX-1e3)return;i.playbackRate=1,this.printJitter&&D.log(this._getTag(),"JitterBuffer reset rate=1 bufLen="+r)}}else{var a=1+s/1e4;if(a=Number(a.toFixed(3)),a=Math.min(a,1.1),a=Math.max(a,.9),Math.abs(1-a)<.03)return;if(1!=n&&Math.abs(n-a)<.03)return;i.playbackRate=a,this.printJitter&&D.log(this._getTag(),"JitterBuffer adjust="+s+" "+n+"->"+a+" bufLen="+r)}else i.playbackRate=1}}}},{key:"setJitter",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3e3,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2e3,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3;e<t&&(e=t+1e3),i<e&&(i=e+2e3),this.JITTER_BUFLEN=e,this.JITTER_BUFMIN=t,this.JITTER_BUFMAX=i,this.enableLowLatencyBufferLen=null!=this.videoElement?this.JITTER_BUFLEN:2e3,D.info(this._getTag()+" MSEPlayer.setJitter bufMin="+t+" bufLen="+e+" bufMax="+i)}},{key:"_getTag",value:function(){var e=this.handler.constructor.name;return this._num_+" "+e}},{key:"isMediaSourceOpen",get:function(){return this.mediaSource&&"open"===this.mediaSource.readyState}}]),e}(),Se=function(){function e(t){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;(0,h.default)(this,e),this.linkHandler=t,this.ws=null,this.connected=!1,this.isYY=i,this.url=null,this.avgSpeed=new U(r)}return(0,d.default)(e,[{key:"destroy",value:function(){this.linkHandler=null,this.reset(),Q.remove(this.onCheckTimer,this)}},{key:"connect",value:function(e){this.reset(),Q.add(this.onCheckTimer,this,1e3),this.url=e,this.ws=new WebSocket(e),this.ws.binaryType="arraybuffer",this.ws.onopen=this.onopen.bind(this),this.ws.onerror=this.onerror.bind(this),this.ws.onclose=this.onclose.bind(this),this.ws.onmessage=this.onmessage.bind(this)}},{key:"reset",value:function(){this.ws&&(this.connected=!1,this.ws.onopen=null,this.ws.onerror=null,this.ws.onclose=null,this.ws.onmessage=null,this.ws.close(),this.ws=null),this.url=null,this.avgSpeed.reset()}},{key:"send",value:function(e){this.ws&&this.connected&&this.ws.send(e)}},{key:"onopen",value:function(){this.connected=!0,this.linkHandler&&this.linkHandler.onopen()}},{key:"onerror",value:function(e){D.log("ProtoLink.onerror event="+e),this.connected=!1,this.ws=null,this.linkHandler&&(this.linkHandler.onerror(e),this.linkHandler=null)}},{key:"onclose",value:function(){this.connected=!1,this.ws=null,this.linkHandler&&(this.linkHandler.onclose(),this.linkHandler=null)}},{key:"onmessage",value:function(e){this.avgSpeed.addCur(e.data.byteLength),e.data instanceof ArrayBuffer?this.processArrayBuffer(e.data):this.processText(e.data)}},{key:"processText",value:function(e){D.log("ProtoLink.processText data="+e)}},{key:"processArrayBuffer",value:function(e){if(this.isYY)for(var t=new DataView(e),i=0,r=0,n=0;i+10<e.byteLength;){if(i+(r=t.getUint32(i,!0))>e.byteLength||r<10)return void D.error("ProtoLink.processArrayBuffer length error pktLen="+r+" bufferLen="+e.byteLength);n=t.getUint32(i+4,!0);var s=new DataView(e,i,r);this.linkHandler&&this.linkHandler.onData(n,s),i+=r}else this.linkHandler&&this.linkHandler.onData(e)}},{key:"onCheckTimer",value:function(e,t){this.connected&&this.avgSpeed.calculate()}},{key:"speed",get:function(){return this.avgSpeed.average()}}]),e}(),ge=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;(0,h.default)(this,e),this.linkHandler=t,this.connected=!1,this.url=null,this.xhr=null,this.avgSpeed=new U(i)}return(0,d.default)(e,null,[{key:"isSupported",value:function(){try{var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),e.responseType="moz-chunked-arraybuffer","moz-chunked-arraybuffer"===e.responseType}catch(e){return Log.w("MozChunkedLoader",e.message),!1}}}]),(0,d.default)(e,[{key:"destroy",value:function(){this.reset(),this.linkHandler=null,Q.remove(this.onCheckTimer,this)}},{key:"reset",value:function(){this.abort(),this.url=null,this.xhr=null,this.connected=!1,this.avgSpeed.reset()}},{key:"abort",value:function(){this.xhr&&(D.log("ProtoLinkXhrFF abort"),this.xhr.abort())}},{key:"connect",value:function(e){this.reset(),this.url=e;var t=this.xhr=new XMLHttpRequest;t.responseType="moz-chunked-arraybuffer",t.open("GET",this.url,!0),t.onerror=this.onerror.bind(this),t.onprogress=this.onprogress.bind(this),t.onloadend=this.loadend.bind(this),t.onload=this.onclose.bind(this),t.send(),Q.add(this.onCheckTimer,this,1e3)}},{key:"onprogress",value:function(e){this.connected||this.onopen();var t=e.target.response;this.linkHandler.onData(t),this.avgSpeed.addCur(t.byteLength)}},{key:"onreadystatechange",value:function(e){}},{key:"onopen",value:function(){this.connected=!0,this.linkHandler&&this.linkHandler.onopen()}},{key:"onerror",value:function(e){D.log("ProtoLinkXhrFF.onerror "+e);var t=event.currentTarget.status;this.connected=!1,this.linkHandler&&(this.linkHandler.onerror(e,t),this.linkHandler=null)}},{key:"loadend",value:function(e){404===e.currentTarget.status&&this.onerror(e)}},{key:"onclose",value:function(){D.log("ProtoLinkXhrFF.onclose"),this.connected=!1,this.linkHandler&&(this.linkHandler.onclose(),this.linkHandler=null)}},{key:"onCheckTimer",value:function(e,t){this.connected&&this.avgSpeed.calculate()}},{key:"speed",get:function(){return this.avgSpeed.average()}}]),e}(),Te=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;(0,h.default)(this,e),this.linkHandler=t,this.connected=!1,this.url=null,this.requestAbort=!1,this.avgSpeed=new U(i)}return(0,d.default)(e,[{key:"destroy",value:function(){this.abort(),this.linkHandler=null,this.reset(),Q.remove(this.onCheckTimer,this)}},{key:"reset",value:function(){this.url=null,this.connected=!1,this.avgSpeed.reset()}},{key:"pump",value:function(e){var t=this;e.read().then(function(i){if(i.done)D.log("ProtoLinkFetch result done"),t.onclose();else{if(!0===t.requestAbort)return D.log("ProtoLinkFetch cancel"),t.requestAbort=!1,e.cancel();var r=i.value.buffer;t.avgSpeed.addCur(r.byteLength),t.linkHandler&&t.linkHandler.onData(r),t.pump(e)}}.bind(this))}},{key:"connect",value:function(e){var t=this;Q.add(this.onCheckTimer,this,1e3),this.url=e,fetch(e).then((function(e){Number(localStorage._printFetchUrl)&&D.log("FetchUrl",e.url),t.linkHandler&&t.linkHandler.onstatus&&t.linkHandler.onstatus(e.status),e.ok&&e.status>=200&&e.status<300?(t.onopen(),t.pump.call(t,e.body.getReader())):(D.log("ProtoLinkFetch http code invalid status:"+e.status),t.onerror(e.statusText,e.status))})).catch((function(e){D.log("ProtoLinkFetch exception"),t.onerror(e.message)}))}},{key:"abort",value:function(){this.requestAbort=!0}},{key:"onopen",value:function(){this.connected=!0,this.linkHandler&&this.linkHandler.onopen()}},{key:"onerror",value:function(e,t){D.log("ProtoLinkFetch.onerror "+e),this.connected=!1,this.linkHandler&&(this.linkHandler.onerror(e,t),this.linkHandler=null)}},{key:"onclose",value:function(){this.connected=!1,this.linkHandler&&(this.linkHandler.onclose(),this.linkHandler=null)}},{key:"onCheckTimer",value:function(e,t){this.connected&&this.avgSpeed.calculate()}},{key:"speed",get:function(){return this.avgSpeed.average()}}]),e}(),Ee=function(){function e(t){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];(0,h.default)(this,e),this.flvPlayer=t,t.hyPlayer&&(this.hyPlayer=t.hyPlayer,this.stat=t.hyPlayer.stat),this._newLink(),this.needRetry=i,this.status=0,this.url=null,this.started=!1,this.lastGetProxyTime=0,this.getProxyPeriod=e.DEFAULT_GET_PROXY_PERIOD}return(0,d.default)(e,[{key:"_newLink",value:function(){E.firefox&&ge.isSupported()?this.link=new ge(this):"mac"===E.platform&&"chrome"===E.name&&72===Number(E.version.major)?this.link=new Se(this):this.link=new Te(this)}},{key:"reset",value:function(){this.started&&(D.log("FlvLoader.reset"),this.link.destroy(),this._newLink(),this.lastGetProxyTime=0,this.status=0,this.url=null)}},{key:"connect",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e){this.link instanceof Se&&(e=e.replace("http","ws"));var i=this.hyPlayer?this.hyPlayer.uuid:0,r=this.flvPlayer.info;if(r&&(i=g.rotUid(r.uid||0,r.presenterUid||0)),t){var n=-1==e.indexOf("?")?"?":"&";e+=n+"u="+i+"&t=100&sv=2006231626"}D.log("FlvLoader.connect url="+e),this.reset(),this.lastGetProxyTime=R()-2e3,this.url=e,this.link.connect(this.url),this.stat&&this.stat.setComDim(O.DIM_COM.STREAM_URL,e),this.started=!0}else D.warn("FlvLoader.connect url is null")}},{key:"close",value:function(){D.log("FlvLoader.close"),this.reset(),this.started=!1}},{key:"onstatus",value:function(e){this.status=e}},{key:"onopen",value:function(){D.log("FlvLoader.onopen"),this.getProxyPeriod=e.DEFAULT_GET_PROXY_PERIOD,this.flvPlayer.onConnected()}},{key:"onclose",value:function(){D.log("FlvLoader.onclose"),this.flvPlayer.onClosed(),this.lastGetProxyTime=0,this.needRetry&&this.getProxy()}},{key:"onerror",value:function(e,t){D.log("FlvLoader.onerror",t),this.lastGetProxyTime=0,this.needRetry&&this.getProxy(),this.flvPlayer.onLoadError&&this.flvPlayer.onLoadError(e)}},{key:"onData",value:function(e){this.flvPlayer.onData(e)}},{key:"onCheckTimer",value:function(e,t){if(this.started&&(this.onCheckConnect(e),t%10==0)){var i=this.link.speed;i!=g.UintMax&&(i=g.formatByteSize(i),D.log("FlvLoader speed "+i+"/s"))}}},{key:"onCheckConnect",value:function(e){this.connected||(this.needRetry?this.getProxy():e-this.lastGetProxyTime>15e3&&0!=this.lastGetProxyTime&&this.flvPlayer&&this.flvPlayer.onLoadError&&(this.flvPlayer.onLoadTimeout(),this.lastGetProxyTime=0))}},{key:"getProxy",value:function(){var e=R();e-this.lastGetProxyTime<this.getProxyPeriod||(D.log("FlvLoader.getProxy lastGetProxyTime="+this.lastGetProxyTime+" now="+e+" period="+this.getProxyPeriod),this.reset(),this.lastGetProxyTime=e,this.getProxyPeriod=Math.min(2*this.getProxyPeriod,128e3),this.flvPlayer.requestUrl())}},{key:"speed",get:function(){var e=this.link.speed;return e==g.UintMax&&(e=0),e}},{key:"connected",get:function(){return this.link&&this.link.connected}}]),e}();Ee.DEFAULT_GET_PROXY_PERIOD=4e3;var Ie=Ee,Pe=function(){function e(t){(0,h.default)(this,e),this.flvPlayer=t,this.hyPlayer=t.hyPlayer,this.jumpToP2PCd=24e4,this.nextJumpToP2PTs=0,this.waitPlayEnd=!1}return(0,d.default)(e,[{key:"reset",value:function(){this.waitPlayEnd=!1}},{key:"initJumpTs",value:function(e){0==this.nextJumpToP2PTs&&(this.nextJumpToP2PTs=e+this.jumpToP2PCd)}},{key:"onCheckTimer",value:function(e,t){if(!this.waitPlayEnd&&this.hyPlayer.isSupportP2P&&!(e<this.nextJumpToP2PTs)){var i=this.flvPlayer,r=this.hyPlayer.lastP2PInfo;if(r&&r.lineType==i.lineType){var n=r.sStreamName;n&&i.url&&-1!=i.url.indexOf(n)&&(i.getBufferLen()<i.mse.JITTER_BUFLEN||(i.loader&&(D.warn("BackToP2P.tryPlayP2P"),i.loader.close()),this.waitPlayEnd=!0))}}}},{key:"onCheckFastTimer",value:function(e,t){this.hyPlayer;var i=this.flvPlayer.getBufferLen();this.waitPlayEnd&&i<1e3&&(this.waitPlayEnd=!1,this.jumpToP2PCd<18e5&&(this.jumpToP2PCd+=12e4),this.nextJumpToP2PTs=e+this.jumpToP2PCd,D.warn("BackToP2P.onCheckFastTimer jumpToP2PCd="+this.jumpToP2PCd/6e4+"min"),this.hyPlayer.metrics.setP2p(1),this.hyPlayer.flvBackToP2P(),Q.once(this.tryPlayP2PTimeout,this,3e3))}},{key:"tryPlayP2PTimeout",value:function(){var e=this.hyPlayer,t=e.player;e.isP2P&&t.isPlaying||e.trigger(c.P2P_TIMEOUT)}}]),e}(),Re=function(){function e(t){(0,h.default)(this,e),this.flvPlayer=t,this.hyPlayer=t.hyPlayer,this.stat=t.hyPlayer.stat,this.data={act:"webhuyah5qa",uid:0,sid:0,subsid:0,linetype:-1,sendcnt:0,paucount:0,paulength:0,bflength:0,vr:0,httphead:"",rel:"jsscene",ref:location.href,isp2p:0},this.img=null,this.pausedCount=0,this.pausedTime=0,this.isPaused=!1,this.isFirstReport=!0}return(0,d.default)(e,[{key:"send",value:function(){}},{key:"sendFlow",value:function(e){var t=[{sMetricName:F.METRIC.VIDEO_FLOW_LINE,vField:{value:e}}];this.stat.setCoreDim(O.DIM_CORE.USER_PROPERTY,this.getUserProperty()),this.stat.fill(t,!0),this.hyPlayer.tsdbUtil.sendMetrics(t)}},{key:"getUserProperty",value:function(){var e=this.hyPlayer.tsdbUtil;return this.flvPlayer.getConfig(100)?this.flvPlayer.getConfig(101)?this.hyPlayer.isBrowserSupport()?this.hyPlayer.isP2PCooling()?Y.userProperty.P2P_COOLING:1==e.turnToFlvTimes&&0==e.restartTimes?e.turnToFlvReason==Y.turnToFlvReason.FULL_CONNECT_TIMEOUT?Y.userProperty.FIRST_FULL_CONNECT_TIMEOUT:e.turnToFlvReason==Y.turnToFlvReason.FULL_NO_DATA?Y.userProperty.FIRST_FULL_NO_DATA:e.turnToFlvReason==Y.turnToFlvReason.FULL_PLAY_FAIL?Y.userProperty.FIRST_FULL_PLAY_FAIL:e.turnToFlvReason==Y.turnToFlvReason.SUB_CONNECT_TIMEOUT?Y.userProperty.SUB_CONNECT_TIMEOUT:e.turnToFlvReason==Y.turnToFlvReason.SUB_NO_DATA?Y.userProperty.SUB_NO_DATA:e.turnToFlvReason==Y.turnToFlvReason.P2P_ARGS_ERROR?Y.userProperty.P2P_ARGS_ERROR:e.turnToFlvReason==Y.turnToFlvReason.P2P_COOLING?Y.userProperty.P2P_COOLING:Y.userProperty.UNKNOW:e.turnToFlvReason==Y.turnToFlvReason.FULL_CONNECT_TIMEOUT||e.turnToFlvReason==Y.turnToFlvReason.FULL_NO_DATA||e.turnToFlvReason==Y.turnToFlvReason.FULL_PLAY_FAIL?e.restartReason==Y.restartReason.RANGE_SEQ_MAX?Y.userProperty.RESTART_RANGE_MAX:e.restartReason==Y.restartReason.RANGE_SEQ_LARGE?Y.userProperty.RESTART_RANGE_LARGE:e.restartReason==Y.restartReason.CONNECT?Y.userProperty.RESTART_CONNECT:e.restartReason==Y.restartReason.MULTI_CDN?Y.userProperty.RESTART_MUTI_CDN:e.restartReason==Y.restartReason.PLAYER_NO_DATA?Y.userProperty.RESTART_PLAYER_NO_DATA:e.restartReason==Y.restartReason.PLAYER_ERROR?Y.userProperty.RESTART_PLAYER_ERROR:e.restartReason==Y.restartReason.FLV_TO_P2P?Y.userProperty.FLV_TO_P2P:e.restartReason==Y.restartReason.LOST_SEQ?Y.userProperty.LOST_SEQ:Y.userProperty.UNKNOW:e.turnToFlvReason==Y.turnToFlvReason.SUB_CONNECT_TIMEOUT?Y.userProperty.SUB_CONNECT_TIMEOUT:e.turnToFlvReason==Y.turnToFlvReason.SUB_NO_DATA?Y.userProperty.SUB_NO_DATA:e.turnToFlvReason==Y.turnToFlvReason.P2P_ARGS_ERROR?Y.userProperty.P2P_ARGS_ERROR:e.turnToFlvReason==Y.turnToFlvReason.P2P_COOLING?Y.userProperty.P2P_COOLING:Y.userProperty.UNKNOW:Y.userProperty.BROWSER_UN_SUPPORT:Y.userProperty.CLIENT_CLOSE:Y.userProperty.SERVER_CLOSE}},{key:"record",value:function(e,t,i,r,n,s,a){if(this.pausedCount+=t,this.pausedTime+=i,this.hyPlayer.tsdbUtil,this.volumeEnergy=a,e%120==0&&r&&this.pausedCount++,r&&(this.isPaused=!0),e%20==0){var o=this.getUserProperty();this.stat.setCoreDim(O.DIM_CORE.USER_PROPERTY,o),this.stat.setCoreDim(O.DIM_CORE.SIGNAL_USER_PROPERTY,0);var u=this.flvPlayer.mse.parser.timeStampStat,l=[{sMetricName:F.METRIC.VIDEO_FLOW_LINE,vField:{value:n}},{sMetricName:F.METRIC.SDK_P2P_SERVER_OPEN,vField:{value:1==o?0:100}},{sMetricName:F.METRIC.SDK_P2P_USER_PROPERTY,vDimension:{success:o}}];u.reset();var h=this.flvPlayer.info;this.stat.setCoreDim(O.DIM_CORE.VIDEO_BAD_QUALITY_OLD,r?100:0),this.stat.setCoreDim(O.DIM_CORE.VIDEO_BAD_QUALITY,r||t>0?100:0),this.stat.setCoreDim(O.DIM_CORE.VIDEO_BAD_REASON,s),this.stat.setCore(O.CORE.BUFFER_LENGTH,this.flvPlayer.getBufferLen()),this.flvPlayer.mse.metadata&&this.flvPlayer.mse.metadata.codecname&&this.stat.setComDim(O.DIM_COM.SPHD_TYPE,this.flvPlayer.mse.metadata.codecname),this.isFirstReport?this.isFirstReport=!1:l.push({sMetricName:F.METRIC.VIDEO_BAD_QUALITY_RATIO,vField:{value:this.isPaused?100:0,pausecnt:t},vDimension:{p2p:0,originalBitrate:0===h.originalBitrate?1:0,p2pCooling:this.hyPlayer.p2pCooling?1:0,topSid:h.sid,reason:s,quality:r||t>0?100:0},vExLog:{cdnip:this.flvPlayer.cdnip}}),this.stat.setComDim(O.DIM_COM.CDNIP,this.flvPlayer.cdnip),this.stat.fill(l),this.hyPlayer.tsdbUtil.sendMetrics(l),this.isPaused=!1}}},{key:"getHost",value:function(e){return e.replace("https*://","").split("/")[0]}},{key:"setHttpHead",value:function(e){this.data.httphead=this.getHost(e)}}]),e}(),ke=function(){function e(t){(0,h.default)(this,e),this.flvPlayer=t,this.data={act:"webhuyaplayed",uid:0,sid:0,subsid:0,linetype:-1,status:0,recode:0,vtime:-1,isp2p:0}}return(0,d.default)(e,[{key:"send",value:function(){var e=this.data,t=this.flvPlayer,i=this.flvPlayer.loader?this.flvPlayer.loader.status:200,r="//ylog.huya.com/d.gif?rid=ods_action_log&pro=huya_web&sdver=1&cutc="+k();for(var n in e.uid=t.info.uuid,e.sid=t.info.sid,e.subsid=t.info.subSid,e.linetype=t.info.lineType,e.status=i||1,0==i?e.recode=2:(i<200||i>=300)&&(e.recode=1),e.vtime=t.loadTime||-1,e)r+="&"+n+"="+e[n];(new Image).src=r}}]),e}(),Le=function(){function e(t,i){(0,h.default)(this,e),this.hyPlayer=t,this.mse=i,this.tickCnt=0}return(0,d.default)(e,[{key:"reset",value:function(){this.tickCnt=0}},{key:"onCheckTimer",value:function(e,t){this.tickCnt++,4!==this.tickCnt&&this.tickCnt%10!=0||this.trigger()}},{key:"trigger",value:function(){var e={};(0,u.default)(e,this.mse.metadata),this.hyPlayer.trigger(m.METADATA,e)}}]),e}();window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext;var Ae=function(e){function t(){var e;return(0,h.default)(this,t),(e=(0,r.default)(this,(t.__proto__||(0,f.default)(t)).call(this))).audioContext=null,e.playing=!1,e.audio=null,e.analyser=null,e.source=null,e.timer=0,e}return(0,n.default)(t,e),(0,d.default)(t,[{key:"reset",value:function(){this.playing=!1}},{key:"createAudioContext",value:function(e){if(e)try{this.audio!=e&&(this.audio=e,this.audioContext=new AudioContext,this.source=this.audioContext.createMediaElementSource(e),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2048,this.source.connect(this.analyser),this.analyser.connect(this.audioContext.destination)),this.playing=!0,this.loop(2e3)}catch(e){D.log("createAudioContext err:"+e)}}},{key:"loop",value:function(e){if(this.playing&&this.analyser&&this.analyser.fftSize){this.audio&&!this.audio.error&&this.playing&&(clearTimeout(this.timer),this.timer=setTimeout(this.loop.bind(this),e,e));var i=this.analyser.fftSize,r=new Uint8Array(i);this.analyser.getByteFrequencyData(r),r.some((function(e){return e}))?this.emit(t.AUDIO_FREQUENCY,{value:1}):this.emit(t.AUDIO_FREQUENCY,{value:0})}}}]),t}(V.EventEmitter),we=Ae;Ae.AUDIO_FREQUENCY="AUDIO_FREQUENCY";var Ce=function(){function e(t,i){var r=i.isPureAudio,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(0,h.default)(this,e),this.hyPlayer=t,this.stat=t.stat,this.startTs=0,this.started=!1,this.startTime=0,this.info=null,this.url=null,this.lineType=0,this.loader=new Ie(this,null==n),this.recvTime=0,this.connectTime=0,this.loadFlvStatus=0,this.videoElement=n,this.flvLoadTimeSended=!1,n?(this.mse=new _e(this,"flv",!0,!1,this.videoElement),this.mse.setSensitivePause(!1)):this.mse=new _e(this,"flv",!0,r),this.pauseStartTs=0,this.metadataTick=new Le(t,this.mse),this.pauseCnt=0,this.pauseTime=0,this.pauseCnt5=0,this.pauseTime5=0,this.pauseReason=0,this.pauseCheckLock=!1,this.loadTime=0,this.connectTime=0,this.loadStartTs=0,this.cdnip="",this.sendPauseTimeout=0,this.videoStatus=v,void 0!==Re&&(this.qaStat=new Re(this)),this.playedStat=null,this.flowSize=0,this.flvDataSize=0,this.backToP2P=new Pe(this),this.volumeCount=0,this.sendMetricTimer=0,this.sendMetricTimes=0,this.businessStartCost=0,this.startTimeStamp=0,this.noNeedSendVideoLoadTime=!1}return(0,d.default)(e,[{key:"reset",value:function(){this.started&&(D.log("FlvPlayer.reset"),Q.remove(this.onCheckTimer,this),Q.remove(this.onCheckFastTimer,this),this.loader.close(),this.mse.destroy(),null==this.videoElement&&(this.mse=new _e(this,"flv",!0,!1,!1,this.videoElement),this.mse.setPushGop(b.pushGop)),this.pauseStartTs=0,this.qaStat.isFirstReport=!0,this.metadataTick.reset(),this.metadataTick.mse=this.mse,this.startTs=0,this.recvTime=0,this.startTime=0,this.pauseCnt=0,this.pauseTime=0,this.pauseCnt5=0,this.pauseTime5=0,this.pauseCheckLock=!1,this.loadTime=0,this.connectTime=0,this.recvDataTime=0,this.flowSize=0,this.flvDataSize=0,this.recvDataEnough=!1,this.recvFlvData=!1,this.cdnip="",this.appStartPlayTime=0,this.backToP2P.reset(),this.stat.reset(),this.stopMetricTimer(),this.audiouitil&&(this.audiouitil.reset(),this.audiouitil=null),this.videoStatus=v)}},{key:"getCostTimes",value:function(){return[this.connectTime>0?this.connectTime-this.startTs:0,this.recvDataTime>0?this.recvDataTime-this.connectTime:0,this.mse.pushVideoStartRenderTime>0?this.mse.pushVideoStartRenderTime-this.startTs:0]}},{key:"start",value:function(e){if(e&&e.url){this.hyPlayer.playingMgr=this,this.reset(),this.initDomain(e),this.info=e,-1!==e.url.indexOf("va.huya.com")&&(e.url+="&https=1"),this.url=e.url,this.lineType=e.lineType,this.appStartPlayTime=e.appStartPlayTime?e.appStartPlayTime:0;var t=R();this.businessStartCost=0,this.UIStartCost=0,this.loadStartTs=0,this.startTimeStamp=Number(e.startTimeStamp)||0,e.noNeedSendVideoLoadTime?this.noNeedSendVideoLoadTime=!0:(this.businessStartCost=Math.floor(e.startTimeStamp>1?(new Date).getTime()-e.startTimeStamp:0),this.noNeedSendVideoLoadTime=!1),e.uistartTs&&e.uistartTs>0&&(this.UIStartCost=Math.floor((new Date).getTime()-e.uistartTs)),this.startTs=t,this.startTime=t,this.started=!0,this.backToP2P.initJumpTs(t),this.loadFlvStatus=0,this.mse.setPushGop(this.getConfig("pushGop")),this.hyPlayer.isNeedAud()?this.mse.setDeleteH264Aud(-1===b.deleteH264Aud.indexOf(e.presenterUid)?0:1):this.mse.setDeleteH264Aud(0),this.updateFlvConfig(),void 0===ke||this.playedStat||(this.playedStat=new ke(this),Q.once(this.playedStat.send,this.playedStat,1e4)),this.stat.setComDim(O.DIM_COM.ORIGINAL_BITRATE,0===e.originalBitrate?1:0),this.stat.setComDim(O.DIM_COM.P2P,O.LIVE_TYPE.FLV),this.loader.connect(e.url,null==this.videoElement),Q.add(this.onCheckTimer,this,1e3),Q.add(this.onCheckFastTimer,this,100),null!=this.videoElement&&this.startMetricTimer(2e4)}else D.error("FlvPlayer.start invalid argument",(0,o.default)(e))}},{key:"setVideoPlayTimeSended",value:function(){this.flvLoadTimeSended=!0}},{key:"getPlayVideo",value:function(){return this.mse.getPlayVideo()}},{key:"stop",value:function(){this._reportFlvFlow(),this.started&&(D.log("FlvPlayer.stopFlv"),this.reset(),this.started=!1),this.audiouitil&&(this.audiouitil.reset(),this.audiouitil=null),this.recvDataEnough=!1,this.recvFlvData=!1}},{key:"recvDataFull",value:function(){this.recvDataTime=R(),this.hyPlayer.trigger(c.RECV_VIDEO_FRAME),D.log("FlvPlayer.recvDataFull")}},{key:"initDomain",value:function(e){if(!e.inited){e.inited=!0;var t=e.domainList;if(t&&t.length){var i=e.url.match(/\/\/(.+?)\//i);e._domain=i?i[1]:"",D.log("FlvPlayer.initDomain:\n\t"+t.join("\n\t"));var r=t.shift();this.cdnip=r,this.stat.setComDim(O.DIM_COM.CDNIP,r),e.url=e.url.replace(/\/\/(.+?)\//,"//"+r+"/"+e._domain+"/")}}}},{key:"retryVideo",value:function(){this.hyPlayer.trigger(c.REPLAY_VIDEO)}},{key:"setEnableLowLatency",value:function(e){this.mse&&this.mse.setEnableLowLatency(e)}},{key:"updateJitter",value:function(){this.mse&&(D.log("jitBufLen="+this.getConfig("jitBufLen")+"  jitMinBufLen="+this.getConfig("jitMinBufLen")+"  jitMaxBufLen="+this.getConfig("jitMaxBufLen")),this.mse.setJitter(this.getConfig("jitBufLen"),this.getConfig("jitMinBufLen"),this.getConfig("jitMaxBufLen")))}},{key:"updateFlvConfig",value:function(){this.updateJitter(),this.mse&&(this.mse.setNeedEmptyAudioFrame(this.getConfig("flvEmptyAudioFrame")>0),D.log("flvEmptyAudioFrame="+this.getConfig("flvEmptyAudioFrame")))}},{key:"requestUrl",value:function(){this._reportFlvFlow();var e=this.info,t=e.domainList;if(t&&e._domain){var i=new RegExp("//(.*?)"+e._domain+"/"),r=t.shift();return r?(this.cdnip=r,this.stat.setExtDim(O.DIM_EXT.CDN_IP,r),D.warn("FlvPlayer.requestUrl change domain to "+r),e.url=e.url.replace(i,"//"+r+"/"+e._domain+"/")):(this.cdnip="",this.stat.delDim(O.DIM_EXT.CDN_IP),D.warn("FlvPlayer.requestUrl change domain to "+e._domain),e.url=e.url.replace(i,"//"+e._domain+"/"),delete e.domainList),void this.start(e)}this.hyPlayer.trigger(c.FLV_URL_UNAVAILABLE)}},{key:"setConfig",value:function(e,t){this.hyPlayer.setConfig(e,t)}},{key:"getConfig",value:function(e){return this.hyPlayer.getConfig(e)}},{key:"setVolume",value:function(e){this.mse.setVolume(e)}},{key:"setMuted",value:function(e){this.mse.setMuted(e)}},{key:"getMuted",value:function(){return this.mse.getMuted()}},{key:"getBufferLen",value:function(){return this.mse&&this.mse.getBufferLen?this.mse.getBufferLen():0}},{key:"getCurrentTime",value:function(){return this.mse.getCurrentRealTime()}},{key:"getDurationTime",value:function(){return this.mse&&this.mse.video?Math.floor(this.mse.video.duration):0}},{key:"getVolumeEnergy",value:function(){var e=this.volumeCount>5?1:0;return this.volumeCount=0,e}},{key:"setPlaybackrateAccess",value:function(e){this.mse&&this.mse.setPlaybackrateAccess(e)}},{key:"setLoadFlvStatus",value:function(e){e>this.loadFlvStatus&&(this.loadFlvStatus=e)}},{key:"sendLoadVideoErrorStatus",value:function(){this.hyPlayer.tsdbUtil.sendMetrics([this.stat.createAct(F.METRIC.VIDEO_VIDEO_LOAD_ERROR,{value:[this.loadFlvStatus]})])}},{key:"onConnected",value:function(){this.connectTime=R(),D.log("%c[TIME] connectTime="+(this.connectTime-this.startTs),"color:#A23400;background:#FFF5C2"),this.setLoadFlvStatus(Y.LoadVideoTimeoutReason.FLV_CONNECTED)}},{key:"onClosed",value:function(){this._reportFlvFlow(),this.reset(),this.hyPlayer.trigger(c.VIDEO_LINK_CLOSE,{video:this.mse.getPlayVideo()})}},{key:"onError",value:function(){this._reportFlvFlow(),this.reset(),this.hyPlayer.trigger(c.ANCHOR_STOP,{video:this.mse.getPlayVideo()})}},{key:"onData",value:function(e){var t=new Uint8Array(e);this.flowSize+=t.byteLength,this.recvDataEnough||(this.flvDataSize+=t.byteLength,this.flvDataSize>1e6&&(this.setLoadFlvStatus(Y.LoadVideoTimeoutReason.FLV_DATA_INVALID),this.recvDataEnough=!0)),this.stat.addCore(O.CORE.CDN_TOTAL_BW,t.byteLength),this.mse.appendFlv(t);var i=R();0==this.recvTime&&(D.log("%c[TIME] firstPkgTime="+(i-this.connectTime),"color:#A23400;background:#FFF5C2"),this.setLoadFlvStatus(Y.LoadVideoTimeoutReason.FLV_RECV_DATA)),this.recvTime=i}},{key:"onPlayVideo",value:function(e,t,i){this.setVolume(this.hyPlayer.getVolume()),this.stat.setComDim(O.DIM_COM.DPI,t+"*"+i);var r=R();D.log("FlvPlayer.onStartVideo loadeddata="+r),this.loadTime=r-this.startTs;var n=this.connectTime-this.startTs,s=this.recvDataTime-this.startTs,a=this.mse.pushVideoStartRenderTime-this.startTs,o=this.UIStartCost>0?this.loadTime+this.UIStartCost:0,u=0;this.startTimeStamp>1?u=this.loadTime+this.businessStartCost:1===this.startTimeStamp&&(u=this.loadTime),this.hyPlayer.tsdbUtil.sendFlvTime(this.loadTime,n,s,a,null!=this.videoElement,u,o),D.log("%cFlvMgr.onPlayVideo loadTime="+this.loadTime+"  businessStartCost="+this.businessStartCost,NaN+this.UIStartCost,"color:#A23400;background:#FFF5C2"),this.hyPlayer.trigger(c.VIDEO_PLAY,{video:e,width:t,height:i,loadTime:this.loadTime,connectTime:n,recvDataTime:s,pushVideoTime:a}),this.updateStatus(p),this.setLoadFlvStatus(Y.LoadVideoTimeoutReason.FLV_STARTPLAY),this.hyPlayer.onPlayVideo&&this.hyPlayer.onPlayVideo(e)}},{key:"onAudioFrequency",value:function(e){e.value&&this.volumeCount++,D.log("MSEPlayer.onAudioFrequency volume:"+e.value+"  volumeCount:"+this.volumeCount)}},{key:"onVideoStop",value:function(e,t){this._reportFlvFlow(),D.log("FlvPlayer.onVideoStop hasVideo="+t),t&&this.updateStatus(v),this.hyPlayer.trigger(c.VIDEO_STOP,{video:e,hasVideo:t})}},{key:"onSendSeiData",value:function(e,t,i){this.hyPlayer.trigger(c.H264_SEI_PLAY,{data:e,ts:t,now:(new Date).getTime(),vt:i})}},{key:"onSendScriptVolumeInfo",value:function(e,t){Number(localStorage._printAudioIntensity)&&D.log("onSendScriptVolumeInfo uid:"+e+"  intensity:"+t),this.hyPlayer.trigger(c.UPDATE_INTERSITY,{uid:e,intensity:t})}},{key:"onLoadError",value:function(e){this.hyPlayer.trigger(c.FLV_URL_UNAVAILABLE,{msg:e}),this.setLoadFlvStatus(Y.LoadVideoTimeoutReason.FLV_CONNECT_ERROR)}},{key:"onVideoParseInvalid",value:function(){this.setLoadFlvStatus(Y.LoadVideoTimeoutReason.FLV_DATA_INVALID)}},{key:"onLoadTimeout",value:function(){this.hyPlayer.trigger(c.FLV_URL_LOAD_TIMEOUT)}},{key:"onPlayerError",value:function(e){this._reportFlvFlow()}},{key:"onErrorEvent",value:function(e){this.mse&&this.mse.getPlayVideo(),this.eventEmitter.trigger(c.H5_PLAYER_ERROR,{code:e.type,msg:"播放错误"})}},{key:"onPlayPause",value:function(e,t){this.pauseStartTs=e,this.pauseCheckLock=!1,this.startSendPauseTimer(),t&&this.updateStatus(y)}},{key:"onPlayResume",value:function(e,t){if(this.stopMetricTimer(),this.pauseStartTs>0){var i=e-this.pauseStartTs;i>200&&(D.warn("FlvPlayer.onPlayResume pauseTime="+i),this.pauseCnt++,this.pauseTime+=i,this.pauseCnt5++,this.pauseTime5+=i),this.pauseStartTs=0}t&&this.updateStatus(p)}},{key:"updateStatus",value:function(e){this.videoStatus!==e&&(this.videoStatus=e,this.hyPlayer.trigger(c.PLAY_STATUS,{status:e}))}},{key:"sendPauseEvent",value:function(){this.hyPlayer.trigger(c.PLAY_CARTON)}},{key:"startMetricTimer",value:function(e){clearTimeout(this.sendMetricTimer),this.sendMetricTimer=setTimeout(this.heartBeat20sMetric.bind(this),e)}},{key:"stopMetricTimer",value:function(){this.sendMetricTimes=0,clearTimeout(this.sendMetricTimer)}},{key:"setAudioUtil",value:function(e){this.audiouitil=e,this.audiouitil.removeAllListeners([we.AUDIO_FREQUENCY]),this.audiouitil.createAudioContext(this.mse.video),this.audiouitil.on(we.AUDIO_FREQUENCY,this.onAudioFrequency.bind(this))}},{key:"startSendPauseTimer",value:function(){this.stopSendPauseTimer(),this.sendPauseTimeout=setTimeout(this.sendPauseEvent.bind(this),200)}},{key:"stopSendPauseTimer",value:function(){clearTimeout(this.sendPauseTimeout)}},{key:"heartBeat20sMetric",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2e4,t=R();if(D.log("FlvPlayer.heartBeat20sMetric "),this.sendMetricTimes++,this.pauseStartTs>0){var i=t-this.pauseStartTs;i>200&&(D.warn("FlvPlayer.heartBeat20sMetric pauseTime="+i),this.pauseTime+=i,this.pauseStartTs=t,this.sendMetricTimes%15==0&&(this.pauseTime5+=i))}if(this.qaStat){0==this.pauseTime&&(this.pauseReason=0);var r=this.pauseStartTs>0;this.qaStat.record(20*this.sendMetricTimes,this.pauseCnt,this.pauseTime,r,this.flowSize,this.pauseReason,this.getVolumeEnergy())}this.pauseCnt=0,this.pauseTime=0,this.pauseReason=0,this.flowSize=0,this.sendMetricTimes%15==0&&(this.hyPlayer.tsdbUtil.sendMetrics([{sMetricName:F.METRIC.VIDEO_VIDEO_BAD_QUALITY_5M_RATIO,vField:{value:this.pauseCnt5>0?100:0}}]),this.pauseCnt5=0,this.pauseTime5=0),e>0&&this.startMetricTimer(e)}},{key:"onCheckTimer",value:function(e,t){if(this.started){if(this.connected&&this.recvTime>0&&e-this.recvTime>8e3){var i=this.getBufferLen();return D.warn("FlvPlayer.onCheckTimer no data received "+(e-this.recvTime)+" buffLen="+i),void this.hyPlayer.trigger(c.NO_DATA_RECEIVED)}if(this.loader.onCheckTimer(e,t),this.mse.onCheckTimer(e,t),this.metadataTick.onCheckTimer(e,t),this.connected){null==this.videoElement&&t%20==0&&this.heartBeat20sMetric(0);try{this.hyPlayer.trigger(c.PLAY_DOWNLINK_INFO,{buffer:this.getBufferLen()/1e3,downLinkSpeed:0|this.loader.speed,videoBufferEnd:this.mse.video.buffered.end(this.mse.video.buffered.length-1)})}catch(e){D.log("cannot get down link info")}this.backToP2P.onCheckTimer(e,t),this.hyPlayer.trigger(c.PLAY_FRAME_BUFFER,{frameStorage:this.mse.getFrameReadyed(),jitterBuffer:this.mse.getBufferLen(),playdelay:this.mse.getFramePlayDelays()})}}}},{key:"onCheckFastTimer",value:function(e,t){this.started&&(this.mse.onCheckFastTimer(e,t),this.backToP2P.onCheckFastTimer(e,t),!this.pauseCheckLock&&this.pauseStartTs>0&&e-this.pauseStartTs>200&&(this.pauseCheckLock=!0,this.pauseCheck(e)))}},{key:"_reportFlvFlow",value:function(){this.flowSize>0&&(this.qaStat&&this.qaStat.sendFlow(this.flowSize),this.flowSize=0)}},{key:"pauseCheck",value:function(e){if(this.started){var t=0,i=this.info.curBitrate/8-10,r=this.loader.speed/1024|0;t=r>0&&r<i?Y.pauseReason.FLV_NET_SLOW:Y.pauseReason.FLV_NO_BUFF,this.recvTime>0&&e-this.recvTime>2e3&&(t=Y.pauseReason.FLV_NO_DATA);var n=this.getBufferLen();n>1e3&&(t=Y.pauseReason.FLV_UNKNOW_PAUSE),t>this.pauseReason&&(this.pauseReason=t),D.warn("FlvPlayer.pauseCheck curReason="+t+" reportReason="+this.pauseReason+" buffLen="+n)}}},{key:"connected",get:function(){return this.loader&&this.loader.connected}},{key:"isPlaying",get:function(){return this.videoStatus!==v}},{key:"hasPicture",get:function(){return this.isPlaying&&0!==this.mse.getCurrentTime()}}]),e}(),Me=function(){function e(t){(0,h.default)(this,e),t&&t.xhrSetup&&(this.xhrSetup=t.xhrSetup)}return(0,d.default)(e,[{key:"destroy",value:function(){this.abort(),this.loader=null}},{key:"abort",value:function(){this.loader&&(this.stats.aborted=!0,this.loader.abort()),this.timeoutHandle&&window.clearTimeout(this.timeoutHandle)}},{key:"load",value:function(e,t,i,r,n,s,a,o){var u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.url=e,this.responseType=t,this.onSuccess=i,this.onError=r,this.onTimeout=n,this.onProgress=u,this.stats={trequest:performance.now(),retry:0},this.timeout=s,this.maxRetry=a,this.retryDelay=o,this.timeoutHandle=window.setTimeout(this.loadtimeout.bind(this),s),this.loadInternal()}},{key:"loadBuffer",value:function(e,t,i,r,n,s,a,o,u){this.onOpen=t,this.load(e,"arraybuffer",(function(e){var t=e.target;return r(t.response)}),n,s,a,o,u)}},{key:"loadInternal",value:function(){var e=this.loader=new XMLHttpRequest;e.onload=this.loadsuccess.bind(this),e.onerror=this.loaderror.bind(this),e.onprogress=this.loadprogress.bind(this),e.onloadend=this.loadend.bind(this),e.onloadstart=this.loadstart.bind(this),e.responseType=this.responseType,e.open("GET",this.url,!0),null!=this.fromByte&&null!=this.toByte&&e.setRequestHeader("Range","bytes="+this.fromByte+"-"+this.toByte),this.stats.tstart=null,this.stats.loaded=0,this.xhrSetup&&this.xhrSetup(e),this.stats.tstart=performance.now(),e.send()}},{key:"loadsuccess",value:function(e){window.clearTimeout(this.timeoutHandle),this.stats.tload=performance.now(),e.requestURL=this.url,this.onSuccess(e,this.stats)}},{key:"loaderror",value:function(e){404!==e.currentTarget.status&&0!==e.currentTarget.status?this.stats.retry<this.maxRetry?(D.warn("XhrLoader.loaderror url="+this.url+" retryDelay="+this.retryDelay),this.destroy(),window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,64e3),this.stats.retry++):(window.clearTimeout(this.timeoutHandle),D.warn("XhrLoader.loaderror reach max retry url="+this.url),this.onError(e)):this.onError(e)}},{key:"loadtimeout",value:function(){this.stats.retry<this.maxRetry?(D.warn("XhrLoader.loadtimeout url="+this.url+" retryDelay="+this.retryDelay),this.destroy(),window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,64e3),this.stats.retry++):(window.clearTimeout(this.timeoutHandle),D.warn("XhrLoader.loadtimeout max retry url="+this.url),this.onTimeout())}},{key:"loadstart",value:function(){this.onOpen&&this.onOpen()}},{key:"loadprogress",value:function(e){var t=this.stats;null===t.tfirst&&(t.tfirst=performance.now()),t.loaded=e.loaded,this.onProgress&&this.onProgress(e,t)}},{key:"loadend",value:function(e){404===e.currentTarget.status&&this.loaderror(e)}}]),e}(),De=i(1),be=i.n(De),Oe=function(){function e(){(0,h.default)(this,e),this.startSeq=1e3,this.m3u8Len=0,this.preTsArr=void 0}return(0,d.default)(e,[{key:"genSnFromM3u8",value:function(e){var t=this.convertM3u8ToArray(e);if(void 0===this.preTsArr)this.preTsArr=t;else{var i=this.findSeq(this.preTsArr,t[0],this.startSeq);-1===i&&(i=this.startSeq+this.preTsArr.length),this.preTsArr=t,this.startSeq=i}return this.startSeq}},{key:"convertM3u8ToArray",value:function(e){for(var t=void 0,i=/#EXT(INF):([\d\.]+)[^\r\n]*[\r\n]+([^#|\r\n]+)?/gi,r=[];null!==(t=i.exec(e));)t.shift(),"INF"===(t=t.filter((function(e){return void 0!==e})))[0]&&r.push(t[2]),t=[];return r}},{key:"findSeq",value:function(e,t,i){for(var r=e.length-1;r>=0;r--)if(e[r]===t)return i+r;return-1}}]),e}(),Ne=function(){function e(t){(0,h.default)(this,e),this.isLive=t,this.seqGener=new Oe,this.isSwitchSeamLessLine=!1}return(0,d.default)(e,[{key:"resolve",value:function(e,t){return be.a.buildAbsoluteURL(t,e)}},{key:"cloneObj",value:function(e){return JSON.parse((0,o.default)(e))}},{key:"parseMasterPlaylist",value:function(e,t){for(var i,r,n,s=[],a={},o=/#EXT-X-STREAM-INF:([^\n\r]*(BAND)WIDTH=(\d+))?([^\n\r]*(CODECS)=\"([^\"\n\r]*)\",?)?([^\n\r]*(RES)OLUTION=(\d+)x(\d+))?([^\n\r]*(NAME)=\"(.*)\")?[^\n\r]*[\r\n]+([^\r\n]+)/gi;null!=(i=o.exec(e));){for(i.shift(),i=i.filter((function(e){return void 0!==e})),(a={}).url=this.resolve(i.pop(),t);i.length>0;)switch(i.shift()){case"RES":a.width=parseInt(i.shift()),a.height=parseInt(i.shift());break;case"BAND":a.bitrate=parseInt(i.shift());break;case"NAME":a.name=i.shift();break;case"CODECS":for(r=i.shift().split(",");r.length>0;)-1!==(n=r.shift()).indexOf("avc1")?a.videoCodec=this.avc1toavcoti(n):a.audioCodec=n}s.push(a)}return s}},{key:"avc1toavcoti",value:function(e){var t,i=e.split(".");return i.length>2?(t=i.shift()+".",t+=parseInt(i.shift()).toString(16),t+=("00"+parseInt(i.shift()).toString(16)).substr(-4)):t=e,t}},{key:"parseKeyParamsByRegex",value:function(e,t){var i=t.exec(e);return i&&(i.shift(),2===(i=i.filter((function(e){return void 0!==e}))).length)?i[1]:null}},{key:"parseLevelPlaylist",value:function(e,t,i){return this._parseByLine(e,t,i)}},{key:"_getValue",value:function(e,t,i){for(var r=t+1;r<i;r++)if(!e[r].startsWith("#"))return[r,e[r]];return!1}},{key:"_getIv",value:function(e){for(var t=new Uint8Array(16),i=12;i<16;i++)t[i]=e>>8*(15-i)&255;return t}},{key:"_parseByLine",value:function(e,t,i){var r,n,s,a,o,u,l=0,h=0,d=!1,c=0,f={url:t,fragments:[],live:this.isLive,startSN:0},p=!1;this.isLive||(r=this.seqGener.genSnFromM3u8(e),f.startSN=r);for(var v={method:null,key:null,iv:null,uri:null},y=e.replace("\r").split("\n"),m=y.length,_=0;_<m;_++){var S=y[_];if(-1!==S.indexOf("#EXT-X-MEDIA-SEQUENCE"))this.isLive&&(h=f.startSN=parseInt(S.match(/\d+/g)[0]));else if(-1!==S.indexOf("#EXT-X-TARGETDURATION"))f.targetduration=parseFloat(S.match(/[\d\.]+/g)[0]);else if(-1!==S.indexOf("#EXT-X-ENDLIST"))f.live=!1,D.info("M3u8Parser.parseLevelPlaylist ENDLIST isLive=false");else if(-1!==S.indexOf("#EXT-X-DISCONTINUITY"))p=!0;else if(-1!==S.indexOf("#EXT-X-BYTERANGE")){var g=S.match(/[\d@]+/g)[0].split("@");u=1===g.length?o:parseInt(g[1]),o=parseInt(g[0])+u,(a=f.fragments.length?f.fragments[f.fragments.length-1]:null)&&!a.url&&(a.byteRangeStartOffset=u,a.byteRangeEndOffset=o,(n=this._getValue(y,_,m))&&(_=n[0],a.url=n[1]))}else if(-1!==S.indexOf("#EXT-X-PROGRAM-DATE-TIME")){var T=S.replace("#EXT-X-PROGRAM-DATE-TIME:","");l=T=new Date(T).getTime(),d=!0,this.isSwitchSeamLessLine=!0}else if(-1!==S.indexOf("#EXTINF")){var E,I=parseFloat(S.match(/[\d\.]+/g)[0]);if(!isNaN(I)&&(s=d?l:++h,this.isLive||(s=r++),v.method&&v.uri&&!v.iv?(E=this.cloneObj(v)).iv=this._getIv(this.isLive?h:s):E=v,n=this._getValue(y,_,m))){_=n[0];var P=n[1];f.fragments.push({url:P?this.resolve(P,t):null,time:P?be.a.getTimeFromUrl(P,this.isLive):0,duration:I,start:c,level:i,sn:s,discontinuity:p,byteRangeStartOffset:u,byteRangeEndOffset:o,decryptdata:E}),p&&(p=!1),c+=I,u=null}}else if(-1!==S.indexOf("#EXT-X-KEY")){var R=S.replace("#EXT-X-KEY:",""),k=this.parseKeyParamsByRegex(R,/(METHOD)=([^,]*)/),L=this.parseKeyParamsByRegex(R,/(URI)=["]([^,]*)["]/),A=this.parseKeyParamsByRegex(R,/(IV)=([^,]*)/);k&&(v={method:null,key:null,iv:null,uri:null},L&&"AES-128"===k&&(v.method=k,v.uri=this.resolve(L,t),v.key=null,A&&(v.iv=A,"0x"===v.iv.substring(0,2)&&(v.iv=v.iv.substring(2)),v.iv=v.iv.match(/.{8}/g),v.iv[0]=parseInt(v.iv[0],16),v.iv[1]=parseInt(v.iv[1],16),v.iv[2]=parseInt(v.iv[2],16),v.iv[3]=parseInt(v.iv[3],16),v.iv=new Uint32Array(v.iv))))}}return f.totalduration=c,f.endSN=l-1,this.isLive||(f.endSN=r-1),f}},{key:"_parseByReg",value:function(e,t,i){var r,n,s,a,o,u=0,l=0,h={url:t,fragments:[],live:this.isLive,startSN:0},d=!1;this.isLive||(r=this.seqGener.genSnFromM3u8(e),h.startSN=r);for(var c={method:null,key:null,iv:null,uri:null},f=/(?:#EXT-X-(MEDIA-SEQUENCE):(\d+))|(?:#EXT-X-(TARGETDURATION):(\d+))|(?:#EXT-X-(KEY):(.*))|(?:#EXT(INF):([\d\.]+)[^\r\n]*([\r\n]+[^#|\r\n]+)?)|(?:#EXT-X-(BYTERANGE):([\d]+[@[\d]*)]*[\r\n]+([^#|\r\n]+)?|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DIS)CONTINUITY))/g;null!==(n=f.exec(e));)switch(n.shift(),(n=n.filter((function(e){return void 0!==e})))[0]){case"MEDIA-SEQUENCE":this.isLive&&(u=h.startSN=parseInt(n[1]));break;case"TARGETDURATION":h.targetduration=parseFloat(n[1]);break;case"ENDLIST":h.live=!1,D.info("M3u8Parser.parseLevelPlaylist ENDLIST isLive=false");break;case"DIS":d=!0;break;case"BYTERANGE":var p=n[1].split("@");o=1===p.length?a:parseInt(p[1]),a=parseInt(p[0])+o,(s=h.fragments.length?h.fragments[h.fragments.length-1]:null)&&!s.url&&(s.byteRangeStartOffset=o,s.byteRangeEndOffset=a,s.url=this.resolve(n[2],t));break;case"INF":var v=parseFloat(n[1]);if(!isNaN(v)){var y,m=u++;if(this.isLive||(m=r++),c.method&&c.uri&&!c.iv){y=this.cloneObj(c);for(var _=new Uint8Array(16),S=12;S<16;S++)_[S]=m>>8*(15-S)&255;y.iv=_}else y=c;var g=n[2];h.fragments.push({url:g?this.resolve(g,t):null,time:g?be.a.getTimeFromUrl(g,this.isLive):0,duration:v,start:l,level:i,sn:m,discontinuity:d,byteRangeStartOffset:o,byteRangeEndOffset:a,decryptdata:y}),d&&(d=!1),l+=v,o=null}break;case"KEY":var T=n[1],E=this.parseKeyParamsByRegex(T,/(METHOD)=([^,]*)/),I=this.parseKeyParamsByRegex(T,/(URI)=["]([^,]*)["]/),P=this.parseKeyParamsByRegex(T,/(IV)=([^,]*)/);E&&(c={method:null,key:null,iv:null,uri:null},I&&"AES-128"===E&&(c.method=E,c.uri=this.resolve(I,t),c.key=null,P&&(c.iv=P,"0x"===c.iv.substring(0,2)&&(c.iv=c.iv.substring(2)),c.iv=c.iv.match(/.{8}/g),c.iv[0]=parseInt(c.iv[0],16),c.iv[1]=parseInt(c.iv[1],16),c.iv[2]=parseInt(c.iv[2],16),c.iv[3]=parseInt(c.iv[3],16),c.iv=new Uint32Array(c.iv))))}return h.totalduration=l,h.endSN=u-1,this.isLive||(h.endSN=r-1),h}}]),e}(),Fe=function(){function e(t){(0,h.default)(this,e),this.hls=t,this.isLive=t.isLive,this.config=t.config,this.m3u8Parser=new Ne(t.isLive),this.currLevelId=0,this.currFrag=null,this.levels=[],this.flagStartList=null,this.firstLevelLoaded=!1,this.loader=null,this.seekTime=0,this.manifestLoadedTs=0,this.isMasterPlayList=!1,this.currLevel=null}return(0,d.default)(e,[{key:"destroy",value:function(){this.m3u8Parser=null,this.currLevelId=0,this.currFrag=null,this.levels=null,this.firstLevelLoaded=!1,this.loader.abort(),this.loader=null,this.flagStartList=null,this.seekTime=0,this.manifestLoadedTs=0,this.isMasterPlayList=!1}},{key:"getNearFragStart",value:function(e){if(this.flagStartList.length>1)for(var t=1;t<this.flagStartList.length;t++)if(this.flagStartList[t]>e&&this.flagStartList[t-1]<e)return this.flagStartList[t];return Math.floor(e+1)}},{key:"getNextFrag",value:function(){var e=this.currDetails,t=e.fragments,i=null;return this.isLive?t.length>0&&(i=t.shift()):(null==e.fragIdx&&(e.fragIdx=0),e.fragIdx<t.length&&(i=t[e.fragIdx++])),i&&(this.currFrag=i),i}},{key:"getCurrentFrag",value:function(){var e=this.currDetails,t=e.fragments,i=null;return this.isLive?t.length>0&&(i=t[0]):(null==e.fragIdx&&(e.fragIdx=0),e.fragIdx<t.length&&(i=t[e.fragIdx])),i&&(this.currFrag=i),i}},{key:"seek",value:function(e){if(this.isLive)return!1;var t=this.currDetails,i=t?t.fragments:null;if(!i)return this.seekTime=e,!1;e=Math.min(e,t.totalduration);var r=void 0,n=void 0,s=!1;if(this.isLive)for(;i.length&&!((r=i[0]).start>e);){if(n=r.start+r.duration,r.start<=e&&n>e){n-.2<e&&i.length>1&&i.shift(),i.length>0&&(i[0].seeking=!0,s=!0);break}i.shift()}else{for(var a=0,o=i.length;a<o;){if(n=(r=i[a]).start+r.duration,r.start<=e&&n>e){n-.2<e&&a<o-1&&a++,a<o&&(i[a].seeking=!0,s=!0);break}a++}D.info("HlsPlaylist.seek seekTime="+e+" fragIdx="+t.fragIdx+", "+a,i[a]?i[a].sn:""),t.fragIdx=a}return this.seekTime=0,s}},{key:"loadManifest",value:function(e){this.m3u8Parser.isSwitchSeamLessLine=!1,this.manifsetUrl=e,this.loader&&(this.loader.destroy(),this.loader=null),this.flagStartList||(this.flagStartList=[0]),this.hls.stat.addComp(O.HLS_INFO.name,O.HLS_INFO.M3U8_CNT,1),this.loader=new Me(this.config),this.loader.load(e,"",this.onManifestLoaded.bind(this),this.loadManifestError.bind(this),this.loadManifestTimeout.bind(this),this.config.listLoadingTimeOut,this.config.listLoadingMaxRetry,this.config.listLoadingRetryDelay)}},{key:"onManifestLoaded",value:function(e,t){0==this.manifestLoadedTs&&(this.manifestLoadedTs=R());var i=e.currentTarget.status;if(404===i||0===i||403===i)return this.hls.stat.addComp(O.HLS_INFO.name,O.HLS_INFO.M3U8_FAIL_CNT,1),D.warn("HlsPlaylist.onManifestLoaded status="+i),void this.hls.setLoadStatus(Y.LoadVideoTimeoutReason.HLS_LOADMANIFEST_ERROR);var r,n=e.currentTarget.responseText,s=this.manifsetUrl,a=null,o=[];if(-1==n.indexOf("#EXTM3U"))return this.hls.stat.addComp(O.HLS_INFO.name,O.HLS_INFO.M3U8_WRONG_CNT,1),D.error("HlsPlaylist.onManifestLoaded m3u8 doesn't match #EXTM3U\n",n),void this.hls.setLoadStatus(Y.LoadVideoTimeoutReason.HLS_LOADMANIFEST_ERROR);this.hls.stat.addComp(O.HLS_INFO.name,O.HLS_INFO.M3U8_SUC_CNT,1);var u=-1==n.indexOf("#EXTINF:");u?(this.isMasterPlayList=!0,a=this.m3u8Parser.parseMasterPlaylist(n,s)):(this.isMasterPlayList=!1,a=[{url:s}]),r=(o=a)[0].bitrate,o.sort((function(e,t){return e.bitrate-t.bitrate})),this.levels=o;for(var l=0;l<o.length;l++)if(o[l].bitrate===r){this.currLevelId=l,D.log("manifest loaded, "+o.length+" level(s) found, first bitrate:"+r);break}this.currLevel={bitrate:r},u?(this.currLevel.url=o[this.currLevelId].url,this.loadLevel()):(this.currLevel.url=this.manifsetUrl,this.onLevelLoaded(e)),this.hls.setLoadStatus(Y.LoadVideoTimeoutReason.HLS_LOADMANIFEST_SUCCESS)}},{key:"loadManifestError",value:function(e){this.hls.stat.addComp(O.HLS_INFO.name,O.HLS_INFO.M3U8_FAIL_CNT,1),D.warn("HlsPlaylist.loadManifestError "+e.currentTarget.status),404!==e.currentTarget.status&&0!==e.currentTarget.status||this.hls.onAnchorStop(),this.hls.onLoadM3u8Error()}},{key:"loadManifestTimeout",value:function(e){this.hls.stat.addComp(O.HLS_INFO.name,O.HLS_INFO.M3U8_TIMEOUT_CNT,1),e>=2?this.hls.onLoadManifestTimeout():this.hls.onConnectManifestTimeout()}},{key:"loadLevel",value:function(){if(this.currLevel){var e=this.currLevel.url;if(!this.isLive&&this.currDetails){var t=this.currDetails.fragments,i=t[t.length-1];i||(D.log("HlsPlaylist.loadLevel: fragments run out"),i=this.currFrag),e=t.length<=this.config.minFragBufferNum?this.currLevel.url.replace(/\?btime=\d*$/,"?btime="+i.time):null}e&&(this.loader&&(this.loader.destroy(),this.loader=null),this.hls.stat.addComp(O.HLS_INFO.name,O.HLS_INFO.M3U8_CNT,1),this.loader=new Me(this.config),this.loader.load(e,"",this.onLevelLoaded.bind(this),this.loadLevelError.bind(this),this.loadLevelTimeout.bind(this),this.config.listLoadingTimeOut,this.config.listLoadingMaxRetry,this.config.listLoadingRetryDelay))}}},{key:"onLevelLoaded",value:function(e,t){if(404!==e.currentTarget.status&&0!==e.currentTarget.status){var i=e.currentTarget.responseText,r=this.currLevel,n=null;if(0===i.indexOf("#EXTM3U")&&i.indexOf("#EXTINF:")>0){if(this.hls.stat.addComp(O.HLS_INFO.name,O.HLS_INFO.M3U8_SUC_CNT,1),n=this.m3u8Parser.parseLevelPlaylist(i,r.url,this.currLevelId,this.flagStartList),r.details=this.mergeDetails(r.details,n),this.isLive&&r.details.fragments.length>10)return D.info("HlsPlaylist.onLevelLoaded fragments.length =",r.details.fragments.length),void this.hls.reconnectLive();this.hls.setTargetDuration(this.currDetails.targetduration),this.seekTime&&this.seek(this.seekTime),this.firstLevelLoaded||(this.firstLevelLoaded=!0,this.hls.loadFragment())}else{this.hls.stat.addComp(O.HLS_INFO.name,O.HLS_INFO.M3U8_EMPTY_CNT,1);var s=r.details.fragments.length;D.warn("HlsPlaylist.onLevelLoaded no playlist. fragments.length="+s+"\n"+i)}this.hls.isSwitchSeamLessLine=this.m3u8Parser.isSwitchSeamLessLine}else this.hls.stat.addComp(O.HLS_INFO.name,O.HLS_INFO.M3U8_FAIL_CNT,1)}},{key:"loadLevelError",value:function(e){this.hls.stat.addComp(O.HLS_INFO.name,O.HLS_INFO.M3U8_FAIL_CNT,1),D.warn("HlsPlaylist.loadLevelError "+e.currentTarget.status),404!==e.currentTarget.status&&0!==e.currentTarget.status||this.hls.onAnchorStop()}},{key:"loadLevelTimeout",value:function(){this.hls.stat.addComp(O.HLS_INFO.name,O.HLS_INFO.M3U8_TIMEOUT_CNT,1),this.hls.reset()}},{key:"mergeDetails",value:function(e,t){if(!e)return t;var i,r,n=0,s=0;return r=e.fragments.length>0?e.fragments[e.fragments.length-1]:this.currFrag,i=r.sn,s=r.start+r.duration,t.fragments.forEach((function(t){t.sn>i&&e.fragments.push(t)})),e.endSN=t.endSN,e.fragments.forEach((function(e){n+=e.duration,e.sn>i&&(e.start=s,s+=e.duration)})),e.totalduration=n,e}},{key:"onCheckTimer",value:function(e){this.isLive&&this.loadLevel()}},{key:"currDetails",get:function(){return this.currLevel?this.currLevel.details:null}},{key:"currFragNum",get:function(){var e=this.currDetails,t=e?e.fragments:null;return t?t.length:0}},{key:"totalDuration",get:function(){var e=this.currDetails;return e?e.totalduration:0}}]),e}(),Ue=function(){function e(t){(0,h.default)(this,e),this._config=t,this._receivedLength=0}return(0,d.default)(e,null,[{key:"isSupported",value:function(){try{var e=E.msedge&&E.version.minor>=15048,t=!E.msedge||e;return fetch&&ReadableStream&&t}catch(e){return!1}}}]),(0,d.default)(e,[{key:"destroy",value:function(){this.onChunk=null,this.onSuccess=null,this.onError=null,this.onTimeout=null,this.abort()}},{key:"loadBuffer",value:function(e,t,i,r,n,s,a,o,u){this.url=e,this.onOpen=t,this.onChunk=i,this.onSuccess=r,this.onError=n,this.onTimeout=s,this.stats={trequest:performance.now(),retry:0},this.timeout=a,this.maxRetry=o,this.retryDelay=u,this.timeoutHandle=window.setTimeout(this.loadtimeout.bind(this),a),this.loadInternal()}},{key:"loadInternal",value:function(){var e=this,t=this.fromByte,i=this.toByte,r=new self.Headers;null!=this.fromByte&&null!=this.toByte&&r.append("Range","bytes="+t+"-"+i);var n={method:"GET",headers:r,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};fetch(this.url,n).then((function(t){if(!e._requestAbort)return t.ok&&t.status>=200&&t.status<=299?(e._onopen(),e._pump.call(e,t.body.getReader())):void e._onerror({code:t.status,msg:t.statusText});e._requestAbort=!1})).catch((function(t){e._onerror({code:-1,msg:t.message})}))}},{key:"abort",value:function(){this._requestAbort=!0}},{key:"_clearTimeout",value:function(){var e=this.timeoutHandle;e&&(clearTimeout(e),this.timeoutHandle=null)}},{key:"_pump",value:function(e){var t=this;return e.read().then((function(i){if(t._clearTimeout(),i.done)t._onsuccess();else{if(!0===t._requestAbort)return t._requestAbort=!1,e.cancel();var r=i.value.buffer;t.onChunk&&t.onChunk(r),t._pump(e)}})).catch((function(e){if(11!==e.code||!E.msedge){var i={code:e.code,msg:e.message};t._onerror(i)}}))}},{key:"_onopen",value:function(){this.onOpen&&this.onOpen()}},{key:"_onerror",value:function(e){0!==e.code&&404!==e.code?this.stats.retry<this.maxRetry?(D.warn("FetchLoader.loaderror url="+this.url+" retryDelay="+this.retryDelay),window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,64e3),this.stats.retry++,this.abort()):(this._clearTimeout(),D.warn("FetchLoader.loaderror reach max retry url="+this.url),this.onError(e)):this.onError(e)}},{key:"_onsuccess",value:function(e){this._clearTimeout(),this.onSuccess&&this.onSuccess(e)}},{key:"loadtimeout",value:function(){this.stats.retry<this.maxRetry?(D.warn("FetchLoader.loadtimeout url="+this.url+" retryDelay="+this.retryDelay),this.abort(),window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,64e3),this.stats.retry++):(this._clearTimeout(),D.warn("FetchLoader.loadtimeout max retry url="+this.url),this.onTimeout&&this.onTimeout())}}]),e}(),Be=function(){function e(t){(0,h.default)(this,e),this.hlsPlayer=t,this.hyPlayer=t.hyPlayer,this.stat=this.hyPlayer.stat,this.tsdbUtil=this.hyPlayer.tsdbUtil,this.isPaused=!1,this.tsOpens=[],this.tsLoadeds=[],this.tsSpeeds=[],this.tsSizes=[]}return(0,d.default)(e,[{key:"setPause",value:function(){this.isPaused=!0,this.stat.setCore(O.CORE.VIDEO_BAD_QUALITY,100)}},{key:"start",value:function(){this.stop(),Q.once(this.checkSuc,this,1e4),Q.once(this.checkVideo,this,2e4)}},{key:"stop",value:function(){this.tsOpens=[],this.tsLoadeds=[],this.tsSpeeds=[],this.tsSizes=[],Q.remove(this.checkSuc,this),Q.remove(this.checkVideo,this)}},{key:"checkSuc",value:function(){var e=this.hlsPlayer,t=e._loaderType,i=e.hasVideo,r=e.url,n=e.playTs,s=i?100:0,a=[{sMetricName:F.METRIC.WEB_HLS_PLAY_SUC_RATIO,vField:{value:s}}];a.push(this.stat.createAct(O.ACT.HLS_PLAY_SUCC,{value:[s,t],str:[r,""+n]})),this.tsdbUtil.sendMetrics(a)}},{key:"checkVideo",value:function(){var e=this.hlsPlayer.hasVideo?100:0,t=[{sMetricName:F.METRIC.WEB_HLS_PLAY_VIDEO_RATIO,vField:{value:e}}];t.push(this.stat.createAct(O.ACT.HLS_LOAD_SUCC,{value:[e]})),this.tsdbUtil.sendMetrics(t)}},{key:"report",value:function(){var e=[{sMetricName:F.METRIC.VIDEO_BAD_QUALITY_RATIO,vField:{value:this.isPaused?100:0},vDimension:{p2p:2}}];this.stat.setCore(O.CORE.PLAY_DELAY,this.hlsPlayer.getBufferLen()),this.stat.setCoreDim(O.DIM_CORE.VIDEO_BAD_QUALITY,this.isPaused?100:0),this.stat.setComp(O.HLS_INFO.name,O.HLS_INFO.TS_OPEN_AVG,this.getAvg(this.tsOpens)),this.stat.setComp(O.HLS_INFO.name,O.HLS_INFO.TS_LOADED_AVG,this.getAvg(this.tsLoadeds)),this.stat.setComp(O.HLS_INFO.name,O.HLS_INFO.TS_SPEED_AVG,this.getAvg(this.tsSpeeds)),this.stat.setComp(O.HLS_INFO.name,O.HLS_INFO.TS_SIZE_AVG,this.getAvg(this.tsSizes)),this.stat.fill(e,!1),this.tsdbUtil.sendMetrics(e),this.isPaused=!1,this.tsOpens=[],this.tsLoadeds=[],this.tsSpeeds=[],this.tsSizes=[]}},{key:"getAvg",value:function(e){var t=e.length;if(0===t)return 0;for(var i=0,r=0;r<t;r++)i+=e[r];return Math.floor(i/t)}}]),e}(),Ve=function(){function e(t){(0,h.default)(this,e),this._hlsPlayer=t,this._seekTime=0}return(0,d.default)(e,[{key:"seek",value:function(e){this._seekTime=e}},{key:"check",value:function(){this._seekTime>0&&(this._seek()?this._seekTime=0:this._reseek())}},{key:"_seek",value:function(){for(var e=this._seekTime,t=this._hlsPlayer.mse.video.buffered,i=0;i<t.length;i++){var r=t.start(i)-.2,n=t.end(i)+.2;if(r<=e&&e<n)return this._hlsPlayer.mse.seek(e),this._hlsPlayer.onVideoSeek(e),this._hlsPlayer.play(),!0}return!1}},{key:"_reseek",value:function(){var e=this._hlsPlayer.mse.parser.getStartTs(),t=this._hlsPlayer.playlist.currDetails,i=t?t.fragments:null;if(i&&t.fragIdx>1){var r=t.fragIdx-1;t.fragIdx=e>i[r].start?this._findIdxBack(e,i,r):this._findIdxFront(e,i,r),D.log("hlsSeek._reseek fromIdx="+r+" toIdx="+t.fragIdx),this._hlsPlayer.mse.resetHls(),this._hlsPlayer.pause(),this._hlsPlayer.seekTime=this._seekTime}}},{key:"_findIdxFront",value:function(e,t,i){for(var r=t.length,n=null,s=i;s<r;s++)if((e+=(n=t[s]).duration)>=this._seekTime)return n.seeking=!0,s;return r-1}},{key:"_findIdxBack",value:function(e,t,i){for(var r=null,n=i;n>0;n--)if((e-=(r=t[n]).duration)<this._seekTime)return r.seeking=!0,n;return 0}}]),e}(),xe=function(){function e(t,i){(0,h.default)(this,e),this.config={autoStartLoad:!0,maxBufferLength:30,bs2Delay:3e3,fragLoadingTimeOut:5e3,fragLoadingMaxRetry:i?3:1,fragLoadingRetryDelay:1e3,listLoadingTimeOut:i?15e3:3e3,listLoadingMaxRetry:i?0:3,listLoadingRetryDelay:1e3,appendErrorMaxRetry:200,minFragBufferNum:3,autoReconnect:!0},this.hyPlayer=t,this.stat=t.stat,this.isLive=null,this.url=null,this.seekTime=0,this.playlist=null,this.mse=null,this.targetDuration=0,this.isLoading=!1,this.fragStartTs=0,this.fragOpenTs=0,this.fragSize=0,this.startTs=0,this.pauseTs=0,this.pauseCnt=0,this.playTs=0,this.started=!1,this.isTryAgain=!1,this.fragLoader=null,this.tryTimer=null,this.hasVideo=!1,this.playStat=new Be(this),this.hlsSeek=new Ve(this),this.firstPlay=!0,this.firstFragLoadTs=0,this.firstFragLoadedTs=0,this.firstFragSize=0,this.videoStatus=v,this.flvLoadTimeSended=!1;var r=function(){var e=b.hlsUseFetch>Math.floor(100*Math.random())&&Ue.isSupported(),t=Y.HLS_LOAD_TYPE,i=t.FETCH,r=t.XHR;return{clz:e?Ue:Me,type:e?i:r}}(),n=r.clz,s=r.type;this._loaderClz=n,this._loaderType=s,this.videoElement=i,this.loadHlsStatus=Y.LoadVideoTimeoutReason.HLS_DISCONNECTED,this.needReset=!1,this.lastPlayTs=0,this.pauseInBufferFullTimes=0,this.sendPauseTimeout=0,this.businessStartCost=0,this.startTimeStamp=0,this.loadStartTs=0,this.isSwitchSeamLessLine=!1}return(0,d.default)(e,[{key:"destroy",value:function(){D.log("HlsPlayer.destroy"),this.started=!1,this.removeTimer(),this.tryTimer&&(clearTimeout(this.tryTimer),this.tryTimer=null),this.mse&&(this.mse.destroy(),this.mse=null),this.playlist&&(this.playlist.destroy(),this.playlist=null),this.releaseLoader(),this.isSwitchSeamLessLine=!1}},{key:"reset",value:function(){D.log("HlsPlayer.reset"),this.removeTimer(),this.isLive=null,this.url=null,this.seekTime=0,this.targetDuration=0,this.isLoading=!1,this.startTs=0,this.pauseTs=0,this.pauseCnt=0,this.playTs=0,this.hasVideo=!1,this.started=!1,this.isTryAgain=!1,this.playStat.stop(),this.firstFragLoadTs=0,this.firstFragLoadedTs=0,this.firstFragSize=0,this.firstPlay=!0,this.stat.reset(),this.isSwitchSeamLessLine=!1}},{key:"resetMediasource",value:function(){this.needReset=!0}},{key:"reloadInError",value:function(){this.mse.getCurrentTime();var e=this.mse.getCurrentTime()/1e3,t=this.playlist.getNearFragStart(e);this.mse.reset(),this.releaseLoader(),this.videoElement?(this.mse=new _e(this,"ts",this.isLive,!1,this.videoElement),this.mse.setSensitivePause(!1)):this.mse=new _e(this,"ts",this.isLive),this.isLoading=!1,this.seek(t)}},{key:"releaseLoader",value:function(){this.fragLoader&&(this.fragLoader.destroy(),this.fragLoader=null)}},{key:"removeTimer",value:function(){Q.remove(this.onCheckTimer,this),Q.remove(this.onCheckFastTimer,this)}},{key:"setConfig",value:function(e,t){}},{key:"start",value:function(e){this.stop(),this.info=e;var t=(new Date).getTime();e.isLive,this.businessStartCost=0,this.UIStartCost=0,this.loadStartTs=0,this.startTimeStamp=Number(e.startTimeStamp)||0,e.noNeedSendVideoLoadTime?this.noNeedSendVideoLoadTime=!0:(this.businessStartCost=e.startTimeStamp?Math.floor(t-e.startTimeStamp):0,this.noNeedSendVideoLoadTime=!1),e.uistartTs&&e.uistartTs>0&&(this.UIStartCost=Math.floor(t-e.uistartTs)),D.log("HlsPlayer.start startTimeStamp="+e.startTimeStamp,"uistartTs="+e.uistartTs,"businessStartCost="+this.businessStartCost,"UIStartCost="+this.UIStartCost,"now="+t,"uistartTs="+e.uistartTs);var i=e.isLive,r=e.url;r?(this.loadHlsStatus=Y.LoadVideoTimeoutReason.HLS_DISCONNECTED,this.url=r,this.isLive=i,D.log("HlsPlayer.start isLive="+this.isLive+" url="+r),this.playlist=new Fe(this),this.videoElement?(this.mse=new _e(this,"ts",i,!1,this.videoElement),this.mse.setSensitivePause(!1)):this.mse=new _e(this,"ts",i),this.playlist.loadManifest(this.url),this.seek(e.seekTime||this.seekTime),this.startTs=R(),this.started=!0,this.playStat.start(),this.stat.setComDim(O.DIM_COM.STREAM_URL,r),this.stat.setComDim(O.DIM_COM.P2P,O.LIVE_TYPE.HLS),this.stat.setComDim(O.DIM_COM.STREAM_TYPE,3),this.stat.setComDim(O.DIM_COM.HLS_TYPE,e.isLhls?2:1)):D.error("HlsPlayer.start invalid argument, pls check the url.")}},{key:"updateAnticode",value:function(){var e=this;if(this.info){var t=new HUYA.GetCdnTokenExReq;t.sFlvUrl=this.info.sHlsUrl,t.sStreamName=this.info.sStreamName,TafLink.sendWup("liveui","getCdnTokenInfoEx",t,(function(t){e.info.sHlsAntiCode=t.sFlvToken}),!0,TafLink.getRequestId())}}},{key:"setVideoPlayTimeSended",value:function(){this.flvLoadTimeSended=!0}},{key:"setLoadStatus",value:function(e){this.loadHlsStatus<e&&(this.loadHlsStatus=e)}},{key:"sendLoadVideoErrorStatus",value:function(){this.hyPlayer.tsdbUtil.sendMetrics([this.stat.createAct(F.METRIC.VIDEO_VIDEO_LOAD_ERROR,{value:[this.loadHlsStatus]})])}},{key:"getPlayVideo",value:function(){return this.mse.getPlayVideo()}},{key:"stop",value:function(){Q.remove(this.updateAnticode,this),this.started&&(D.log("HlsPlayer.stop"),this.destroy(),this.reset())}},{key:"seek",value:function(e){if(!this.isLive&&null!=e){if(this.seekTime=e,0==e){if(!this.mse||!this.mse.video)return;if(0==this.mse.video.currentTime)return}this.playlist&&(D.log("HlsPlayer.seek "+e),e=Math.max(0,Number(e)),this.playlist.seek(e)?(this.pause(),this.mse.resetHls(),this.releaseLoader(),this.isLoading=!1,this.loadFragment(),this.hlsSeek.seek(this.seekTime)):this.playlist.firstLevelLoaded&&(D.warn("HlsPlayer.seek out of range."),this.stop(),this.onAnchorStop()))}}},{key:"pause",value:function(){this.started&&(D.info("HlsPlayer.pause"),this.mse&&this.mse.pause())}},{key:"play",value:function(){this.started&&(D.info("HlsPlayer.play"),this.mse&&this.mse.play())}},{key:"setVolume",value:function(e){this.mse&&this.mse.setVolume(e)}},{key:"getVolume",value:function(){return this.mse?this.mse.getVolume():-1}},{key:"getBufferLen",value:function(){return this.mse.getBufferLen()}},{key:"getCurrentTime",value:function(){return this.mse&&(this.lastPlayTs=Math.round(this.mse.getCurrentTime()/1e3)),this.lastPlayTs>this.getDurationTime()?this.getDurationTime():this.lastPlayTs}},{key:"getDurationTime",value:function(){return Math.floor(this.playlist&&this.playlist.totalDuration?this.playlist.totalDuration:0)}},{key:"setMuted",value:function(e){this.mse&&this.mse.setMuted(e)}},{key:"getMuted",value:function(){return this.mse?this.mse.getMuted():-1}},{key:"reconnectLive",value:function(){D.log("HlsPlayer.reconnectLive"),this.isLive?(this.url,this.isLive,this.destroy(),this.reset(),this.start(this.info)):this.onPlayerError()}},{key:"setTargetDuration",value:function(e){this.targetDuration=e*this.config.minFragBufferNum}},{key:"loadFragment",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isLoading&&null!==this.playlist.currDetails){this.hlsSeek.check();var t=void 0;if(0==this.seekTime){var i=this.targetDuration||this.config.maxBufferLength,r=this.mse.getPlayVideo();if((t=this.bufferedInfo(r.currentTime,r.buffered).len)>=i)return}var n=e?this.playlist.getCurrentFrag():this.playlist.getNextFrag();if(n){var s=this.config,a=s.bs2Delay+this.targetDuration/3*1e3,o=n.url;0==this.firstFragLoadTs&&(this.firstFragLoadTs=R()),this.isLoading=!0,this.releaseLoader();var u=new this._loaderClz(s);this.fragLoader=u,n.byteRangeEndOffset&&(u.fromByte=n.byteRangeStartOffset,u.toByte=n.byteRangeEndOffset-1),this.fragStartTs=R(),this.fragSize=0,this.stat.addComp(O.HLS_INFO.name,O.HLS_INFO.TS_CNT,1),u.loadBuffer(o,this.loadOpen.bind(this),this.loadChunk.bind(this),this.loadSuccess.bind(this),this.loadError.bind(this),this.loadTimeout.bind(this),a,s.fragLoadingMaxRetry,s.fragLoadingRetryDelay)}else null!=t&&t<=.05?D.log("HlsPlayer.loadFragment ANCHOR_STOP bufferedLen="+t.toFixed(2)):this.seekTime>0&&(D.warn("HlsPlayer.seek out of range."),this.stop(),this.onAnchorStop())}}},{key:"loadOpen",value:function(){this.fragOpenTs=R();var e=this.fragOpenTs-this.fragStartTs;e<5e3&&this.playStat.tsOpens.push(e)}},{key:"loadChunk",value:function(e){this.pushData(e)}},{key:"loadSuccess",value:function(e){this.isLoading=!1,this.pushData(e);var t=R()-this.fragOpenTs;t<1e4&&(this.playStat.tsLoadeds.push(t),this.playStat.tsSpeeds.push(this.fragSize/t),this.playStat.tsSizes.push(this.fragSize)),this.stat.addComp(O.HLS_INFO.name,O.HLS_INFO.TS_SUC_CNT,1),this.fragSize=0}},{key:"pushData",value:function(e){if(e){this.fragSize+=e.byteLength,this.stat.addCore(O.CORE.CDN_TOTAL_BW,e.byteLength);var t=this.playlist.currLevel,i=this.playlist.currFrag,r=t.details.totalduration;0==this.firstFragLoadedTs&&(this.firstFragLoadedTs=R(),this.firstFragSize=e.byteLength/1024|0),this.mse.appendTs({data:e,audioCodec:t.audioCodec,videoCodec:t.videoCodec,timeOffset:i.start,duration:r,discontinuity:i.discontinuity,level:i.level,sn:i.sn,seeking:i.seeking,hlsDT:i.hlsDT,tsDT:i.tsDT}),i&&i.seeking&&(i.seeking=!1,this.firstPlay&&(this.firstPlay=!1,this.mse.seek(this.seekTime),this.onVideoSeek(this.seekTime),this.play()),this.seekTime=0),Q.has(this.onCheckTimer,this)||(Q.add(this.onCheckTimer,this,1e3),Q.add(this.onCheckFastTimer,this,100)),this.setLoadStatus(Y.LoadVideoTimeoutReason.HLS_LOADFRAMENT_SUCCESS)}}},{key:"loadError",value:function(e){var t=e.code,i=e.currentTarget;this.stat.addComp(O.HLS_INFO.name,O.HLS_INFO.TS_FAIL_CNT,1),D.warn("load fragment error:"+(t||i.status)),this.isLoading=!1,this.config.autoReconnect&&this.reconnectLive(),this.setLoadStatus(Y.LoadVideoTimeoutReason.HLS_LOADFRAMENT_ERROR)}},{key:"loadTimeout",value:function(e){this.stat.addComp(O.HLS_INFO.name,O.HLS_INFO.TS_TIMEOUT_CNT,1),D.warn("load fragment timeout",e),this.isLoading=!1,this.config.autoReconnect&&this.reconnectLive()}},{key:"bufferedInfo",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.3,r=void 0,n=void 0,s=void 0,a=void 0,o=void 0,u=[],l=[];for(o=0;o<t.length;o++)u.push({start:t.start(o),end:t.end(o)});for(u.sort((function(e,t){return e.start-t.start||t.end-e.end})),o=0;o<u.length;o++){var h=l.length;if(h){var d=l[h-1].end;u[o].start-d<i?u[o].end>d&&(l[h-1].end=u[o].end):l.push(u[o])}else l.push(u[o])}for(o=0,r=0,n=s=e;o<l.length;o++){var c=l[o].start,f=l[o].end;if(e+i>=c&&e<f)n=c,r=(s=f)-e;else if(e+i<c){a=c;break}}return{len:r,start:n,end:s,nextStart:a}}},{key:"checkCatonError",value:function(){if(this.mse&&this.mse.getBufferLen&&this.mse.getBufferLen()>8e3&&!this.mse.video.paused&&Math.floor(this.mse.getCurrentTime()/1e3)<5&&(Math.floor(this.lastPlayTs)==Math.floor(this.mse.getCurrentTime()/1e3)&&this.pauseInBufferFullTimes++,this.pauseInBufferFullTimes>=5)){var e=this.playlist.getNearFragStart(this.lastPlayTs+1);this.seek(e),this.pauseInBufferFullTimes=0}}},{key:"onCheckTimer",value:function(e,t){if(this.started&&this.mse&&!this.needReset&&(this.loadFragment(),this.mse&&!this.mse.userPaused)){if(this.mse&&this.mse.onCheckTimer(e,t),this.playlist&&this.playlist.onCheckTimer(t),this.playTs>0){var i=e-this.pauseTs;this.playStat&&(this.pauseTs>0&&i>200&&this.playStat.setPause(),t%20==0&&this.playStat.report()),this.pauseTs>0&&i>8e3&&(D.warn("HlsPlayer.onCheckTimer pauseTime="+i),this.isLive?this.reconnectLive():(this.onPlayerError(),this.pauseTs=0))}this.checkCatonError(),this.hyPlayer.trigger(c.PLAY_TIME_STATUS,{current:this.getCurrentTime(),total:this.getDurationTime()}),this.hyPlayer.trigger(c.PLAY_FRAME_BUFFER,{frameStorage:this.mse.getFrameReadyed(),jitterBuffer:this.mse.getBufferLen()})}}},{key:"onCheckFastTimer",value:function(e,t){this.needReset?this.mse&&this.mse.getBufferLen()<500&&(this.reloadInError(),this.needReset=!1):this.started&&this.mse&&!this.mse.userPaused&&this.mse&&this.mse.onCheckFastTimer(e,t)}},{key:"updateStatus",value:function(e){this.videoStatus!==e&&(this.videoStatus=e,this.hyPlayer.trigger(c.PLAY_STATUS,{status:e}))}},{key:"onStartVideo",value:function(){this.loadStartTs=R()}},{key:"onPlayVideo",value:function(e,t,i,r){var n=R();if(this.playTs=n,this.hasVideo=r,e.volume=this.hyPlayer.volume,0!==this.startTs){var s=n-this.startTs,a=this.playlist.manifestLoadedTs-this.startTs,o=this.firstFragLoadTs-this.playlist.manifestLoadedTs,u=this.firstFragLoadedTs-this.firstFragLoadTs,l=this.UIStartCost>0?s+this.UIStartCost:0,h=0;this.startTimeStamp>1?h=s+this.businessStartCost:1===this.startTimeStamp&&(h=n-this.loadStartTs),this.hyPlayer.tsdbUtil.sendHlsTime(this._loaderType,s,a,o,u,this.firstFragSize,h,l),D.log("%cHlsPlayer.onPlayVideo loadTime="+s,"color:#A23400;background:#FFF5C2"),this.startTs=0}this.hyPlayer.trigger(c.VIDEO_PLAY,{video:e,width:t,height:i}),this.updateStatus(p)}},{key:"onVideoStop",value:function(e,t){D.log("HlsPlayer.onVideoStop hasVideo="+t),this.hasVideo=!1,t&&(this.updateStatus(v),this.hyPlayer.trigger(c.VIDEO_STOP,{video:e}))}},{key:"onAnchorStop",value:function(){var e=this.mse?this.mse.getPlayVideo():null;this.hyPlayer.trigger(c.ANCHOR_STOP,{video:e})}},{key:"onLoadM3u8Error",value:function(){this.hyPlayer.trigger(c.HLS_URL_UNAVAILABLE)}},{key:"onLoadManifestTimeout",value:function(){this.hyPlayer.trigger(c.HLS_MAINFEST_LOAD_TIMEOUT)}},{key:"onConnectManifestTimeout",value:function(){this.hyPlayer.trigger(c.HLS_URL_LOAD_TIMEOUT)}},{key:"onPlayerError",value:function(e){this.videoElement}},{key:"onErrorEvent",value:function(e){var t=this.mse?this.mse.getPlayVideo():null;this.hyPlayer.trigger(c.H5_PLAYER_ERROR,{video:t,code:e.type,msg:"播放错误"}),this.setLoadStatus(Y.LoadVideoTimeoutReason.HLS_PLAY_ERROR)}},{key:"onPlayPause",value:function(e,t){if(t&&(this.pauseTs=e,this.updateStatus(y),this.playlist&&!this.isLive)){var i=1e3*this.playlist.totalDuration,r=this.mse?this.mse.getCurrentTime():0;i>0&&r>0&&Math.abs(i-r)<1e3&&(D.warn("HlsPlayer detect anchor stop."),this.onAnchorStop(),this.stop()),this.startSendPauseTimer()}}},{key:"onPlayResume",value:function(e,t){if(this.pauseTs>0){var i=e-this.pauseTs;i>200&&(D.warn("FlvPlayer.onPlayResume pauseTime="+i),this.pauseCnt++),this.pauseTs=0}t&&this.updateStatus(p)}},{key:"onVideoSeek",value:function(e){var t=this.mse?this.mse.getPlayVideo():null;this.hyPlayer.trigger(c.VIDEO_SEEK,{video:t,currentTime:e})}},{key:"startSendPauseTimer",value:function(){this.stopSendPauseTimer(),this.sendPauseTimeout=setTimeout(this.sendPauseEvent.bind(this),200)}},{key:"stopSendPauseTimer",value:function(){clearTimeout(this.sendPauseTimeout)}},{key:"sendPauseEvent",value:function(){this.hyPlayer.trigger(c.PLAY_CARTON)}},{key:"getCostTimes",value:function(){return[this.playlist.manifestLoadedTs>0?this.playlist.manifestLoadedTs-this.startTs:0,this.firstFragLoadedTs>0?this.firstFragLoadTs-this.playlist.manifestLoadedTs:0,this.firstFragLoadedTs>0?this.firstFragLoadedTs-this.firstFragLoadTs:0]}},{key:"switchLevel",value:function(e){var t=this.playlist.levels,i=e.curBitRate;if(t.length>0&&this.playlist.isMasterPlayList){for(var r=0;r<t.length;r++)if(t[r].bitrate===i&&this.playlist.currLevel.bitrate!=i){this.playlist.currLevel.bitrate=i,this.playlist.currLevelId=r,this.playlist.currLevel.url=t[r].url,this.mse.parser.switchLevel(),this.play();break}}else this.playlist.currLevel.url=e.url,this.playlist.currLevel.bitrate=i,this.mse.parser.switchLevel(),this.play()}},{key:"isPlaying",get:function(){return this.videoStatus!==v}},{key:"hasPicture",get:function(){return this.isPlaying&&0!==this.mse.getCurrentTime()}}]),e}(),He=function(){function e(){(0,h.default)(this,e),this.comDim=new s.default,this.coreDim=new s.default,this.actDim=new s.default,this.extDim=new s.default,this.coreMap=new s.default,this.compMap=new s.default,this.heart_type=O.HEART_TYPE.START}return(0,d.default)(e,[{key:"reset",value:function(){this.comDim.clear(),this.coreDim.clear(),this.actDim.clear(),this.extDim.clear(),this.coreMap.clear(),this.compMap.clear(),this.heart_type=O.HEART_TYPE.START}},{key:"createAct",value:function(e,t){return this._createAct(e,t)}},{key:"createActs",value:function(e){var t=[];if(e)for(var i=0;i<e.length;i++){var r=e[i],n=this._createAct(r.type,r.params);t.push(n)}return t}},{key:"_createAct",value:function(e,t){var i={sMetricName:O.ACT.name,vField:{},vDimension:{}};if(i.vDimension[O.ACT.field]=e,this._fillFromMap(i.vDimension,this.comDim),this._fillFromMap(i.vDimension,this.actDim),t){var r=0;if(t.hasOwnProperty(O.KEY_VALUE)){var n=t[O.KEY_VALUE];for(r=0;r<n.length;r++)i.vField[O.KEY_VALUE+(r+1)]=n[r]}if(t.hasOwnProperty(O.KEY_STR)){var s=t[O.KEY_STR];for(r=0;r<s.length;r++)i.vDimension[O.KEY_STR+(r+1)]=s[r]}t.hasOwnProperty(O.KEY_DIM)&&(0,u.default)(i.vDimension,t[O.KEY_DIM])}return this.actDim.clear(),i}},{key:"fill",value:function(e,t){t?(this.heart_type=O.HEART_TYPE.END,this._fill(e)):this._fill(e)}},{key:"_fill",value:function(e){if(0!=this.coreMap.size||0!=this.compMap.size){var t={sMetricName:O.CORE.name,vField:{},vDimension:{},vExLog:{}};this.coreDim.set(O.DIM_CORE.HEART_TYPE,this.heart_type),this._fillFromMap(t.vDimension,this.comDim),this._fillFromMap(t.vDimension,this.coreDim),this._fillFromMap(t.vExLog,this.extDim),this._fillFromMap(t.vField,this.coreMap),this._fillComp(t.vDimension),this.coreDim.clear(),this.extDim.clear(),this.coreMap.clear(),this.compMap.clear(),this.heart_type==O.HEART_TYPE.START&&(this.heart_type=O.HEART_TYPE.CONTINUS),e.push(t)}}},{key:"_fillComp",value:function(e){var t=!0,i=!1,r=void 0;try{for(var n,s=(0,a.default)(this.compMap.keys());!(t=(n=s.next()).done);t=!0){var o=n.value,u=this.compMap.get(o),l="",h=!0,d=!1,c=void 0;try{for(var f,p=(0,a.default)(u.keys());!(h=(f=p.next()).done);h=!0){var v=f.value;l.length>0&&(l+=";"),l+=v+","+u.get(v)}}catch(e){d=!0,c=e}finally{try{!h&&p.return&&p.return()}finally{if(d)throw c}}e[o]=l}}catch(e){i=!0,r=e}finally{try{!t&&s.return&&s.return()}finally{if(i)throw r}}}},{key:"_fillFromMap",value:function(e,t){var i=!0,r=!1,n=void 0;try{for(var s,o=(0,a.default)(t.keys());!(i=(s=o.next()).done);i=!0){var u=s.value;e[u]=t.get(u)}}catch(e){r=!0,n=e}finally{try{!i&&o.return&&o.return()}finally{if(r)throw n}}}},{key:"setComDim",value:function(e,t){this.comDim.set(e,t)}},{key:"setCoreDim",value:function(e,t){this.coreDim.set(e,t)}},{key:"setActDim",value:function(e,t){this.actDim.set(e,t)}},{key:"setExtDim",value:function(e,t){this.extDim.set(e,t)}},{key:"delDim",value:function(e){this.comDim.has(e)?this.comDim.delete(e):this.coreDim.has(e)?this.coreDim.delete(e):this.actDim.has(e)&&this.actDim.delete(e)}},{key:"setCore",value:function(e,t){this.coreMap.set(e,t)}},{key:"addCore",value:function(e,t){this._addValue(this.coreMap,e,t)}},{key:"setComp",value:function(e,t,i){this._getCompMap(e).set(t,i)}},{key:"addComp",value:function(e,t,i){var r=this._getCompMap(e);this._addValue(r,t,i)}},{key:"_getCompMap",value:function(e){if(this.compMap.has(e))return this.compMap.get(e);var t=new s.default;return this.compMap.set(e,t),t}},{key:"_addValue",value:function(e,t,i){if(e.has(t)){var r=e.get(t);e.set(t,r+i)}else e.set(t,i)}}]),e}(),Ge=function(){function e(t){(0,h.default)(this,e),R();var i=Number(localStorage.sdkLogLevel);isNaN(i)||this.setLogLevel(i),H.initUUId(),this.uuid=H.uuid,this.VideoPlayTimeSended=!1;var r=E.platform+" "+E.name+" "+E.version.string;D.warn("SDK 2006231626 | 2020-06-23 16:26:43 | RELEASE | "+r+" | "+this.uuid),this.config=b,this.config.init(t),this.config.jitBufLen=6e3,this.config.jitMaxBufLen=16e3,this.config.jitMinBufLen=3e3;var n=new x.a;n.trigger=function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];setTimeout((function(){var t=i;"Array"==i.constructor.name&&(t=i[0]),e==m.PLAY_STATUS?D.log("%c"+e+" %c"+t.status,"color:#F9F900;background:gray","color:#53FF53;background:gray"):e!=m.H264_SEI_PLAY&&e!=m.AUDIO_SOUND&&e!=m.SIGNAL_DATA&&e!=m.UPDATE_INTERSITY&&e!=m.PLAY_DOWNLINK_INFO&&e!=m.PLAY_FRAME_BUFFER&&e!=m.PLAY_TIME_STATUS&&D.log("%c"+e,"color:#F9F900;background:gray",t),n.emit.apply(n,[e,e].concat(i))}),0)},n.off=function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];n.removeListener.apply(n,[e].concat(i))},this.on=n.on.bind(n),this.off=n.off.bind(n),this.trigger=n.trigger.bind(n),this.volume=1,this._type=0,this.player=null,this.lastFlvInfo=null,this.lastP2PInfo=null,this.noPictureSended=!1,this.playingMgr=null,this.videoPlaybackrateAccess=!E.firefox,this.stat=new He,this.metrics=new B,this.tsdbUtil=new F(this),this.enableLowLatency=!1,this.nimoPlayConfig=null,this.audiouitil=null,this.stat.setComDim(O.DIM_COM.BROWSER_NAME,E.name),this.stat.setComDim(O.DIM_COM.BROWSER_VERSION,E.version.major)}return(0,d.default)(e,null,[{key:"isSupported",value:function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')&&!E.msie}},{key:"Events",get:function(){return m}}]),(0,d.default)(e,[{key:"isBrowserSupport",value:function(){return E.firefox||E.opera||E.chrome&&53!=E.version.major}},{key:"isNeedAud",value:function(){return E.chrome&&E.version.major>=73}},{key:"isP2PCooling",value:function(){return!1}},{key:"setExtendConfig",value:function(e){var t={};e.p2pConfig&&((0,u.default)(t,e.p2pConfig),delete e.p2pConfig),e.sdk&&(e.sdk.p2pConfig&&((0,u.default)(t,e.sdk.p2pConfig),delete e.sdk.p2pConfig),(0,u.default)(t,e.sdk),delete e.sdk),(0,u.default)(t,e),this.config.init(t)}},{key:"setConfig",value:function(e,t){this.config[e]!=t&&(this.config[e]=t,D.log("HYPlayer.setConfig "+e+"="+t))}},{key:"setNimoConfig",value:function(e){try{e.nimoConfig&&(this.nimoPlayConfig=JSON.parse(e.nimoConfig)),this.setExtendConfig(this.nimoPlayConfig),this.player&&this.player.updateFlvConfig&&this.player.updateFlvConfig()}catch(e){D.log("config err")}}},{key:"getConfig",value:function(e){return this.config[e]}},{key:"getVolume",value:function(){return this.volume}},{key:"setVolume",value:function(e){var t=Math.max(0,Number(e));t=Math.min(1,t),this.volume=t,this.player&&this.player.setVolume(t)}},{key:"pause",value:function(){this.player&&(this.player.pause?this.player.pause():this.player.stop())}},{key:"play",value:function(){this.player&&this.player.play&&this.player.play()}},{key:"setLogLevel",value:function(e){D.setLevel(e)}},{key:"seek",value:function(e){this.player&&this.player.seek&&this.player.seek(e)}},{key:"getLog",value:function(){return D.getLog()}},{key:"getMetrics",value:function(){return this.metrics.getResult()}},{key:"getCurrentTime",value:function(){return this.player?this.player.getCurrentTime():0}},{key:"getDurationTime",value:function(){return this.player?this.player.getDurationTime():0}},{key:"sendMetrics",value:function(e){this.trigger(m.DATA_METRIC2,e)}},{key:"sendDanmuCarton",value:function(e,t,i){this.tsdbUtil.sendMetrics([this.stat.createAct(F.METRIC.RECV_DANMU_CARTON,{str:[e,t,i]})])}},{key:"start",value:function(t){switch(t=(0,u.default)({uuid:this.uuid,type:0,lineType:-1,curBitrate:0,originalBitrate:0,enableLowLatency:0},t),this.stop(),this.enableLowLatency=t.enableLowLatency,D.log("HYPlayer.start type="+t.type,t),this.stat.setComDim(O.DIM_COM.PLAYER_TYPE,t.type),this.stat.setComDim(O.DIM_COM.LIVE_TYPE,t.liveType||0),this.stat.setComDim(O.DIM_COM.START_TYPE,t.startType||1),this._type=t.type,t.uid&&(H.uid=t.uid),/*!this.noPictureSended && */t.type===e.FLV||t.type===e.P2P?Q.once(this.onNoPictureFlv,this,1e4):t.type===e.HLS&&Q.once(this.onNoPictureHls,this,1e4),t.type){case e.FLV:this.player=new Ce(this,{isPureAudio:!1},this.videoElement),this.lastFlvInfo=t;break;case e.HLS:this.player=new xe(this,this.videoElement)}this.player.setVideoPlayTimeSended&&this.VideoPlayTimeSended&&this.player.setVideoPlayTimeSended(),this.player.start(t),this.nimoPlayConfig&&this.setNimoConfig(this.nimoPlayConfig),this.enableLowLatency&&this.player&&this.player.setEnableLowLatency&&this.player.setEnableLowLatency(!0),this.player.setPlaybackrateAccess&&this.player.setPlaybackrateAccess(this.videoPlaybackrateAccess),this.playingMgr=this.player}},{key:"attachMediaElement",value:function(e){this.videoElement=e}},{key:"sendVideoLoadError",value:function(){this.player&&this.player.sendLoadVideoErrorStatus()}},{key:"onNoPictureP2P",value:function(){this.player&&this.isP2P&&!this.noPictureP2PSended&&this.onNoPicture()}},{key:"onNoPictureFlv",value:function(){this.player&&this.isFlv&&!this.noPictureFlvSended&&this.onNoPicture()}},{key:"onNoPictureHls",value:function(){this.player&&this.isHls&&!this.noPictureHlsSended&&(this.noPictureHlsSended=!0,this.onNoPicture())}},{key:"onNoPicture",value:function(){var e=this.player.getCostTimes?this.player.getCostTimes():[],t=[this.player.isPlaying?0:100,this.player.hasPicture?0:100].concat(e),i=[this.stat.createAct(O.ACT.NO_PICTURE,{value:t})];this.trigger(m.DATA_METRIC2,i)}},{key:"onPlayVideo",value:function(e){this.audiouitil||(this.audiouitil=new we),this.player&&this.player.setAudioUtil&&this.player.setAudioUtil(this.audiouitil),this.VideoPlayTimeSended=!0}},{key:"stop",value:function(){D.group("HYPlayer.stop"),Q.remove(this.onNoPictureFlv,this),Q.remove(this.onNoPictureP2P,this),Q.remove(this.onNoPictureHls,this),this.player&&(this.player.stop(),this.player.destroy&&this.player.destroy(),this.player=null),D.groupEnd()}},{key:"setAppHandler",value:function(e){e.onHySDKPlayerInited(this)}},{key:"switchLevel",value:function(e){this.player&&this.player.switchLevel(e)}},{key:"isSupportP2P",get:function(){return!1}},{key:"type",get:function(){return this._type}},{key:"isFlv",get:function(){return this._type==e.FLV}},{key:"isP2P",get:function(){return this._type==e.P2P}},{key:"isHls",get:function(){return this._type==e.HLS}}]),e}();Ge.FLV=1,Ge.P2P=2,Ge.HLS=3,Ge.HUYA=4,Ge.STREAM=5,t.default=Ge,window.HYPlayer=Ge,window.H5Player=Ge}])},function(e,t,i){e.exports={default:i(101),__esModule:!0}},function(e,t,i){i(35),i(37),e.exports=i(38).f("iterator")},function(e,t,i){var r=i(48),n=i(46);e.exports=function(e){return function(t,i){var s,a,o=String(n(t)),u=r(i),l=o.length;return u<0||u>=l?e?"":void 0:(s=o.charCodeAt(u))<55296||s>56319||u+1===l||(a=o.charCodeAt(u+1))<56320||a>57343?e?o.charAt(u):s:e?o.slice(u,u+2):a-56320+(s-55296<<10)+65536}}},function(e,t,i){"use strict";var r=i(36),n=i(31),s=i(28),a={};i(17)(a,i(6)("iterator"),(function(){return this})),e.exports=function(e,t,i){e.prototype=r(a,{next:n(1,i)}),s(e,t+" Iterator")}},function(e,t,i){var r=i(12),n=i(13),s=i(24);e.exports=i(8)?Object.defineProperties:function(e,t){n(e);for(var i,a=s(t),o=a.length,u=0;o>u;)r.f(e,i=a[u++],t[i]);return e}},function(e,t,i){"use strict";var r=i(106),n=i(68),s=i(27),a=i(20);e.exports=i(53)(Array,"Array",(function(e,t){this._t=a(e),this._i=0,this._k=t}),(function(){var e=this._t,t=this._k,i=this._i++;return!e||i>=e.length?(this._t=void 0,n(1)):n(0,"keys"==t?i:"values"==t?e[i]:[i,e[i]])}),"values"),s.Arguments=s.Array,r("keys"),r("values"),r("entries")},function(e,t){e.exports=function(){}},function(e,t,i){i(70),i(39),i(109),i(110),e.exports=i(2).Symbol},function(e,t,i){var r=i(24),n=i(52),s=i(33);e.exports=function(e){var t=r(e),i=n.f;if(i)for(var a,o=i(e),u=s.f,l=0;o.length>l;)u.call(e,a=o[l++])&&t.push(a);return t}},function(e,t,i){i(55)("asyncIterator")},function(e,t,i){i(55)("observable")},function(e,t,i){e.exports={default:i(112),__esModule:!0}},function(e,t,i){i(113),e.exports=i(2).Object.setPrototypeOf},function(e,t,i){var r=i(3);r(r.S,"Object",{setPrototypeOf:i(114).set})},function(e,t,i){var r=i(7),n=i(13),s=function(e,t){if(n(e),!r(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,r){try{(r=i(16)(Function.call,i(74).f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,i){return s(e,i),t?e.__proto__=i:r(e,i),e}}({},!1):void 0),check:s}},function(e,t,i){i(116);var r=i(2).Object;e.exports=function(e,t){return r.create(e,t)}},function(e,t,i){var r=i(3);r(r.S,"Object",{create:i(36)})},function(e,t,i){i(39),i(35),i(37),i(118),i(126),i(129),i(131),e.exports=i(2).Map},function(e,t,i){"use strict";var r=i(119),n=i(79);e.exports=i(122)("Map",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{get:function(e){var t=r.getEntry(n(this,"Map"),e);return t&&t.v},set:function(e,t){return r.def(n(this,"Map"),0===e?0:e,t)}},r,!0)},function(e,t,i){"use strict";var r=i(12).f,n=i(36),s=i(56),a=i(16),o=i(57),u=i(29),l=i(53),h=i(68),d=i(78),c=i(8),f=i(54).fastKey,p=i(79),v=c?"_s":"size",y=function(e,t){var i,r=f(t);if("F"!==r)return e._i[r];for(i=e._f;i;i=i.n)if(i.k==t)return i};e.exports={getConstructor:function(e,t,i,l){var h=e((function(e,r){o(e,h,t,"_i"),e._t=t,e._i=n(null),e._f=void 0,e._l=void 0,e[v]=0,null!=r&&u(r,i,e[l],e)}));return s(h.prototype,{clear:function(){for(var e=p(this,t),i=e._i,r=e._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete i[r.i];e._f=e._l=void 0,e[v]=0},delete:function(e){var i=p(this,t),r=y(i,e);if(r){var n=r.n,s=r.p;delete i._i[r.i],r.r=!0,s&&(s.n=n),n&&(n.p=s),i._f==r&&(i._f=n),i._l==r&&(i._l=s),i[v]--}return!!r},forEach:function(e){p(this,t);for(var i,r=a(e,arguments.length>1?arguments[1]:void 0,3);i=i?i.n:this._f;)for(r(i.v,i.k,this);i&&i.r;)i=i.p},has:function(e){return!!y(p(this,t),e)}}),c&&r(h.prototype,"size",{get:function(){return p(this,t)[v]}}),h},def:function(e,t,i){var r,n,s=y(e,t);return s?s.v=i:(e._l=s={i:n=f(t,!0),k:t,v:i,p:r=e._l,n:void 0,r:!1},e._f||(e._f=s),r&&(r.n=s),e[v]++,"F"!==n&&(e._i[n]=s)),e},getEntry:y,setStrong:function(e,t,i){l(e,t,(function(e,i){this._t=p(e,t),this._k=i,this._l=void 0}),(function(){for(var e=this._k,t=this._l;t&&t.r;)t=t.p;return this._t&&(this._l=t=t?t.n:this._t._f)?h(0,"keys"==e?t.k:"values"==e?t.v:[t.k,t.v]):(this._t=void 0,h(1))}),i?"entries":"values",!i,!0),d(t)}}},function(e,t,i){var r=i(13);e.exports=function(e,t,i,n){try{return n?t(r(i)[0],i[1]):t(i)}catch(t){var s=e.return;throw void 0!==s&&r(s.call(e)),t}}},function(e,t,i){var r=i(27),n=i(6)("iterator"),s=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||s[n]===e)}},function(e,t,i){"use strict";var r=i(4),n=i(3),s=i(54),a=i(18),o=i(17),u=i(56),l=i(29),h=i(57),d=i(7),c=i(28),f=i(12).f,p=i(123)(0),v=i(8);e.exports=function(e,t,i,y,m,_){var S=r[e],g=S,T=m?"set":"add",E=g&&g.prototype,I={};return v&&"function"==typeof g&&(_||E.forEach&&!a((function(){(new g).entries().next()})))?(g=t((function(t,i){h(t,g,e,"_c"),t._c=new S,null!=i&&l(i,m,t[T],t)})),p("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),(function(e){var t="add"==e||"set"==e;e in E&&(!_||"clear"!=e)&&o(g.prototype,e,(function(i,r){if(h(this,g,e),!t&&_&&!d(i))return"get"==e&&void 0;var n=this._c[e](0===i?0:i,r);return t?this:n}))})),_||f(g.prototype,"size",{get:function(){return this._c.size}})):(g=y.getConstructor(t,e,m,T),u(g.prototype,i),s.NEED=!0),c(g,e),I[e]=g,n(n.G+n.W+n.F,I),_||y.setStrong(g,e,m),g}},function(e,t,i){var r=i(16),n=i(45),s=i(21),a=i(47),o=i(124);e.exports=function(e,t){var i=1==e,u=2==e,l=3==e,h=4==e,d=6==e,c=5==e||d,f=t||o;return function(t,o,p){for(var v,y,m=s(t),_=n(m),S=r(o,p,3),g=a(_.length),T=0,E=i?f(t,g):u?f(t,0):void 0;g>T;T++)if((c||T in _)&&(y=S(v=_[T],T,m),e))if(i)E[T]=y;else if(y)switch(e){case 3:return!0;case 5:return v;case 6:return T;case 2:E.push(v)}else if(h)return!1;return d?-1:l||h?h:E}}},function(e,t,i){var r=i(125);e.exports=function(e,t){return new(r(e))(t)}},function(e,t,i){var r=i(7),n=i(71),s=i(6)("species");e.exports=function(e){var t;return n(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!n(t.prototype)||(t=void 0),r(t)&&null===(t=t[s])&&(t=void 0)),void 0===t?Array:t}},function(e,t,i){var r=i(3);r(r.P+r.R,"Map",{toJSON:i(127)("Map")})},function(e,t,i){var r=i(58),n=i(128);e.exports=function(e){return function(){if(r(this)!=e)throw TypeError(e+"#toJSON isn't generic");return n(this)}}},function(e,t,i){var r=i(29);e.exports=function(e,t){var i=[];return r(e,!1,i.push,i,t),i}},function(e,t,i){i(130)("Map")},function(e,t,i){"use strict";var r=i(3);e.exports=function(e){r(r.S,e,{of:function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)}})}},function(e,t,i){i(132)("Map")},function(e,t,i){"use strict";var r=i(3),n=i(23),s=i(16),a=i(29);e.exports=function(e){r(r.S,e,{from:function(e){var t,i,r,o,u=arguments[1];return n(this),(t=void 0!==u)&&n(u),null==e?new this:(i=[],t?(r=0,o=s(u,arguments[2],2),a(e,!1,(function(e){i.push(o(e,r++))}))):a(e,!1,i.push,i),new this(i))}})}},function(e,t,i){i(37),i(35),e.exports=i(134)},function(e,t,i){var r=i(13),n=i(77);e.exports=i(2).getIterator=function(e){var t=n(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return r(t.call(e))}},function(e,t,i){var r=i(2),n=r.JSON||(r.JSON={stringify:JSON.stringify});e.exports=function(e){return n.stringify.apply(n,arguments)}},function(e,t,i){e.exports={default:i(137),__esModule:!0}},function(e,t,i){i(39),i(35),i(37),i(138),i(143),i(144),e.exports=i(2).Promise},function(e,t,i){"use strict";var r,n,s,a,o=i(26),u=i(4),l=i(16),h=i(58),d=i(3),c=i(7),f=i(23),p=i(57),v=i(29),y=i(82),m=i(83).set,_=i(140)(),S=i(59),g=i(84),T=i(141),E=i(85),I=u.TypeError,P=u.process,R=P&&P.versions,k=R&&R.v8||"",L=u.Promise,A="process"==h(P),w=function(){},C=n=S.f,M=!!function(){try{var e=L.resolve(1),t=(e.constructor={})[i(6)("species")]=function(e){e(w,w)};return(A||"function"==typeof PromiseRejectionEvent)&&e.then(w)instanceof t&&0!==k.indexOf("6.6")&&-1===T.indexOf("Chrome/66")}catch(e){}}(),D=function(e){var t;return!(!c(e)||"function"!=typeof(t=e.then))&&t},b=function(e,t){if(!e._n){e._n=!0;var i=e._c;_((function(){for(var r=e._v,n=1==e._s,s=0,a=function(t){var i,s,a,o=n?t.ok:t.fail,u=t.resolve,l=t.reject,h=t.domain;try{o?(n||(2==e._h&&F(e),e._h=1),!0===o?i=r:(h&&h.enter(),i=o(r),h&&(h.exit(),a=!0)),i===t.promise?l(I("Promise-chain cycle")):(s=D(i))?s.call(i,u,l):u(i)):l(r)}catch(e){h&&!a&&h.exit(),l(e)}};i.length>s;)a(i[s++]);e._c=[],e._n=!1,t&&!e._h&&O(e)}))}},O=function(e){m.call(u,(function(){var t,i,r,n=e._v,s=N(e);if(s&&(t=g((function(){A?P.emit("unhandledRejection",n,e):(i=u.onunhandledrejection)?i({promise:e,reason:n}):(r=u.console)&&r.error&&r.error("Unhandled promise rejection",n)})),e._h=A||N(e)?2:1),e._a=void 0,s&&t.e)throw t.v}))},N=function(e){return 1!==e._h&&0===(e._a||e._c).length},F=function(e){m.call(u,(function(){var t;A?P.emit("rejectionHandled",e):(t=u.onrejectionhandled)&&t({promise:e,reason:e._v})}))},U=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),b(t,!0))},B=function e(t){var i,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===t)throw I("Promise can't be resolved itself");(i=D(t))?_((function(){var n={_w:r,_d:!1};try{i.call(t,l(e,n,1),l(U,n,1))}catch(t){U.call(n,t)}})):(r._v=t,r._s=1,b(r,!1))}catch(t){U.call({_w:r,_d:!1},t)}}};M||(L=function(e){p(this,L,"Promise","_h"),f(e),r.call(this);try{e(l(B,this,1),l(U,this,1))}catch(e){U.call(this,e)}},(r=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=i(56)(L.prototype,{then:function(e,t){var i=C(y(this,L));return i.ok="function"!=typeof e||e,i.fail="function"==typeof t&&t,i.domain=A?P.domain:void 0,this._c.push(i),this._a&&this._a.push(i),this._s&&b(this,!1),i.promise},catch:function(e){return this.then(void 0,e)}}),s=function(){var e=new r;this.promise=e,this.resolve=l(B,e,1),this.reject=l(U,e,1)},S.f=C=function(e){return e===L||e===a?new s(e):n(e)}),d(d.G+d.W+d.F*!M,{Promise:L}),i(28)(L,"Promise"),i(78)("Promise"),a=i(2).Promise,d(d.S+d.F*!M,"Promise",{reject:function(e){var t=C(this);return(0,t.reject)(e),t.promise}}),d(d.S+d.F*(o||!M),"Promise",{resolve:function(e){return E(o&&this===a?L:this,e)}}),d(d.S+d.F*!(M&&i(142)((function(e){L.all(e).catch(w)}))),"Promise",{all:function(e){var t=this,i=C(t),r=i.resolve,n=i.reject,s=g((function(){var i=[],s=0,a=1;v(e,!1,(function(e){var o=s++,u=!1;i.push(void 0),a++,t.resolve(e).then((function(e){u||(u=!0,i[o]=e,--a||r(i))}),n)})),--a||r(i)}));return s.e&&n(s.v),i.promise},race:function(e){var t=this,i=C(t),r=i.reject,n=g((function(){v(e,!1,(function(e){t.resolve(e).then(i.resolve,r)}))}));return n.e&&r(n.v),i.promise}})},function(e,t){e.exports=function(e,t,i){var r=void 0===i;switch(t.length){case 0:return r?e():e.call(i);case 1:return r?e(t[0]):e.call(i,t[0]);case 2:return r?e(t[0],t[1]):e.call(i,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(i,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(i,t[0],t[1],t[2],t[3])}return e.apply(i,t)}},function(e,t,i){var r=i(4),n=i(83).set,s=r.MutationObserver||r.WebKitMutationObserver,a=r.process,o=r.Promise,u="process"==i(25)(a);e.exports=function(){var e,t,i,l=function(){var r,n;for(u&&(r=a.domain)&&r.exit();e;){n=e.fn,e=e.next;try{n()}catch(r){throw e?i():t=void 0,r}}t=void 0,r&&r.enter()};if(u)i=function(){a.nextTick(l)};else if(!s||r.navigator&&r.navigator.standalone)if(o&&o.resolve){var h=o.resolve(void 0);i=function(){h.then(l)}}else i=function(){n.call(r,l)};else{var d=!0,c=document.createTextNode("");new s(l).observe(c,{characterData:!0}),i=function(){c.data=d=!d}}return function(r){var n={fn:r,next:void 0};t&&(t.next=n),e||(e=n,i()),t=n}}},function(e,t,i){var r=i(4).navigator;e.exports=r&&r.userAgent||""},function(e,t,i){var r=i(6)("iterator"),n=!1;try{var s=[7][r]();s.return=function(){n=!0},Array.from(s,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!n)return!1;var i=!1;try{var s=[7],a=s[r]();a.next=function(){return{done:i=!0}},s[r]=function(){return a},e(s)}catch(e){}return i}},function(e,t,i){"use strict";var r=i(3),n=i(2),s=i(4),a=i(82),o=i(85);r(r.P+r.R,"Promise",{finally:function(e){var t=a(this,n.Promise||s.Promise),i="function"==typeof e;return this.then(i?function(i){return o(t,e()).then((function(){return i}))}:e,i?function(i){return o(t,e()).then((function(){throw i}))}:e)}})},function(e,t,i){"use strict";var r=i(3),n=i(59),s=i(84);r(r.S,"Promise",{try:function(e){var t=n.f(this),i=s(e);return(i.e?t.reject:t.resolve)(i.v),t.promise}})},function(e,t,i){i(146);var r=i(2).Object;e.exports=function(e,t,i){return r.defineProperty(e,t,i)}},function(e,t,i){var r=i(3);r(r.S+r.F*!i(8),"Object",{defineProperty:i(12).f})},function(e,t,i){e.exports={default:i(148),__esModule:!0}},function(e,t,i){i(149),e.exports=i(2).Object.keys},function(e,t,i){var r=i(21),n=i(24);i(60)("keys",(function(){return function(e){return n(r(e))}}))},function(e,t,i){i(151),e.exports=i(2).Object.getPrototypeOf},function(e,t,i){var r=i(21),n=i(67);i(60)("getPrototypeOf",(function(){return function(e){return n(r(e))}}))},function(e,t,i){e.exports={default:i(153),__esModule:!0}},function(e,t,i){i(154),e.exports=i(2).Number.isNaN},function(e,t,i){var r=i(3);r(r.S,"Number",{isNaN:function(e){return e!=e}})},function(e,t,i){e.exports={default:i(156),__esModule:!0}},function(e,t,i){i(157);var r=i(2).Object;e.exports=function(e){return r.getOwnPropertyNames(e)}},function(e,t,i){i(60)("getOwnPropertyNames",(function(){return i(72).f}))},function(e,t,i){e.exports={default:i(159),__esModule:!0}},function(e,t,i){i(70),e.exports=i(2).Object.getOwnPropertySymbols},function(e,t,i){e.exports={default:i(161),__esModule:!0}},function(e,t,i){i(39),e.exports=i(38).f("toStringTag")},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=m(i(11)),n=m(i(0)),s=m(i(9)),a=m(i(1)),o=m(i(10)),u=i(14),l=m(i(163)),h=m(i(30)),d=m(i(40)),c=m(i(15)),f=m(i(5)),p=(m(i(174)),m(i(175))),v=m(i(88)),y=m(i(41));function m(e){return e&&e.__esModule?e:{default:e}}var _=!1,S=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:81;(0,n.default)(this,t);var i=(0,s.default)(this,(t.__proto__||(0,r.default)(t)).call(this)),a=Number(localStorage.channelLogLevel);return isNaN(a)||f.default.setLevel(a),i.playList=[],c.default.app=i,c.default.appId=e,localStorage.appId&&(c.default.appId=Number(localStorage.appId)),f.default.log("connect room"),i.channel=null,i.connectChannel(),i}return(0,o.default)(t,e),(0,a.default)(t,null,[{key:"Events",get:function(){return h.default}}]),(0,a.default)(t,[{key:"connectChannel",value:function(){var e=this;if(!this.channel){this.channel=new l.default(this,!0),y.default.setTaf(this.channel.tafHandler);var i=0,r=function(){++i>=2&&(_=!0,f.default.log("%HYSDK SERVER_INITED","background:#CEFFCE"),e.emit(h.default.SERVER_INITED))}.bind(this);this.channel.on(h.default.SERVER_LOGIN,r),this.channel.on(h.default.SERVER_CFG_INITED,(function(i){t.config=c.default.config;for(var r=0;r<e.playList.length;r++)e.playList[r]&&e.playList[r].setConfig(i)})),this.channel.on(h.default.UPDATE_STREAM_INFO,this.onUpdateStreamInfo.bind(this))}}},{key:"onUpdateStreamInfo",value:function(){}},{key:"setRoom",value:function(e){if(!this.isInited)throw new Error("[HYSDK.setRoom] Listen the SERVER_INITED event, and then call this method.");this.reset(),this.channel._sendWup(d.default.GET_STREAM_INFO_BY_ROOM,{roomId:e})}},{key:"createPlayer",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return c.default.deviceId=e,this.player||(this.player=new p.default(this,this.channel),t.tafHandler&&this.player.setTaf(t.tafHandler)),this.playList.push(this.player),this.player}},{key:"joinRoom",value:function(e){}},{key:"reset",value:function(){f.default.log("HYSDK.reset"),this.channel&&this.channel.reset()}},{key:"destroy",value:function(){this.channel&&(this.channel.dispose(),this.channel=null,y.default.setTaf(null))}},{key:"isInited",get:function(){return _}}]),t}(u.EventEmitter);t.default=S,window.HYSDK=S,S.PlayerEvents=v.default},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=g(i(11)),n=g(i(0)),s=g(i(1)),a=g(i(9)),o=g(i(10)),u=g(i(14)),l=g(i(15)),h=g(i(5)),d=g(i(164)),c=g(i(165)),f=g(i(87)),p=g(i(40)),v=g(i(61)),y=g(i(62)),m=g(i(30)),_=g(i(169)),S=g(i(172));function g(e){return e&&e.__esModule?e:{default:e}}var T=function(e){function t(e){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(0,n.default)(this,t);var s=(0,a.default)(this,(t.__proto__||(0,r.default)(t)).call(this));return s.tcpLink=new d.default,s.tcpLink.connect(),s.protoMgr=new c.default,s.mediaServ=new _.default(s),s.tafHandler=new S.default(s.tcpLink,l.default.appId),s.handler=e,s.needLogin=i,s.startRefreshCookie=!1,s.tickTimer=0,s.tickTimes=0,s._updateRoomStreamInfoTimer=0,s._isLogin=!1,s.addTick(),s.addEventListeners(),s}return(0,o.default)(t,e),(0,s.default)(t,[{key:"addTick",value:function(){this.removeTick(),this.tickTimes=0,this.tickTimer=setInterval(this.tick.bind(this),5e3)}},{key:"removeTick",value:function(){clearInterval(this.tickTimer)}},{key:"tick",value:function(){this.tickTimes++,this.tcpLink.onTimer(),this.tickTimes%12&&this.tcpLink.send(this.protoMgr.getHeartBeat()),this.startRefreshCookie&&this.tickTimes%12==0&&this._sendWup(p.default.REFRESH_COOKIE)}},{key:"addEventListeners",value:function(){this.tcpLink&&(this.tcpLink.on(v.default.TCP_OPEN,this.serverOpen.bind(this)),this.tcpLink.on(v.default.TCP_CLOSE,this.serverClose.bind(this)),this.tcpLink.on(v.default.TCP_ERROR,this.serverError.bind(this)),this.tcpLink.on(v.default.TCP_MESSAGE,this.serverMessage.bind(this))),this.protoMgr&&this.protoMgr.on(y.default.TAF_DECODE_SUCCESS,this.onPortoDecoded.bind(this))}},{key:"removeEventListeners",value:function(){this.tcpLink&&this.tcpLink.removeAllListeners(),this.protoMgr&&this.protoMgr.removeAllListeners()}},{key:"loginVerify",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.hasOwnProperty("sToken")&&(l.default.sToken=e.sToken),e.hasOwnProperty("uid")&&(l.default.MediaUid=e.uid),h.default.log("HYChannel.loginVerify isLogin="+this._isLogin+" hasToken="+(""!==l.default.sToken)),this.needLogin&&!this._isLogin&&this.tcpLink.connected&&""!==l.default.sToken&&this._sendWup(p.default.LOGIN_VERIFY)}},{key:"serverOpen",value:function(e){h.default.log("HYChannel.serverOpen "),this.loginVerify(),this._sendWup(p.default.GET_MEDIA_CONFIG),this.emit(m.default.SERVER_OPEN),this.tafHandler.serverOpen()}},{key:"serverClose",value:function(e){this._isLogin=!1,this.tafHandler.dispatch(m.default.WEBSOCKET_CLOSED),this.emit(m.default.SERVER_CLOSE)}},{key:"serverError",value:function(e){this.tafHandler.dispatch(m.default.WEBSOCKET_ERROR),this.emit(m.default.SERVER_ERROR)}},{key:"serverMessage",value:function(e){this.protoMgr.decode(e)}},{key:"onPortoDecoded",value:function(e){this.mediaServ.onPortoDecoded(e),this.tafHandler.dispatch(e.uri,e.data,e.requestId),this.emit(e.uri,e.data,e.requestId)}},{key:"onServerLogin",value:function(){this._isLogin=!0,this.startRefreshCookie=!0,this.roomId&&this.getStreamInfoByRoom(this.roomId,-1)}},{key:"onMediaConfigUpdate",value:function(e){this.emit(m.default.SERVER_CFG_INITED,{config:e})}},{key:"onGetStreamInfoByRoom",value:function(e){this.emit(m.default.UPDATE_STREAM_INFO,{liveStreams:e})}},{key:"sendJoinRoom",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];h.default.log("HYChannel.sendJoinRoom roomId="+e,t),this.roomId=e,this.needSubscribeRoom=!!i,this.mediaServ.setRoomId(this.roomId),this.isLogin?this.getStreamInfoByRoom(this.roomId,t):i&&this.getStreamInfoByRoomFake(this.roomId)}},{key:"sendQuitRoom",value:function(e){this.mediaServ.quitGroups(e)}},{key:"getStreamInfoByRoom",value:function(e,t){h.default.log("HYChannel.getStreamInfoByRoom roomId="+e+"  mediaPackType="+t),this._sendWup(p.default.GET_STREAM_INFO_BY_ROOM,{roomId:e,mediaPackType:t})}},{key:"getStreamInfoByRoomFake",value:function(e){h.default.log("HYChannel.getStreamInfoByRoomFake roomId="+e),this._sendWupHttp(p.default.GET_STREAM_INFO_BY_ROOM_FAKE,{roomId:e},this.getStreamInfoByRoomFakeFail.bind(this))}},{key:"getStreamInfoByRoomFakeFail",value:function(){this.isLogin||this.emit(m.default.UPDATE_STREAM_INFO_FAIL)}},{key:"setRoomStreamInfo",value:function(e,t){this.needSubscribeRoom=!0,this.mediaServ.setRoomId(e),this.mediaServ.onGetStreamInfoByRoom(t)}},{key:"quitRoom",value:function(e){return this.roomId==e&&(this.roomId=0,!0)}},{key:"_sendWup",value:function(e,t){var i=this.protoMgr.getProto(e,t);i&&this.tcpLink.send(i)}},{key:"_sendWupHttp",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=this.protoMgr.getHttpProto(e,t);this.tafHandler.sendHttpWup(r,this.onRespone.bind(this),i)}},{key:"onRespone",value:function(e){this.protoMgr.decodeHttpValue(e)}},{key:"roomStreamChangeNotice",value:function(e){h.default.log("HYChannel.roomStreamChangeNotice roomId="+e.sRoomId+"  delay="+e.iDelay);var t=e.iDelay;this._startUpdateRoomSteamInfo(t+1e3)}},{key:"mediaStopStreamNotice",value:function(){this.emit(m.default.MEDIA_STOPSTREAM_NOTICE)}},{key:"_startUpdateRoomSteamInfo",value:function(e){clearTimeout(this._updateRoomStreamInfoTimer),this._updateRoomStreamInfoTimer=setTimeout(this._onUpdateRoomStreamInfoTime.bind(this),e)}},{key:"_stopUpdateRoomStreamInfo",value:function(){clearTimeout(this._updateRoomStreamInfoTimer)}},{key:"_onUpdateRoomStreamInfoTime",value:function(){this.sendJoinRoom(this.roomId,f.default.kMediaPackTypeRoomStreamChangeNotice),this.emit(m.default.MEDIA_STREAMCHANGED_NOTICE)}},{key:"emitOut",value:function(e,t,i){this.emit(e,t,i)}},{key:"reset",value:function(){h.default.log("HYChannel.reset"),this.mediaServ.reset()}},{key:"dispose",value:function(){h.default.log("HYChannel.dispose"),this.removeTick(),this.removeEventListeners(),this.tcpLink&&(this.tcpLink.close(),this.tcpLink=null),this.mediaServ.reset()}},{key:"isLogin",get:function(){return this._isLogin}},{key:"isCfgInited",get:function(){return this.mediaServ.isCfgInited}}]),t}(u.default);t.default=T},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=f(i(11)),n=f(i(0)),s=f(i(1)),a=f(i(9)),o=f(i(10)),u=f(i(22)),l=f(i(5)),h=i(14),d=f(i(61)),c=f(i(15));function f(e){return e&&e.__esModule?e:{default:e}}var p={},v=function(e){function t(){(0,n.default)(this,t);var e=(0,a.default)(this,(t.__proto__||(0,r.default)(t)).call(this));return e.url="",e.socket=null,e.connected=!1,e.connecting=!1,e.connectTime=0,e.reConnectTimes=0,e.initWebsocketList(),e}return(0,o.default)(t,e),(0,s.default)(t,[{key:"initWebsocketList",value:function(){p[80]="testws.master.live",p[81]="wsapi.master.live"}},{key:"onTimer",value:function(){if(!this.connected){var e=Date.now();if(0==this.connectTime)this.connect();else{var t=this.reConnectTimes<3?3e3:5e3;e-this.connectTime>t&&(this.reConnectTimes++,this.connecting=!1,this.connect())}}}},{key:"send",value:function(e){this.socket&&this.connected&&this.socket.send(e)}},{key:"connect",value:function(){if(!this.connected&&!this.connecting){this.connecting=!0,this.connectTime=Date.now();try{l.default.log("Global.appId="+c.default.appId),p[c.default.appId]?this.url="wss://"+p[c.default.appId]:this.url="wss://wsapi.master.live",this.releaseWs(),this.socket=new WebSocket(this.url),this.socket.onopen=this.onopen.bind(this),this.socket.onclose=this.onclose.bind(this),this.socket.onerror=this.onerror.bind(this),this.socket.onmessage=this.onmessage.bind(this)}catch(e){}l.default.info("%cTAF connecting "+this.url,u.default.logcss("#0000E3"))}}},{key:"close",value:function(){this.releaseWs(),this.connected=!1,this.connecting=!1}},{key:"releaseWs",value:function(){if(this.socket){var e=this.socket;l.default.info("%crelease "+this.url,u.default.logcss("#AE8F00")),e.onopen=e.onclose=e.onerror=e.onmessage=void 0;try{e.close()}catch(e){}this.socket=e=null}}},{key:"dispose",value:function(){this.close(),this.connectTime=0,this.reConnectTimes=0}},{key:"onopen",value:function(){l.default.log("%cTAF connected "+this.url,u.default.logcss("#060")),this.connected=!0,this.connecting=!1,this.reConnectTimes=0,this.emit(d.default.TCP_OPEN,this.url)}},{key:"onclose",value:function(){this.close(),this.emit(d.default.TCP_CLOSE,this.url)}},{key:"onerror",value:function(){this.close(),this.emit(d.default.TCP_ERROR,this.url)}},{key:"onmessage",value:function(e){8!=e.data.size&&l.default.log("pkg.data size="+e.data.size),this.emit(d.default.TCP_MESSAGE,e.data)}}]),t}(h.EventEmitter);t.default=v},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=v(i(11)),n=v(i(0)),s=v(i(1)),a=v(i(9)),o=v(i(10)),u=i(14),l=v(i(166)),h=v(i(167)),d=(v(i(61)),v(i(62))),c=v(i(168)),f=v(i(22)),p=v(i(5));function v(e){return e&&e.__esModule?e:{default:e}}var y=!!Number(localStorage._printProtocol),m=function(e){function t(){(0,n.default)(this,t);var e=(0,a.default)(this,(t.__proto__||(0,r.default)(t)).call(this));return e.protoEncoder=new l.default,e.protoDecoder=new h.default,e.protoRequests=new c.default,e.protoDecoder.on(d.default.TAF_DECODE_SUCCESS,e.onPortoDecoded.bind(e)),e}return(0,o.default)(t,e),(0,s.default)(t,[{key:"getHeartBeat",value:function(){return this.protoRequests.getHeartBeat()}},{key:"getProto",value:function(e,t){var i=this.protoRequests.getRequest(e,t);return i?(y&&!TafMx.NoLog[i.funcName]&&p.default.log("%c>>>>>>> %creqWup: %c"+i.servantName+" %c"+i.funcName,f.default.logcss("#009100"),f.default.logcss("black"),f.default.logcss("#AE00AE"),f.default.logcss("#009100"),i.data),this.encode(i)):(p.default.warn("Request error, can't get "+e+" pkg."),null)}},{key:"getHttpProto",value:function(e,t){var i=this.protoRequests.getHttpRequest(e,t),r=new Taf.Wup;return r.setServant(i.servantName),r.setFunc(i.funcName),r.setRequestId(i.requestId),r.writeStruct("tReq",i.req),r.encode().getBuffer()}},{key:"decode",value:function(e){this.protoDecoder.decode(e)}},{key:"decodeHttpValue",value:function(e){this.protoDecoder.decodeHttpTaf(e)}},{key:"encode",value:function(e){var t=e.servantName,i=e.funcName,r=e.data,n=e.requestId;return this.protoEncoder.encode(t,i,r,n)}},{key:"onPortoDecoded",value:function(e){this.emit(d.default.TAF_DECODE_SUCCESS,e)}}]),t}(u.EventEmitter);t.default=m},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=u(i(11)),n=u(i(0)),s=u(i(1)),a=u(i(9)),o=u(i(10));function u(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){return(0,n.default)(this,t),(0,a.default)(this,(t.__proto__||(0,r.default)(t)).call(this))}return(0,o.default)(t,e),(0,s.default)(t,[{key:"encode",value:function(e,t,i,r){var n=new Taf.Wup;n.setServant(e),n.setFunc(t),n.writeStruct("tReq",i),n.setRequestId(r);var s=new HUYA.WebSocketCommand;s.iCmdType=HUYA.EWebSocketCommandType.EWSCmd_WupReq,s.vData=n.encode();var a=new Taf.JceOutputStream;return s.writeTo(a),a.getBuffer()}}]),t}(i(14).EventEmitter);t.default=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=c(i(11)),n=c(i(0)),s=c(i(1)),a=c(i(9)),o=c(i(10)),u=i(14),l=c(i(5)),h=c(i(22)),d=c(i(62));function c(e){return e&&e.__esModule?e:{default:e}}var f=!!Number(localStorage._printProtocol),p=!!Number(localStorage._printProtocolWarn),v=!!Number(localStorage._printGateway),y=function(e){function t(){return(0,n.default)(this,t),(0,a.default)(this,(t.__proto__||(0,r.default)(t)).call(this))}return(0,o.default)(t,e),(0,s.default)(t,[{key:"decode",value:function(e){var t=new FileReader;t.onload=this.decodeTaf.bind(this),t.readAsArrayBuffer(e)}},{key:"decodeHttpTaf",value:function(e){var t=new Taf.Wup;t.decode(e),l.default.log("ProtoDecoder.decodeHttpTaf","funcName="+t.sFuncName);var i=this._getWupKey(t);if(i)if(TafMx.WupMapping[t.sFuncName]){var r=TafMx.WupMapping[t.sFuncName],n=new r;t.readStruct(i,n,r),this.dispatch(t.sFuncName,n)}else l.default.log("ProtoDecoder.decodeHttpTaf 收到未映射的 WupRsp sFuncName="+t.sFuncName)}},{key:"decodeTaf",value:function(e){var t=e.currentTarget.result;this.decodeTafBuffer(t)}},{key:"decodeTafBuffer",value:function(e){localStorage.__wup>1&&Taf.Util.jcestream(e,32);var t=new Taf.JceInputStream(e),i=new HUYA.WebSocketCommand;switch(i.readFrom(t),i.iCmdType){case HUYA.EWebSocketCommandType.EWSCmd_RegisterRsp:t=new Taf.JceInputStream(i.vData.buffer);var r=new HUYA.WSRegisterRsp;r.readFrom(t),f&&l.default.log("%c<<<<<<< %crspRegister",h.default.logcss("#0000E3"),h.default.logcss("#D9006C"),r),this.dispatch("WSRegisterRsp",r);break;case HUYA.EWebSocketCommandType.EWSCmdS2C_RegisterGroupRsp:t=new Taf.JceInputStream(i.vData.buffer);var n=new HUYA.WSRegisterGroupRsp;n.readFrom(t),f&&l.default.log("%c<<<<<<< %crspRegisterGroup",h.default.logcss("#0000E3"),h.default.logcss("#D9006C"),n),this.dispatch("WSRegisterGroupRsp",n);break;case HUYA.EWebSocketCommandType.EWSCmdS2C_UnRegisterGroupRsp:t=new Taf.JceInputStream(i.vData.buffer);var s=new HUYA.WSUnRegisterGroupRsp;s.readFrom(t),f&&l.default.log("%c<<<<<<< %crspUnRegisterGroup",h.default.logcss("#0000E3"),h.default.logcss("#D9006C"),s),this.dispatch("WSUnRegisterGroupRsp",s);break;case HUYA.EWebSocketCommandType.EWSCmd_WupRsp:var a=new Taf.Wup;a.decode(i.vData.buffer);var o=TafMx.WupMapping[a.sFuncName];if(o){var u=this._getWupKey(a);if(!u)return;var d=new o;a.readStruct(u,d,o);var c=v||"videogateway"!=a.sServantName.toLowerCase();f&&!TafMx.NoLog[a.sFuncName]&&c&&l.default.log("%c<<<<<<< %crspWup:%c "+a.sServantName+" %c"+a.sFuncName,h.default.logcss("#0000E3"),h.default.logcss("black"),h.default.logcss("#AE00AE"),h.default.logcss("#0000E3"),d),this.dispatch(a.sFuncName,d,a.iRequestId)}else p&&!TafMx.NoLog[a.sFuncName]&&l.default.info("收到未映射的 WupRsp sFuncName="+a.sFuncName),this.dispatch(a.sFuncName);break;case HUYA.EWebSocketCommandType.EWSCmdS2C_MsgPushReq:t=new Taf.JceInputStream(i.vData.buffer);var y=new HUYA.WSPushMessage;y.readFrom(t);var m=y.iUri;t=new Taf.JceInputStream(y.sMsg.buffer);var _=TafMx.UriMapping[m]||TafMx.UriMapping[m+""];if(_){var S=new _;S.readFrom(t),f&&!TafMx.NoLog[m]&&l.default.log("%c<<<<<<< %crspMsgPush, %ciUri="+m,h.default.logcss("#0000E3"),h.default.logcss("black"),h.default.logcss("#8600FF"),S),this.dispatch(m,S)}else p&&l.default.info("收到未映射的 WSPushMessage uri="+m);break;case HUYA.EWebSocketCommandType.EWSCmdS2C_MsgPushReq_V2:t=new Taf.JceInputStream(i.vData.buffer);var g=new HUYA.WSPushMessage_V2;g.readFrom(t);for(var T=0,E=g.vMsgItem.value.length;T<E;T++){var I=g.vMsgItem.value[T],P=I.iUri,R=TafMx.UriMapping[P]||TafMx.UriMapping[P+""];if(R){var k=new R,L=new Taf.JceInputStream(I.sMsg);k.readFrom(L),f&&!TafMx.NoLog[P]&&l.default.log("%c<<<<<<< %crspMsgPushV2, %ciUri="+P,h.default.logcss("#0000E3"),h.default.logcss("black"),h.default.logcss("#8600FF"),k),this.dispatch(P,k)}else p&&l.default.info("收到未映射的 WSPushMessage_V2 uri="+P)}break;case HUYA.EWebSocketCommandType.EWSCmdS2C_HeartBeatAck:case HUYA.EWebSocketCommandType.EWSCmdS2C_HeartBeatRsp:break;case HUYA.EWebSocketCommandType.EWSCmdS2C_VerifyCookieRsp:t=new Taf.JceInputStream(i.vData.buffer);var A=new HUYA.WSVerifyCookieRsp;A.readFrom(t);var w=0==A.iValidate;f&&l.default.log("%c<<<<<<< %cVerifyCookie",h.default.logcss("#0000E3"),h.default.logcss("#D9006C"),"校验"+(w?"通过！":"失败！"),A),this.dispatch("VerifyCookie",A);break;default:l.default.log("%c<<<<<<< Not matched CmdType: "+i.iCmdType,h.default.logcss("#red"))}}},{key:"dispatch",value:function(e,t,i){this.emit(d.default.TAF_DECODE_SUCCESS,{uri:e,data:t,requestId:i})}},{key:"_getWupKey",value:function(e){if(!e)return!1;var t="";if(3===e.iVersion)t=e.newdata.get("tRsp")?"tRsp":"tResp";else if(e.data)for(var i in e.data.value){t=i,l.default.warn("Try to decode wup with key "+t);break}return""===t?(l.default.error("Error wup",e),!1):t}}]),t}(u.EventEmitter);t.default=y},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(i(0)),n=o(i(1)),s=o(i(40)),a=(o(i(22)),o(i(15)));function o(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(){(0,r.default)(this,e)}return(0,n.default)(e,[{key:"getRequest",value:function(e,t){switch(e){case s.default.CHECK_ID_BY_STR:return(i=new HUYA.CheckUidByStrReq).iAppid=a.default.appId,i.sUid=a.default.sUid,this.setRequestData("mediauisea",e,i);case s.default.LOGIN_VERIFY:return(i=new HUYA.LoginVerifyReq).tId=a.default.getMediaUserId(),this.setRequestData("mediauisea",e,i);case s.default.REFRESH_COOKIE:return(i=new HUYA.RefreshCookieReq).tId=a.default.getMediaUserId(),this.setRequestData("mediauisea",e,i);case s.default.GET_MEDIA_CONFIG:var i=new HUYA.GetMediaConfigReq;for(var r in i.tId=a.default.getMediaUserId(),t)i.mpVariable.put(r,t[r]);return this.setRequestData("mediauisea",e,i);case s.default.JOIN_GROUP:return(i=new HUYA.JoinMediaGroupReq).tId=a.default.getMediaUserId(),i.vGroupId.value=t.groupIds,this.setRequestData("mediauisea",e,i);case s.default.QUIT_GROUP:return(i=new HUYA.QuitMediaGroupReq).tId=a.default.getMediaUserId(),i.vGroupId.value=t.groupIds,this.setRequestData("mediauisea",e,i);case s.default.GET_STREAM_INFO_BY_ROOM:return(i=new HUYA.GetStreamInfoByRoomReq).tId=a.default.getMediaUserId(),i.sRoomId=t.roomId,t.mediaPackType?i.iMediaPackType=t.mediaPackType:i.iMediaPackType=-1,this.setRequestData("mediauisea",e,i);case s.default.GET_STREAM_INFO_BY_ROOM_FAKE:return(i=new HUYA.GetStreamInfoByRoomFakeReq).tId=a.default.getMediaUserId(),i.sRoomId=t.roomId,this.setRequestData("mediauisea",e,i)}}},{key:"getHttpRequest",value:function(e,t){switch(e){case s.default.GET_STREAM_INFO_BY_ROOM_FAKE:var i=new HUYA.GetStreamInfoByRoomFakeReq;return i.tId=a.default.getMediaUserId(),i.sRoomId=t.roomId,{servantName:"mediauisea",funcName:e,req:i,requestId:0}}}},{key:"getHeartBeat",value:function(){var e=new HUYA.WebSocketCommand;e.iCmdType=HUYA.EWebSocketCommandType.EWSCmdC2S_HeartBeatReq;var t=new Taf.JceOutputStream;return e.writeTo(t),t.getBuffer()}},{key:"setRequestData",value:function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1234,n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return{servantName:e,funcName:t,data:i,requestId:r,recode:n}}}]),e}();t.default=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=p(i(11)),n=p(i(0)),s=p(i(1)),a=p(i(9)),o=p(i(10)),u=p(i(5)),l=(p(i(22)),p(i(15))),h=p(i(30)),d=p(i(40)),c=p(i(87)),f=p(i(170));function p(e){return e&&e.__esModule?e:{default:e}}var v=function(e){function t(e){(0,n.default)(this,t);var i=(0,a.default)(this,(t.__proto__||(0,r.default)(t)).call(this));return i.channel=e,i.room=new f.default(i),i.isLogin=!0,i.isCfgInited=!0,i.loginTimes=0,i.listeningGroupIds=null,i}return(0,o.default)(t,e),(0,s.default)(t,[{key:"onPortoDecoded",value:function(e){switch(e.uri){case d.default.CHECK_ID_BY_STR:break;case d.default.LOGIN_VERIFY:this.onLoginVerify(e.data);break;case d.default.REFRESH_COOKIE:this.onRefreshCookie(e.data);break;case d.default.GET_MEDIA_CONFIG:this.onConfig(e.data);break;case d.default.GET_STREAM_INFO_BY_ROOM:this.onGetStreamInfoByRoom(e.data);break;case d.default.GET_STREAM_INFO_BY_ROOM_FAKE:this.onGetStreamInfoByRoomFake(e.data);break;case d.default.JOIN_GROUP:this.onJoinGroup(e.data);break;case d.default.QUIT_GROUP:this.onQuitGroup(e.data);break;case c.default.kMediaPackTypeStreamChangeNotice:case c.default.kMediaPackTypeMediaStopStream:break;case c.default.kMediaPackTypeRoomStreamChangeNotice:this.channel.roomStreamChangeNotice(e.data)}}},{key:"onLoginVerify",value:function(e){this.loginTimes++,u.default.log("MediaServ.onLoginVerify login resp."),0!=e.lUid&&(l.default.MediaUid=e.lUid),l.default.sCookie=e.sCookie,0==e.iResCode?(this.isLogin=!0,u.default.log("MediaServ.onLoginVerify login success."),this.channel._sendWup(d.default.GET_MEDIA_CONFIG),this.channel.tafHandler.dispatch(h.default.WEBSOCKET_CONNECTED),this.channel.onServerLogin()):(u.default.warn("MediaServ.onLoginVerify login failded. iResCode="+e.iResCode),1==e.iResCode&&(l.default.bAnonymous=1,this.channel._sendWup(d.default.LOGIN_VERIFY)))}},{key:"onRefreshCookie",value:function(e){l.default.sCookie=e.sCookie,u.default.log("MediaServ.onRefreshCookie iResCode",e.iResCode,e.sCookie)}},{key:"onConfig",value:function(e){l.default.config=e.mpConfig.value,this.isCfgInited=!0,this.channel.onMediaConfigUpdate(e.mpConfig.value),u.default.log("MediaServ.onConfig getConfig success.",l.default.config)}},{key:"onGetStreamInfoByRoom",value:function(e){u.default.log("MediaServ.onGetStreamInfoByRoom "),this.room.sRoomId==e.sRoomId?(this.room.sRoomGroupId=e.sRoomGroupId,this.room.updateMediaStream(e.tStreamInfoPack,!0)):""===e.sRoomId&&""!==this.room.sRoomId&&this.channel.getStreamInfoByRoomFake(this.room.sRoomId)}},{key:"onGetStreamInfoByRoomFake",value:function(e){u.default.log("MediaServ.onGetStreamInfoByRoomFake "),this.room.sRoomGroupId=e.sRoomGroupId,this.room.updateMediaStream(e.tStreamInfoPack,!0)}},{key:"onJoinGroup",value:function(e){0!=e.iCode&&u.default.warn("MediaServ.onJoinGroup",e.sMsg)}},{key:"onQuitGroup",value:function(e){0!=e.iCode&&u.default.warn("MediaServ.onQuitGroup",sMsg)}},{key:"onMediaBeginLiveNotice",value:function(e){var t=e.tLiveInfo;u.default.log("MediaServ.onMediaBeginLiveNotice sRoomId="+t.sRoomId),t.sRoomId==this.room.sRoomId?this.room.updateMediaStream(t.tStreamInfoPack):u.default.warn("MediaServ.onMediaBeginLiveNotice another room "+t.sRoomId+", exist room "+this.room.sRoomId)}},{key:"onMediaEndLiveNotice",value:function(e){u.default.log("MediaServ.onMediaEndLiveNotice sRoomId="+e.sRoomId,e.sReason),e.sRoomId==this.room.sRoomId?this.emit(h.default.ROOM_LIVE_END,e.sRoomId):u.default.warn("MediaServ.onMediaEndLiveNotice another room "+e.sRoomId+", exist room "+this.room.sRoomId)}},{key:"onUpdateSteramInfo",value:function(e){u.default.log("onUpdateSteramInfo",e),this.channel.onGetStreamInfoByRoom(e)}},{key:"joinGroups",value:function(e){u.default.log("MediaServ.joinGroups",e.join(",")),this.listeningGroupIds=e,this.channel._sendWup(d.default.JOIN_GROUP,{groupIds:e})}},{key:"setRoomId",value:function(e){this.room.sRoomId=e}},{key:"getMediaConfig",value:function(){this.channel._sendWup(d.default.GET_MEDIA_CONFIG)}},{key:"quitGroups",value:function(e){u.default.log("MediaServ.quitGroups",e.join(",")),this.channel._sendWup(d.default.QUIT_GROUP,{groupIds:e})}},{key:"reset",value:function(){u.default.log("MediaServ.reset"),this.listeningGroupIds&&(this.quitGroups(this.listeningGroupIds),this.listeningGroupIds=null)}}]),t}(i(14).EventEmitter);t.default=v},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(i(0)),n=o(i(1)),s=o(i(5)),a=(o(i(15)),o(i(171)));function o(e){return e&&e.__esModule?e:{default:e}}o(i(30));var u=function(){function e(t){(0,r.default)(this,e),this.mediaServ=t,this.sRoomId="",this.sRoomGroupId=""}return(0,n.default)(e,[{key:"updateMediaStream",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var t=e.mMediaStreamInfoPack.value,i=[];this.sRoomGroupId&&i.push(this.sRoomGroupId);var r={streams:{}};for(var n in r.vproto=e.mMediaStreamInfoPack.vproto,t){var o=t[n];if(o.iStreamType!==HUYA.EMediaStreamType.EMST_HUYA_UDP||o.iStreamProperty!==HUYA.EMediaStreamProperty.EOriginalStream){i.push(o.sStreamGroupId);for(var u=[],l=o.vMediaStreamInfo.value,h=0;h<l.length;h++){var d=l[h];d.iLineIndex<1||4==d.iLineIndex||0!==d.mMediaStreamFormatInfo.size()&&u.push(d)}if(u.length>0){u.sort((function(e,t){return e.iLineIndex-t.iLineIndex}));var c=new a.default;c.streamName=n,c.lLiveCompatibleFlag=o.lLiveCompatibleFlag,c.lStreamId=o.lStreamId,c.sAntiCode=o.sAntiCode,c.iWebDefaultBitRate=o.iWebDefaultBitRate,c.vStreamGearInfo=o.vStreamGearInfo.value,c.vMediaStreamInfo=u,c.iStreamProperty=o.iStreamProperty,c.iBitRate=o.iBitRate,c.iStreamType=o.iStreamType,c.sAdditionalParam=o.sAdditionalParam,c.lUid=o.lUid,r.streams[n]=c,c.vStreamGearInfo=c.vStreamGearInfo.filter((function(e,t,i){return"auto"!==e.sDisplayName}),this),c.vStreamGearInfo.sort((function(e,t){return 0==e.iBitRate?-1:0==t.iBitRate?1:t.iBitRate-e.iBitRate}))}}}var f=[];for(var p in r)f.push("\t"+p+"    ");s.default.log("Room.updateMediaStream liveStreams:\n%c"+f.join("\n"),"background:#FFBFFF"),f.length,this.mediaServ.onUpdateSteramInfo(r)}},{key:"onMediaStopStreamNotice",value:function(e){}},{key:"onRoomStreamChangeNotic",value:function(e){}}]),e}();t.default=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a(i(0)),n=a(i(1)),s=a(i(5));function a(e){return e&&e.__esModule?e:{default:e}}var o=function(){function e(){(0,r.default)(this,e),this.streamName="",this.lLiveCompatibleFlag=0,this.lStreamId=0,this.sAntiCode="",this.vStreamGearInfo=null,this.vMediaStreamInfo=null,this.lUid=0}return(0,n.default)(e,[{key:"getLineInfo",value:function(e){var t=this.vMediaStreamInfo;if(t){for(var i=0;i<t.length;i++){var r=t[i];if(r.iLineIndex==Number(e))return r}return null}s.default.warn("StreamInfo.getLineInfo streamInfo=null")}}]),e}();t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=u(i(0)),n=u(i(1)),s=u(i(15)),a=u(i(5)),o=u(i(173));function u(e){return e&&e.__esModule?e:{default:e}}var l=window.TafMx||{},h=Number(localStorage._printProtocol),d=function(){function e(t,i){(0,r.default)(this,e),this.tcpLink=t,this.appid=i,this.listener=new o.default,this.wupDataList=[],this.wupLinkList={},this.initWupLinkList()}return(0,n.default)(e,[{key:"initWupLinkList",value:function(){this.wupLinkList[80]="//testws.master.live",this.wupLinkList[81]="//wsapi.master.live"}},{key:"serverOpen",value:function(){}},{key:"getUserId",value:function(){return s.default.getUserId()}},{key:"getMediaUserId",value:function(){return s.default.getMediaUserId()}},{key:"sendWup",value:function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(h&&!l.NoLog[t]&&a.default.log("%c>>>>>>> %creqWup: %c"+t,c("#009100"),c("black"),c("#009100"),e,i),this.connected||s){var o=new Taf.Wup;if(o.setServant(e),o.setFunc(t),o.writeStruct("tReq",i),null==n&&(n=-1),o.setRequestId(n),s){var u=o.encode().getBuffer();Taf.Util.ajax("https://statwup.master.live",u,(function(e){a.default.log("======= http stat success.")}),(function(e){a.default.warn("======= http stat failed.",e)}))}else{var d=new HUYA.WebSocketCommand;d.iCmdType=HUYA.EWebSocketCommandType.EWSCmd_WupReq,d.vData=o.encode();var f=new Taf.JceOutputStream;d.writeTo(f),this.tcpLink.send(f.getBuffer())}}else this.wupDataList.push({servantName:e,funcName:t,data:i,ticket:r,iRequestId:n})}},{key:"sendHttpWup",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Taf.Util.ajax(this.wupLinkList[this.appid]?this.wupLinkList[this.appid]:"//wup.huya.com",e,t,(function(e){a.default.log("TafHandler.sendHttpWup fail status="+e),null!==i&&i()}))}},{key:"sendWup2",value:function(e,t,i,r){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;this.addListener(t,r,null,0,!0),this.sendWup(e,t,i,null,n)}},{key:"addListener",value:function(e,t,i,r){var n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.listener.on(e,t,i,r,n)}},{key:"removeListener",value:function(e,t,i){this.listener.off(e,t,i)}},{key:"dispatch",value:function(e,t,i){this.listener.trigger(e,t,i)}},{key:"reset",value:function(){this.listener.clear()}},{key:"packVGInfo",value:function(e,t,i){var r=new HUYA.GetInfoFromVGMReq;return r.tId=s.default.getMediaUserId(),r.iUri=e,t&&"function"==typeof t.marshall&&(r.sMsg=new Taf.BinBuffer(t.marshall().buffer)),r.sProtoName="yy",i&&"string"==typeof i&&(r.vStreamName.value=i.split("")),r.iTypeFlag=1,r}},{key:"connected",get:function(){return this.tcpLink.connected}}]),e}();function c(e,t,i){var r="font-weight:900";return e&&(r+=";color:"+e),t&&(r+=";background:"+t),i&&(r+=";border:3px solid "+i),r}t.default=d},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a(i(0)),n=a(i(1)),s=a(i(5));function a(e){return e&&e.__esModule?e:{default:e}}var o=function(){function e(){(0,r.default)(this,e),this.listeners={}}return(0,n.default)(e,[{key:"has",value:function(e,t,i){var r=this.listeners[e];if(!r)return!1;for(var n=0,s=r.length;n<s;n++){var a=r[n];if(a.callback==t&&a.thisObj==i)return!0}return!1}},{key:"on",value:function(e,t,i,r){var n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!this.has(e,t,i)){var s=this.listeners[e]||[];s.push({once:n,priority:r||0,callback:t,thisObj:i,bindCallback:i&&t?t.bind(i):t}),s.sort((function(e,t){return t.priority-e.priority})),this.listeners[e]=s}}},{key:"once",value:function(e,t,i,r){this.on(e,t,i,r,!0)}},{key:"off",value:function(e,t,i){var r=this.listeners[e];if(r)for(var n=r.length-1;n>=0;n--){var s=r[n];if(s.callback==t&&s.thisObj==i)return void r.splice(n,1)}}},{key:"clear",value:function(){this.listeners={}}},{key:"trigger",value:function(e,t,i){var r=this.listeners[e];if(r){r.forEach((function(r){var n=r.bindCallback;"function"==typeof n?n(t,i):s.default.warn("logger.trigger uri="+e+" callback=undefined",r)}));for(var n=r.length-1;n>=0;n--)r[n].once&&r.splice(n,1)}}}]),e}();t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a(i(0)),n=a(i(1)),s=a(i(5));function a(e){return e&&e.__esModule?e:{default:e}}var o=function(){function e(){(0,r.default)(this,e),this.libLoaded=!1,this.callback=null}return(0,n.default)(e,[{key:"load",value:function(e,t){this.callback=t;var i=document.createElement("script");i.type="text/javaScript",i.onload=this.SDKLibLoaded.bind(this),i.src=e,document.getElementsByTagName("head")[0].appendChild(i)}},{key:"SDKLibLoaded",value:function(){this.libLoaded=!0,"function"==typeof this.callback&&(s.default.log("SDKLibLoaded"),this.callback())}}]),e}();t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=E(i(81)),n=E(i(11)),s=E(i(0)),a=E(i(1)),o=E(i(9)),u=E(i(10)),l=i(14),h=E(i(88)),d=E(i(30)),c=E(i(5)),f=E(i(176)),p=E(i(177)),v=E(i(179)),y=E(i(180)),m=E(i(184)),_=E(i(15)),S=E(i(185)),g=E(i(89)),T=E(i(41));function E(e){return e&&e.__esModule?e:{default:e}}var I=function(e){function t(e,i){(0,s.default)(this,t);var r=(0,o.default)(this,(t.__proto__||(0,n.default)(t)).call(this));return r.handler=e,r.hyplayer=null,r.mp4player=null,r.player=null,r.playingPlayerType=null,r.mediaTypeRecorded="",r.Events=h.default,r.tafHandler=null,r.requestList=[],r.videoType="",r.isLive=!0,r.pid=0,r.config=null,r.parsedanmu=!1,r.videoplayLateSendLog=!1,r.videoplayLateStr="",r.videoDomId="",r.destroyed=!1,r.playerVideo=null,r.streamList=null,r.currentBitRate=0,r.sBusiGearIndex=-1,r.gearIndexList=[],r.bUserStoped=!1,r.uistartTs=performance.timing.fetchStart,r.stat=new g.default,r.VideoEvents=["loadstart","suspend","abort","error","emptied","stalled","loadedmetadata","loadeddata","canplay","canplaythrough","playing","waiting","seeking","seeked","ended","durationchange","timeupdate","progress","play","pause","ratechange","resize","volumechange"],r.signChannel=null,r.signCHannelHandler=null,r.needSubscribeRoom=!1,r.roomId=0,r.currentRoomStream={},r.startPlayInfo=null,r.startTimeStamp=0,r.start_type=0,r._onServerInited=r.onServerInited.bind(r),r.setChannel(i),r.on("error",r.onvideoError.bind(r)),r.setFetchTime(),r}return(0,u.default)(t,e),(0,a.default)(t,[{key:"switchLine",value:function(e){if(this.streamList&&this.streamList.length>0){var t=this.streamList[0];if(t.vMediaStreamInfo&&t.vMediaStreamInfo.length>0)for(var i=0;i<t.vMediaStreamInfo.length;i++)if(t.vMediaStreamInfo[i].iLineIndex===e)return t.chooseLine=e,this.playStream(this.streamList,this.currentRoomStream?this.currentRoomStream.iBitRate:-1),!0}return!1}},{key:"switchBitRate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;this.bUserStoped=!1;var i=-1;if(this.streamList&&this.streamList.length>0&&this.streamList[0].vStreamGearInfo&&this.streamList[0].vStreamGearInfo.length>0){for(var r=0;r<this.streamList[0].vStreamGearInfo.length;r++)if(e==this.streamList[0].vStreamGearInfo[r].sDisplayName){i=this.streamList[0].vStreamGearInfo[r].iBitRate,this.streamList[0].vStreamGearInfo[r].sDisplayName;break}if(-1==i&&-1!=t){c.default.log("HyOpenPlayer.switchBitRate no videoquality:"+e);for(var n=0;n<this.streamList[0].vStreamGearInfo.length;n++)if(t==this.streamList[0].vStreamGearInfo[n].iBitRate){i=this.streamList[0].vStreamGearInfo[n].iBitRate,this.streamList[0].vStreamGearInfo[n].sDisplayName;break}}}if(-1==i)return c.default.log("HyOpenPlayer.switchBitRate switchBitRateError no stream videoquality="+e+"  targetBitrate="+t),!1;var s=!0;return this.playStream(this.streamList,i,s),!0}},{key:"resume",value:function(){this.bUserStoped=!1,this.playStream(this.streamList,this.currentBitRate)}},{key:"onMediaStreamInfoError",value:function(e){}},{key:"backToBusi",value:function(e){var t=[this.stat.createAct("stream_error",{value:[e]})];T.default.onNimoDataMetric2(t,this.pid,0,"",0),this.emit(h.default.MEDIA_STREAM_INFO_ERROR)}},{key:"startPlay",value:function(e,t){var i=e.id,r=e.url,n=e.type,s=e.bLive,a=e.pid,o=e.myid,u=e.videoquality,l=e.enableLowLatency,h=e.line,d=e.startTimeStamp,f=e.clickroomts,p=e.roomId,v=(e.yspwlStreamPkg,e.place),y=e.sBusiGearIndex,S=e.gearIndexList;if(c.default.log("HyOpenPlayer.startPlay id="+i+"  url="+r+"  type="+n+"  startTimeStamp="+d+"  clickroomts="+f),_.default.place=v,this.startPlayInfo=arguments[0],this.startTimeStamp=d,this.clickroomts=f,this.currentRoomStream={},this.gearIndexList=S,void 0!==y?(this.sBusiGearIndex=Number(y),isNaN(this.sBusiGearIndex)&&(this.sBusiGearIndex=-1)):this.sBusiGearIndex=-1,p&&p>0)return this.start_type=2,void(this.playRoomInfo(arguments[0],t)||this.backToBusi(1));this.start_type=1;var g=new m.default;g.id=i,g.url=r,g.type=n,g.bLive=s,g.pid=a,g.myid=o,g.videoquality=u,g.enableLowLatency=l,g.line=h,g.clickroomts=f,g.vjsOptions=t,this.startPlayVideo(g),this.destroyed&&this.handler&&(this.destroyed=!1)}},{key:"startPlayNewVideo",value:function(e,t){var i=e.id,r=e.url,n=e.type,s=e.bLive,a=e.pid,o=e.myid,u=e.videoquality,l=e.enableLowLatency,h=e.line,d=e.startTimeStamp,f=e.clickroomts,p=e.roomId;if(e.yspwlStreamPkg,c.default.log("HyOpenPlayer.startPlayNewVideo id="+i+"  url="+r+"  type="+n+"  startTimeStamp="+d+"  clickroomts="+f),this.startPlayInfo=arguments[0],this.currentRoomStream={},this.clearVideoChildnote(),p&&p>0)this.playRoomInfo(arguments[0],t)||this.backToBusi(3);else{var v=new m.default;v.id=i,v.url=r,v.type=n,v.bLive=s,v.pid=a,v.myid=o,v.videoquality=u,v.enableLowLatency=l,v.line=h,v.clickroomts=f,this.startPlayVideo(v),this.destroyed&&this.handler&&(this.destroyed=!1)}}},{key:"setLiving",value:function(e){}},{key:"fleshVideo",value:function(){c.default.log("HyOpenPlayer.fleshVideo bUserStoped="+this.bUserStoped),this.bUserStoped=!1,this.roomId&&this.streamList&&this.streamList.length>0&&this.currentRoomStream?this.playStream(this.streamList,this.currentRoomStream.iBitRate):this.startPlayInfo&&this.startPlay(this.startPlayInfo,this.vjsOptions)}},{key:"getCurrentStreamInfo",value:function(){return this.streamList&&this.streamList.length>0?{streamGearInfo:this.streamList[0].vStreamGearInfo,streamInfo:this.streamList[0].vMediaStreamInfo,currentRoomStream:this.currentRoomStream}:{streamGearInfo:[],streamInfo:[],currentRoomStream:this.currentRoomStream}}},{key:"setConfig",value:function(e){if(this.config=e,this.config&&this.player&&this.setHYPlayerConfig(this.config),this.config&&this.config.nimoConfig)try{var t=JSON.parse(this.config.nimoConfig);this.videoplayLateSendLog=t.videoplayLateSendLog,this.videoplayLateSendLog&&this.sendFeedbackForVideoPlay(this.videoplayLateStr)}catch(e){c.default.log("get config err")}}},{key:"replayVideo",value:function(){this.startPlayNewVideo({id:this.id,url:this.url,type:this.type,bLive:this.bLive,pid:this.pid,myid:this.myid,videoquality:this.videoquality,enableLowLatency:this.enableLowLatency,line:this.line},this.vjsOptions)}},{key:"play",value:function(){c.default.log("HyOpenPlayer.play"),this.player&&this.player.play()}},{key:"pause",value:function(){c.default.log("HyOpenPlayer.pause"),this.player&&this.player.pause()}},{key:"stop",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];c.default.log("HyOpenPlayer.stop"),this.bUserStoped=e,this.player&&this.player.stop(),e&&(this.startPlayInfo=null)}},{key:"seek",value:function(e){c.default.log("HyOpenPlayer.seek time="+e),this.player&&this.player.setCurrentTime(e)}},{key:"setVolume",value:function(e){c.default.log("HyOpenPlayer.setVolume volume="+e),this.player&&this.player.setVolume(e)}},{key:"sendDanmu",value:function(e){}},{key:"sendFeedbackForVideoPlay",value:function(e){this.videoplayLateStr=e,this.videoplayLateSendLog&&""!=e&&(this.videoplayLateStr="")}},{key:"userRecvDanmu",value:function(e){}},{key:"submitLog",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"问题反馈",t=void 0;t=this.hyplayer?c.default.getLog().concat(this.hyplayer.getLog()):c.default.getLog();var i=(0,r.default)(t),n=new S.default;return n.feedBack(this.pid,i,e),i}},{key:"setTaf",value:function(e){this.tafHandler=e}},{key:"getEl",value:function(){return this.playerVideo?this.playerVideo:null}},{key:"destroy",value:function(){c.default.log("HyOpenPlayer.destroy"),this.player&&this.player.dispose(),this.signChannel&&(this.roomId>0&&this.signChannel.sendQuitRoom([this.roomId]),this.signChannel.removeListener(d.default.SERVER_OPEN,this.signalChannelOpenBind),this.signChannel.removeListener(d.default.UPDATE_STREAM_INFO,this.onUpdateStreamInfoBind),this.signChannel.removeListener(d.default.UPDATE_STREAM_INFO_FAIL,this.onUpdateStreamInfoFailBind),this.signChannel.removeListener(d.default.MEDIA_STOPSTREAM_NOTICE,this.onMediaStreamStopNoticeBind)),this.removeAllListeners(),this.handler=null,this.destroyed=!0,this.tafHandler=null,this.clearVideoChildnote()}},{key:"emitOut",value:function(e,t,i){this.emit(e,t,i)}},{key:"clearVideoChildnote",value:function(){c.default.log("HyOpenPlayer.clearVideoChildnote");var e=document.getElementById(this.videoDomId);if(e){for(var t=e.childNodes,i=0;i<t.length;i++)e.removeChild(t[i]);this.playerVideo=null}}},{key:"switchLevel",value:function(e){this.player&&this.player.switchLevel(e)}},{key:"isSupported",value:function(){return f.default.isSupported()}},{key:"reset",value:function(){this.hyplayer&&(this.hyplayer.reset(),this.hyplayer=null),this.mp4player&&(this.mp4player.reset(),this.mp4player=null)}},{key:"startPlayVideo",value:function(e){var t=this;c.default.log("HyOpenPlayer.startPlayVideo url="+r);var i="video/flv";this.bLive=e.bLive,this.myid=e.myid,this.pid=e.pid,this.videoquality=e.videoquality,this.enableLowLatency=e.enableLowLatency,this.line=e.line,this.videoType=e.type,this.vjsOptions=e.vjsOptions,this.videoDomId=e.id,this.clickroomts=0;var r=e.url;-1!=r.indexOf("http://")&&(r=r.replace("http://","https://")),e.clickroomts>0?(this.clickroomts=(new Date).getTime()-(performance.now()-e.clickroomts),this.uistartTs=this.clickroomts):this.checkUIPlayStart()&&(this.uistartTs=0),this.noNeedSendVideoLoadTime=!(this.startTimeStamp&&this.startTimeStamp>0),"flv"==e.type?i="video/flv":"mp4"==e.type?i="video/mp4":"hls"==e.type&&(i="video/hls");var n=0;if(-1!=e.curBitRate)switch(e.videoquality){case 0:break;case 6:n=6e3;break;case 2:n=2500;break;case 3:n=1e3;break;case 4:n=500;break;case 5:n=250}else n=e.curBitRate;this.reset(),this.playerVideo&&this.clearVideoChildnote();var s=document.getElementById(e.id);if(s&&(this.playerVideo=document.createElement("video"),s.appendChild(this.playerVideo),this.addH5EventListener(this.playerVideo),this.isSupported())){var a=e.vjsOptions||{};if(v.default.setVideoAttributeOptions(this.playerVideo,a),"video/hls"==i||"video/flv"==i?(this.hyplayer||(this.hyplayer=new f.default(this)),this.player=this.hyplayer,this.hyplayer.startPlay({video:this.playerVideo,pid:e.pid,myid:e.myid,bLive:this.bLive,lineType:e.line,url:r,bitrate:n,enableLowLatency:e.enableLowLatency,mediaType:i,startTimeStamp:this.startTimeStamp,uistartTs:this.uistartTs,needSendVideoLoadTime:this.needSendVideoLoadTime,startType:this.start_type}),2===this.start_type&&this.hyplayer&&this.hyplayer.player&&!this.hyplayer.player.isPlaying&&(100*Math.random()>95||1===Number(localStorage._testLog))&&setTimeout((function(){t.submitLog("黑屏排查")}),1e4)):"video/mp4"==i&&(this.mp4player||(this.mp4player=new p.default(this,this.playerVideo)),this.player=this.mp4player,this.mp4player.startPlay(r,this.uistartTs)),this.playerVideo&&e.vjsOptions&&e.vjsOptions.autoplay){var o=this.playerVideo.play();void 0!==o&&o.then((function(e){})).catch((function(e){c.default.log("MSEPlayer.videoPlay play err "+e)}))}}}},{key:"joinRoom",value:function(e,t){var i=e.id,r=e.roomId,n=(e.pid,e.myid,e.enableLowLatency),s=(e.videoquality,!(arguments.length>2&&void 0!==arguments[2])||arguments[2]);c.default.log("HyOpenPlayer.joinRoom id="+i+"  roomId="+r+"  enableLowLatency="+n),this.bUserStoped=!1;var a=arguments[0];this.updateBasicsInfo(a),this.vjsOptions=t,this.connectChannel(s)}},{key:"quitRoom",value:function(e){this.signChannel&&(this.signChannel.sendQuitRoom([e]),this.signChannel.quitRoom()&&this.stop())}},{key:"setChannel",value:function(e){this.signChannel=e,this.signCHannelHandler=this.signChannel.tafHandler,this.needSubscribeRoom=!0,this.signalChannelOpenBind=this.signalChannelOpen.bind(this),this.onUpdateStreamInfoBind=this.onUpdateStreamInfo.bind(this),this.onUpdateStreamInfoFailBind=this.onUpdateStreamInfoFail.bind(this),this.onMediaStreamStopNoticeBind=this.onMediaStreamStopNotice.bind(this),this.signChannel.addListener(d.default.SERVER_OPEN,this.signalChannelOpenBind),this.signChannel.addListener(d.default.UPDATE_STREAM_INFO,this.onUpdateStreamInfoBind),this.signChannel.addListener(d.default.UPDATE_STREAM_INFO_FAIL,this.onUpdateStreamInfoFailBind),this.signChannel.addListener(d.default.MEDIA_STOPSTREAM_NOTICE,this.onMediaStreamStopNoticeBind)}},{key:"onUpdateStreamInfoFail",value:function(){this.backToBusi(2)}},{key:"loginMedia",value:function(e){this.signChannel&&this.signChannel.loginVerify(e)}},{key:"connectChannel",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];c.default.log("HyOpenPlayer.connectChannel "),this.signChannel.sendJoinRoom(this.roomId,-1,e)}},{key:"getStreamDisplayName",value:function(e,t){var i="";if(this.streamList.length>0&&this.streamList[0].vStreamGearInfo&&this.streamList[0].vStreamGearInfo.length>0)for(var r=0;r<e[0].vStreamGearInfo.length;r++)if(t==e[0].vStreamGearInfo[r].iBitRate){i=e[0].vStreamGearInfo[r].sDisplayName;break}return i}},{key:"getStreamGearInfo",value:function(e,t){if(this.streamList.length>0&&this.streamList[0].vStreamGearInfo&&this.streamList[0].vStreamGearInfo.length>0)for(var i=0;i<e[0].vStreamGearInfo.length;i++)if(t==e[0].vStreamGearInfo[i].iBitRate)return e[0].vStreamGearInfo[i];return null}},{key:"getBusiGearIndex",value:function(e,t){var i="";if(this.streamList.length>0&&this.streamList[0].vStreamGearInfo&&this.streamList[0].vStreamGearInfo.length>0)for(var r=0;r<e[0].vStreamGearInfo.length;r++)if(t==e[0].vStreamGearInfo[r].iBitRate){i=e[0].vStreamGearInfo[r].sBusiGearIndex;break}return i}},{key:"setFetchTime",value:function(){try{localStorage.uifetch&&localStorage.uifetch>=performance.timing.fetchStart?this.uistartTs=0:this.setLocalVideoStarted(!1),localStorage.uifetch=performance.timing.fetchStart}catch(e){}}},{key:"setLocalVideoStarted",value:function(e){try{localStorage.videoStarted=e?1:0}catch(e){}}},{key:"checkUIPlayStart",value:function(){try{return localStorage.videoStarted&&1==localStorage.videoStarted}catch(e){}return!1}},{key:"removeH5EventListeners",value:function(e){for(var t=0;t<this.VideoEvents.length;t++)e.removeEventListener(this.VideoEvents[t],this.emitVideoPlayerEvent.bind(this))}},{key:"addH5EventListener",value:function(e){for(var t=0;t<this.VideoEvents.length;t++)e.addEventListener(this.VideoEvents[t],this.emitVideoPlayerEvent.bind(this))}},{key:"emitVideoPlayerEvent",value:function(e){try{"timeupdate"!=e.type&&"progress"!=e.type&&"durationchange"!=e.type&&c.default.log("HyOpenPlayer.emitVideoPlayerEvent type="+e.type),this.emit(e.type,e)}catch(e){c.default.log("HyOpenPlayer.emitVideoPlayerEvent error")}}},{key:"setHYPlayerConfig",value:function(e){this.player&&this.player.setPlayerConfig(e)}},{key:"signalChannelOpen",value:function(){}},{key:"playRoomInfo",value:function(e,t){var i=e.yspwlStreamPkg;if(i){var r=new y.default(e.pid,this.gearIndexList).setLiveRoomBinData(i);if(!r)return!1;this.bUserStoped=!1,this.updateBasicsInfo(e),this.vjsOptions=t,this.signChannel.setRoomStreamInfo(r.sRoomId,r),c.default.log("HyOpenPlayer.playRoomInfo ")}return this.joinRoom(e,t,!i),!0}},{key:"updateBasicsInfo",value:function(e){this.enableLowLatency=e.enableLowLatency,this.roomId=e.roomId,this.pid=e.pid,this.videoBoxId=e.id}},{key:"onUpdateStreamInfo",value:function(e){var t=new y.default(this.pid,this.gearIndexList).setLivingInfo(e.liveStreams,-1,this.sBusiGearIndex);this.streamList=t,this.needPlay(t)?this.playStream(t):t.length>0&&this.emit(h.default.MEDIA_STREAM_UPDATE,{streamInfo:t[0].vMediaStreamInfo,streamGearInfo:t[0].vStreamGearInfo,currentRoomStream:this.currentRoomStream})}},{key:"needPlay",value:function(e){var t=this;if(e&&e.length>0){var i=e[0];if(i.streamName!==this.currentRoomStream.sStreamName)return!0;var r=!1;if(i.vMediaStreamInfo.forEach((function(e){e.iLineIndex===t.currentRoomStream.line&&(r=!0)})),!r)return!0;var n=!1,s="",a="";if(i.vStreamGearInfo.forEach((function(e){e.iBitRate===t.currentRoomStream.iBitRate&&Number(e.tResolution.iWidth)===Number(t.currentRoomStream.iWidth)&&Number(e.tResolution.iHeight)===Number(t.currentRoomStream.iHeight)&&(n=!0,s=e.sDisplayName,a=e.sBusiGearIndex)})),!n)return!0;this.currentRoomStream.sDisplayName=s,this.currentRoomStream.sBusiGearIndex=a}return!1}},{key:"onMediaStreamStopNotice",value:function(){c.default.log("HyOpenPlayer.ONMediaStreamStopNotice")}},{key:"playStream",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];c.default.log("HyOpenPlayer.playStream");var r=!1;if(e&&e.length>0)if(e[0].vMediaStreamInfo.length>0){for(var n=0;n<e[0].vMediaStreamInfo.length;n++)if(e[0].chooseLine==e[0].vMediaStreamInfo[n].iLineIndex){var s=e[0].vMediaStreamInfo[n],a=e[0].playFormat?e[0].playFormat.sFormatName:"flv",o="",u="";switch(a){case"flv":o=s.sFlvUrl+(s.sFlvUrl.endsWith("/")?"":"/")+s.sStreamName+s.sFlvSuffix,u=s.sFlvUrl;break;case"hls":o=s.sHlsUrl+(s.sHlsUrl.endsWith("/")?"":"/")+s.sStreamName+s.sHlsSuffix,u=s.sHlsUrl}this.currentRoomStream.mediaFormat=a;var l=[];""!==e[0].sAdditionalParam&&l.push(e[0].sAdditionalParam),s.sAdditionalParam&&""!=s.sAdditionalParam&&l.push(s.sAdditionalParam),e[0].playFormat&&""!==e[0].playFormat.sAdditionalParam&&l.push(e[0].playFormat.sAdditionalParam);var d=0;(d=-1==t&&0==e[0].defaultBitRate||-1===t?e[0].defaultBitRate:t)>0&&l.push("ratio="+d);var f=this.getStreamGearInfo(e,d);f?(this.currentRoomStream.sDisplayName=f.sDisplayName,this.currentRoomStream.sBusiGearIndex=f.sBusiGearIndex,this.currentRoomStream.iWidth=f.tResolution.iWidth,this.currentRoomStream.iHeight=f.tResolution.iHeight,l.push(f.sAdditionalParam)):(this.currentRoomStream.sDisplayName="",this.currentRoomStream.sBusiGearIndex=""),l.length>0&&(o+="?"+l.join("&"));var p=(u=u.replace("//","")).split("/");u.endsWith("/")&&p.pop(),this.currentRoomStream.backsrc=p.length>1?p.pop():"",this.currentRoomStream.sStreamName=s.sStreamName,this.currentRoomStream.iBitRate=d,this.currentRoomStream.isSrc=this.currentRoomStream.iWidth>0&&this.currentRoomStream.iHeight>0&&0===d;var v=e[0].chooseLine;if(this.currentRoomStream.line=e[0].chooseLine,this.currentBitRate=d,(new Date).getTime(),!this.bUserStoped){var y=new m.default;y.id=this.videoBoxId,y.url=o,y.type=a,y.bLive=!0,y.pid=this.pid,y.myid=this.myid,y.videoquality=Number(this.currentRoomStream.sBusiGearIndex),y.enableLowLatency=this.enableLowLatency,y.vjsOptions=this.vjsOptions,y.line=v,y.clickroomts=this.clickroomts,y.curBitRate=d,i&&"hls"==a&&this.hyplayer&&this.hyplayer.hyPlayer&&this.hyplayer.hyPlayer.player&&this.hyplayer.hyPlayer.player.isSwitchSeamLessLine?this.hyplayer.switchLevel(y):this.startPlayVideo(y)}c.default.log("HyOpenPlayer.UPDATE_STREAM_INFO"),this.emit(h.default.MEDIA_STREAM_UPDATE,{streamGearInfo:e[0].vStreamGearInfo,streamInfo:e[0].vMediaStreamInfo,currentRoomStream:this.currentRoomStream})}}else r=!0;else r=!0;r&&(c.default.log("HyOpenPlayer.ROOM_NO_STREAM"),this.emit(h.default.ROOM_NO_STREAM),this.stop(!1))}},{key:"videoTimeout",value:function(){Math.floor(100*Math.random())>=98&&this.handler&&this.submitLog()}},{key:"videoWaitingTimes",value:function(){Math.floor(1e3*Math.random())>=995&&this.handler&&this.submitLog()}},{key:"onPlayVideo",value:function(e){this.startTimeStamp=0,this.setLocalVideoStarted(!0),this.emit(h.default.VIDEO_PLAY,{video:e.video,loadTime:e&&e.loadTime?e.loadTime:0,connectTime:e&&e.connectTime?e.connectTime:0,recvDataTime:e&&e.recvDataTime?e.recvDataTime:0})}},{key:"onStopVideo",value:function(){this.emit(h.default.VIDEO_STOP,{})}},{key:"onPlayerError",value:function(e){this.emit(h.default.VIDEO_ERROR,{type:e})}},{key:"onNoDataReceived",value:function(){this.emit(h.default.NO_DATA_RECEIVED,{})}},{key:"onLinkTimeout",value:function(){this.emit(h.default.LINK_TIMEOUT,{})}},{key:"onVideoFrameLoaded",value:function(){this.emit(h.default.VIDEO_FRAME_LOADED,{})}},{key:"onLoadDataTimeout",value:function(){this.emit(h.default.LOAD_DATA_TIMEOUT,{})}},{key:"onLinkUnAvailable",value:function(){this.emit(h.default.LINK_UNAVAILABLE,{})}},{key:"onPlayDownLinkInfo",value:function(e){this.emit(h.default.PLAY_DOWNLINK_INFO,e)}},{key:"onClose",value:function(){this.emit(h.default.VIDEO_CLOSE)}},{key:"onPlayTime",value:function(e,t,i){this.emit(h.default.PLAY_TIME,{currentTime:e,buffered:i,duration:t})}},{key:"onPlayFrameBuffer",value:function(e){this.emit(h.default.VIDEO_FRAME_JITTERBUFFER,{frameStorage:e.frameStorage,jitterBuffer:e.jitterBuffer,playdelay:e.playdelay})}},{key:"onMetaData",value:function(e){this.emit(h.default.METADATA,e)}},{key:"onPlayStatus",value:function(){}},{key:"onServerInited",value:function(){}},{key:"onvideoError",value:function(e){}},{key:"duration",get:function(){return this.player?this.player.getDurationTime():0}},{key:"currentTime",get:function(){return this.player?this.player.getCurrentTime():0}},{key:"volume",get:function(){return this.playerVideo?this.playerVideo.volume:1},set:function(e){this.setVolume(e)}},{key:"currentSrc",get:function(){return this.playerVideo?this.playerVideo.currentSrc:this.currentSrc}},{key:"buffered",get:function(){return this.playerVideo?this.playerVideo.buffered:this.buffered}},{key:"muted",get:function(){return!!this.playerVideo&&this.playerVideo.muted},set:function(e){this.playerVideo&&(this.playerVideo.muted=e)}},{key:"playbackRate",get:function(){return this.playerVideo?this.playerVideo.playbackRate:1},set:function(e){this.playerVideo&&(this.playerVideo.playbackRate=e)}},{key:"paused",get:function(){return!!this.playerVideo&&this.playerVideo.paused},set:function(e){this.playerVideo&&(this.playerVideo.paused=e)}},{key:"ended",get:function(){return!!this.playerVideo&&this.playerVideo.ended},set:function(e){this.playerVideo&&(this.playerVideo.ended=e)}},{key:"videoWidth",get:function(){return this.playerVideo?this.playerVideo.videoWidth:0}},{key:"videoHeight",get:function(){return this.playerVideo?this.playerVideo.videoHeight:0}}]),t}(l.EventEmitter);t.default=I},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=h(i(11)),n=h(i(0)),s=h(i(1)),a=h(i(9)),o=h(i(10)),u=i(14),l=h(i(41));function h(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(e,i){(0,n.default)(this,t);var s=(0,a.default)(this,(t.__proto__||(0,r.default)(t)).call(this));return s.handler=e,s.playerConfig=i,s.onPlayVideoBind=s.onPlayVideo.bind(s),s.onStopVideoBind=s.onStopVideo.bind(s),s.onSeekVideoBind=s.onSeekVideo.bind(s),s.onAnchorStopBind=s.onAnchorStop.bind(s),s.onPlayStatusBind=s.onPlayStatus.bind(s),s.onPlayTimeStatusBind=s.onPlayStatus.bind(s),s.onPlayDataMeteric2Bind=s.onPlayDataMeteric2.bind(s),s.onPlayDownLinkInfoBind=s.onPlayDownLinkInfo.bind(s),s.onLinkUavailableBind=s.onLinkUavailable.bind(s),s.onLinkTimeoutBind=s.onLinkTimeout.bind(s),s.onLoadTimeoutBind=s.onLoadTimeout.bind(s),s.onPlayerErrorBind=s.onPlayerError.bind(s),s.onNoDataReceivedBind=s.onNoDataReceived.bind(s),s.onCloseBind=s.onClose.bind(s),s.onReplayVideoBind=s.onReplayVideo.bind(s),s.onRecvVideoFramesBind=s.onRecvVideoFrames.bind(s),s.onUpdateFrameBufferBind=s.onUpdateFrameBuffer.bind(s),s.onMetaDataBind=s.onMetaData.bind(s),s.onVideoPauseBind=s.onVideoPause.bind(s),s.onVideoStartBind=s.onVideoStart.bind(s),s.onVideoStartLoadBind=s.onVideoStartLoad.bind(s),s}return(0,o.default)(t,e),(0,s.default)(t,[{key:"sdkPlay",value:function(e,t){var i=HYPlayer.HLS;switch(t){case"video/flv":i=HYPlayer.FLV;break;case"video/hls":i=HYPlayer.HLS}var r={type:i,lineType:this.lineType,url:e,curBitrate:this.bitrate,enableLowLatency:this.enableLowLatency,startTimeStamp:this.startTimeStamp,uistartTs:this.uistartTs,isLive:this.bLive,startType:this.startType};this.videoSrc=e,this.hyPlayer.start(r)}},{key:"startPlay",value:function(e){this.lineType=e.lineType,this.videoSrc=e.url,this.bitrate=e.bitrate,this.enableLowLatency=e.enableLowLatency,this.mediaType=e.mediaType,this.pidpresenterUid=e.pid,this.myid=e.myid,this.el_=e.video,this.startTimeStamp=e.startTimeStamp,this.uistartTs=e.uistartTs,this.bLive=e.bLive,this.startType=e.startType,this.noNeedSendVideoLoadTime=e.noNeedSendVideoLoadTime,this.hyPlayer||(this.hyPlayer=new HYPlayer({}),this.hyPlayer.attachMediaElement(this.el_),this.hyPlayer.on(HYPlayer.Events.VIDEO_PLAY,this.onPlayVideoBind),this.hyPlayer.on(HYPlayer.Events.VIDEO_STOP,this.onStopVideoBind),this.hyPlayer.on(HYPlayer.Events.VIDEO_SEEK,this.onSeekVideoBind),this.hyPlayer.on(HYPlayer.Events.ANCHOR_STOP,this.onAnchorStopBind),this.hyPlayer.on(HYPlayer.Events.PLAY_STATUS,this.onPlayStatusBind),this.hyPlayer.on(HYPlayer.Events.PLAY_TIME_STATUS,this.onPlayTimeStatusBind),this.hyPlayer.on(HYPlayer.Events.DATA_METRIC2,this.onPlayDataMeteric2Bind),this.hyPlayer.on(HYPlayer.Events.PLAY_DOWNLINK_INFO,this.onPlayDownLinkInfoBind),this.hyPlayer.on(HYPlayer.Events.FLV_URL_UNAVAILABLE,this.onLinkUavailableBind),this.hyPlayer.on(HYPlayer.Events.FLV_URL_LOAD_TIMEOUT,this.onLinkTimeoutBind),this.hyPlayer.on(HYPlayer.Events.HLS_URL_UNAVAILABLE,this.onLinkUavailableBind),this.hyPlayer.on(HYPlayer.Events.HLS_URL_LOAD_TIMEOUT,this.onLinkTimeoutBind),this.hyPlayer.on(HYPlayer.Events.HLS_MAINFEST_LOAD_TIMEOUT,this.onLoadTimeoutBind),this.hyPlayer.on(HYPlayer.Events.H5_PLAYER_ERROR,this.onPlayerErrorBind),this.hyPlayer.on(HYPlayer.Events.NO_DATA_RECEIVED,this.onNoDataReceivedBind),this.hyPlayer.on(HYPlayer.Events.VIDEO_LINK_CLOSE,this.onCloseBind),this.hyPlayer.on(HYPlayer.Events.REPLAY_VIDEO,this.onReplayVideoBind),this.hyPlayer.on(HYPlayer.Events.RECV_VIDEO_FRAME,this.onRecvVideoFramesBind),this.hyPlayer.on(HYPlayer.Events.PLAY_FRAME_BUFFER,this.onUpdateFrameBufferBind),this.hyPlayer.on(HYPlayer.Events.METADATA,this.onMetaDataBind),this.el_.addEventListener("waiting",this.onVideoPauseBind),this.el_.addEventListener("playing",this.onVideoStartBind),this.el_.addEventListener("loadstart",this.onVideoStartLoadBind),this.playerConfig&&this.hyPlayer.setNimoConfig(this.playerConfig)),this.sdkPlay(this.videoSrc,this.mediaType)}},{key:"onPlayVideo",value:function(e,t){this.handler&&this.handler.onPlayVideo(t)}},{key:"onStopVideo",value:function(){}},{key:"onSeekVideo",value:function(){}},{key:"onAnchorStop",value:function(){}},{key:"onPlayerError",value:function(e,t){this.handler&&this.handler.onPlayerError(t.code)}},{key:"onNoDataReceived",value:function(e){this.handler}},{key:"onPlayStatus",value:function(){}},{key:"onPlayDownLinkInfo",value:function(e,t){this.handler&&this.handler.onPlayDownLinkInfo(t)}},{key:"onPlayDataMeteric2",value:function(e,t){if(l.default.onNimoDataMetric2(t,this.pidpresenterUid,this.bitrate,this.videoSrc,this.lineType),t.length>1)for(var i=0;i<t.length;i++)if(t[i].sMetricName&&"yspwl.web.live.user.act"==t[i].sMetricName&&t[i].vDimension&&"video_load_ts"==t[i].vDimension.act_type&&t[i].vField.value1&&t[i].vField.value2&&t[i].vField.value3&&t[i].vField.value1-t[i].vField.value2>1e3){this.handler.sendFeedbackForVideoPlay("有数据，视频慢");break}}},{key:"onPlayTimeStatus",value:function(e,t){this.handler&&this.handler.onPlayTime(Math.floor(t.current),Math.floor(t.total),0)}},{key:"onLinkUavailable",value:function(){this.handler&&this.handler.onLinkUnAvailable()}},{key:"onLoadTimeout",value:function(){this.handler&&this.handler.onLoadDataTimeout()}},{key:"onLinkTimeout",value:function(){this.handler&&this.handler.onLinkTimeout()}},{key:"onClose",value:function(){this.handler&&this.handler.onClose()}},{key:"onReplayVideo",value:function(){this.handler&&this.handler.replayVideo()}},{key:"onUpdateFrameBuffer",value:function(e,t){this.handler&&this.handler.onPlayFrameBuffer(t)}},{key:"onMetaData",value:function(e,t){this.handler&&this.handler.onMetaData&&this.handler.onMetaData(t)}},{key:"onRecvVideoFrames",value:function(){this.handler&&this.handler.onVideoFrameLoaded()}},{key:"onVideoPause",value:function(e){}},{key:"onVideoStart",value:function(e){}},{key:"onVideoStartLoad",value:function(){}},{key:"pause",value:function(){this.hyPlayer&&this.hyPlayer.pause()}},{key:"removeHyPlayerEventListeners",value:function(){this.hyPlayer&&(this.hyPlayer.off(HYPlayer.Events.VIDEO_PLAY,this.onPlayVideoBind),this.hyPlayer.off(HYPlayer.Events.VIDEO_STOP,this.onStopVideoBind),this.hyPlayer.off(HYPlayer.Events.VIDEO_SEEK,this.onSeekVideoBind),this.hyPlayer.off(HYPlayer.Events.ANCHOR_STOP,this.onAnchorStopBind),this.hyPlayer.off(HYPlayer.Events.PLAY_STATUS,this.onPlayStatusBind),this.hyPlayer.off(HYPlayer.Events.PLAY_TIME_STATUS,this.onPlayTimeStatusBind),this.hyPlayer.off(HYPlayer.Events.DATA_METRIC2,this.onPlayDataMeteric2Bind),this.hyPlayer.off(HYPlayer.Events.PLAY_DOWNLINK_INFO,this.onPlayDownLinkInfoBind),this.hyPlayer.off(HYPlayer.Events.FLV_URL_UNAVAILABLE,this.onLinkUavailableBind),this.hyPlayer.off(HYPlayer.Events.FLV_URL_LOAD_TIMEOUT,this.onLinkTimeoutBind),this.hyPlayer.off(HYPlayer.Events.HLS_URL_UNAVAILABLE,this.onLinkUavailableBind),this.hyPlayer.off(HYPlayer.Events.HLS_URL_LOAD_TIMEOUT,this.onLinkTimeoutBind),this.hyPlayer.off(HYPlayer.Events.HLS_MAINFEST_LOAD_TIMEOUT,this.onLoadTimeoutBind),this.hyPlayer.off(HYPlayer.Events.H5_PLAYER_ERROR,this.onPlayerErrorBind),this.hyPlayer.off(HYPlayer.Events.NO_DATA_RECEIVED,this.onNoDataReceivedBind),this.hyPlayer.off(HYPlayer.Events.VIDEO_LINK_CLOSE,this.onCloseBind),this.hyPlayer.off(HYPlayer.Events.REPLAY_VIDEO,this.onReplayVideoBind),this.hyPlayer.off(HYPlayer.Events.RECV_VIDEO_FRAME,this.onRecvVideoFramesBind),this.hyPlayer.off(HYPlayer.Events.PLAY_FRAME_BUFFER,this.onUpdateFrameBufferBind),this.hyPlayer.off(HYPlayer.Events.METADATA,this.onMetaDataBind),this.hyPlayer.stop(),this.hyPlayer=null)}},{key:"removeElEventListeners",value:function(){this.el_&&(this.el_.removeEventListener("waiting",this.onVideoPauseBind),this.el_.removeEventListener("playing",this.onVideoStartBind),this.el_.removeEventListener("loadstart",this.onVideoStartLoadBind))}},{key:"reset",value:function(){this.handler=null,this.removeHyPlayerEventListeners(),this.removeElEventListeners()}},{key:"play",value:function(){this.hyPlayer&&this.hyPlayer.play()}},{key:"pause",value:function(){this.hyPlayer&&this.hyPlayer.pause()}},{key:"stop",value:function(){this.hyPlayer&&this.hyPlayer.stop()}},{key:"setCurrentTime",value:function(e){this.hyPlayer&&this.hyPlayer.seek(e)}},{key:"getCurrentTime",value:function(){return this.hyPlayer?this.hyPlayer.getCurrentTime():this.el_?this.el_.currentTime:0}},{key:"getDurationTime",value:function(){return this.hyPlayer?this.hyPlayer.getDurationTime():this.el_?this.el_.duration:0}},{key:"setVolume",value:function(e){this.hyPlayer.setVolume(e)}},{key:"getLog",value:function(){return this.hyPlayer?this.hyPlayer.getLog():""}},{key:"setPlayerConfig",value:function(e){this.playerConfig=e,this.hyPlayer&&this.hyPlayer.setNimoConfig(this.playerConfig)}},{key:"sendDanmuMetric",value:function(e,t,i){this.hyPlayer&&this.hyPlayer.sendDanmuCarton(e,t,i)}},{key:"dispose",value:function(){this.stop(),this.hyPlayer&&this.reset()}},{key:"setPlayerConfig",value:function(e){this.playerConfig=e,this.hyPlayer&&this.hyPlayer.setNimoConfig(this.playerConfig)}},{key:"getLog",value:function(){return this.hyPlayer?this.hyPlayer.getLog():""}},{key:"dispose",value:function(){this.hyPlayer&&this.reset()}},{key:"switchLevel",value:function(e){this.hyPlayer&&this.hyPlayer.switchLevel(e)}},{key:"isPlaying",get:function(){return this.hyPlayer&&this.hyPlayer.player&&this.hyPlayer.player.isPlaying}}]),t}(u.EventEmitter);d.isSupported=function(){return window.HYPlayer&&window.HYPlayer.isSupported()},t.default=d},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=c(i(11)),n=c(i(0)),s=c(i(1)),a=c(i(9)),o=c(i(10)),u=i(14),l=c(i(5)),h=c(i(41)),d=c(i(178));function c(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(e,i){(0,n.default)(this,t);var s=(0,a.default)(this,(t.__proto__||(0,r.default)(t)).call(this));return s.handler=e,s.el_=i,s.tickTimer=0,s.tickTimer20S=0,s.pauseByUser=!1,s.lastPlayTime=0,s.recordPlayTimeTS=0,s.clickroomts=0,s.startPlayTs=0,s.businessStartCost=0,s.UIStartCost=0,s.playStat=new d.default(s),s.el_&&(s.el_.addEventListener("pause",s.onVideoPause.bind(s)),s.el_.addEventListener("playing",s.onVideoPlay.bind(s)),s.el_.addEventListener("error",s.onVideoError.bind(s)),s.el_.addEventListener("timeupdate",s.onVideoTimeupdate.bind(s)),s.el_.addEventListener("progress",s.onVideoProgress.bind(s))),s}return(0,o.default)(t,e),(0,s.default)(t,[{key:"startPlay",value:function(e,t,i){var r=(new Date).getTime();this.startPlayTs=r,this.uistartTs=t,this.UIStartCost=0,this.businessStartCost=i?r-i:0,this.uistartTs&&this.uistartTs>0&&(this.UIStartCost=r-this.uistartTs),this.startTickTimer(!0),this.playing=!1,this.el_.src=e}},{key:"setCurrentTime",value:function(e){this.el_.currentTime=e}},{key:"getCurrentTime",value:function(){return this.el_.currentTime}},{key:"getDurationTime",value:function(){return this.el_.duration}},{key:"setVolume",value:function(e){this.el_&&(this.el_.volume=e)}},{key:"play",value:function(){this.pauseByUser=!1;var e=this.el_.play();void 0!==e&&e.then((function(e){})).catch((function(e){}))}},{key:"pause",value:function(){this.pauseByUser=!0,this.el_.pause()}},{key:"stop",value:function(){this.el_.pause(),this.el_.src="",this.startTickTimer(!1)}},{key:"setPlayerConfig",value:function(e){}},{key:"dispose",value:function(){this.stop()}},{key:"updateTime",value:function(){if(this.handler){var e=0;try{if(this.el_){for(var t=this.el_.buffered,i=0;i<t.length;i++)if(t.start(i)<=this.el_.currentTime&&t.end(i)>=this.el_.currentTime){l.default.log("updateTime i="+i,"start="+t.start(i)," end="+t.end(i)),e=(e=t.end(i)-this.el_.currentTime)<0?0:e,Math.floor(this.el_.currentTime),this.handler.onPlayTime(Math.floor(this.el_.currentTime),Math.floor(this.el_.duration),Math.floor(e));break}for(var r=0;r<t.length;r++)l.default.log("buffer i="+r,"start="+t.start(r)," end="+t.end(r))}}catch(e){l.default.log("cannot get buffer")}}}},{key:"checkPause",value:function(){var e=(new Date).getTime();this.lastPlayTime!=this.getCurrentTime()||this.pauseByUser?(this.recordPlayTimeTS=e,this.lastPlayTime=this.getCurrentTime()):0!=this.recordPlayTimeTS&&e-this.recordPlayTimeTS>200&&this.playStat.setPause()}},{key:"startTickTimer",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];clearInterval(this.tickTimer),clearInterval(this.tickTimer20S),e&&(this.tickTimer=setInterval(this.onTick.bind(this),1e3),this.tickTimer20S=setInterval(this.onTick20S.bind(this),2e4))}},{key:"onTick",value:function(){this.checkPause()}},{key:"onTick20S",value:function(){this.playing&&this.playStat.reportVideoQuality()}},{key:"onVideoPause",value:function(){}},{key:"onVideoPlay",value:function(){if(!this.playing){l.default.log("mp4 played");var e=(new Date).getTime();this.playing=!0,this.handler.onPlayVideo({video:this.el_});var t=e-this.startPlayTs,i=this.UIStartCost>0?t+this.UIStartCost:0,r=this.businessStartCost>0?t+this.businessStartCost:0;this.playStat.reportVideoLoadTs(t,i,r)}}},{key:"onVideoError",value:function(e){this.handler&&(l.default.log("mp4 play error"),this.handler.onPlayerError())}},{key:"onVideoTimeupdate",value:function(e){this.updateTime()}},{key:"onVideoProgress",value:function(e){this.updateTime()}},{key:"onMetrics",value:function(e){h.default.onNimoDataMetric2(e,this.pidpresenterUid,this.bitrate,this.videoSrc,this.lineType)}},{key:"reset",value:function(){this.stop()}}]),t}(u.EventEmitter);t.default=f},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a(i(0)),n=a(i(1)),s=a(i(89));function a(e){return e&&e.__esModule?e:{default:e}}var o=function(){function e(t){(0,r.default)(this,e),this.player=t,this.stat=new s.default,this.isPaused=!1}return(0,n.default)(e,[{key:"setPause",value:function(){this.isPaused=!0,this.stat.setCore("video_bad_quality",100)}},{key:"stop",value:function(){}},{key:"reportVideoQuality",value:function(){var e=[{sMetricName:"video.video_bad_quality_ratio",vField:{value:this.isPaused?100:0},vDimension:{p2p:3}}];this.stat.setCoreDim("video_bad_quality",this.isPaused?100:0),this.stat.setCoreDim("p2p",3),this.stat.fill(e,!1),this.sendMetrics(e),this.isPaused=!1,this.stat.setCore("video_bad_quality",0)}},{key:"reportVideoLoadTs",value:function(e,t,i){var r=[],n=0;t&&(n+=1),i&&(n+=2),this.stat.setComDim("p2p",3),this.stat.setComDim("act_load_type",n),r.push(this.stat.createAct("video_load_ts",{value:[e,0,0,t,i]})),this.stat.fill(r,!1),this.sendMetrics(r)}},{key:"sendMetrics",value:function(e){this.player.onMetrics(e)}},{key:"getAvg",value:function(e){var t=e.length;if(0===t)return 0;for(var i=0,r=0;r<t;r++)i+=e[r];return Math.floor(i/t)}}]),e}();t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,n=(r=i(0))&&r.__esModule?r:{default:r},s=function e(){(0,n.default)(this,e)};s.setVideoAttributeOptions=function(e,t){for(var i in void 0!==t.preload&&s.setAttribute(e,"preload",t.preload),t)t[i],s.setAttribute(e,i,i);for(var r=["loop","muted","playsinline","autoplay","controls"],n=0;n<r.length;n++){var a=r[n],o=t[a];void 0!==o&&(o||s.removeAttribute(e,a),e[a]=o)}},s.setAttribute=function(e,t,i){e.setAttribute(t,i)},s.removeAttribute=function(e,t){e.removeAttribute(t)},t.default=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a(i(181)),n=a(i(0)),s=a(i(1));function a(e){return e&&e.__esModule?e:{default:e}}var o=function(){function e(t,i){(0,n.default)(this,e),this.pid=t,this.gearIndexList=i,this.supportLivingFormat=["flv","hls"]}return(0,s.default)(e,[{key:"setLivingInfo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,r=[],n=e.vproto.iBitRate;for(var s in e.streams){var a=e.streams[s],o=[],u=0,l=0,h=-1,d=[],c=a.vMediaStreamInfo,f=a.vStreamGearInfo;l=-1==t?a.iWebDefaultBitRate:t;for(var p=0;p<c.length;p++){var v=c[p];if(v.iWebPriorityRate<0)d.push(p);else{var y=v.iLineIndex;u+=v.iWebPriorityRate,o.push({line:y,rate:v.iWebPriorityRate}),100==v.iWebPriorityRate&&(h=y)}}for(var m=d.length-1;m>=0;m--){var _=d[m];c.splice(_,1)}if(0==c.length)break;if(1===c.length||0===u)h=c[0].iLineIndex;else if(-1===h)for(var S=0,g=Math.random(),T=0,E=o.length;T<E;T++){var I=o[T],P=I.rate/u;if(g<=(S+=P)){h=I.line;break}}l=this.checkDefalutBitRate(f,l,i);for(var R=null,k=0;k<c.length;k++)if(c[k].iLineIndex==h){R=this.getMediaStreamFormat(c[k].mMediaStreamFormatInfo.value);break}var L={streamName:s,vMediaStreamInfo:c,chooseLine:h,vStreamGearInfo:f,defaultBitRate:l,iBitRate:n,playFormat:R,sAdditionalParam:a.sAdditionalParam};r.push(L)}return r}},{key:"getMediaStreamFormat",value:function(e){var t=[],i=0;for(var r in e)-1!=this.supportLivingFormat.indexOf(r)&&t.push(e[r]);var n=t.length,s=0;for(s=0;s<n;s++)i+=t[s].iRate;var a=Math.random()*i,o=0,u=null;for(s=0;s<n;s++){if(o<a&&a<=t[s].iRate+o){u=t[s];break}o+=t[s].iRate}return null===u&&n>0&&(u=t[0]),u}},{key:"checkDefalutBitRate",value:function(e,t,i){var r=this.getByGearIndex(e,i);return-1===r&&(r=this.getByBitrate(e,t)),r}},{key:"getByBitrate",value:function(e,t){for(var i=e.length>0?-1:0,n=t,s=0,a=r.default,o=0;o<e.length;o++){var u=e[o].iBitRate;if(0===n){if(0===u){i=u;break}}else if(u>0&&u<=n){i=u;break}s=Math.max(s,u),a=Math.min(a,u)}return-1===i&&(i=0===n?s:a),i}},{key:"getByGearIndex",value:function(e,t){if(!this.gearIndexList||0===this.gearIndexList.length)return-1;if(-1===(t=Number(t)))return-1;var i=this.gearIndexList.indexOf(t);if(-1===i)return-1;var r=this._getByGearIndex(e,t);if(-1===r)for(var n=this.gearIndexList.length,s=0;s<n;s++){var a=i-s,o=i+s;if(a>0&&(r=this._getByGearIndex(e,this.gearIndexList[a])),-1===r&&(r=this._getByGearIndex(e,this.gearIndexList[o])),-1!==r)break}return r}},{key:"_getByGearIndex",value:function(e,t){for(var i=0;i<e.length;i++)if(Number(e[i].sBusiGearIndex)===t)return Number(e[i].iBitRate);return-1}},{key:"setLiveRoomBinData",value:function(e){try{for(var t=new ArrayBuffer(e.length/2),i=new Uint8Array(t),r=0,n=e.length/2;r<n;r++){var s=parseInt(e[2*r]+e[2*r+1]+"",16);i[r]=s}var a=new Taf.Wup;if(a.decode(i.buffer),TafMx.WupMapping[a.sFuncName],"getStreamInfoByRoom"==a.sFuncName){var o=new HUYA.GetStreamInfoByRoomRsp;return a.readStruct("tRsp",o,"HUYA.GetStreamInfoByRoomRsp"),o}}catch(e){}return null}}]),e}();t.default=o},function(e,t,i){e.exports={default:i(182),__esModule:!0}},function(e,t,i){i(183),e.exports=9007199254740991},function(e,t,i){var r=i(3);r(r.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,n=(r=i(0))&&r.__esModule?r:{default:r};t.default=function e(){(0,n.default)(this,e),this.id="",this.line=0,this.url="",this.type="",this.bLive=!1,this.pid=0,this.myid=0,this.videoquality=0,this.enableLowLatency=!1,this.vjsOptions=null,this.clickroomts=0,this.curBitRate=-1}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=s(i(0)),n=s(i(1));function s(e){return e&&e.__esModule?e:{default:e}}var a=function(){function e(){(0,r.default)(this,e)}return(0,n.default)(e,[{key:"detectOS",value:function(){var e=navigator.userAgent,t="Win32"==navigator.platform||"Windows"==navigator.platform,i="Mac68K"==navigator.platform||"MacPPC"==navigator.platform||"Macintosh"==navigator.platform||"MacIntel"==navigator.platform;if(i)return"Mac";if("X11"==navigator.platform&&!t&&!i)return"Unix";if(String(navigator.platform).indexOf("Linux")>-1)return"Linux";if(t){if(e.indexOf("Windows NT 5.0")>-1||e.indexOf("Windows 2000")>-1)return"Win2000";if(e.indexOf("Windows NT 5.1")>-1||e.indexOf("Windows XP")>-1)return"WinXP";if(e.indexOf("Windows NT 5.2")>-1||e.indexOf("Windows 2003")>-1)return"Win2003";if(e.indexOf("Windows NT 6.0")>-1||e.indexOf("Windows Vista")>-1)return"WinVista";if(e.indexOf("Windows NT 6.1")>-1||e.indexOf("Windows 7")>-1)return"Win7";if(e.indexOf("Windows NT 10")>-1||e.indexOf("Windows 10")>-1)return"Win10"}return"other"}},{key:"feedBack",value:function(e,t,i){this.getFbId(e,t,"其它",i,this.postLog.bind(this))}},{key:"getFbId",value:function(e,t,i,r,n){var s=18e11+parseInt(1e11*Math.random());if(window.XMLHttpRequest){var a=new XMLHttpRequest,o=new FormData;o.append("fbType",i),o.append("fbDetails",r||i),o.append("uid",s),o.append("gid",this.getCookie("guid")),o.append("device",this.detectOS()),o.append("appVersion","sdk"),o.append("deviceType",1),o.append("anchorId",e),o.append("ssid",0),o.append("appId",4e3),a.open("post","//ffilelogapp.nimo.tv/addFeedBack",!1),a.onload=function(e){var i=JSON.parse(e.target.responseText),r=i.fbId;1==i.result?(n(r,t),console.info("获取fbid成功")):console.info("获取fbid失败")},a.send(o)}}},{key:"getCookie",value:function(e){for(var t=e+"=",i=document.cookie.split(";"),r=0,n=i.length;r<n;r++){var s=i[r].trim();if(0==s.indexOf(t))return s.substr(t.length)}return""}},{key:"gblen",value:function(e){for(var t=0,i=e.length,r=0;r<i;r++){var n=e.charCodeAt(r);n>=1&&n<=126||65376<=n&&n<=65439?t++:t+=2}return t}},{key:"postLog",value:function(e,t){var i=this.gblen(t);if(window.XMLHttpRequest){var r=new XMLHttpRequest,n=new FormData;n.append("feedbackId",e),n.append("log",t),n.append("fileSize",i),r.open("post","//ffilelogupload.nimo.tv/uploadStringLog",!1),r.onreadystatechange=function(){if(console.log(r.readyState),4==r.readyState&&200==r.status){var e=r.responseText;console.log(e)}},r.onload=function(e){},r.send(n)}}}]),e}();t.default=a}])},Nt51:function(e,t,i){"use strict";var r=i("QILm"),n=i.n(r),s=i("lwsE"),a=i.n(s),o=i("W8MJ"),u=i.n(o),l=i("lSNA"),h=i.n(l),d=i("+qE3"),c=i.n(d),f=(i("IDdw"),i("Kw0i")),p=i("+xEq"),v=i("KkFV"),y=i("KFtC"),m=i("cOjp"),_=i("UvjP"),S=i("q2PW"),g={autoplay:!0,controls:!0,preload:"auto",muted:!1,poster:""},T={MEDIA_ELEMENT_ATTACH:"media.element.attach",MEDIA_ELEMENT_DETACH:"media.element.detach",PLAYER_STATE_CHANGE:"player.state.change",PLAYER_READY:"player.ready",PLAYER_DISPOSE:"player.dispose",PLAYER_PLUGIN_READY:"player.plugin.ready",PLAYER_PLUGIN_DISPOSE:"player.plugin.dispose",STREAM_INFO_UPDATE:"stream.info.update",STREAM_INFO_LOCKED:"stream.info.locked",STREAM_INFO_WILL_UPDATE:"stream.rate.will.update",STREAM_STAT_INFO_UPDATE:"stream.stat.info.update",STREAM_NEW:"stream.new",STREAM_STOP:"stream.stop",STREAM_PLAYBACK_NOTIFY:"stream.playback.notify",CONFIG_UPDATE:"config.update",TECH_UPDATE:"tech.update",LOAD_START:"load.start",LOADED_DATA:"loaded.data",VIDEO_FRAME_LOADED:"video.frame.loaded",LINK_UNAVAILABLE:"link.unavailable",VIDEO_ENDED:"video.ended",MEDIA_STREAM_UPDATE:"media.stream.update",VIDEO_FIRST_START:"video.first.start",ROOM_NO_STREAM:"room.no.stream"},E=i("J4zp"),I=i.n(E),P=i("zWQp"),R=i.n(P),k=R.a.browser,L=R.a.platform,A=R.a.os,w=R.a.isWap,C=A.name;function M(){var e=window.MediaSource||window.WebKitMediaSource,t=window.SourceBuffer||window.WebKitSourceBuffer,i=e&&"function"===typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),r=!t||t.prototype&&"function"===typeof t.prototype.appendBuffer&&"function"===typeof t.prototype.remove;return!!i&&!!r}function D(){return"macOS"===C&&"Safari"===k.name}var b={supportType:{flv:!w,hls:!!w||(M()||D()),rtmp:!1},supportTech:{flash:!w,flvjs:function(){var e=window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),t=function(){var e="Microsoft Edge"===k.name,t=k.version;try{var i=t.split("."),r=I()(i,2)[1],n=void 0===r?"0":r,s=!e||parseInt(n,10)>=15048;return window.fetch&&window.ReadableStream&&s}catch(a){return!1}}()||function(){try{var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),e.responseType="moz-chunked-arraybuffer","moz-chunked-arraybuffer"===e.responseType}catch(t){return!1}}();return e&&t}(),hlsjs:M(),hls:D(),rtmp:!1},platform:L,browser:k.name},O=i("voLu"),N=i("OI0W"),F=i("H4nB"),U=function(e){var t=new c.a;e.on=function(e,i){i&&t.on(e,i)},e.off=function(e,i){i&&t.off(e,i)},e.once=function(e,i){i&&t.once(e,i)},e.emit=function(){t.emit.apply(t,arguments)},e.trigger=e.emit},B=i("MJIl"),V=i.n(B);function x(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function H(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?x(Object(i),!0).forEach((function(t){h()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):x(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var G=function(){function e(t,i){a()(this,e),this.urls={},this.map=[],this.config={},this.infos={},this.hyCdnMap={},this.parent=t,this.isLive=!0}return u()(e,[{key:"dispose",value:function(){this.urls=null,this.map=null,this.config=null,this.infos=null,this.hyCdnMap=null,this.parent=null}},{key:"getStreamInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.infos,t=arguments.length>1?arguments[1]:void 0,i=t.rate;t.cdn,t.mediaType;this.createLineInfoDictionary(e);var r=this.selectRate(i),n=this.getRecommendConfig(r);return this.setRecommendConfig(n)}},{key:"createLineInfoDictionary",value:function(e){this.infos=e;var t,i,r,n,s,a,o={},u=[];for(n=e.vCodeLines2,t=0;t<n.length;t++){var l=n[t],h={type:l.iNameCode,value:[]};for(u.push(h),s=l.vCdns,i=0;i<s.length;i++){var d=s[i],c={type:d.iCdnType,value:[]};for(this.hyCdnMap[d.iCdnType]||(this.hyCdnMap[d.iCdnType]=d.iCdnTypeHY),h.value.push(c),a=d.vCdnUrls,r=0;r<a.length;r++){var f=a[r];c.value.push(f.imediaType),o["".concat(l.iNameCode,".").concat(d.iCdnType,".").concat(f.imediaType)]=f.smediaUrl||""}}}return this.urls=o,this.map=u,{urls:o,map:u}}},{key:"selectRate",value:function(e){var t=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=this.parent.parent.const.RATE_ORDER,s=n.indexOf(e),a=function i(r,s,a){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,u=!1,l=n[r];l=void 0===l?-1:l,u=t.hasRate(l);var h=l===e;return u&&(a||!a&&!h)?l:(r+=o,o=s?-o*(1+1/Math.abs(o)):o,(r>=n.length||r<0)&&-1===l?l:i(r,s,a,o))};return a(s,i,r)}},{key:"getRecommendConfig",value:function(e){var t=this.parent.parent.feature,i=this.parent.parent.const.MEDIA_TYPE_MAP;if(-1===e)return null;for(var r=Object.keys(this.urls).filter((function(t){return parseInt(t[0],10)===e})),n=0;n<r.length;){var s=parseInt(r[n][4],10);if(t.supportType[i[s]])break;n++}if(n===r.length)return this.getRecommendConfig(this.selectRate(e,!1,!1));var a=parseInt(r[n][2],10),o={rate:e,cdn:a,hyCdn:this.hyCdnMap[a],mediaType:parseInt(r[n][4],10),streamSource:1};return o.url=this.getUrl(o),o.streamName=this.getStreamNameFromUrl(o.url),o}},{key:"setRecommendConfig",value:function(e){var t=H({url:this.getUrl(e)},e);return t.streamName=this.getStreamNameFromUrl(t.url),this.config=t,t}},{key:"setRecommendConfigByRate",value:function(e){return this.config=this.getRecommendConfig(e),this.config}},{key:"getRates",value:function(){return this.map.map((function(e){return e.type}))}},{key:"getCDNS",value:function(e){return this.map.find((function(t){return t.type===e})).value.map((function(e){return e.type}))}},{key:"switchCDN",value:function(){var e=this.config;if(!e)return null;var t=e.rate,i=e.cdn,r=e.mediaType,n=this.getCDNS(t),s=n.indexOf(i);do{(s+=1)===n.length&&(s=0),i=n[s]}while(!this.hasMediaType(t,i,r));var a=this.urls["".concat(t,".").concat(i,".").concat(r)];return H({},e,{cdn:i,hyCdn:this.hyCdnMap[i],url:a})}},{key:"getUrl",value:function(e){var t=e.rate,i=e.cdn,r=e.mediaType;return this.urls["".concat(t,".").concat(i,".").concat(r)]||""}},{key:"hasRate",value:function(e){var t=Object.keys(this.urls);return V()(t,(function(t){return parseInt(t[0],10)===e}))}},{key:"hasCDN",value:function(e,t){var i=Object.keys(this.urls);return V()(i,(function(i){return parseInt(i[0],10)===e&&parseInt(i[2],10)===t}))}},{key:"hasMediaType",value:function(e,t,i){var r=Object.keys(this.urls);return V()(r,(function(r){return parseInt(r[0],10)===e&&parseInt(r[2],10)===t&&parseInt(r[4])===i}))}},{key:"getStreamNameFromUrl",value:function(e){var t=/\/([a-zA-Z0-9]+)(\w+)?(((\/[a-zA-Z0-9]+)?\.m3u8)|(\.flv))$/g.exec(e);return t?t[1]:""}}]),e}();function Y(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function W(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Y(Object(i),!0).forEach((function(t){h()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Y(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var j=function(){function e(t,i){a()(this,e),this.parent=t,this.infos={},this.maps=[],this.isLive=!1}return u()(e,[{key:"dispose",value:function(){this.map=null,this.infos=null,this.parent=null}},{key:"getStreamInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.infos,t=arguments.length>1?arguments[1]:void 0,i=t.rate,r=void 0===i?1:i;this.saveInfos(e);var n=this.getRecommendConfig(r);return n}},{key:"saveInfos",value:function(e){this.infos=e}},{key:"getRecommendConfig",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=this.infos.vVedioList,i=this.parent.parent.const.MEDIA_TYPE_MAP_INVERT,r={url:"",rate:1,cdn:4,mediaType:10};if(t.length){var n=t.find((function(t){return t.vtype===e}))||t[0],s=n.vtype,a=n.iCdn,o=n.videourl,u=/([\w]+[^?])/.exec(o.split(".").slice(-1)[0]);r=W({},r,{rate:s,cdn:a,url:o,mediaType:u=i[u=u?u[1]:""],streamSource:1})}return r}},{key:"setRecommendConfig",value:function(e){return this.config=e,e}},{key:"setRecommendConfigByRate",value:function(e){return this.config=this.getRecommendConfig(e),this.config}},{key:"selectRate",value:function(e){var t=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=this.parent.parent.const.RATE_ORDER,s=n.indexOf(e),a=function i(r,s,a){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,u=!1,l=n[r];l=void 0===l?-1:l,u=t.hasRate(l);var h=l===e;return u&&(a||!a&&!h)?l:(r+=o,o=s?-o*(1+1/Math.abs(o)):o,(r>=n.length||r<0)&&-1===l?l:i(r,s,a,o))};return a(s,i,r)}},{key:"getRates",value:function(){var e=this.infos,t=(e=void 0===e?{}:e).vVedioList;return(void 0===t?[]:t).map((function(e){return e.vtype}))}},{key:"hasRate",value:function(e){var t=this.infos,i=(t=void 0===t?{}:t).vVedioList;return!!(void 0===i?[]:i).find((function(t){return t.vtype===e}))}},{key:"getCDNS",value:function(){return[this.config.cdn]}},{key:"switchCDN",value:function(){return this.config}}]),e}();function q(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}var K=function(){function e(t,i){a()(this,e),this.map=[],this.config={},this.lines=[],this.infos={},this.parent=t,this.isLive=!0,this.bindSDKEventListeners()}return u()(e,[{key:"dispose",value:function(){this.unbindSDKEventListeners(),this.map=null,this.lines=null,this.config=null,this.infos=null,this.parent=null}},{key:"bindSDKEventListeners",value:function(){var e=this,t=this.parent.parent,i=t.player,r=t.events,n=this.parent.config.PlayerEvents;this.onSDKMediaStreamUpdate=function(t){t&&(e.createLineInfoDictionary(t),e.parent.emit(r.MEDIA_STREAM_UPDATE,e.config))},i.on(n.MEDIA_STREAM_UPDATE,this.onSDKMediaStreamUpdate),this.onSDKMediaStreamInfoError=function(){e.parent.playBizStream()},i.on(n.MEDIA_STREAM_INFO_ERROR,this.onSDKMediaStreamInfoError),this.onSDKRoomNoStream=function(){e.parent.emit(r.ROOM_NO_STREAM)},i.on(n.ROOM_NO_STREAM,this.onSDKRoomNoStream),this.onSDKMetaData=function(t){var i=(t||{}).fps;void 0!==i&&e.updateConfig({fps:i})},i.on(n.METADATA,this.onSDKMetaData)}},{key:"unbindSDKEventListeners",value:function(){var e=this.parent.parent.player,t=this.parent.config.PlayerEvents;e.off(t.MEDIA_STREAM_UPDATE,this.onSDKMediaStreamUpdate),e.off(t.MEDIA_STREAM_INFO_ERROR,this.onSDKMediaStreamInfoError),e.off(t.ROOM_NO_STREAM,this.onSDKRoomNoStream),e.off(t.METADATA,this.onSDKMetaData)}},{key:"createLineInfoDictionary",value:function(e){this.infos=e,this.config=this._covertStreamInfo(e.currentRoomStream),this.map=e.streamGearInfo||[],this.lines=e.streamInfo||[]}},{key:"updateConfig",value:function(e){var t=this.parent.parent.events;this.config=function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?q(Object(i),!0).forEach((function(t){h()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):q(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}({},this.config,{},e),this.parent.emit(t.MEDIA_STREAM_UPDATE,this.config)}},{key:"getRates",value:function(){return this.map.map((function(e){return Number(e.sBusiGearIndex)}))}},{key:"getCDNS",value:function(){return this.lines.map((function(e){return e.iLineIndex}))}},{key:"switchCDN",value:function(){if(this.config){var e=this.config.hyCdn,t=this.getCDNS(),i=t.length;i>0&&(e=Math.floor(Math.random()*i)),this.parent.parent.player.switchLine(t[e])}}},{key:"refresh",value:function(){return this.parent.parent.player.fleshVideo()}},{key:"switchBitRate",value:function(e){var t=this.parent.parent.player,i=this.getStreamGearByRate(e)||{},r=i.sDisplayName,n=i.iBitRate;return t.switchBitRate(r,n)}},{key:"getStreamGearByRate",value:function(e){return this.map.find((function(t){return t.sBusiGearIndex==="".concat(e)}))}},{key:"_covertStreamInfo",value:function(e){var t=this.parent.parent.const,i=t.MEDIA_TYPE_MAP_INVERT,r=t.HY_CDN_MAP,n=e||{},s=n.sBusiGearIndex,a=n.line,o=n.mediaFormat,u=n.sStreamName,l=n.iBitRate,h=n.iHeight,d=n.iWidth,c=n.isSrc,f=n.backsrc,p=function(e){return"hls"===e?"m3u8":e}(o);return{rate:Number(s),cdn:r[a],hyCdn:a,mediaType:i[p],streamName:u,streamSource:2,bitrate:l,resolution:void 0!==d&&void 0!==h?"".concat(d,"x").concat(h):"",width:d,height:h,isSrc:c?1:0,backsrc:f}}}]),e}();function J(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function z(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?J(Object(i),!0).forEach((function(t){h()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):J(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var X=function(){function e(t,i){var r=this;a()(this,e),h()(this,"setStreamInfo",(function(e){r.streamInfo=e,r.parent.streamInfo=e,r.parent.trigger(r.parent.events.STREAM_INFO_UPDATE,{value:e})})),h()(this,"getStreamInfo",(function(){return r.streamInfo})),h()(this,"bindBizEventListeners",(function(){N.default.onStreamNew(r.onStreamNew).onStreamStop(r.onStreamStop).onNoticeVideoList(r.onPlaybackNotify)})),h()(this,"unbindBizEventListeners",(function(){N.default.offStreamStop(r.onStreamStop).offStreamNew(r.onStreamNew).offNoticeVideoList(r.onPlaybackNotify)})),h()(this,"onStreamNew",(function(e){r.emit(r.parent.events.STREAM_NEW,e)})),h()(this,"onStreamStop",(function(e){r.emit(r.parent.events.STREAM_STOP,e)})),h()(this,"onPlaybackNotify",(function(e){r.emit(r.parent.events.STREAM_PLAYBACK_NOTIFY,e)})),h()(this,"getPullInfo",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return F.b.getPullInfo(e).then(r.onGetPullInfo)})),h()(this,"onGetPullInfo",(function(e){var t=F.a.kMRC_OK,i=F.a.kMRC_PLAYBLACK_FINISHED,n=(e||{}).returnValue;if(r.parent)return n!==t&&n!==i&&r.parent.onStreamStop(),e})),h()(this,"getHuyaSdkToken",(function(){return r.huyaToken?Promise.resolve(r.huyaToken):F.b.getHuyaSdkToken().then((function(e){e&&(r.logger&&r.logger.log("getHuyaSdkToken(...) success",e.sHuyaToken),r.huyaToken=e.sHuyaToken)})).catch((function(){r.logger&&r.logger.warn("getHuyaSdkToken(...) fail")}))})),h()(this,"lockStreamInfo",(function(e){r.streamLockState=z({},r.streamLockState,{},e),r.parent.trigger(r.parent.events.STREAM_INFO_LOCKED,{value:r.streamLockState})})),h()(this,"getVideoRate",(function(){var e=r.parent.getVideoElement(),t=e.videoWidth,i=void 0===t?0:t,n=e.videoHeight,s=void 0===n?0:n,a=Math.max(i,s);return(a>1440?6:a>1e3?2:a>720?3:a>480?4:5)||2})),h()(this,"updateStreamInfo",(function(e){var t=r.parent.events.STREAM_INFO_UPDATE;e&&(r.createLineInfoDictionary(e),r.emit(t,{value:r.getStreamInfo()}))})),h()(this,"stashStreamInfo",(function(e,t){var i=r._getRealMemoRate(e);t=t||i;var n=r.parseStreamData(e,{rate:t});return r.setStreamInfo(n),n})),h()(this,"_getMemorizedRate",(function(){var e=r.parent.isLiveType(),t=v.b.get(e?"nimo_rate_key":"nimo_video_rate_key"),i=parseInt(t,10);return isNaN(i)?void 0:i})),h()(this,"_getRealMemoRate",(function(e){var t=(e||{}).iRecommendCode;return r._getMemorizedRate()||t})),h()(this,"_compareRate",(function(e,t){var i=r.parent.const.RATE_ORDER;return i.indexOf(t)-i.indexOf(e)})),U(this),this.parent=t,this.config=i,this.streamInfo={},this.streamLockState={},this.sdkStreamErr=!1,this.huyaToken="",this.greyGrp=function(){var e;if(["BR"].indexOf(Object(y.f)())>-1){e=O.b.apply(void 0,["nimo_player_stream_v2",1,1])}else e=(e=v.b.get("nimo_player_stream"))&&parseInt(e,10);return 0===e?0:1}(),this.logger=this.parent.logger,this.bindEventListeners(),this._createHelper()}return u()(e,[{key:"dispose",value:function(){this._getHelper().dispose(),this.unbindEventListeners(),this.huyaToken=null,this.logger=null,this.greyGrp=null,this.streamLockState=null,this.streamInfo=null,this.config=null,this.parent=null}},{key:"bindEventListeners",value:function(){var e=this,t=this.parent.events;this.onMediaStreamUpdate=function(i){e.setStreamInfo(i),e.parent.emit(t.LOAD_START,i)},this.on(t.MEDIA_STREAM_UPDATE,this.onMediaStreamUpdate),this.onSDKRoomNoStream=function(i){e.parent.emit(t.ROOM_NO_STREAM,i)},this.on(t.ROOM_NO_STREAM,this.onSDKRoomNoStream)}},{key:"unbindEventListeners",value:function(){var e=this.parent.events;this.off(e.MEDIA_STREAM_UPDATE,this.onMediaStreamUpdate),this.on(e.ROOM_NO_STREAM,this.onSDKRoomNoStream)}},{key:"loginMedia",value:function(){var e=this,t=this.parent.config.udbUserId;return this.getHuyaSdkToken().then((function(){e.parent&&e.parent.player&&e.parent.player.loginMedia({uid:t&&parseInt(t,10)||0,sToken:e.huyaToken})}))}},{key:"switchRate",value:function(e){var t=this,i=this.getStreamInfo(),r=this.streamLockState.rate,n=void 0!==r&&r;this.parent.trigger(this.parent.events.STREAM_INFO_WILL_UPDATE,z({},i,{rate:e})),n||(this.parent.off("loadeddata",this.onVideoSwitchRateFinished),this.parent.isLiveType()?(v.b.set("nimo_rate_key",e),this.useSDKStream()?this._getHelper().switchBitRate(e):this.parent.playStream(this.data,e)):(v.b.set("nimo_video_rate_key",e),this.videoSwitchCurrentTime=this.videoSwitchCurrentTime||this.parent.currentTime(),this.onVideoSwitchRateFinished=function(){t.parent.currentTime(t.videoSwitchCurrentTime||0),t.videoSwitchCurrentTime=0},this.parent.once("loadeddata",this.onVideoSwitchRateFinished),this.parent.playStream(this.data,e)))}},{key:"switchCDN",value:function(){if(this.useSDKStream)this._getHelper().switchCDN();else{var e=this._getHelper().switchCDN();e&&this.setStreamInfo(this.setRecommendConfig(e)),this.parent.load(this.streamHelper.getStreamInfo())}}},{key:"playStream",value:function(e,t,i){if(this.needReport=!!i,this.useSDKStream())this.logger.log("Load sdk stream"),this.data=e,this.parent.load({rate:t},void 0,i),this.loginMedia();else if(e){this.logger.log("Load business stream");var r=this.stashStreamInfo(e,t);this.parent.emit(this.parent.events.LOAD_START,r),this.parent.load(r,void 0,i)}}},{key:"updateStream",value:function(e,t){!this.useSDKStream()&&e&&(this.logger.log("update business stream"),this.stashStreamInfo(e,t))}},{key:"load",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.parent,n=r.player,s=r.config,a=r.subContainerId,o=r.mode,u=r.const.RATE_ORDER,l=s||{},h=l.autoplay,d=l.muted,c=l.roomId,f=l.anchorId,p=l.udbUserId,v=l.reduceDelay,y=this.parent.isLiveType(),m=i?1:0,_={autoplay:h,muted:d},S={id:a,bLive:y,pid:f,myid:p&&parseInt(p,10)||0,enableLowLatency:v,startTimeStamp:m,clickroomts:window.__clickRoomTs||0,place:o},g=e.url,T=e.mediaType,E=e.rate,I=e.cdn;if(this.useSDKStream()){var P=this.data||{},R=P.mStreamPkg;S.roomId=c,S.sBusiGearIndex=E||this._getMemorizedRate(),R&&(S.yspwlStreamPkg=R),S.gearIndexList=u}else{var k=g.replace("http:",location.protocol);S=z({},S,{url:k,type:this.parent.const.MEDIA_TYPE_MAP[T]||"flv",videoquality:E,line:I})}var L=t?"startPlayNewVideo":"startPlay";n[L](S,_)}},{key:"refresh",value:function(e){if(this.useSDKStream())return this._getHelper().refresh();var t=this.getStreamInfo();return this.parent.load(t,e)}},{key:"playBizStream",value:function(){this.sdkStreamErr||(this.sdkStreamErr=!0,this.helper&&(this.helper.dispose(),this.helper=null),this.data&&this.playStream(this.data))}},{key:"getRates",value:function(){return this._getHelper().getRates()}},{key:"getStreamInfoByRate",value:function(e,t,i){var r=this._getHelper(),n=r.selectRate(e,t,i);return r.getRecommendConfig(n)}},{key:"parseStreamData",value:function(e,t){return this.data=e,this._getHelper().getStreamInfo(e,t)}},{key:"createLineInfoDictionary",value:function(e){return this.data=e,this._getHelper().createLineInfoDictionary(e)}},{key:"setRecommendConfig",value:function(e){return this._getHelper().setRecommendConfig(e)}},{key:"useSDKStream",value:function(){return this.parent.isLiveType()&&1===this.greyGrp&&!this.sdkStreamErr}},{key:"_getHelper",value:function(){return this._createHelper()}},{key:"_createHelper",value:function(){var e=this.parent,t=this.helper,i=e.isLiveType();if(t){if(i===t.isLive)return t;t.dispose()}return this.useSDKStream()?this.helper=new K(this):this.helper=i?new G(this):new j(this),this.helper}}]),e}(),Q=function(){function e(t){a()(this,e),this.parent=t,this.plugins={},this.registPluginApi()}return u()(e,[{key:"dispose",value:function(){var e=this.plugins;for(name in e){var t=e[name];t&&t.dispose&&t.dispose()}parent.plugins=null}},{key:"registPluginApi",value:function(){var e=this;this.parent.plugins={add:function(){return e.add.apply(e,arguments)},remove:function(){return e.remove.apply(e,arguments)},get:function(){return e.get.apply(e,arguments)}}}},{key:"get",value:function(e){return this.plugins[e]||null}},{key:"add",value:function(e,t){var i=this.plugins,r=this.parent;if(i.hasOwnProperty(e))return!1;i[e]=t(r,r.config),r.trigger(r.events.PLAYER_PLUGIN_READY,{name:e,value:i[e]})}},{key:"remove",value:function(e){var t=this.plugins,i=this.parent,r=t[e];return!!r&&(r.dispose&&r.dispose(),i.trigger(i.events.PLAYER_PLUGIN_DISPOSE,{name:e,value:r}),delete t[e],!0)}}]),e}();function Z(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function $(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Z(Object(i),!0).forEach((function(t){h()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Z(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var ee,te=p.a.hyplayer_appid,ie=HYSDK.PlayerEvents,re=function(){function e(t){a()(this,e),this.initConfig(t),this.const=S.a,this.events=T,this.feature=b,this.player=function(e){var t=null;HYSDK&&(ee=new HYSDK(te));if(ee&&ee.createPlayer){var i=(e||{}).deviceId;t=ee.createPlayer(i)}return t}({deviceId:Object(y.j)()}),this.ee=new c.a,this.logger=new m.a({prefix:"HyPlayer"}),this.initConfigAPI(),this.streamHelper=new X(this,{PlayerEvents:ie}),this.plugins=new Q(this,this.config),this.statInfo={},this.initState(),this.initEventAPI(),this.initStateAPI(),this.bindStateChangeListener(),this.initVideoEventListeners(),this.bindVideoElementEventListeners(),this.bindSDKEventListeners(),this.bindGLobalEventListeners(),this.initStreamAPI(),this.initVideoJSAPI(),this.bindVideoJSListener(),this.initPlugins(),this.initReconnectAPI(),this.initStatAPI()}return u()(e,[{key:"dispose",value:function(){this.unbindStateChangeListener(),this.unbindVideoJSListener(),this.clear(),this.unbindVideoElementEventListeners(),this.unbindSDKEventListeners(),this.unbindGLobalEventListeners(),this.clearReconnectTimeout(),this.offLiveSocketMsg(),this.plugins.dispose(),this.streamHelper.dispose(),this.streamHelper=null,this.roomId=null,this.player.stop(),this.player.destroy(),this.player=null,this.ee=null,this.logger=null,this.feature=null,this.statInfo={},this.deleteSubContainer()}},{key:"convertOptions",value:function(e){return $({},g,{},e)}},{key:"initConfig",value:function(e){var t=this.convertOptions(e),i=t.mode,r=t.containerId,n=t.type,s=void 0===n?S.a.TYPE.LIVE:n,a=t.isDebug;this.config=t,this.const=S.a,this.events=T,this.type=s,this.mode=i,this.isDebug=a,this.version="0.0.1",r&&(this.containerId=r,this.container=document.getElementById(r))}},{key:"updateContainer",value:function(e){this.containerId=e,this.container=document.getElementById(e)}},{key:"createSubContainer",value:function(){var e=this.container,t=this.containerId,i=this.mode,r=this.id,n=void 0===r?"hy-".concat(t,"-").concat(i):r,s=this.subContainerId,a=void 0===s?"player-".concat(n):s,o=document.getElementById(a);e&&(o&&o.parentNode!==e?e.appendChild(o):o||((o=document.createElement("div")).id=a,o.classList.add("video-player"),e.appendChild(o)),this.subContainerId=a)}},{key:"deleteSubContainer",value:function(){var e=this.subContainerId,t=void 0===e?"":e,i=document.getElementById(t);i&&i.remove(),this.subContainerId=""}},{key:"initConfigAPI",value:function(){var e=this;this.isLiveType=function(){return e.type===S.a.TYPE.LIVE},this.onConfigChange=function(t){e.on(T.CONFIG_UPDATE,t)},this.offConfigChange=function(t){e.off(T.CONFIG_UPDATE,t)},this.switchType=function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.type,n=e.config;if(r!==t){e.updateConfig($({},n,{},i,{type:t}));var s=t===e.const.TYPE.LIVE;e.setState("isLive",s),e.setState("isPlayback",!s),e.logger.log("switch player type: ",t)}},this.updateConfig=function(t){t.containerId,t.autoplay,t.controls,t.preload,t.muted,t.plugins,t.url;var i=n()(t,["containerId","autoplay","controls","preload","muted","plugins","url"]),r=e.config,s=$({},r,{},i),a=i.mode,o=void 0===a?e.mode:a,u=i.type,l=void 0===u?e.type:u,h=i.isDebug,d=void 0===h?e.isDebug:h;e.mode=o,e.type=l,e.isDebug=d,e.player&&r.roomId&&t.roomId&&r.roomId!==t.roomId&&e.player.quitRoom(r.roomId),e.config=s,e.emit(T.CONFIG_UPDATE,{value:s})},this.updateRoomInfo=function(t){e.isLiveType()?e.updateConfig(t):e.switchType(S.a.TYPE.LIVE,t)}}},{key:"initEventAPI",value:function(){var e=this.ee;this.on=function(t,i){i&&e.on(t,i)},this.off=function(t,i){i&&e.off(t,i)},this.once=function(t,i){i&&e.once(t,i)},this.emit=function(){e.emit.apply(e,arguments)},this.trigger=this.emit}},{key:"initVideoEventListeners",value:function(){var e=this;this.onPlay$=function(){e.logger.log("Play"),e.setState("isPlaying",!0),e.setState("isPaused",!1)},this.onPlaying$=function(){e.logger.log("Playing"),e.setState("isPlaying",!0),e.setState("isPaused",!1)},this.onPause$=function(){e.logger.log("Pause"),e.setState("isPlaying",!1),e.setState("isPaused",!0)},this.onLoadstart$=function(){e.logger.log("Loadstart"),e.setState("isIdle",!1),e.setState("isLoading",!0),e.config.muted||e.initVolume()},this.onLoadedmetadata$=function(){e.logger.log("Loadedmetadata"),e.setState("metaLoaded",!0)},this.onLoadeddata$=function(){e.logger.log("Loadeddata"),e.setState("dataLoaded",!0),e.emit(e.events.LOADED_DATA)},this.onWaiting$=function(){e.logger.log("Waiting"),e.setState("isLoading",!0)},this.onCanplaythrough$=function(){e.logger.log("Canplaythrough"),e.setState("isLoading",!1)},this.onSeeking$=function(){e.logger.log("Seeking")}}},{key:"getVideoEvents",value:function(){return["loadstart","loadedmetadata","loadeddata","canplay","canplaythrough","waiting","play","playing","pause","volumechange","ratechange","progress","timeupdate","durationchange","ended","seeking","seeked","complete","emptied","error","stalled","suspend"]}},{key:"bindVideoElementEventListeners",value:function(){var e=this;this.getVideoEvents().forEach((function(t){var i="on".concat(ne(t),"$");e[i]&&e.on(t,e[i])}))}},{key:"unbindVideoElementEventListeners",value:function(){var e=this;this.getVideoEvents().forEach((function(t){var i="on".concat(ne(t),"$");e[i]&&e.off(t,e[i])})),this.off("loadeddata",this.onVideoSwitchRateFinished)}},{key:"bindSDKEventListeners",value:function(){var e=this;this.getVideoEvents().forEach((function(t){var i="bind".concat(ne(t),"Handler$");e[i]=function(){e.emit(t)},e.player.on(t,e[i])})),this.onSDKVideoPlay=function(t){t.video;e.logger.log("TECH UPDATE"),e.emit(e.events.TECH_UPDATE)},this.player.on(ie.VIDEO_PLAY,this.onSDKVideoPlay),this.onSDKPlayDownLinkInfo=function(e){},this.onSDKVideoError=function(t){var i=t.type;e.logger.log("VIDEO ERROR - ",i)},this.player.on(ie.VIDEO_ERROR,this.onSDKVideoError),this.onSDKLoadDataTimeout=function(){e.logger.log("LOAD DATA TIMEOUT"),e.reconnect();var t=e.plugins.get("metricReport");t&&t.reportLoadTimeout()},this.player.on(ie.LOAD_DATA_TIMEOUT,this.onSDKLoadDataTimeout),this.onSDKLinkUnavailable=function(){e.logger.log("LINK UNAVAILABLE"),e.reconnect();var t=e.plugins.get("metricReport");t&&t.reportLoadError(),e.emit(e.events.LINK_UNAVAILABLE)},this.player.on(ie.LINK_UNAVAILABLE,this.onSDKLinkUnavailable),this.onSDKVideoClose=function(){e.logger.log("VIDEO CLOSE"),e.state.isLive&&e.reconnect()},this.player.on(ie.VIDEO_CLOSE,this.onSDKVideoClose),this.onSDKVideoFrameJitterbuffer=function(t){var i=e.statInfo;Object.keys(t).forEach((function(e){var r=i[e];r||(r=[],i[e]=r),r.length>=1e3&&r.shift(),r.push(t[e])}))},this.player.on(ie.VIDEO_FRAME_JITTERBUFFER,this.onSDKVideoFrameJitterbuffer),this.onSDKPlayTime=function(t){var i=t||{},r=i.currentTime,n=i.duration;e.isLiveType()||!1!==e.state.isIdle||r!==n||(e.emit(e.events.VIDEO_ENDED),e.clear())},this.player.on(ie.PLAY_TIME,this.onSDKPlayTime),this.onSDKVideoFrameLoaded=function(){e.emit(e.events.VIDEO_FRAME_LOADED)},this.player.on(ie.VIDEO_FRAME_LOADED,this.onSDKVideoFrameLoaded),this.onSDKNoDataReceived=function(){e.logger.log("NO DATA RECEIVED"),e.reconnect()},this.player.on(ie.NO_DATA_RECEIVED,this.onSDKNoDataReceived)}},{key:"unbindSDKEventListeners",value:function(){var e=this;this.getVideoEvents().forEach((function(t){var i="bind".concat(ne(t),"Handler$");e.player.off(t,e[i])})),this.player.off(ie.VIDEO_PLAY,this.onSDKVideoPlay),this.player.off(ie.VIDEO_ERROR,this.onSDKVideoError),this.player.off(ie.LOAD_DATA_TIMEOUT,this.onSDKLoadDataTimeout),this.player.off(ie.LINK_UNAVAILABLE,this.onSDKLinkUnavailable),this.player.off(ie.VIDEO_CLOSE,this.onSDKVideoClose),this.player.off(ie.VIDEO_FRAME_JITTERBUFFER,this.onSDKVideoFrameJitterbuffer),this.player.off(ie.PLAY_TIME,this.onSDKPlayTime),this.player.off(ie.VIDEO_FRAME_LOADED,this.onSDKVideoFrameLoaded),this.player.off(ie.NO_DATA_RECEIVED,this.onSDKNoDataReceived)}},{key:"bindGLobalEventListeners",value:function(){var e=this;this.onMsgSendSucceed=function(t){var i=t.data;try{var r=i.tNotice,n=(r=void 0===r?{}:r).sContent,s=void 0===n?"":n;s&&e.player.sendDanmu(s)}catch(a){throw a}},f.b.on(f.a.ROOM_SEND_MSG_SUCCEED,this.onMsgSendSucceed)}},{key:"unbindGLobalEventListeners",value:function(){f.b.off(f.a.ROOM_SEND_MSG_SUCCEED,this.onMsgSendSucceed)}},{key:"initState",value:function(){this.state={isPlaying:!1,isPaused:!1,isLoading:!1,isIdle:!0,metaLoaded:!1,dataLoaded:!1,size:S.a.SIZE_MAP.NORMAL,isLive:!0,isPlayback:!1,isMini:!1}}},{key:"initStateAPI",value:function(){var e=this;this.stateChangeListenerQueue={},this.stateChangeListener=function(t){var i=t.key,r=e.stateChangeListenerQueue[i];r&&r.length&&r.forEach((function(e){e&&e(t)}))},this.setState=function(t,i){if(e.state){var r=e.state[t];if(void 0===r||r!==i){var n=T.PLAYER_STATE_CHANGE;e.state[t]=i,e.emit(n,{key:t,value:i,oldValud:r})}}},this.onStateChange=function(t,i){if(t){var r=e.stateChangeListenerQueue[t];r||(r=[],e.stateChangeListenerQueue[t]=r),r.indexOf(i)>=0||r.push(i)}},this.offStateChange=function(t,i){if(t){var r=e.stateChangeListenerQueue[t],n=void 0===r?[]:r,s=n.indexOf(i);s<0||(e.stateChangeListenerQueue[t]=n.slice(0,s).concat(n.slice(s+1)))}},this.clear=function(){e.setState("isIdle",!0),e.setState("isPlaying",!1),e.setState("isPaused",!1),e.setState("isLoading",!1),e.setState("metaLoaded",!1),e.setState("dataLoaded",!1)}}},{key:"bindStateChangeListener",value:function(){this.on(T.PLAYER_STATE_CHANGE,this.stateChangeListener)}},{key:"unbindStateChangeListener",value:function(){this.off(T.PLAYER_STATE_CHANGE,this.stateChangeListener)}},{key:"initStreamAPI",value:function(){var e=this;this.getStreamInfo=function(){return e.streamHelper.getStreamInfo()},this.setStreamInfo=function(t){e.streamHelper.setStreamInfo(t)},this.playStream=function(t,i,r){e.clearReconnectTimeout(),e.streamHelper.playStream(t,i,r)},this.updateStream=function(t){e.streamHelper.updateStream(t)},this.getRates=function(){return e.streamHelper.getRates()},this.switchRate=function(t){e.setState("isIdle",!0),e.streamHelper.switchRate(t)},this.getVideoRate=function(){return e.streamHelper.getVideoRate()},this.lockStreamInfo=function(t){e.streamHelper.lockStreamInfo(t)},this.getStreamInfoByRate=function(t,i,r){return e.streamHelper.getStreamInfoByRate(t,i,r)},this.onStreamNew=function(t){var i=t.roomLine,r=t.needReport,n=void 0!==r&&r,s=(i||{}).lRoomId;e.setState("isLive",!0),e.setState("isPlayback",!1),e.setState("streamStop",!1),(e.state.isIdle||s!==e.roomId)&&e.clear(),e.isLiveType()||e.switchType(S.a.TYPE.LIVE,{roomId:i.lRoomId,resourceId:""}),e.logger.log("stream new"),e.state.isIdle||s!==e.roomId?e.playStream(i,void 0,n):e.updateStream(i),e.roomId=s},this.onStreamStop=function(){e.setState("isLive",!1),e.setState("isPlayback",!1),e.setState("streamStop",!0),e.setState("isPaused",!1),e.clear(),e.logger.log("stream stop"),e.clearReconnectTimeout()},this.onPlaybackNotify=function(t){e.setState("isLive",!1),e.setState("isPlayback",!0),e.setState("streamStop",!1),e.clear(),e.isLiveType()&&e.switchType(S.a.TYPE.VIDEO),e.logger.log("playback notify"),e.playStream(t)},this.getPullInfo=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return e.streamHelper.getPullInfo(t)},this.onLiveSocketMsg=function(){e.streamHelper&&(e.streamHelper.bindBizEventListeners(),e.streamHelper.on(e.events.STREAM_NEW,e.onStreamNew),e.streamHelper.on(e.events.STREAM_STOP,e.onStreamStop),e.streamHelper.on(e.events.STREAM_PLAYBACK_NOTIFY,e.onPlaybackNotify))},this.offLiveSocketMsg=function(){e.streamHelper&&(e.streamHelper.unbindBizEventListeners(),e.streamHelper.off(e.events.STREAM_NEW,e.onStreamNew),e.streamHelper.off(e.events.STREAM_STOP,e.onStreamStop),e.streamHelper.off(e.events.STREAM_PLAYBACK_NOTIFY,e.onPlaybackNotify))},this.useSDKStream=function(){return e.streamHelper.useSDKStream()}}},{key:"initVideoJSAPI",value:function(){var e=this;this.load=function(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=T.VIDEO_FIRST_START;e.createSubContainer(),e.subContainerId&&document.getElementById(e.subContainerId)&&(e.emit(n),e.streamHelper.load(t,i,r))},this.getVideoElement=function(){var t=e.player,i=null;try{t&&(i=t.getEl())}catch(r){}return i},this.play=function(){var t=e.getVideoElement();if(t)if(e.state.isIdle)e.refresh();else{var i=t.play();i&&i.catch&&i.catch((function(){}))}},this.pause=function(){var t=e.getVideoElement();t&&(e.isLiveType()?e.clear():t.pause())},this.refresh=function(t){e.streamHelper.refresh(t)},this.volume=function(t){var i=e.getVideoElement();return i?(void 0!==t&&e.player.setVolume(t),i.volume):0},this.muted=function(t){var i=e.getVideoElement();return!i||(void 0!==t&&(i.muted=t),i.muted)},this.currentTime=function(t){var i=e.getVideoElement();return i?(void 0!==t&&e.player.seek(t),i.currentTime):0},this.duration=function(){var t=e.getVideoElement();return t?t.duration:0},this.buffered=function(){var t=e.getVideoElement();return t?t.buffered:[]},this.bufferedStart=function(){var t=e.getVideoElement();if(!t)return 0;var i=t.buffered,r=i.length;return r?i.start(r-1):0},this.bufferedEnd=function(){var t=e.getVideoElement();if(!t)return 0;var i=t.buffered,r=i.length;return r?i.end(r-1):0},this.getScreenshot=function(){var t=e.getVideoElement(),i=e.state.dataLoaded,r=e.isLiveType();if(!t||!i||!r)return e.config.poster||"";var n=t.videoHeight,s=t.videoWidth,a=document.createElement("canvas");return a.width=s,a.height=n,a.getContext("2d").drawImage(t,0,0,s,n),a.toDataURL()||""},this.screenshot=this.getScreenshot(),this.initVolume=function(){var t=parseFloat(v.b.get("nimo_volume_key")||"1"),i="true"===(v.b.get("nimo_mute_key")||"false");e.volume(t),e.muted(i)},this.switchBitRate=function(t,i){return e.player.switchBitRate(t,i)}}},{key:"bindVideoJSListener",value:function(){var e=this;this.isIdleStateChangeListener=function(t){if(t.value){e.logger.log("player idle");var i=e.player;i&&(e.screenshot=e.getScreenshot(),e.isLiveType()&&!e.useSDKStream()?i.stop():i.pause())}},this.onStateChange("isIdle",this.isIdleStateChangeListener)}},{key:"unbindVideoJSListener",value:function(){this.offStateChange("isIdle",this.isIdleStateChangeListener)}},{key:"initPlugins",value:function(){this.plugins.add("stat",(function(e,t){return new _.a(e,t)}))}},{key:"initReconnectAPI",value:function(){var e=this,t=0,i=0,r=!0;this.reconnect=function(){var n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e.clear(),e.state.streamStop||(r?(0===t&&n&&(t=setTimeout((function(){r=!1}),12e4)),i=setTimeout((function(){e.streamHelper.switchCDN()}),5e3)):e.onStreamStop())},this.resetReconnectState=function(){e.clearReconnectTimeout(),t=0,i=0,r=!0},this.clearReconnectTimeout=function(){clearTimeout(t),clearTimeout(i)}}},{key:"initStatAPI",value:function(){var e=this;this.getAvgDelayStatData=function(){var t=e.statInfo.playdelay,i=void 0===t?[]:t;return e.statInfo.playdelay=[],i},this.handleRecvMsg=function(t){e.player.userRecvDanmu({str:t.sContent,danmuUid:t.tUserInfo})}}}]),e}();function ne(e){return"string"!==typeof e?"":e.replace(/^\w{1}/gi,(function(e){return e.toUpperCase()}))}h()(re,"CONST",S.a);var se=re;i("xSjr"),i("9Lt2");i.d(t,"a",(function(){return S.a}));t.b=se},q2PW:function(e,t,i){"use strict";t.a={MODE:{ROOM:"room",CLIP:"clip",EMBED:"embed",INDEX:"index",LIST:"list",DASHBOARD:"dashboard"},TYPE:{LIVE:"live",VIDEO:"video"},VIDEO_STATUS:{UPDATING:0,UDPATE_FAILED:1,REVIEWING:2,REVIEW_FAILED:3,NOT_PUBLISHED:4,PUBLISHED:5,NOT_EXISTED:6},RATE_MAP:{2:"720",3:"480",4:"360",5:"240",6:"1080"},RATE_MAP_REVERT:{720:2,480:3,360:4,240:5,1080:6},RATE_ORDER:[1,6,2,3,4,5],CDN_MAP:{1:"ws",2:"tx",3:"al",4:"ms",5:"aws",6:"gg",7:"cf"},HY_CDN_MAP:{1:1,3:3,5:2,9:6,10:7},MEDIA_TYPE_MAP:{1:"flv",2:"hls",3:"rtmp",10:"mp4"},MIMETYPE_MAP:{1:"video/x-flv",2:"application/x-mpegurl",10:"video/mp4"},MEDIA_TYPE_MAP_INVERT:{flv:1,m3u8:2,rtmp:3,mp4:10},RATE_IN_DECREASE:[1,6,2,3,4,5],SIZE_MAP:{PIP:"pip",NORMAL:"normal",THEATER:"theater",FULLSCREEN:"fullscreen"}}},xSjr:function(e,t,i){}}]);